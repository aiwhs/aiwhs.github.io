<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
<style>
    .pace .pace-progress {
        background: #1E92FB; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #1E92FB;    /*上边框颜色*/
        border-left-color: #1E92FB;    /*左边框颜色*/
    }
</style>
<meta name="theme-color" content="#222">




  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-pace-theme-minimal.min.css?v=1.0.2">



















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">

<link rel="stylesheet" href="/css/main.css?v=7.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    }
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="itw">
<meta property="og:url" content="http://aiwhs.github.io/page/5/index.html">
<meta property="og:site_name" content="itw">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="itw">



  <link rel="alternate" href="/atom.xml" title="itw" type="application/atom+xml">



  
  
  <link rel="canonical" href="http://aiwhs.github.io/page/5/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  
  <title>itw</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
    <a href="https://github.com/aiwhs" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; left: 0; transform: scale(-1, 1);" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style></a>
	
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">itw</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://aiwhs.github.io/2018/09/08/网络基础管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="itw">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="itw">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/09/08/网络基础管理/" class="post-title-link" itemprop="url">网络基础管理</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-09-08 08:15:57" itemprop="dateCreated datePublished" datetime="2018-09-08T08:15:57+08:00">2018-09-08</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-12 15:32:37" itemprop="dateModified" datetime="2019-07-12T15:32:37+08:00">2019-07-12</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux运维/" itemprop="url" rel="index"><span itemprop="name">Linux运维</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h1 id="1-网卡命名"><a href="#1-网卡命名" class="headerlink" title="1. 网卡命名"></a>1. 网卡命名</h1><h3 id="1-1-传统网卡命名机制"><a href="#1-1-传统网卡命名机制" class="headerlink" title="1.1 传统网卡命名机制"></a>1.1 传统网卡命名机制</h3><blockquote>
<p>传统命名：</p>
<p>以太网eth[0,1,2,…] </p>
<p>wlan[0,1,2,…]</p>
</blockquote>
<h3 id="1-2-redhat7网卡命名机制"><a href="#1-2-redhat7网卡命名机制" class="headerlink" title="1.2 redhat7网卡命名机制"></a>1.2 redhat7网卡命名机制</h3><p><strong>systemd对网络设备的命名方式：</strong></p>
<ol>
<li>如果Firmware或BIOS为主板上集成的设备提供的索引信息可用，且可预测，则根据此索引进行命名，例如eno1</li>
<li>如果Firmware或BIOS为PCI-E扩展槽所提供的索引信息可用，且可预测，则根据此索引进行命名，例如ens1</li>
<li>如果硬件接口的物理位置信息可用，则根据此信息进行命名，例如enp2s0</li>
<li>如果用户显式启动，也可根据MAC地址进行命名，例如enx2387a1dc56</li>
<li>上述均不可用时，则使用传统命名机制</li>
</ol>
<p>上述命名机制中，有的需要biosdevname程序的参与。所以必须安装biosdevname程序且启用它。</p>
<h3 id="1-3-网络接口名称组成格式"><a href="#1-3-网络接口名称组成格式" class="headerlink" title="1.3 网络接口名称组成格式"></a>1.3 网络接口名称组成格式</h3><blockquote>
<p>基于固件、设备结构、设备类型</p>
</blockquote>
<ul>
<li>由两个字母开头标示固件<ul>
<li><input disabled type="checkbox"> 以太网网卡以 en 开头</li>
<li><input disabled type="checkbox"> 无线网卡以 wl 开头</li>
</ul>
</li>
<li>设备结构<ul>
<li><input disabled type="checkbox"> o：主板上集成的设备的设备索引号</li>
<li><input disabled type="checkbox"> s：扩展槽的索引号</li>
<li><input disabled type="checkbox"> x：基于MAC地址的命名</li>
<li><input disabled type="checkbox"> p<bus>s<slot>：基于物理位置拓扑的命名。如enp2s1，表示PCI总线上第2个总线的第1个插槽的设备索引号</slot></bus></li>
</ul>
</li>
</ul>
<h3 id="1-4-网卡设备的命名过程"><a href="#1-4-网卡设备的命名过程" class="headerlink" title="1.4 网卡设备的命名过程"></a>1.4 网卡设备的命名过程</h3><blockquote>
<ol>
<li>udev，辅助工具程序/lib/udev/rename_device会根据/usr/lib/udev/rules.d/60-net.rules中的信息设定网卡名称</li>
<li>biosdevname会根据/usr/lib/udev/rules.d/71-biosdevname.rules中的信息设定网卡名称</li>
<li>通过udev检测网络接口设备，根据/usr/lib/udev/rules.d/75-net-description中的变量信息设定网卡名称</li>
</ol>
</blockquote>
<h3 id="1-5-回归传统命名"><a href="#1-5-回归传统命名" class="headerlink" title="1.5 回归传统命名"></a>1.5 回归传统命名</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">修改网卡配置文件</span><br><span class="line">[root@wenhs-AWS ~]# cd /etc/sysconfig/network-scripts/</span><br><span class="line">[root@wenhs-AWS network-scripts]# cp ifcfg-ens33 ifcfg-eth0</span><br><span class="line">[root@wenhs-AWS network-scripts]# vim ifcfg-eth0</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=dhcp</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">NAME=eth0   //此处要把ens33改成eht0</span><br><span class="line">DEVICE=eth0 //此处要把ens33改成eht0</span><br><span class="line">ONBOOT=yes</span><br><span class="line"></span><br><span class="line">编辑/etc/default/grub配置文件，在以GRUB_CMDLINE_LINUX开头的行内rhgb的前面加上net.ifnames=0 biosdevname=0 </span><br><span class="line"></span><br><span class="line">[root@wenhs-AWS ~]# vim /etc/default/grub</span><br><span class="line">GRUB_TIMEOUT=5</span><br><span class="line">GRUB_DISTRIBUTOR=&quot;$(sed &apos;s, release .*$,,g&apos; /etc/system-release)&quot;</span><br><span class="line">GRUB_DEFAULT=saved</span><br><span class="line">GRUB_DISABLE_SUBMENU=true</span><br><span class="line">GRUB_TERMINAL_OUTPUT=&quot;console&quot;</span><br><span class="line">GRUB_CMDLINE_LINUX=&quot;crashkernel=auto rd.lvm.lv=rhel/root rd.lvm.lv=rhel/swap net.ifnames=0 biosdevname=0 rhgb quiet&quot;</span><br><span class="line">GRUB_DISABLE_RECOVERY=&quot;true&quot;</span><br><span class="line"></span><br><span class="line">为grub2生成其配置文件</span><br><span class="line">[root@wenhs-AWS ~]# grub2-mkconfig -o /etc/grub2.cfg</span><br><span class="line">Generating grub configuration file ...</span><br><span class="line">Found linux image: /boot/vmlinuz-3.10.0-957.el7.x86_64</span><br><span class="line">Found initrd image: /boot/initramfs-3.10.0-957.el7.x86_64.img</span><br><span class="line">Found linux image: /boot/vmlinuz-0-rescue-4b6c5369a989421bb4205cfad603d374</span><br><span class="line">Found initrd image: /boot/initramfs-0-rescue-4b6c5369a989421bb4205cfad603d374.img</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">重启系统</span><br><span class="line">[root@localhost ~]# reboot</span><br></pre></td></tr></table></figure>

<h1 id="2-网络管理常用命令"><a href="#2-网络管理常用命令" class="headerlink" title="2. 网络管理常用命令"></a>2. 网络管理常用命令</h1><h3 id="2-1-ifconfig"><a href="#2-1-ifconfig" class="headerlink" title="2.1 ifconfig"></a>2.1 ifconfig</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">查看当前处于活动状态的所有网络接口</span><br><span class="line">[root@wenhs-AWS ~]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 9001</span><br><span class="line">        inet 10.0.100.10  netmask 255.255.255.0  broadcast 10.0.100.255</span><br><span class="line">        inet6 fe80::869:6bff:fe89:6872  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 0a:69:6b:89:68:72  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 1187  bytes 128192 (125.1 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 1232  bytes 120424 (117.6 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 96  bytes 8952 (8.7 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 96  bytes 8952 (8.7 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line">  </span><br><span class="line">仅查看eth0网卡状态      </span><br><span class="line">[root@wenhs-AWS ~]# ifconfig eth0</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 9001</span><br><span class="line">        inet 10.0.100.10  netmask 255.255.255.0  broadcast 10.0.100.255</span><br><span class="line">        inet6 fe80::869:6bff:fe89:6872  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 0a:69:6b:89:68:72  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 1221  bytes 130744 (127.6 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 1265  bytes 126274 (123.3 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line">        </span><br><span class="line">查看所有网卡状态信息, 包括禁用和启用</span><br><span class="line">[root@wenhs-AWS ~]# ifconfig -a</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 9001</span><br><span class="line">        inet 10.0.100.10  netmask 255.255.255.0  broadcast 10.0.100.255</span><br><span class="line">        inet6 fe80::869:6bff:fe89:6872  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 0a:69:6b:89:68:72  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 1240  bytes 131850 (128.7 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 1280  bytes 128032 (125.0 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 96  bytes 8952 (8.7 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 96  bytes 8952 (8.7 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line">    </span><br><span class="line">        </span><br><span class="line">网卡配置信息含义如下:</span><br><span class="line"></span><br><span class="line">UP: 网卡处于活动状态</span><br><span class="line">BROADCAST: 支持广播</span><br><span class="line">RUNNING: 网线已接入</span><br><span class="line">MULTICAST: 支持组播</span><br><span class="line">MTU: 最大传输单元(字节),即此接口一次所能传输的最大封包</span><br><span class="line"></span><br><span class="line">inet: 显示IPv4地址行</span><br><span class="line">inet6: 显示IPv6地址行</span><br><span class="line">link/enther: 指设备硬件(MAC)地址</span><br><span class="line">txqueuelen: 传输缓存区长度大小</span><br><span class="line">RX packets: 接收的数据包</span><br><span class="line">TX packets: 发送的数据包</span><br><span class="line">errors: 总的收包的错误数量</span><br><span class="line">dropped: 由于各种原因, 导致拷贝在内存过程中被丢弃</span><br><span class="line">collisions: 网络信号冲突情况, 值不为0则可能存在网络故障</span><br></pre></td></tr></table></figure>

<h3 id="2-2-ip"><a href="#2-2-ip" class="headerlink" title="2.2 ip"></a>2.2 ip</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">语法：ip [ OPTIONS ] OBJECT &#123; COMMAND | help &#125;</span><br><span class="line">OBJECT：</span><br><span class="line">    link：网络接口属性</span><br><span class="line">    addr：协议地址</span><br><span class="line">    route：路由 </span><br><span class="line"></span><br><span class="line">查看网络接口所有地址  </span><br><span class="line">[root@wenhs-AWS ~]# ip link show</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9001 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000</span><br><span class="line">    link/ether 0a:69:6b:89:68:72 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    </span><br><span class="line">显示报文统计信息</span><br><span class="line">[root@wenhs-AWS ~]# ip -s link show</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    RX: bytes  packets  errors  dropped overrun mcast   </span><br><span class="line">    8952       96       0       0       0       0       </span><br><span class="line">    TX: bytes  packets  errors  dropped carrier collsns </span><br><span class="line">    8952       96       0       0       0       0       </span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9001 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000</span><br><span class="line">    link/ether 0a:69:6b:89:68:72 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    RX: bytes  packets  errors  dropped overrun mcast   </span><br><span class="line">    135805     1306     0       0       0       0       </span><br><span class="line">    TX: bytes  packets  errors  dropped carrier collsns </span><br><span class="line">    135567     1339     0       0       0       0       </span><br><span class="line">    </span><br><span class="line">启用或禁用网络接口ip link set DEV &#123;up|down&#125;</span><br><span class="line">[root@wenhs-AWS ~]# ip link set lo down</span><br><span class="line">[root@wenhs-AWS ~]# ip link set lo up</span><br><span class="line"></span><br><span class="line">ip addr add ADDRESS dev DEV：添加IP地址</span><br><span class="line">[root@wenhs-AWS ~]# ip addr show eth0</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9001 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 0a:69:6b:89:68:72 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.100.10/24 brd 10.0.100.255 scope global noprefixroute dynamic eth0</span><br><span class="line">       valid_lft 2924sec preferred_lft 2924sec</span><br><span class="line">    inet6 fe80::869:6bff:fe89:6872/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">[root@wenhs-AWS ~]# ip addr add 192.168.1.1/24 dev eth0</span><br><span class="line">[root@wenhs-AWS ~]# ip addr show eth0</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9001 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 0a:69:6b:89:68:72 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.100.10/24 brd 10.0.100.255 scope global noprefixroute dynamic eth0</span><br><span class="line">       valid_lft 2871sec preferred_lft 2871sec</span><br><span class="line">    inet 192.168.1.1/24 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::869:6bff:fe89:6872/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line">ip addr del ADDRESS dev DEV：删除IP地址</span><br><span class="line">[root@wenhs-AWS ~]# ip addr show eth0</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9001 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 0a:69:6b:89:68:72 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.100.10/24 brd 10.0.100.255 scope global noprefixroute dynamic eth0</span><br><span class="line">       valid_lft 2826sec preferred_lft 2826sec</span><br><span class="line">    inet 192.168.1.1/24 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::869:6bff:fe89:6872/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">[root@wenhs-AWS ~]# ip addr del 192.168.1.1/24 dev eth0</span><br><span class="line">[root@wenhs-AWS ~]# ip addr show eth0</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9001 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 0a:69:6b:89:68:72 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.100.10/24 brd 10.0.100.255 scope global noprefixroute dynamic eth0</span><br><span class="line">       valid_lft 2742sec preferred_lft 2742sec</span><br><span class="line">    inet6 fe80::869:6bff:fe89:6872/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ip addr show DEV：查看网络接口的地址</span><br><span class="line">[root@wenhs-AWS ~]# ip addr show eth0</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9001 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 0a:69:6b:89:68:72 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.100.10/24 brd 10.0.100.255 scope global noprefixroute dynamic eth0</span><br><span class="line">       valid_lft 2694sec preferred_lft 2694sec</span><br><span class="line">    inet6 fe80::869:6bff:fe89:6872/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line">ip route：routing table management 路由管理</span><br><span class="line">添加路由：ip route add TARGET via GW dev IFACE src SOURCE_IP</span><br><span class="line">    TARGET：</span><br><span class="line">        主机路由：IP</span><br><span class="line">        网络路由：NETWORK/MASK </span><br><span class="line">        </span><br><span class="line">删除路由：ip route del TARGET</span><br><span class="line">    TARGET：</span><br><span class="line">        主机路由：IP</span><br><span class="line">        网络路由：NETWORK/MASK</span><br><span class="line">                        </span><br><span class="line">查看路由：ip route show</span><br><span class="line"></span><br><span class="line">刷新路由表：ip route flush</span><br><span class="line">    [dev IFACE]</span><br><span class="line">    [via PREFIX]</span><br></pre></td></tr></table></figure>

<h3 id="2-3-route"><a href="#2-3-route" class="headerlink" title="2.3 route"></a>2.3 route</h3><p>Linux主机之间是使用IP进行通信, 假设A主机和B主机同在一个网段内且网卡都处于激活状态, 则A具备和B直接通信的能力, 但如果A主机和B主机处于两个不同的网段, 则A必须通过路由器才能和B通信, 路由器属于IT设备的基础设施, 每一个网段都应该至少有一个网关</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">查看当前路由表</span><br><span class="line">[root@wenhs-AWS ~]# route</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">default         ip-10-0-100-1.a 0.0.0.0         UG    100    0        0 eth0</span><br><span class="line">10.0.100.0      0.0.0.0         255.255.255.0   U     100    0        0 eth0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">以数字方式显示各主机或端口等相关信息</span><br><span class="line">[root@wenhs-AWS ~]# route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         10.0.100.1      0.0.0.0         UG    100    0        0 eth0</span><br><span class="line">10.0.100.0      0.0.0.0         255.255.255.0   U     100    0        0 eth0</span><br><span class="line"></span><br><span class="line">增加路由</span><br><span class="line">语法：route add [-net|-host] target [netmask Nm] [gw Gw]  [[dev] If]</span><br><span class="line"></span><br><span class="line">增加网段路由</span><br><span class="line">[root@wenhs-AWS ~]# route add -net 10.0.200.0/24 gw 10.0.100.1 dev eth0</span><br><span class="line"></span><br><span class="line">增加主机路由</span><br><span class="line">[root@wenhs-AWS ~]# route add -host 10.0.100.100 gw 10.0.100.1</span><br><span class="line"></span><br><span class="line">查看添加路由情况</span><br><span class="line">[root@wenhs-AWS ~]# route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         10.0.100.1      0.0.0.0         UG    100    0        0 eth0</span><br><span class="line">10.0.100.0      0.0.0.0         255.255.255.0   U     100    0        0 eth0</span><br><span class="line">10.0.100.100    10.0.100.1      255.255.255.255 UGH   0      0        0 eth0</span><br><span class="line">10.0.200.0      10.0.100.1      255.255.255.0   UG    0      0        0 eth0</span><br><span class="line"></span><br><span class="line">删除路由</span><br><span class="line">[root@wenhs-AWS ~]# route del -host 10.0.100.100 gw 10.0.100.1</span><br><span class="line">[root@wenhs-AWS ~]# route del -net 10.0.200.0/24</span><br><span class="line">[root@wenhs-AWS ~]# route -n</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</span><br><span class="line">0.0.0.0         10.0.100.1      0.0.0.0         UG    100    0        0 eth0</span><br><span class="line">10.0.100.0      0.0.0.0         255.255.255.0   U     100    0        0 eth0</span><br></pre></td></tr></table></figure>

<h3 id="2-4-hostname与hostnamectl"><a href="#2-4-hostname与hostnamectl" class="headerlink" title="2.4 hostname与hostnamectl"></a>2.4 hostname与hostnamectl</h3><p><strong>生产环境中必须配置主机名,同时主机名也需要遵循一定的规范</strong>, 比如:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">公有云: 地区-项目-业务-服务-节点-地址</span><br><span class="line">wh-shop-register-nginx-node1-192.168.56.13</span><br><span class="line">wh-med-pay-mysql-master01-192.168.56.11</span><br><span class="line">wh-med-pay-mysql-slave01-192.168.56.12</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hostname查看主机名</span><br><span class="line">[root@wenhs-AWS ~]# hostname</span><br><span class="line">ip-10-0-100-10.ap-northeast-1.compute.internal</span><br><span class="line"></span><br><span class="line">hostname临时修改主机名</span><br><span class="line">[root@ip-10-0-100-10 ~]# hostname wenhs-AWS</span><br><span class="line">[root@ip-10-0-100-10 ~]# bash</span><br><span class="line">[root@wenhs-AWS ~]# </span><br><span class="line">[root@wenhs-AWS ~]# cat /etc/hostname</span><br><span class="line">ip-10-0-100-10.ap-northeast-1.compute.internal</span><br><span class="line">注意：修改主机名后需要重新登录用户才会显示效果</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rhel7系统建议使用hostnamectl修改和查看主机名</span><br><span class="line">设定永久名称</span><br><span class="line">[root@wenhs-AWS ~]# hostnamectl set-hostname wenhs-AWS</span><br><span class="line">[root@wenhs-AWS ~]# cat /etc/hostname</span><br><span class="line">wenhs-aws</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看主机信息</span><br><span class="line">[root@wenhs-AWS ~]# hostnamectl</span><br><span class="line">   Static hostname: wenhs-aws</span><br><span class="line">   Pretty hostname: wenhs-AWS</span><br><span class="line">         Icon name: computer-vm</span><br><span class="line">           Chassis: vm</span><br><span class="line">        Machine ID: 61ac11bb8b404d10b1df9b6f7cb9f990</span><br><span class="line">           Boot ID: 24a44c75a1af4526be89f06e17e7446b</span><br><span class="line">    Virtualization: xen</span><br><span class="line">  Operating System: Red Hat Enterprise Linux Server 7.6 (Maipo)</span><br><span class="line">       CPE OS Name: cpe:/o:redhat:enterprise_linux:7.6:GA:server</span><br><span class="line">            Kernel: Linux 3.10.0-957.el7.x86_64</span><br><span class="line">      Architecture: x86-64</span><br></pre></td></tr></table></figure>

<blockquote>
<p>  <code>注意：</code></p>
<p>在Linux中以命令方式修改网络配置只在当前状态有效，重启后将失效。故若想使修改的配置重启后依然有效，则必须编辑配置文件进行配置的修改。</p>
</blockquote>
<h1 id="3-网络相关配置文件"><a href="#3-网络相关配置文件" class="headerlink" title="3. 网络相关配置文件"></a>3. 网络相关配置文件</h1><h3 id="3-1-网络配置文件"><a href="#3-1-网络配置文件" class="headerlink" title="3.1 网络配置文件"></a>3.1 网络配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">网络配置文件：/etc/sysconfig/network</span><br><span class="line">    NETWORKING=&#123;yes|no&#125;：设定整个系统是否启用网络功能，若设为no，则不论网卡如何设置都不能使用网络功能。</span><br><span class="line">    HOSTNAME：设置主机名</span><br></pre></td></tr></table></figure>

<h3 id="3-2-网络接口配置文件"><a href="#3-2-网络接口配置文件" class="headerlink" title="3.2 网络接口配置文件"></a>3.2 网络接口配置文件</h3><p>网络接口即网卡，其配置文件的路径是<code>/etc/sysconfig/network-scripts/ifcfg-INTERFACE_NAME</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs-AWS ~]# vim /etc/sysconfig/network-scripts/ifcfg-eth1</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">NAME=eth1</span><br><span class="line">DEVICE=eth1</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=172.16.1.2</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=172.16.1.1</span><br><span class="line">DNS1=172.16.1.1</span><br><span class="line"></span><br><span class="line">网卡配置说明</span><br><span class="line">参数                    说明</span><br><span class="line">BOOTPROTO=none          //引导协议，可选值有｛static｜none｜dhcp｜bootp｝。如果要使用静态地址，使用static或none都可以</span><br><span class="line">NM_CONTROLLED           //NM是NetworkManager的简写，NM是由RHEL研发的在RHEL6中取代network脚本来实现网络管理、配置的服务脚本</span><br><span class="line">    //可选值有&#123; yes ｜ no &#125;</span><br><span class="line">    //此项是设定此网卡是否接受NM控制。CentOS6建议设为“no”</span><br><span class="line">TYPE                    //接口类型。常见的接口类型有：Ethernet，Bridge</span><br><span class="line">UUID                    //设备的惟一标识</span><br><span class="line">HWADDR                  //硬件地址，要与硬件中的地址保持一致，可省</span><br><span class="line">IPADDR=172.16.1.2    //固定IP地址</span><br><span class="line">PREFIX=24               //子网掩码</span><br><span class="line">NETMASK=255.255.255.0   //子网掩码</span><br><span class="line">GATEWAY=172.16.1.1     //默认网关</span><br><span class="line">DNS1=172.16.1.1        //第一个DNS服务器指向</span><br><span class="line">DNS2                    //第二个DNS服务器指向</span><br><span class="line">DNS3                    //第三个DNS服务器指向</span><br><span class="line">DEVICE=eth1             //关联的设备名称，要与文件名的后半部&quot;INTERFACE_NAME&quot;保持一致  </span><br><span class="line">NAME=&quot;eth1&quot;             //连接名称</span><br><span class="line">ONBOOT=yes              //在系统引导时是否自动激活此网络接口，可选值有&#123; yes ｜ no &#125;</span><br><span class="line">DEFROUTE=yes            //将接口设定为默认路由[yes|no]</span><br><span class="line">USERCTL=&#123;yes|no&#125;        //是否允许普通用户控制此接口的启用与禁用</span><br><span class="line">PEERDNS=&#123;yes|no&#125;        //是否在BOOTPROTO为dhcp时接受由dhcp服务器指定的DNS地址，此项设为yes时获得的DNS地址将直接覆盖至/etc/resolv.conf文件中</span><br></pre></td></tr></table></figure>

<h3 id="3-3-路由配置文件"><a href="#3-3-路由配置文件" class="headerlink" title="3.3 路由配置文件"></a>3.3 路由配置文件</h3><p>路由配置文件的路径是<code>/etc/sysconfig/network-scripts/route-INTERFACE_NAME</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">添加格式一：DEST via NEXTHOP</span><br><span class="line">[root@wenhs-AWS ~]# vim /etc/sysconfig/network-scripts/route-eth0</span><br><span class="line">10.0.200.0/24 via 10.0.100.1</span><br><span class="line">                </span><br><span class="line">添加格式二：</span><br><span class="line">[root@wenhs-AWS ~]# vim /etc/sysconfig/network-scripts/route-eth0</span><br><span class="line">ADDRESS0=10.0.200.0</span><br><span class="line">NETMASK0=255.255.255.0</span><br><span class="line">GATEWAY0=10.0.100.1</span><br></pre></td></tr></table></figure>

<h3 id="3-4-DNS配置文件"><a href="#3-4-DNS配置文件" class="headerlink" title="3.4 DNS配置文件"></a>3.4 DNS配置文件</h3><p>DNS配置文件的路径是<code>/etc/resolv.conf</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs-AWS ~]# vim /etc/resolv.conf</span><br><span class="line">search ap-northeast-1.compute.internal</span><br><span class="line">nameserver 10.0.0.2</span><br><span class="line"></span><br><span class="line">nameserver DNS_IP_1</span><br><span class="line">nameserver DNS_IP_2</span><br><span class="line">nameserver DNS_IP_3</span><br></pre></td></tr></table></figure>

<h1 id="4-NetworkManager管理网络"><a href="#4-NetworkManager管理网络" class="headerlink" title="4. NetworkManager管理网络"></a>4. NetworkManager管理网络</h1><p><code>RHEL/CentOS7</code>系统默认使用<code>NetworkManager</code>来提供网络服务，这是一种动态管理网络配置的守护进程，能够让网络设备保持连接状态。<br><code>NetworkManager</code>提供的命令行和图形配置工具对网络进行设定, 设定保存的配置文件在<code>/etc/sysconfig/network-scripts</code>目录下, 工具有 <code>nmcli</code>, <code>nmtui</code>, <code>nm-connect-editor</code></p>
<p><code>device</code>物理设备, 例如 <code>ens33</code>,<code>enp2s0</code>,<code>virbr0</code>,<code>team0</code><br><code>connection</code>连接设置, 具体网络配置方案</p>
<blockquote>
<p>1.不同的网络连接配置可以应用到相同的物理设备，但物理设备同一时间只能应用其中某个网络连接<br>2.针对物理网络接口, 设定不同的网络连接, 在不同的使用环境中激活相应的网络连接，就可以实现网络配置信息的自动切换了</p>
</blockquote>
<p>使用<code>nmcli</code>命令查看设备以及连接情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br></pre></td><td class="code"><pre><span class="line">查看设备状态</span><br><span class="line">[root@wenhs-AWS ~]# nmcli device</span><br><span class="line">DEVICE  TYPE      STATE      CONNECTION  </span><br><span class="line">eth0    ethernet  connected  System eth0 </span><br><span class="line">lo      loopback  unmanaged  --        </span><br><span class="line">查看指定设备的详细状态</span><br><span class="line">[root@wenhs-AWS ~]# nmcli device show eth0</span><br><span class="line">GENERAL.DEVICE:                         eth0</span><br><span class="line">GENERAL.TYPE:                           ethernet</span><br><span class="line">GENERAL.HWADDR:                         0A:69:6B:89:68:72</span><br><span class="line">GENERAL.MTU:                            9001</span><br><span class="line">GENERAL.STATE:                          100 (connected)</span><br><span class="line">GENERAL.CONNECTION:                     System eth0</span><br><span class="line">GENERAL.CON-PATH:                       /org/freedesktop/NetworkManager/ActiveConnectio</span><br><span class="line">WIRED-PROPERTIES.CARRIER:               on</span><br><span class="line">IP4.ADDRESS[1]:                         10.0.100.10/24</span><br><span class="line">IP4.GATEWAY:                            10.0.100.1</span><br><span class="line">IP4.ROUTE[1]:                           dst = 0.0.0.0/0, nh = 10.0.100.1, mt = 100</span><br><span class="line">IP4.ROUTE[2]:                           dst = 10.0.100.0/24, nh = 0.0.0.0, mt = 100</span><br><span class="line">IP4.DNS[1]:                             10.0.0.2</span><br><span class="line">IP4.DOMAIN[1]:                          ap-northeast-1.compute.internal</span><br><span class="line">IP6.ADDRESS[1]:                         fe80::869:6bff:fe89:6872/64</span><br><span class="line">IP6.GATEWAY:                            --</span><br><span class="line">IP6.ROUTE[1]:                           dst = ff00::/8, nh = ::, mt = 256, table=255</span><br><span class="line">IP6.ROUTE[2]:                           dst = fe80::/64, nh = ::, mt = 256</span><br><span class="line">lines 1-18/18 (END)</span><br><span class="line"></span><br><span class="line">查看连接状态</span><br><span class="line">[[root@wenhs-AWS ~]# nmcli connection</span><br><span class="line">NAME         UUID                                  TYPE      DEVICE </span><br><span class="line">System eth0  5fb06bd0-0bb0-7ffb-45f1-d6edd65f3e03  ethernet  eth0</span><br><span class="line"></span><br><span class="line">查看所有活动的连接</span><br><span class="line">NAME         UUID                                  TYPE      DEVICE </span><br><span class="line">System eth0  5fb06bd0-0bb0-7ffb-45f1-d6edd65f3e03  ethernet  eth0</span><br><span class="line"></span><br><span class="line">查看指定设备连接的详细情况</span><br><span class="line">[root@wenhs-AWS ~]# nmcli connection show eth0</span><br><span class="line">Error: eth0 - no such connection profile.</span><br><span class="line">[root@wenhs-AWS ~]# nmcli connection show 5fb06bd0-0bb0-7ffb-45f1-d6edd65f3e03</span><br><span class="line">connection.id:                          System eth0</span><br><span class="line">connection.uuid:                        5fb06bd0-0bb0-7ffb-45f1-d6edd65f3e03</span><br><span class="line">connection.stable-id:                   --</span><br><span class="line">connection.type:                        802-3-ethernet</span><br><span class="line">connection.interface-name:              eth0</span><br><span class="line">connection.autoconnect:                 yes</span><br><span class="line">connection.autoconnect-priority:        0</span><br><span class="line">connection.autoconnect-retries:         -1 (default)</span><br><span class="line">connection.auth-retries:                -1</span><br><span class="line">connection.timestamp:                   1552909406</span><br><span class="line">connection.read-only:                   no</span><br><span class="line">connection.permissions:                 --</span><br><span class="line">connection.zone:                        --</span><br><span class="line">connection.master:                      --</span><br><span class="line">connection.slave-type:                  --</span><br><span class="line">connection.autoconnect-slaves:          -1 (default)</span><br><span class="line">connection.secondaries:                 --</span><br><span class="line">connection.gateway-ping-timeout:        0</span><br><span class="line">connection.metered:                     unknown</span><br><span class="line">connection.lldp:                        default</span><br><span class="line">connection.mdns:                        -1 (default)</span><br><span class="line">802-3-ethernet.port:                    --</span><br><span class="line">802-3-ethernet.speed:                   0</span><br><span class="line">802-3-ethernet.duplex:                  --</span><br><span class="line">802-3-ethernet.auto-negotiate:          no</span><br><span class="line">802-3-ethernet.mac-address:             0A:69:6B:89:68:72</span><br><span class="line">802-3-ethernet.cloned-mac-address:      --</span><br><span class="line">802-3-ethernet.generate-mac-address-mask:--</span><br><span class="line">802-3-ethernet.mac-address-blacklist:   --</span><br><span class="line">802-3-ethernet.mtu:                     auto</span><br><span class="line">802-3-ethernet.s390-subchannels:        --</span><br><span class="line">802-3-ethernet.s390-nettype:            --</span><br><span class="line">802-3-ethernet.s390-options:            --</span><br><span class="line">802-3-ethernet.wake-on-lan:             default</span><br><span class="line">802-3-ethernet.wake-on-lan-password:    --</span><br><span class="line">ipv4.method:                            auto</span><br><span class="line">ipv4.dns:                               --</span><br><span class="line">ipv4.dns-search:                        --</span><br><span class="line">ipv4.dns-options:                       &quot;&quot;</span><br><span class="line">ipv4.dns-priority:                      0</span><br><span class="line">ipv4.addresses:                         --</span><br><span class="line">ipv4.gateway:                           --</span><br><span class="line">ipv4.routes:                            --</span><br><span class="line">ipv4.route-metric:                      -1</span><br><span class="line">ipv4.route-table:                       0 (unspec)</span><br><span class="line">ipv4.ignore-auto-routes:                no</span><br><span class="line">ipv4.ignore-auto-dns:                   no</span><br><span class="line">ipv4.dhcp-client-id:                    --</span><br><span class="line">ipv4.dhcp-timeout:                      0 (default)</span><br><span class="line">ipv4.dhcp-send-hostname:                yes</span><br><span class="line">ipv4.dhcp-hostname:                     --</span><br><span class="line">ipv4.dhcp-fqdn:                         --</span><br><span class="line">ipv4.never-default:                     no</span><br><span class="line">ipv4.may-fail:                          yes</span><br><span class="line">ipv4.dad-timeout:                       -1 (default)</span><br><span class="line">ipv6.method:                            ignore</span><br><span class="line">ipv6.dns:                               --</span><br><span class="line">ipv6.dns-search:                        --</span><br><span class="line">ipv6.dns-options:                       &quot;&quot;</span><br><span class="line">ipv6.dns-priority:                      0</span><br><span class="line">ipv6.addresses:                         --</span><br><span class="line">ipv6.gateway:                           --</span><br><span class="line">ipv6.routes:                            --</span><br><span class="line">ipv6.route-metric:                      -1</span><br><span class="line">ipv6.route-table:                       0 (unspec)</span><br><span class="line">ipv6.ignore-auto-routes:                no</span><br><span class="line">ipv6.ignore-auto-dns:                   no</span><br><span class="line">ipv6.never-default:                     no</span><br><span class="line">ipv6.may-fail:                          yes</span><br><span class="line">ipv6.ip6-privacy:                       -1 (unknown)</span><br><span class="line">ipv6.addr-gen-mode:                     stable-privacy</span><br><span class="line">ipv6.dhcp-duid:                         --</span><br><span class="line">ipv6.dhcp-send-hostname:                yes</span><br><span class="line">ipv6.dhcp-hostname:                     --</span><br><span class="line">ipv6.token:                             --</span><br><span class="line">proxy.method:                           none</span><br><span class="line">proxy.browser-only:                     no</span><br><span class="line">proxy.pac-url:                          --</span><br><span class="line">proxy.pac-script:                       --</span><br><span class="line">GENERAL.NAME:                           System eth0</span><br><span class="line">GENERAL.UUID:                           5fb06bd0-0bb0-7ffb-45f1-d6edd65f3e03</span><br><span class="line">GENERAL.DEVICES:                        eth0</span><br><span class="line">GENERAL.STATE:                          activated</span><br><span class="line">GENERAL.DEFAULT:                        yes</span><br><span class="line">GENERAL.DEFAULT6:                       no</span><br><span class="line">GENERAL.SPEC-OBJECT:                    --</span><br><span class="line">GENERAL.VPN:                            no</span><br><span class="line">GENERAL.DBUS-PATH:                      /org/freedesktop/NetworkManager/ActiveConnectio</span><br><span class="line">GENERAL.CON-PATH:                       /org/freedesktop/NetworkManager/Settings/1</span><br><span class="line">GENERAL.ZONE:                           --</span><br><span class="line">GENERAL.MASTER-PATH:                    --</span><br><span class="line">IP4.ADDRESS[1]:                         10.0.100.10/24</span><br><span class="line">IP4.GATEWAY:                            10.0.100.1</span><br><span class="line">IP4.ROUTE[1]:                           dst = 0.0.0.0/0, nh = 10.0.100.1, mt = 100</span><br><span class="line">IP4.ROUTE[2]:                           dst = 10.0.100.0/24, nh = 0.0.0.0, mt = 100</span><br><span class="line">IP4.DNS[1]:                             10.0.0.2</span><br><span class="line">IP4.DOMAIN[1]:                          ap-northeast-1.compute.internal</span><br><span class="line">DHCP4.OPTION[1]:                        broadcast_address = 10.0.100.255</span><br><span class="line">DHCP4.OPTION[2]:                        dhcp_lease_time = 3600</span><br><span class="line">DHCP4.OPTION[3]:                        dhcp_message_type = 5</span><br><span class="line">DHCP4.OPTION[4]:                        dhcp_server_identifier = 10.0.100.1</span><br><span class="line">DHCP4.OPTION[5]:                        domain_name = ap-northeast-1.compute.internal</span><br><span class="line">DHCP4.OPTION[6]:                        domain_name_servers = 10.0.0.2</span><br><span class="line">DHCP4.OPTION[7]:                        expiry = 1552912159</span><br><span class="line">DHCP4.OPTION[8]:                        host_name = ip-10-0-100-10</span><br><span class="line">DHCP4.OPTION[9]:                        interface_mtu = 9001</span><br><span class="line">DHCP4.OPTION[10]:                       ip_address = 10.0.100.10</span><br><span class="line">DHCP4.OPTION[11]:                       network_number = 10.0.100.0</span><br><span class="line">DHCP4.OPTION[12]:                       next_server = 0.0.0.0</span><br><span class="line">DHCP4.OPTION[13]:                       requested_broadcast_address = 1</span><br><span class="line">DHCP4.OPTION[14]:                       requested_classless_static_routes = 1</span><br><span class="line">DHCP4.OPTION[15]:                       requested_domain_name = 1</span><br><span class="line">DHCP4.OPTION[16]:                       requested_domain_name_servers = 1</span><br><span class="line">DHCP4.OPTION[17]:                       requested_domain_search = 1</span><br><span class="line">DHCP4.OPTION[18]:                       requested_host_name = 1</span><br><span class="line">DHCP4.OPTION[19]:                       requested_interface_mtu = 1</span><br><span class="line">DHCP4.OPTION[20]:                       requested_ms_classless_static_routes = 1</span><br><span class="line">DHCP4.OPTION[21]:                       requested_nis_domain = 1</span><br><span class="line">DHCP4.OPTION[22]:                       requested_nis_servers = 1</span><br><span class="line">DHCP4.OPTION[23]:                       requested_ntp_servers = 1</span><br><span class="line">DHCP4.OPTION[24]:                       requested_rfc3442_classless_static_routes = 1</span><br><span class="line">DHCP4.OPTION[25]:                       requested_routers = 1</span><br><span class="line">DHCP4.OPTION[26]:                       requested_static_routes = 1</span><br><span class="line">DHCP4.OPTION[27]:                       requested_subnet_mask = 1</span><br><span class="line">DHCP4.OPTION[28]:                       requested_time_offset = 1</span><br><span class="line">DHCP4.OPTION[29]:                       requested_wpad = 1</span><br><span class="line">DHCP4.OPTION[30]:                       routers = 10.0.100.1</span><br><span class="line">DHCP4.OPTION[31]:                       subnet_mask = 255.255.255.0</span><br><span class="line">IP6.ADDRESS[1]:                         fe80::869:6bff:fe89:6872/64</span><br><span class="line">IP6.GATEWAY:                            --</span><br><span class="line">IP6.ROUTE[1]:                           dst = ff00::/8, nh = ::, mt = 256, table=255</span><br><span class="line">IP6.ROUTE[2]:                           dst = fe80::/64, nh = ::, mt = 256</span><br><span class="line">lines 110-132/132 (END)</span><br></pre></td></tr></table></figure>

<h1 id="5-使用原生network管理网络"><a href="#5-使用原生network管理网络" class="headerlink" title="5. 使用原生network管理网络"></a>5. 使用原生network管理网络</h1><p><code>CentOS/RHEL</code>的网络配置文件默认目录为<code>/etc/sysconfig/network-scripts</code><br>默认第一块物理网卡配置文件为<code>ifcfg-eth0</code>, 如果有第二块物理网卡, 配置文件则为<code>ifcfg-eth1</code>以此类推。 <code>注意</code>: 如果新增物理网卡没有配置文件，可选择复制系统默认的进行修改。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">设置NetworkManger开机不启动, 同时停止NetworkManger服务</span><br><span class="line">[root@wenhs-aws ~]# systemctl disable NetworkManager</span><br><span class="line">Removed symlink /etc/systemd/system/multi-user.target.wants/NetworkManager.service.</span><br><span class="line">Removed symlink /etc/systemd/system/dbus-org.freedesktop.NetworkManager.service.</span><br><span class="line">Removed symlink /etc/systemd/system/dbus-org.freedesktop.nm-dispatcher.service.</span><br><span class="line">Removed symlink /etc/systemd/system/network-online.target.wants/NetworkManager-wait-online.service.</span><br><span class="line">[root@wenhs-aws ~]# systemctl disable NetworkManager</span><br><span class="line">[root@wenhs-aws ~]# systemctl stop NetworkManager</span><br><span class="line"></span><br><span class="line">添加一块物理网卡, 然后新增网络连接配置文件</span><br><span class="line">复制配置eth0配置文件为eth1</span><br><span class="line">[root@wenhs-aws ~]# cp /etc/sysconfig/network-scripts/&#123;ifcfg-eth0,ifcfg-eth1&#125;</span><br><span class="line">[root@wenhs-aws ~]# ls /etc/sysconfig/network-scripts/</span><br><span class="line">ifcfg-eth0       ifup-bnep</span><br><span class="line">ifcfg-eth1       ifup-eth</span><br><span class="line">ifcfg-lo         ifup-ippp</span><br><span class="line">ifdown           ifup-ipv6</span><br><span class="line">ifdown-bnep      ifup-isdn</span><br><span class="line">ifdown-eth       ifup-plip</span><br><span class="line">ifdown-ippp      ifup-plusb</span><br><span class="line">ifdown-ipv6      ifup-post</span><br><span class="line">ifdown-isdn      ifup-ppp</span><br><span class="line">ifdown-post      ifup-routes</span><br><span class="line">ifdown-ppp       ifup-sit</span><br><span class="line">ifdown-routes    ifup-Team</span><br><span class="line">ifdown-sit       ifup-TeamPort</span><br><span class="line">ifdown-Team      ifup-tunnel</span><br><span class="line">ifdown-TeamPort  ifup-wireless</span><br><span class="line">ifdown-tunnel    init.ipv6-global</span><br><span class="line">ifup             network-functions</span><br><span class="line">ifup-aliases     network-functions-ipv6</span><br><span class="line">[root@wenhs-aws ~]# </span><br><span class="line"></span><br><span class="line">编辑网卡配置文件</span><br><span class="line">[root@wenhs-aws ~]# vim /etc/sysconfig/network-scripts/ifcfg-eth1</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">NAME=eth1</span><br><span class="line">DEVICE=eth1</span><br><span class="line">NM_CONTROLLED=no</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=10.0.100.100</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=10.0.100.1</span><br><span class="line">DNS1=10.0.100.1</span><br><span class="line"></span><br><span class="line">重启network网络服务加载网络并设置开机启动</span><br><span class="line">[root@wenhs-aws ~]# systemctl restart network</span><br><span class="line">[root@wenhs-aws ~]# systemctl enable network</span><br></pre></td></tr></table></figure>

<h1 id="6-网络检测工具与故障排查"><a href="#6-网络检测工具与故障排查" class="headerlink" title="6. 网络检测工具与故障排查"></a>6. 网络检测工具与故障排查</h1><h3 id="6-1-ping"><a href="#6-1-ping" class="headerlink" title="6.1 ping"></a>6.1 ping</h3><p>ping命令的目的在于测试另一台主机是否可达, 如果ping不到某台主机,就说明对方主机已经出现了问题, 但是不排除由于链路中的防火墙、ping被丢弃等原因造成ping不通的情况</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ping命令常用选项：</span><br><span class="line">    -c 指定ping的次数</span><br><span class="line">    -i 指定ping包的发送间隔</span><br><span class="line">    -w 如果ping没有回应, 则在指定超时时间后退出</span><br></pre></td></tr></table></figure>

<h3 id="6-2-host与nslookup"><a href="#6-2-host与nslookup" class="headerlink" title="6.2 host与nslookup"></a>6.2 host与nslookup</h3><p><code>host</code>/<code>nslookup</code>命令用于查询DNS记录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">host是由bind-utils这个软件包提供,没有这个命令先安装这个软件包</span><br><span class="line"></span><br><span class="line">[root@wenhs-aws ~]# host www.baidu.com</span><br><span class="line">www.baidu.com is an alias for www.a.shifen.com.</span><br><span class="line">www.a.shifen.com is an alias for www.wshifen.com.</span><br><span class="line">www.wshifen.com has address 119.63.197.139</span><br><span class="line">www.wshifen.com has address 119.63.197.151</span><br><span class="line"></span><br><span class="line">[root@wenhs-aws ~]# nslookup www.baidu.com</span><br><span class="line">Server:		10.0.0.2</span><br><span class="line">Address:	10.0.0.2#53</span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">www.baidu.com	canonical name = www.a.shifen.com.</span><br><span class="line">www.a.shifen.com	canonical name = www.wshifen.com.</span><br><span class="line">Name:	www.wshifen.com</span><br><span class="line">Address: 119.63.197.139</span><br><span class="line">Name:	www.wshifen.com</span><br><span class="line">Address: 119.63.197.151</span><br></pre></td></tr></table></figure>

<h3 id="6-3-traceroute"><a href="#6-3-traceroute" class="headerlink" title="6.3 traceroute"></a>6.3 traceroute</h3><p><code>traceroute</code>命令用于路由跟踪, 检测网络故障出现在ISP运营商或是对端服务无法响应</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs-aws ~]# yum -y install traceroute</span><br><span class="line">[root@wenhs-aws ~]# traceroute www.google.com</span><br><span class="line">traceroute to www.google.com (172.217.161.68), 30 hops max, 60 byte packets</span><br><span class="line"> 1  ec2-175-41-192-216.ap-northeast-1.compute.amazonaws.com (175.41.192.216)  19.315 ms  19.254 ms ec2-175-41-192-220.ap-northeast-1.compute.amazonaws.com (175.41.192.220)  16.067 ms</span><br><span class="line"> 2  100.66.8.80 (100.66.8.80)  20.800 ms 100.66.8.62 (100.66.8.62)  11.427 ms 100.66.8.18 (100.66.8.18)  28.192 ms</span><br><span class="line"> 3  100.66.11.40 (100.66.11.40)  15.950 ms 100.66.11.128 (100.66.11.128)  15.379 ms 100.66.10.108 (100.66.10.108)  14.116 ms</span><br><span class="line"> 4  100.66.6.47 (100.66.6.47)  11.757 ms 100.66.7.75 (100.66.7.75)  18.120 ms 100.66.7.9 (100.66.7.9)  23.942 ms</span><br><span class="line"> 5  100.66.4.253 (100.66.4.253)  11.212 ms 100.66.4.15 (100.66.4.15)  20.038 ms 100.66.4.175 (100.66.4.175)  17.110 ms</span><br><span class="line"> 6  100.65.8.161 (100.65.8.161)  0.327 ms 100.65.9.129 (100.65.9.129)  2.533 ms 100.65.10.1 (100.65.10.1)  0.318 ms</span><br><span class="line"> 7  27.0.0.73 (27.0.0.73)  1.121 ms  0.619 ms  0.568 ms</span><br><span class="line"> 8  52.95.31.73 (52.95.31.73)  0.873 ms 52.95.31.79 (52.95.31.79)  1.155 ms 52.95.31.85 (52.95.31.85)  0.867 ms</span><br><span class="line"> 9  52.95.31.58 (52.95.31.58)  1.211 ms 52.95.31.28 (52.95.31.28)  1.644 ms 52.95.31.42 (52.95.31.42)  0.721 ms</span><br><span class="line">10  100.91.149.16 (100.91.149.16)  6.774 ms 100.91.149.0 (100.91.149.0)  3.297 ms  3.278 ms</span><br><span class="line">11  100.91.3.193 (100.91.3.193)  2.101 ms 100.91.3.199 (100.91.3.199)  16.686 ms 100.91.3.197 (100.91.3.197)  2.074 ms</span><br><span class="line">12  100.91.147.35 (100.91.147.35)  1.647 ms 100.91.147.99 (100.91.147.99)  1.666 ms 100.91.147.35 (100.91.147.35)  1.590 ms</span><br><span class="line">13  52.95.30.69 (52.95.30.69)  1.678 ms 52.95.30.11 (52.95.30.11)  2.329 ms 52.95.30.27 (52.95.30.27)  1.956 ms</span><br><span class="line">14  54.239.53.247 (54.239.53.247)  1.312 ms 54.239.53.251 (54.239.53.251)  2.363 ms 54.239.53.237 (54.239.53.237)  1.701 ms</span><br><span class="line">15  72.14.220.244 (72.14.220.244)  1.465 ms  1.406 ms  1.447 ms</span><br><span class="line">16  108.170.242.193 (108.170.242.193)  3.106 ms  3.108 ms 108.170.242.161 (108.170.242.161)  1.797 ms</span><br><span class="line">17  209.85.243.1 (209.85.243.1)  2.661 ms  2.362 ms  2.388 ms</span><br><span class="line">18  nrt20s09-in-f4.1e100.net (172.217.161.68)  1.647 ms  1.688 ms  1.691 ms</span><br><span class="line">[root@wenhs-aws ~]# traceroute www.baidu.com</span><br><span class="line">traceroute to www.baidu.com (119.63.197.139), 30 hops max, 60 byte packets</span><br><span class="line"> 1  ec2-175-41-192-220.ap-northeast-1.compute.amazonaws.com (175.41.192.220)  19.912 ms ec2-175-41-192-216.ap-northeast-1.compute.amazonaws.com (175.41.192.216)  14.914 ms ec2-175-41-192-218.ap-northeast-1.compute.amazonaws.com (175.41.192.218)  21.939 ms</span><br><span class="line"> 2  100.66.8.90 (100.66.8.90)  22.108 ms 100.66.8.62 (100.66.8.62)  21.366 ms 100.66.8.118 (100.66.8.118)  13.522 ms</span><br><span class="line"> 3  100.66.10.10 (100.66.10.10)  15.786 ms 100.66.10.192 (100.66.10.192)  12.084 ms 100.66.10.230 (100.66.10.230)  13.922 ms</span><br><span class="line"> 4  100.66.6.195 (100.66.6.195)  20.764 ms 100.66.6.239 (100.66.6.239)  11.196 ms 100.66.6.195 (100.66.6.195)  20.744 ms</span><br><span class="line"> 5  100.66.4.51 (100.66.4.51)  15.529 ms 100.66.4.127 (100.66.4.127)  9.056 ms 100.66.4.145 (100.66.4.145)  6.459 ms</span><br><span class="line"> 6  100.65.9.161 (100.65.9.161)  0.336 ms 100.65.8.1 (100.65.8.1)  0.988 ms 100.65.8.129 (100.65.8.129)  0.408 ms</span><br><span class="line"> 7  27.0.0.159 (27.0.0.159)  1.532 ms 27.0.0.73 (27.0.0.73)  2.287 ms 27.0.0.159 (27.0.0.159)  2.505 ms</span><br><span class="line"> 8  52.95.31.83 (52.95.31.83)  0.961 ms  0.807 ms 52.95.31.75 (52.95.31.75)  1.576 ms</span><br><span class="line"> 9  52.95.31.68 (52.95.31.68)  1.340 ms 52.95.31.8 (52.95.31.8)  0.661 ms 52.95.31.30 (52.95.31.30)  1.618 ms</span><br><span class="line">10  52.93.73.245 (52.93.73.245)  6.652 ms 52.95.31.147 (52.95.31.147)  6.815 ms  6.718 ms</span><br><span class="line">11  54.239.53.19 (54.239.53.19)  14.539 ms 54.239.53.54 (54.239.53.54)  7.296 ms 54.239.53.46 (54.239.53.46)  7.149 ms</span><br><span class="line">12  54.239.53.90 (54.239.53.90)  6.790 ms 54.239.53.98 (54.239.53.98)  6.844 ms 54.239.53.90 (54.239.53.90)  7.629 ms</span><br><span class="line">13  210.132.124.201 (210.132.124.201)  7.064 ms  7.197 ms  7.382 ms</span><br><span class="line">14  27.86.41.109 (27.86.41.109)  8.133 ms 27.85.134.53 (27.85.134.53)  9.559 ms 27.85.228.13 (27.85.228.13)  8.928 ms</span><br><span class="line">15  27.85.196.9 (27.85.196.9)  8.221 ms 27.85.196.5 (27.85.196.5)  8.634 ms  8.597 ms</span><br><span class="line">16  27.85.199.194 (27.85.199.194)  7.574 ms 27.85.199.190 (27.85.199.190)  7.472 ms  7.462 ms</span><br><span class="line">17  118.159.224.162 (118.159.224.162)  10.214 ms  10.623 ms  10.548 ms</span><br><span class="line">18  * * *</span><br><span class="line">.....			#看地区,国内运营商大部分屏蔽了路由跟踪,所以是* * *</span><br><span class="line">30  * * *</span><br><span class="line">[root@wenhs-aws ~]#</span><br></pre></td></tr></table></figure>

<h3 id="6-4-netstat"><a href="#6-4-netstat" class="headerlink" title="6.4 netstat"></a>6.4 netstat</h3><p><code>netstat</code>用于查看网络状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">显示路由表</span><br><span class="line">[root@wenhs-aws ~]# netstat -r</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface</span><br><span class="line">default         ip-10-0-100-1.a 0.0.0.0         UG        0 0          0 eth0</span><br><span class="line">10.0.100.0      0.0.0.0         255.255.255.0   U         0 0          0 eth0</span><br><span class="line">[root@wenhs-aws ~]# </span><br><span class="line"></span><br><span class="line">以数字方式显示路由表</span><br><span class="line">[root@wenhs-aws ~]# netstat -rn</span><br><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface</span><br><span class="line">0.0.0.0         10.0.100.1      0.0.0.0         UG        0 0          0 eth0</span><br><span class="line">10.0.100.0      0.0.0.0         255.255.255.0   U         0 0          0 eth0</span><br><span class="line">[root@wenhs-aws ~]#</span><br><span class="line"></span><br><span class="line">显示建立的tcp连接</span><br><span class="line">[root@wenhs-aws ~]# netstat -t</span><br><span class="line">Active Internet connections (w/o servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State      </span><br><span class="line">tcp        0     36 ip-10-0-100-10.ap-n:ssh 113.57.246.160:36144    ESTABLISHED</span><br><span class="line">[root@wenhs-aws ~]#</span><br><span class="line"></span><br><span class="line">显示udp连接</span><br><span class="line">[root@wenhs-aws ~]# netstat -u</span><br><span class="line">Active Internet connections (w/o servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State      </span><br><span class="line">[root@wenhs-aws ~]#</span><br><span class="line"></span><br><span class="line">显示监听状态的连接</span><br><span class="line">[root@wenhs-aws ~]# netstat -l</span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State      </span><br><span class="line">tcp        0      0 0.0.0.0:ssh             0.0.0.0:*               LISTEN     </span><br><span class="line">tcp        0      0 localhost:smtp          0.0.0.0:*               LISTEN     </span><br><span class="line">tcp6       0      0 [::]:ssh                [::]:*                  LISTEN     </span><br><span class="line">tcp6       0      0 localhost:smtp          [::]:*                  LISTEN     </span><br><span class="line">udp        0      0 0.0.0.0:bootpc          0.0.0.0:*                          </span><br><span class="line">udp        0      0 localhost:323           0.0.0.0:*                          </span><br><span class="line">udp6       0      0 localhost:323           [::]:*                             </span><br><span class="line">Active UNIX domain sockets (only servers)</span><br><span class="line">Proto RefCnt Flags       Type       State         I-Node   Path</span><br><span class="line">unix  2      [ ACC ]     STREAM     LISTENING     26787    public/pickup</span><br><span class="line">unix  2      [ ACC ]     STREAM     LISTENING     8273     /run/systemd/journal/stdout</span><br><span class="line">unix  2      [ ACC ]     STREAM     LISTENING     20536    /run/dbus/system_bus_socket</span><br><span class="line">...</span><br><span class="line">unix  2      [ ACC ]     STREAM     LISTENING     26831    public/showq</span><br><span class="line">unix  2      [ ACC ]     SEQPACKET  LISTENING     16876    /run/udev/control</span><br><span class="line">[root@wenhs-aws ~]# </span><br><span class="line"></span><br><span class="line">显示监听指定的套接字的进程的进程号及进程名</span><br><span class="line">[root@wenhs-aws ~]# netstat -p</span><br><span class="line">Active Internet connections (w/o servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span><br><span class="line">tcp        0     36 ip-10-0-100-10.ap-n:ssh 113.57.246.160:36144    ESTABLISHED 4376/sshd: root@pts </span><br><span class="line">Active UNIX domain sockets (w/o servers)</span><br><span class="line">Proto RefCnt Flags       Type       State         I-Node   PID/Program name     Path</span><br><span class="line">unix  3      [ ]         DGRAM                    8254     1/systemd            /run/systemd/notify</span><br><span class="line">unix  2      [ ]         DGRAM                    8256     1/systemd            /run/systemd/cgroups-agent</span><br><span class="line">.....</span><br><span class="line">unix  3      [ ]         STREAM     CONNECTED     26832    4013/master          </span><br><span class="line">[root@wenhs-aws ~]# </span><br><span class="line"></span><br><span class="line">显示所有状态的连接</span><br><span class="line">[root@wenhs-aws ~]# netstat -a</span><br><span class="line">Active Internet connections (servers and established)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State      </span><br><span class="line">tcp        0      0 0.0.0.0:ssh             0.0.0.0:*               LISTEN     </span><br><span class="line">tcp        0      0 localhost:smtp          0.0.0.0:*               LISTEN     </span><br><span class="line">tcp        0     36 ip-10-0-100-10.ap-n:ssh 113.57.246.160:36144    ESTABLISHED</span><br><span class="line">tcp        0      0 ip-10-0-100-10.ap-n:ssh 121.143.145.177:47091   TIME_WAIT  </span><br><span class="line">tcp6       0      0 [::]:ssh                [::]:*                  LISTEN     </span><br><span class="line">tcp6       0      0 localhost:smtp          [::]:*                  LISTEN     </span><br><span class="line">udp        0      0 localhost:323           0.0.0.0:*                          </span><br><span class="line">udp6       0      0 localhost:323           [::]:*                             </span><br><span class="line">Active UNIX domain sockets (servers and established)</span><br><span class="line">Proto RefCnt Flags       Type       State         I-Node   Path</span><br><span class="line">unix  2      [ ACC ]     STREAM     LISTENING     26787    public/pickup</span><br><span class="line">unix  3      [ ]         DGRAM                    8254     /run/systemd/notify</span><br><span class="line">.........</span><br><span class="line"></span><br><span class="line">常用选项</span><br><span class="line">    -antlp</span><br><span class="line"></span><br><span class="line">[root@wenhs-aws ~]# netstat -antlp</span><br><span class="line">Active Internet connections (servers and established)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    </span><br><span class="line">tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      4056/sshd           </span><br><span class="line">tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN      4013/master         </span><br><span class="line">tcp        0     36 10.0.100.10:22          113.57.246.160:36144    ESTABLISHED 4376/sshd: root@pts </span><br><span class="line">tcp6       0      0 :::22                   :::*                    LISTEN      4056/sshd           </span><br><span class="line">tcp6       0      0 ::1:25                  :::*                    LISTEN      4013/master         </span><br><span class="line">[root@wenhs-aws ~]#</span><br></pre></td></tr></table></figure>

<h3 id="6-5-ss"><a href="#6-5-ss" class="headerlink" title="6.5 ss"></a>6.5 ss</h3><p>ss是一种网络状态查看工具，取代netstat</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">语法：ss [options] [ FILTER ]</span><br><span class="line">常用的options：</span><br><span class="line">    -t：tcp协议相关</span><br><span class="line">    -u：udp协议相关</span><br><span class="line">    -w：裸套接字相关</span><br><span class="line">    -x：unix套接字相关</span><br><span class="line">    -l：listen状态的连接</span><br><span class="line">    -a：所有</span><br><span class="line">    -n：数字格式</span><br><span class="line">    -p：相关的程序及pid</span><br><span class="line">    -e：扩展的信息</span><br><span class="line">    -m：内存用量</span><br><span class="line">    -o：显示计时器信息</span><br><span class="line">                </span><br><span class="line">常见的FILTER：</span><br><span class="line">    FILTER := [ state TCP-STATE ] [ EXPRESSION ]</span><br><span class="line">    如：ss -tan state ESTABLISHED</span><br><span class="line">                        </span><br><span class="line">常见的state：</span><br><span class="line">    tcp finite state machine：有限状态机</span><br><span class="line">        LISTEN：监听</span><br><span class="line">        ESTABLISHED：已建立的连接</span><br><span class="line">        </span><br><span class="line">    EXPRESSION：</span><br><span class="line">        dport =</span><br><span class="line">        sport =</span><br><span class="line">        示例：&apos;( dport = :ssh or sport = :ssh)&apos;，此处的ssh也即服务名可以使用其对应的端口号代替，等号两边必须有空格</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">常用组合：</span><br><span class="line">[root@wenhs-aws ~]# ss -tan</span><br><span class="line">State       Recv-Q Send-Q Local Address:Port               Peer Address:Port              </span><br><span class="line">LISTEN      0      128     *:22                  *:*                  </span><br><span class="line">LISTEN      0      100    127.0.0.1:25                  *:*                  </span><br><span class="line">ESTAB       0      168    10.0.100.10:22                 113.57.246.160:36144              </span><br><span class="line">LISTEN      0      128    :::22                 :::*                  </span><br><span class="line">LISTEN      0      100       ::1:25                 :::*                  </span><br><span class="line">[root@wenhs-aws ~]#</span><br><span class="line"></span><br><span class="line">[root@wenhs-aws ~]# ss -tanl</span><br><span class="line">State       Recv-Q Send-Q Local Address:Port               Peer Address:Port              </span><br><span class="line">LISTEN      0      128     *:22                  *:*                  </span><br><span class="line">LISTEN      0      100    127.0.0.1:25                  *:*                  </span><br><span class="line">LISTEN      0      128    :::22                 :::*                  </span><br><span class="line">LISTEN      0      100       ::1:25                 :::*                  </span><br><span class="line">[root@wenhs-aws ~]#</span><br><span class="line"></span><br><span class="line">[root@wenhs-aws ~]# ss -antlp</span><br><span class="line">State       Recv-Q Send-Q Local Address:Port               Peer Address:Port              </span><br><span class="line">LISTEN      0      128     *:22                  *:*                   users:((&quot;sshd&quot;,pid=4056,fd=3))</span><br><span class="line">LISTEN      0      100    127.0.0.1:25                  *:*                   users:((&quot;master&quot;,pid=4013,fd=13))</span><br><span class="line">LISTEN      0      128    :::22                 :::*                   users:((&quot;sshd&quot;,pid=4056,fd=4))</span><br><span class="line">LISTEN      0      100       ::1:25                 :::*                   users:((&quot;master&quot;,pid=4013,fd=14))</span><br><span class="line">[root@wenhs-aws ~]#</span><br><span class="line"></span><br><span class="line">[root@wenhs-aws ~]# ss -anu</span><br><span class="line">State       Recv-Q Send-Q Local Address:Port               Peer Address:Port              </span><br><span class="line">UNCONN      0      0      127.0.0.1:323                 *:*                  </span><br><span class="line">UNCONN      0      0         ::1:323                :::*                  </span><br><span class="line">[root@wenhs-aws ~]#</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">常见端口</span><br><span class="line">dns  53/udp</span><br><span class="line">http    80/tcp </span><br><span class="line">https   443/tcp </span><br><span class="line">ssh     22/tcp </span><br><span class="line">ftp     20,21/tcp</span><br><span class="line">mysql   3306/tcp</span><br><span class="line">rsync   873/rsync</span><br><span class="line">redis   6379/tcp</span><br></pre></td></tr></table></figure>

<h4 id="6-6-网络故障排查"><a href="#6-6-网络故障排查" class="headerlink" title="6.6 网络故障排查"></a>6.6 网络故障排查</h4><ul>
<li>网络故障分为硬件/软件故障<ul>
<li><input disabled type="checkbox"> 网卡损坏</li>
<li><input disabled type="checkbox"> 链路故障</li>
<li><input disabled type="checkbox"> 网卡驱动不兼容</li>
</ul>
</li>
<li>网络排查思路<ul>
<li><input disabled type="checkbox"> ping本地回环口, 确定本机TCP/IP协议栈是否正常</li>
<li><input disabled type="checkbox"> ping本机IP地址, 确定本地设备以及驱动是否正常</li>
<li><input disabled type="checkbox"> ping同网段主机, 确定二层网络是否正常工作</li>
<li><input disabled type="checkbox"> ping网关地址, 确定本地与网络是否正常</li>
<li><input disabled type="checkbox"> ping公网地址, 确定本地路由是否正常</li>
<li><input disabled type="checkbox"> ping公网域名, 确定DNS客户端是否正常</li>
</ul>
</li>
<li>服务故障排查思路<ul>
<li><input disabled type="checkbox"> 使用telnet检测端口是否开放</li>
<li><input disabled type="checkbox"> 检查服务端防火墙以及SElinux</li>
<li><input disabled type="checkbox"> 检查相应的权限是否配置正常</li>
<li><input disabled type="checkbox"> 检查日志是否有异常</li>
<li><input disabled type="checkbox"> 检查完毕后持续测试</li>
</ul>
</li>
</ul>
<p><strong>建议</strong>: </p>
<p>所有的排查思路都从OSI七层模型由下往上逐一进行排查(学会看日志)</p>
<h3 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h3><p><strong>1.查看系统中每个ip的连接数</strong></p>
<pre><code>[root@wenhs-aws ~]# netstat -n|awk &apos;/^tcp/{print $5}&apos; 
113.57.246.160:36144
[root@wenhs-aws ~]# netstat -n|awk &apos;/^tcp/{print $5}&apos;|wc -l
1
[root@wenhs-aws ~]#</code></pre><p><strong>2.列出下列服务使用的端口,http,ftp,ssh,telnet,mysql,dns</strong></p>
<pre><code>http    80/tcp
ftp     20,21/tcp 
ssh     22/tcp 
telnet 23/tcp
mysql   3306/tcp
dns  53/udp</code></pre><p><strong>3.在虚拟机上新增加一块网卡，并配置IP为172.16.0.10，指定网关为172.16.0.1</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/sysconfig/network-scripts/&#123;ifcfg-eth0,ifcfg-eth1&#125;</span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-eth1</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">NAME=eth1</span><br><span class="line">DEVICE=eth1</span><br><span class="line">NM_CONTROLLED=no</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=172.116.0.10</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=172.16.0.1</span><br><span class="line">DNS1=172.16.0.1</span><br><span class="line"></span><br><span class="line">或者一步,参数都记住自己写:</span><br><span class="line">cat &lt;&lt;EOF&gt;&gt;/etc/sysconfig/network-scripts/ifcfg-eth1</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">NAME=eth1</span><br><span class="line">DEVICE=eth1</span><br><span class="line">NM_CONTROLLED=no</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=172.116.0.10</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=172.16.0.1</span><br><span class="line">DNS1=172.16.0.1</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p><strong>4.详细描述dns解析过程，以访问<a href="http://www.baidu.com为例" target="_blank" rel="noopener">www.baidu.com为例</a></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">①用户主机上运行着DNS的客户端，就是我们的PC机或者手机客户端运行着DNS客户端了</span><br><span class="line">②浏览器将接收到的url中抽取出域名字段，就是访问的主机名，比如http://www.baidu.com/, 并将这个主机名传送给DNS应用的客户端</span><br><span class="line">③DNS客户机端向DNS服务器端发送一份查询报文，报文中包含着要访问的主机名字段（中间包括一些列缓存查询以及分布式DNS集群的工作）</span><br><span class="line">④该DNS客户机最终会收到一份回答报文，其中包含有该主机名对应的IP地址</span><br><span class="line">⑤一旦该浏览器收到来自DNS的IP地址，就可以向该IP地址定位的HTTP服务器发起TCP连接</span><br><span class="line"></span><br><span class="line">[root@wenhs-aws ~]# dig +trace www.baidu.com</span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.9.4-RedHat-9.9.4-73.el7_6 &lt;&lt;&gt;&gt; +trace www.baidu.com</span><br><span class="line">;; global options: +cmd</span><br><span class="line">.			518400	IN	NS	L.ROOT-SERVERS.NET.</span><br><span class="line">.			518400	IN	NS	M.ROOT-SERVERS.NET.</span><br><span class="line">.			518400	IN	NS	A.ROOT-SERVERS.NET.</span><br><span class="line">.			518400	IN	NS	B.ROOT-SERVERS.NET.</span><br><span class="line">.			518400	IN	NS	C.ROOT-SERVERS.NET.</span><br><span class="line">.			518400	IN	NS	D.ROOT-SERVERS.NET.</span><br><span class="line">.			518400	IN	NS	E.ROOT-SERVERS.NET.</span><br><span class="line">.			518400	IN	NS	F.ROOT-SERVERS.NET.</span><br><span class="line">.			518400	IN	NS	G.ROOT-SERVERS.NET.</span><br><span class="line">.			518400	IN	NS	H.ROOT-SERVERS.NET.</span><br><span class="line">.			518400	IN	NS	I.ROOT-SERVERS.NET.</span><br><span class="line">.			518400	IN	NS	J.ROOT-SERVERS.NET.</span><br><span class="line">.			518400	IN	NS	K.ROOT-SERVERS.NET.</span><br><span class="line">;; Received 811 bytes from 10.0.0.2#53(10.0.0.2) in 7 ms</span><br><span class="line"></span><br><span class="line">com.			172800	IN	NS	a.gtld-servers.net.</span><br><span class="line">com.			172800	IN	NS	e.gtld-servers.net.</span><br><span class="line">com.			172800	IN	NS	l.gtld-servers.net.</span><br><span class="line">com.			172800	IN	NS	i.gtld-servers.net.</span><br><span class="line">com.			172800	IN	NS	g.gtld-servers.net.</span><br><span class="line">com.			172800	IN	NS	f.gtld-servers.net.</span><br><span class="line">com.			172800	IN	NS	h.gtld-servers.net.</span><br><span class="line">com.			172800	IN	NS	j.gtld-servers.net.</span><br><span class="line">com.			172800	IN	NS	c.gtld-servers.net.</span><br><span class="line">com.			172800	IN	NS	m.gtld-servers.net.</span><br><span class="line">com.			172800	IN	NS	d.gtld-servers.net.</span><br><span class="line">com.			172800	IN	NS	k.gtld-servers.net.</span><br><span class="line">com.			172800	IN	NS	b.gtld-servers.net.</span><br><span class="line">com.			86400	IN	DS	30909 8 2 E2D3C916F6DEEAC73294E8268FB5885044A833FC5459588F4A9184CF C41A5766</span><br><span class="line">com.			86400	IN	RRSIG	DS 8 1 86400 20190331170000 20190318160000 16749 . XOWxpjf7b0ZVxRoIr2eJvXzd/jAAYk+wyfLk9tyUrUWsBcm2KPeZW9z4 vd1LVzZKZG68Hd/SGdbjmwB5SVS3MJ4OhLCl/GjongZqYQ1LXUMFl4JK H715rc37vUT+3qVq9vjKs/dm4560fCXcph1XzYtj0EhdPHm0pme9tjyl 7xay1HqtGD62e9odTgDapDeYg1p6OZZ8BypYagG/EOCi1tJSwmXnn5V4 YpTrKXZ36/2cGnFIQbApjkEbCB+nesjeHIIMnOdYFb1ufYtFdvhMrr1v PAL2VHqYlYqZt93kfLnynSkxA6UXWzKttvyuJqrjb/xtMKkUPD6Mit03 Kf0qRA==</span><br><span class="line">;; Received 1173 bytes from 199.9.14.201#53(B.ROOT-SERVERS.NET) in 116 ms</span><br><span class="line"></span><br><span class="line">baidu.com.		172800	IN	NS	ns2.baidu.com.</span><br><span class="line">baidu.com.		172800	IN	NS	ns3.baidu.com.</span><br><span class="line">baidu.com.		172800	IN	NS	ns4.baidu.com.</span><br><span class="line">baidu.com.		172800	IN	NS	ns1.baidu.com.</span><br><span class="line">baidu.com.		172800	IN	NS	ns7.baidu.com.</span><br><span class="line">CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 86400 IN NSEC3 1 1 0 - CK0Q1GIN43N1ARRC9OSM6QPQR81H5M9A NS SOA RRSIG DNSKEY NSEC3PARAM</span><br><span class="line">CK0POJMG874LJREF7EFN8430QVIT8BSM.com. 86400 IN RRSIG NSEC3 8 2 86400 20190324044646 20190317033646 16883 com. f2hJ7tw/8vfb5zFICChoxKLDH4OYgiVlVrPqujnu7iFMqHfv3CYGqXsw w9un0N7NZy1l99VRfxVwiihNWIaJtEkPCBDxsN9VxyqFuDS/x6H1gTwA 3xvjAWsdUbmqZdUISVLu0E1oifIx1IcIwIceGPRSUq3bxAKQUOMCdyAV 43Q=</span><br><span class="line">HPVV2B5N85O7HJJRB7690IB5UVF9O9UA.com. 86400 IN NSEC3 1 1 0 - HPVVN3Q5E5GOQP2QFE2LEM4SVB9C0SJ6 NS DS RRSIG</span><br><span class="line">HPVV2B5N85O7HJJRB7690IB5UVF9O9UA.com. 86400 IN RRSIG NSEC3 8 2 86400 20190322050600 20190315035600 16883 com. dXvLamIne0cO6SIn/6qnH+0DmAjbAvwizXxcdnYeAjxRvrt4GXIsgljC amDSCtlvtZF+4i2EEgmEF3DXIuWef8Yp0YqRXlAsxFnOk4BY4hhD1Gno hH8MVb5ZV6moGREbPu8U+qzwgXugej/EfyNt6LlURHRoOCFi55EdCqgw eZo=</span><br><span class="line">;; Received 697 bytes from 192.33.14.30#53(b.gtld-servers.net) in 37 ms</span><br><span class="line"></span><br><span class="line">www.baidu.com.		1200	IN	CNAME	www.a.shifen.com.</span><br><span class="line">a.shifen.com.		1200	IN	NS	ns5.a.shifen.com.</span><br><span class="line">a.shifen.com.		1200	IN	NS	ns3.a.shifen.com.</span><br><span class="line">a.shifen.com.		1200	IN	NS	ns4.a.shifen.com.</span><br><span class="line">a.shifen.com.		1200	IN	NS	ns2.a.shifen.com.</span><br><span class="line">a.shifen.com.		1200	IN	NS	ns1.a.shifen.com.</span><br><span class="line">;; Received 239 bytes from 14.215.178.80#53(ns4.baidu.com) in 64 ms</span><br><span class="line"></span><br><span class="line">[root@wenhs-aws ~]#</span><br></pre></td></tr></table></figure>

<p><strong>5.如何查看系统中运行了多少个进程</strong></p>
<pre><code>netstat -nap
或者
ps -aux</code></pre><p><strong>6.如何查看系统中启动了哪些端口</strong></p>
<pre><code>netstat -antlp</code></pre><p><strong>7.如何查看是否开启80端口，及查看sshd进程是否存在</strong></p>
<pre><code>通过&quot;netstat -anp&quot; 来查看哪些端口被打开
netstat -anp | grep :22</code></pre><p><strong>8.列出所有处于监听状态的tcp端口</strong></p>
<pre><code>netstat -lt</code></pre><p><strong>9.查看所有的端口信息, 包括 PID 和进程名称</strong></p>
<pre><code>netstat -antlp</code></pre>
          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    
	
	  <div>
        
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://aiwhs.github.io/2018/06/30/源码安装包管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="itw">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="itw">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/30/源码安装包管理/" class="post-title-link" itemprop="url">源码安装包管理</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-06-30 08:15:57" itemprop="dateCreated datePublished" datetime="2018-06-30T08:15:57+08:00">2018-06-30</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-12 15:51:35" itemprop="dateModified" datetime="2019-07-12T15:51:35+08:00">2019-07-12</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux运维/" itemprop="url" rel="index"><span itemprop="name">Linux运维</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h1 id="1-源码包基本概述"><a href="#1-源码包基本概述" class="headerlink" title="1. 源码包基本概述"></a>1. 源码包基本概述</h1><p>在linux环境下面安装源码包是比较常见的, 早期运维管理工作中，大部分软件都是通过源码安装的。那么安装一个源码包，是需要我们自己把源代码编译成二进制的可执行文件。</p>
<p>源码包的编译用到了linux系统里的编译器，通常源码包都是用C语言开发的，这也是因为C语言为linux上最标准的程序语言。Linux上的C语言编译器叫做gcc，利用它就可以把C语言变成可执行的二进制文件。所以如果你的机器上没有安装gcc就没有办法去编译源码。可以使用yum -y install gcc来完成安装。</p>
<h1 id="2-源码包的好处"><a href="#2-源码包的好处" class="headerlink" title="2. 源码包的好处"></a>2. 源码包的好处</h1><ul>
<li>自定义修改源代码</li>
<li>定制需要的相关功能</li>
<li>新版软件优先更新源码</li>
</ul>
<h1 id="3-源码包的获取"><a href="#3-源码包的获取" class="headerlink" title="3. 源码包的获取"></a>3. 源码包的获取</h1><p>官方网站, 可以获得最新的软件包</p>
<ul>
<li><a href="http://www.apache.org/" target="_blank" rel="noopener">Apache官方网站</a></li>
<li><a href="http://nginx.org/" target="_blank" rel="noopener">Nginx官方网站</a></li>
<li><a href="https://dev.mysql.com/downloads/mysql/5.7.html#downloads" target="_blank" rel="noopener">Mysql官方网站</a></li>
</ul>
<h1 id="4-源码包分类"><a href="#4-源码包分类" class="headerlink" title="4. 源码包分类"></a>4. 源码包分类</h1><ul>
<li>源码格式（需要编译安装）</li>
<li>二进制格式（解压后可以直接使用）</li>
</ul>
<h1 id="5-源码包的安装"><a href="#5-源码包的安装" class="headerlink" title="5. 源码包的安装"></a>5. 源码包的安装</h1><ul>
<li>编译需要编译环境，开发环境，开发库，开发工具。</li>
<li>常用的编译环境有c、c++、perl、java、python5种</li>
<li>c环境的编译器：gcc（GNU C Complier）</li>
<li>c++环境的编译器：g++</li>
<li>make：c、c++的统一项目管理工具，编译时有可能调用gcc也有可能调用g++。使用makefile文件定义make按何种次序去编译源程序文件中的源程序</li>
</ul>
<p><strong>源码安装三部曲（常见）：</strong></p>
<blockquote>
<p><strong>第一步: ./configure（定制组件）</strong></p>
<p>1.指定安装路径，例如 –prefix=/opt/nginx-1.12<br>2.启用或禁用某项功能, 例如 –enable-ssl<br>3.和其它软件关联，例如–with-pcre<br>4.检查安装环境，例如是否有编译器 gcc，是否满足软件的依赖需求<br>5.检测通过后生成Makefile文件</p>
</blockquote>
<p><strong>第二步: make</strong></p>
<blockquote>
<p>1.执行make命令进行编译, 可以使用-j指定CPU核心数进行编译<br>2.按Makefile文件进行编译, 编译成可执行二进制文件<br>3.生成各类模块和主程序</p>
</blockquote>
<p><strong>第三步: make install</strong></p>
<blockquote>
<p>1.按Makefile定义好的路径拷贝至安装目录中</p>
</blockquote>
<p>上面介绍的源码三部曲不能百分百通用于所有源码包, 也就是说源码包的安装并非存在标准安装步骤，但是大部分源码安装都是类似的步骤</p>
<p><code>建议</code>:</p>
<p>拿到源码包解压后，然后进入到目录找相关的帮助文档，通常会以INSTALL或者README为文件名</p>
<h3 id="5-1-configure脚本的功能"><a href="#5-1-configure脚本的功能" class="headerlink" title="5.1 configure脚本的功能"></a>5.1 configure脚本的功能</h3><ul>
<li>让用户选定编译特性</li>
<li>检查编译环境是否符合程序编译的基本需要</li>
</ul>
<h3 id="5-2-编译安装注意事项"><a href="#5-2-编译安装注意事项" class="headerlink" title="5.2 编译安装注意事项"></a>5.2 编译安装注意事项</h3><ul>
<li>如果安装时不是使用的默认路径，则必须要修改PATH环境变量，以能够识别此程序的二进制文件路径；<ul>
<li><input disabled type="checkbox"> 修改/etc/profile文件或在/etc/profile.d/目录建立一个以.sh为后缀的文件，在里面定义export<pre><code>PATH=$PATH:/path/to/somewhere</code></pre></li>
</ul>
</li>
<li>默认情况下，系统搜索库文件的路径只有/lib，/usr/lib<ul>
<li><input disabled type="checkbox"> 增添额外库文件搜索路径方法：<ul>
<li>在/etc/ld.so.conf.d/中创建以.conf为后缀名的文件，而后把要增添的路径直接写至此文件中。此时库文件增添的搜索路径重启后有效，若要使用增添的路径立即生效则要使用ldconfig命令</li>
<li><input disabled type="checkbox"> ldconfig：通知系统重新搜索库文件</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/etc/ld.so.conf和/etc/ls.so.conf.d/*.conf    //配置文件</span><br><span class="line">/etc/ld.so.cache            //缓存文件</span><br><span class="line">-v      //显示重新搜索库的过程</span><br><span class="line">-p      //打印出系统启动时自动加载并缓存到内存中的可用库文件名及文件路径映射关系</span><br></pre></td></tr></table></figure>

<ul>
<li>头文件：输出给系统<ul>
<li><input disabled type="checkbox"> 默认：系统在/usr/include中找头文件，若要增添头文件搜索路径，使用链接进行</li>
</ul>
</li>
<li>man文件路径：安装在–prefix指定的目录下的man目录<ul>
<li><input disabled type="checkbox"> 默认：系统在/usr/share/man中找man文件。此时因为编译安装的时候不是安装到默认路径下，如果要查找man文件则可以使用以下两种方法：<ul>
<li>man -M /path/to/man_dir command</li>
<li>在/etc/man.config文件中添加一条MANPATH</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="5-3-源码包编译实例"><a href="#5-3-源码包编译实例" class="headerlink" title="5.3 源码包编译实例"></a>5.3 源码包编译实例</h3><p><strong>下面通过编译安装nginx来深入理解源码包安装</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">1.基础环境准备</span><br><span class="line">[root@localhost ~]# yum -y install gcc gcc-c++ make wget</span><br><span class="line"></span><br><span class="line">2.下载源码包(源码包一定要上官方站点下载，其他站点不安全)</span><br><span class="line">[root@localhost ~]# cd /usr/src</span><br><span class="line">[root@localhost src]# wget http://nginx.org/download/nginx-1.12.2.tar.gz</span><br><span class="line"></span><br><span class="line">3.解压源码包,并进入相应目录</span><br><span class="line">[root@localhost src]# tar xf nginx-1.12.2.tar.gz</span><br><span class="line">[root@localhost src]# cd nginx-1.12.2</span><br><span class="line"></span><br><span class="line">4.配置相关的选项，并生成Makefile</span><br><span class="line">[root@localhost nginx-1.12.2]# ./configure --help|head</span><br><span class="line"></span><br><span class="line">  --help                             print this message</span><br><span class="line">  --prefix=PATH                      set installation prefix</span><br><span class="line">  --sbin-path=PATH                   set nginx binary pathname</span><br><span class="line">  --modules-path=PATH                set modules path</span><br><span class="line">  --conf-path=PATH                   set nginx.conf pathname</span><br><span class="line">  --error-log-path=PATH              set error log pathname</span><br><span class="line">  --pid-path=PATH                    set nginx.pid pathname</span><br><span class="line">  --lock-path=PATH                   set nginx.lock pathname</span><br><span class="line"></span><br><span class="line">后面的内容省略了，使用 ./configure --help 命令查看可以使用的选项</span><br><span class="line">一般常用的有 --prefix=PREFIX 这个选项的意思是定义软件包安装到哪里</span><br><span class="line">建议，源码包都是安装在/opt/目录下</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5.指定编译参数 </span><br><span class="line">[root@localhost nginx-1.12.2]# ./configure --prefix=/opt/nginx-1.12.2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6.验证这一步命令是否成功, 非0的都不算成功</span><br><span class="line">[root@localhost nginx-1.12.2]# echo $?</span><br><span class="line">0</span><br><span class="line"></span><br><span class="line">7.编译并安装</span><br><span class="line">[root@localhost nginx-1.12.2]# make</span><br><span class="line">[root@localhost nginx-1.12.2]# make install</span><br><span class="line">[root@localhost nginx-1.12.2]# echo $?</span><br><span class="line"></span><br><span class="line">8.建立软链接</span><br><span class="line">[root@localhost nginx-1.12.2]# ln -s /opt/nginx-1.12.2 /opt/nginx</span><br></pre></td></tr></table></figure>

<p><strong>源码编译报错信息处理</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs-AWS nginx-1.14.2]# ./configure </span><br><span class="line">checking for OS</span><br><span class="line"> + Linux 3.10.0-957.el7.x86_64 x86_64</span><br><span class="line">checking for C compiler ... not found</span><br><span class="line"></span><br><span class="line">./configure: error: C compiler cc is not found</span><br><span class="line"></span><br><span class="line">解决方案</span><br><span class="line">[root@wenhs-AWS nginx-1.14.2]# yum -y install gcc gcc-c++ make</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">./configure: error: the HTTP rewrite module requires the PCRE library.</span><br><span class="line">You can either disable the module by using --without-http_rewrite_module</span><br><span class="line">option, or install the PCRE library into the system, or build the PCRE library</span><br><span class="line">statically from the source with nginx by using --with-pcre=&lt;path&gt; option.</span><br><span class="line"></span><br><span class="line">解决方案</span><br><span class="line">[root@wenhs-AWS nginx-1.14.2]# yum install -y pcre-devel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">./configure: error: the HTTP gzip module requires the zlib library.</span><br><span class="line">You can either disable the module by using --without-http_gzip_module</span><br><span class="line">option, or install the zlib library into the system, or build the zlib library</span><br><span class="line">statically from the source with nginx by using --with-zlib=&lt;path&gt; option.</span><br><span class="line"></span><br><span class="line">解决方案:</span><br><span class="line">[root@wenhs-AWS nginx-1.14.2]# yum -y install zlib-devel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">./configure: error: SSL modules require the OpenSSL library.</span><br><span class="line">You can either do not enable the modules, or install the OpenSSL </span><br><span class="line">library into the system, or build the OpenSSL library statically</span><br><span class="line">from the source with nginx by using --with-openssl=&lt;path&gt; option.</span><br><span class="line"></span><br><span class="line">解决方案</span><br><span class="line">[root@localhost ~]# yum -y install openssl-devel</span><br></pre></td></tr></table></figure>

<h3 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h3><p><strong>1.源码安装nginx</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs-AWS ]# yum install -y pcre.devel</span><br><span class="line">[root@wenhs-AWS ]#wget http://nginx.org/download/nginx-1.14.2.tar.gz</span><br><span class="line">[root@wenhs-AWS ]#tar xf nginx-1.14.2.tar.gz</span><br><span class="line">[root@wenhs-AWS ]#cd nginx-1.14.2</span><br><span class="line">[root@wenhs-AWS nginx-1.14.2]#./configure --prefix=/usr/local/nginx --with-pcre</span><br><span class="line">发现上面三次报错,以免文章过长,这里就不写了</span><br><span class="line">另外,第一次编译的时候,没有指定--with-pcre,报make:No rule to make target `build&apos;, needed by `default&apos;.  Stop.的错误,但是make已经安装,于是乎删掉重新编译,加上--with-pcre,一遍成功</span><br><span class="line">[root@wenhs-AWS nginx-1.14.2]#make &amp;&amp; make install</span><br><span class="line">[root@wenhs-AWS nginx-1.14.2]#/usr/local/nginx/sbin/nginx</span><br><span class="line">[root@wenhs-AWS nginx-1.14.2]#ss -antl</span><br><span class="line">State      Recv-Q Send-Q Local Address:Port               Peer Address:Port              </span><br><span class="line">LISTEN     0      128         *:80                      *:*                  </span><br><span class="line">LISTEN     0      128         *:22                      *:*                  </span><br><span class="line">LISTEN     0      100    127.0.0.1:25                      *:*                  </span><br><span class="line">LISTEN     0      128        :::22                     :::*                  </span><br><span class="line">LISTEN     0      100       ::1:25                     :::*</span><br><span class="line">[root@wenhs-AWS nginx-1.14.2]#curl http://103.4.11.215</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><strong>2.源码安装apache</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">免得端口占用,上题影响这题结果,先把nginx关闭。</span><br><span class="line">[root@wenhs-AWS ~]# /usr/local/nginx/sbin/nginx -s stop</span><br><span class="line">[root@wenhs-AWS ~]# ss -antl</span><br><span class="line">State       Recv-Q Send-Q Local Address:Port               Peer Address:Port              </span><br><span class="line">LISTEN      0      128              *:22                           *:*                  </span><br><span class="line">LISTEN      0      100      127.0.0.1:25                           *:*                  </span><br><span class="line">LISTEN      0      128             :::22                          :::*                  </span><br><span class="line">LISTEN      0      100            ::1:25                          :::*                  </span><br><span class="line">[root@wenhs-AWS ~]#</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs-AWS ]#wget https://www-us.apache.org/dist/httpd/httpd-2.4.38.tar.gz</span><br><span class="line">[root@wenhs-AWS ]#wget https://www-us.apache.org/dist/apr/apr-1.6.5.tar.gz</span><br><span class="line">[root@wenhs-AWS ]#wget https://www-us.apache.org/dist/apr/apr-util-1.6.1.tar.gz</span><br><span class="line">[root@wenhs-AWS ~]# tar xf httpd-2.4.38.tar.gz </span><br><span class="line">[root@wenhs-AWS ~]# tar xf apr-1.6.5.tar.gz </span><br><span class="line">[root@wenhs-AWS ~]# tar xf apr-util-1.6.1.tar.gz </span><br><span class="line">[root@wenhs-AWS ~]# ls</span><br><span class="line">anaconda-ks.cfg   apr-util-1.6.1.tar.gz                     nginx-1.14.2</span><br><span class="line">apr-1.6.5         httpd-2.4.38                              nginx-1.14.2.tar.gz</span><br><span class="line">apr-1.6.5.tar.gz  httpd-2.4.38.tar.gz                       original-ks.cfg</span><br><span class="line">apr-util-1.6.1    mysql-5.7.25-1.el7.x86_64.rpm-bundle.tar</span><br><span class="line">[root@wenhs-AWS ~]# cd apr-1.6.5/</span><br><span class="line">[root@wenhs-AWS apr-1.6.5]# ls</span><br><span class="line">apr-config.in  buildconf         dso         libapr.rc     NOTICE         support</span><br><span class="line">apr.dep        build.conf        emacs-mode  LICENSE       NWGNUmakefile  tables</span><br><span class="line">apr.dsp        build-outputs.mk  encoding    locks         passwd         test</span><br><span class="line">apr.dsw        CHANGES           file_io     Makefile.in   poll           threadproc</span><br><span class="line">apr.mak        CMakeLists.txt    helpers     Makefile.win  random         time</span><br><span class="line">apr.pc.in      config.layout     include     memory        README         tools</span><br><span class="line">apr.spec       configure         libapr.dep  misc          README.cmake   user</span><br><span class="line">atomic         configure.in      libapr.dsp  mmap          shmem</span><br><span class="line">build          docs              libapr.mak  network_io    strings</span><br><span class="line">[root@wenhs-AWS apr-1.6.5]# ./configure --prefix=/usr/local/apr/</span><br><span class="line">checking build system type... x86_64-pc-linux-gnu</span><br><span class="line">checking host system type... x86_64-pc-linux-gnu</span><br><span class="line">checking target system type... x86_64-pc-linux-gnu</span><br><span class="line">Configuring APR library</span><br><span class="line">Platform: x86_64-pc-linux-gnu</span><br><span class="line">checking for working mkdir -p... yes</span><br><span class="line">APR Version: 1.6.5</span><br><span class="line">checking for chosen layout... apr</span><br><span class="line">......</span><br><span class="line">configure: creating ./config.status</span><br><span class="line">config.status: creating Makefile</span><br><span class="line">config.status: WARNING:  &apos;Makefile.in&apos; seems to ignore the --datarootdir setting</span><br><span class="line">config.status: creating include/apr.h</span><br><span class="line">config.status: creating build/apr_rules.mk</span><br><span class="line">config.status: creating build/pkg/pkginfo</span><br><span class="line">config.status: creating apr-1-config</span><br><span class="line">config.status: creating apr.pc</span><br><span class="line">config.status: creating test/Makefile</span><br><span class="line">config.status: creating test/internal/Makefile</span><br><span class="line">config.status: creating include/arch/unix/apr_private.h</span><br><span class="line">config.status: executing libtool commands</span><br><span class="line">rm: cannot remove &apos;libtoolT&apos;: No such file or directory</span><br><span class="line">config.status: executing default commands</span><br><span class="line">[root@wenhs-AWS apr-1.6.5]# echo $?							#由于不清楚到底有没有报错,查询一下是否运行成功</span><br><span class="line">0															#成功了</span><br><span class="line">[root@wenhs-AWS apr-1.6.5]# make</span><br><span class="line">......</span><br><span class="line">usr/local/apr//build-1,&apos; &lt; build/apr_rules.mk &gt; build/apr_rules.out</span><br><span class="line">make[1]: Leaving directory `/root/apr-1.6.5&apos;</span><br><span class="line">[root@wenhs-AWS apr-1.6.5]# echo $?</span><br><span class="line">0</span><br><span class="line">[root@wenhs-AWS apr-1.6.5]# make install</span><br><span class="line">make[1]: Entering directory `/root/apr-1.6.5&apos;</span><br><span class="line">make[1]: Nothing to be done for `local-all&apos;.</span><br><span class="line">make[1]: Leaving directory `/root/apr-1.6.5&apos;</span><br><span class="line">...</span><br><span class="line">/usr/bin/install -c -m 644 /root/apr-1.6.5/build/find_apr.m4 /usr/local/apr//build-1</span><br><span class="line">/usr/bin/install -c -m 755 apr-config.out /usr/local/apr//bin/apr-1-config</span><br><span class="line">[root@wenhs-AWS apr-1.6.5]# echo $?</span><br><span class="line">0</span><br><span class="line">[root@wenhs-AWS ~]# cd ../apr-util-1.6.1/</span><br><span class="line">[root@wenhs-AWS apr-util-1.6.1]#  ./configure --prefix=/usr/local/apr-util/ --with-apr=/usr/local/apr/</span><br><span class="line">checking build system type... x86_64-pc-linux-gnu</span><br><span class="line">checking host system type... x86_64-pc-linux-gnu</span><br><span class="line">checking target system type... x86_64-pc-linux-gnu</span><br><span class="line">......</span><br><span class="line">config.status: creating test/Makefile</span><br><span class="line">config.status: creating include/private/apu_config.h</span><br><span class="line">config.status: executing default commands</span><br><span class="line">[root@wenhs-AWS apr-util-1.6.1]# echo $?</span><br><span class="line">0</span><br><span class="line">[root@wenhs-AWS apr-util-1.6.1]# make</span><br><span class="line">make[1]: Entering directory `/root/apr-util-1.6.1&apos;</span><br><span class="line">.......</span><br><span class="line">#include &lt;expat.h&gt;</span><br><span class="line">                   ^</span><br><span class="line">compilation terminated.</span><br><span class="line">make[1]: *** [xml/apr_xml.lo] Error 1</span><br><span class="line">make[1]: Leaving directory `/root/apr-util-1.6.1&apos;</span><br><span class="line">make: *** [all-recursive] Error 1</span><br><span class="line">[root@wenhs-AWS apr-util-1.6.1]# yum install -y expat-devel</span><br><span class="line">[root@wenhs-AWS apr-util-1.6.1]# make</span><br><span class="line">make[1]: Entering directory `/root/apr-util-1.6.1&apos;</span><br><span class="line">.......</span><br><span class="line">sed &apos;s,^\(location=\).*$,\1installed,&apos; &lt; apu-1-config &gt; apu-config.out</span><br><span class="line">make[1]: Leaving directory `/root/apr-util-1.6.1&apos;</span><br><span class="line">[root@wenhs-AWS apr-util-1.6.1]# echo $?</span><br><span class="line">0</span><br><span class="line">[root@wenhs-AWS apr-util-1.6.1]# make install</span><br><span class="line">make[1]: Entering directory `/root/apr-util-1.6.1&apos;</span><br><span class="line">make[1]: Nothing to be done for `local-all&apos;.</span><br><span class="line">make[1]: Leaving directory `/root/apr-util-1.6.1&apos;</span><br><span class="line">....</span><br><span class="line">/usr/bin/install -c -m 644 aprutil.exp /usr/local/apr-util//lib</span><br><span class="line">/usr/bin/install -c -m 755 apu-config.out /usr/local/apr-util//bin/apu-1-config</span><br><span class="line">[root@wenhs-AWS apr-util-1.6.1]# echo $?</span><br><span class="line">0</span><br><span class="line">[root@wenhs-AWS apr-util-1.6.1]# cd ../httpd-2.4.38/</span><br><span class="line">[root@wenhs-AWS httpd-2.4.38]# ./configure --prefix=/usr/local/apache --with-apr=/usr/local/apr/ --with-apr-util=/usr/local/apr-util</span><br><span class="line">checking for chosen layout... Apache</span><br><span class="line">checking for working mkdir -p... yes</span><br><span class="line">......</span><br><span class="line">    Server Version: 2.4.38</span><br><span class="line">    Install prefix: /usr/local/apache</span><br><span class="line">    C compiler:     gcc -std=gnu99</span><br><span class="line">    CFLAGS:          -g -O2 -pthread  </span><br><span class="line">    CPPFLAGS:        -DLINUX -D_REENTRANT -D_GNU_SOURCE  </span><br><span class="line">    LDFLAGS:           </span><br><span class="line">    LIBS:             </span><br><span class="line">    C preprocessor: gcc -E</span><br><span class="line">    </span><br><span class="line">[root@wenhs-AWS httpd-2.4.38]# echo $?</span><br><span class="line">0</span><br><span class="line">[root@wenhs-AWS httpd-2.4.38]# make</span><br><span class="line">.....</span><br><span class="line">collect2: error: ld returned 1 exit status</span><br><span class="line">make[2]: *** [htpasswd] Error 1</span><br><span class="line">make[2]: Leaving directory `/root/httpd-2.4.38/support&apos;</span><br><span class="line">make[1]: *** [all-recursive] Error 1</span><br><span class="line">make[1]: Leaving directory `/root/httpd-2.4.38/support&apos;</span><br><span class="line">make: *** [all-recursive] Error 1</span><br><span class="line">[root@wenhs-AWS httpd-2.4.38]# yum install -y libxml2-devel</span><br><span class="line">安装后重新编译还是失败,好像要重新安装apr-util</span><br><span class="line">[root@wenhs-AWS httpd-2.4.38]# rm -rf /usr/local/apr-util</span><br><span class="line">[root@wenhs-AWS ~]# rm -rf apr-util-1.6.1</span><br><span class="line">[root@wenhs-AWS ~]# tar xf apr-util-1.6.1.tar.gz </span><br><span class="line">[root@wenhs-AWS ~]# cd apr-util-1.6.1/</span><br><span class="line">[root@wenhs-AWS apr-util-1.6.1]#  ./configure --prefix=/usr/local/apr-util/ --with-apr=/usr/local/apr/</span><br><span class="line">[root@wenhs-AWS apr-util-1.6.1]# make &amp;&amp; make install</span><br><span class="line">一切顺利,安装过一次</span><br><span class="line">[root@wenhs-AWS apr-util-1.6.1]# cd ../httpd-2.4.38/</span><br><span class="line">[root@wenhs-AWS httpd-2.4.38]# make</span><br><span class="line">.....</span><br><span class="line">make[4]: Leaving directory `/root/httpd-2.4.38/modules/mappers&apos;</span><br><span class="line">make[3]: Leaving directory `/root/httpd-2.4.38/modules/mappers&apos;</span><br><span class="line">make[2]: Leaving directory `/root/httpd-2.4.38/modules&apos;</span><br><span class="line">make[2]: Entering directory `/root/httpd-2.4.38/support&apos;</span><br><span class="line">make[2]: Leaving directory `/root/httpd-2.4.38/support&apos;</span><br><span class="line"></span><br><span class="line">make[1]: Leaving directory `/root/httpd-2.4.38&apos;</span><br><span class="line">[root@wenhs-AWS httpd-2.4.38]# echo $?</span><br><span class="line">0</span><br><span class="line">[root@wenhs-AWS httpd-2.4.38]#make install</span><br><span class="line">......</span><br><span class="line">mkdir /usr/local/apache/man/man8</span><br><span class="line">mkdir /usr/local/apache/manual</span><br><span class="line">make[1]: Leaving directory `/root/httpd-2.4.38&apos;</span><br><span class="line">[root@wenhs-AWS httpd-2.4.38]# echo $?</span><br><span class="line">0</span><br><span class="line">[root@wenhs-AWS httpd-2.4.38]# mkdir /usr/include/apache</span><br><span class="line">[root@wenhs-AWS httpd-2.4.38]# ln -s /usr/local/apache/include/* /usr/include/apache</span><br><span class="line">[root@wenhs-AWS httpd-2.4.38]# service httpd start </span><br><span class="line">Usage: /etc/init.d/httpd [-D name] [-d directory] [-f file]</span><br><span class="line">                         [-C &quot;directive&quot;] [-c &quot;directive&quot;]</span><br><span class="line">                         [-k start|restart|graceful|graceful-stop|stop]</span><br><span class="line">                         [-v] [-V] [-h] [-l] [-L] [-t] [-T] [-S] [-X]</span><br><span class="line">Options:</span><br><span class="line">  -D name            : define a name for use in &lt;IfDefine name&gt; directives</span><br><span class="line">  -d directory       : specify an alternate initial ServerRoot</span><br><span class="line">  -f file            : specify an alternate ServerConfigFile</span><br><span class="line">  -C &quot;directive&quot;     : process directive before reading config files</span><br><span class="line">  -c &quot;directive&quot;     : process directive after reading config files</span><br><span class="line">  -e level           : show startup errors of level (see LogLevel)</span><br><span class="line">  -E file            : log startup errors to file</span><br><span class="line">  -v                 : show version number</span><br><span class="line">  -V                 : show compile settings</span><br><span class="line">  -h                 : list available command line options (this page)</span><br><span class="line">  -l                 : list compiled in modules</span><br><span class="line">  -L                 : list available configuration directives</span><br><span class="line">  -t -D DUMP_VHOSTS  : show parsed vhost settings</span><br><span class="line">  -t -D DUMP_RUN_CFG : show parsed run settings</span><br><span class="line">  -S                 : a synonym for -t -D DUMP_VHOSTS -D DUMP_RUN_CFG</span><br><span class="line">  -t -D DUMP_MODULES : show all loaded modules </span><br><span class="line">  -M                 : a synonym for -t -D DUMP_MODULES</span><br><span class="line">  -t -D DUMP_INCLUDES: show all included configuration files</span><br><span class="line">  -t                 : run syntax check for config files</span><br><span class="line">  -T                 : start without DocumentRoot(s) check</span><br><span class="line">  -X                 : debug mode (only one worker, do not detach)</span><br><span class="line">[root@wenhs-AWS httpd-2.4.38]# service httpd -k start </span><br><span class="line">AH00558: httpd: Could not reliably determine the server&apos;s fully qualified domain name, using fe80::869:6bff:fe89:6872. Set the &apos;ServerName&apos; directive globally to suppress this message</span><br><span class="line">[root@wenhs-AWS httpd-2.4.38]# ervice httpd -T</span><br><span class="line">-bash: ervice: command not found</span><br><span class="line">[root@wenhs-AWS httpd-2.4.38]# service httpd -T</span><br><span class="line">AH00558: httpd: Could not reliably determine the server&apos;s fully qualified domain name, using fe80::869:6bff:fe89:6872. Set the &apos;ServerName&apos; directive globally to suppress this message</span><br><span class="line">httpd (pid 12017) already running</span><br><span class="line">[root@wenhs-AWS httpd-2.4.38]# netstat -antp|grep 80</span><br><span class="line">tcp6       0      0 :::80                   :::*                    LISTEN      12017/httpd         </span><br><span class="line">[root@wenhs-AWS httpd-2.4.38]# curl http://3.112.59.94          #避免浪费资源,晚上亚马逊云主机会关机,所以再开机公网IP会变,今天IP是下面这个</span><br><span class="line">&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/zangjiaoshou/article/details/80523540" target="_blank" rel="noopener">关于为什么监听到只有ipv6地址问题,可以看这个,但是访问ipv4地址还是可以访问到的</a><br>本题只是让我们学会如何源码安装apache服务,过多的设置以后回学,在这里就不修改了<br><a href="https://segmentfault.com/a/1190000015612597" target="_blank" rel="noopener">另外,本题排版不是很好,点击这个,跳转到一位大神的,个人感觉十分详细</a></p>
<p><strong>3.源码安装PHP</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs-AWS ~]# wget http://jp2.php.net/distributions/php-7.3.3.tar.bz2</span><br><span class="line">--2019-03-14 01:43:38--  http://jp2.php.net/distributions/php-7.3.3.tar.bz2</span><br><span class="line">Resolving jp2.php.net (jp2.php.net)... 49.212.134.217</span><br><span class="line">Connecting to jp2.php.net (jp2.php.net)|49.212.134.217|:80... connected.</span><br><span class="line">HTTP request sent, awaiting response... 200 OK</span><br><span class="line">Length: 14813435 (14M) [application/octet-stream]</span><br><span class="line">Saving to: ‘php-7.3.3.tar.bz2’</span><br><span class="line"></span><br><span class="line">100%[=============================================&gt;] 14,813,435  20.0MB/s   in 0.7s   </span><br><span class="line"></span><br><span class="line">2019-03-14 01:43:39 (20.0 MB/s) - ‘php-7.3.3.tar.bz2’ saved [14813435/14813435]</span><br><span class="line"></span><br><span class="line">[root@wenhs-AWS ~]# ll</span><br><span class="line">total 541696</span><br><span class="line">-rw-------.  1 root root      7329 Oct 17 12:27 anaconda-ks.cfg</span><br><span class="line">drwxr-xr-x. 28 1001 1001      4096 Mar 13 10:35 apr-1.6.5</span><br><span class="line">-rw-r--r--.  1 root root   1073556 Sep 14 04:07 apr-1.6.5.tar.gz</span><br><span class="line">drwxr-xr-x. 21 1001 1001      4096 Mar 13 11:09 apr-util-1.6.1</span><br><span class="line">-rw-r--r--.  1 root root    554301 Oct 22  2017 apr-util-1.6.1.tar.gz</span><br><span class="line">drwxr-sr-x. 12 root   40      4096 Mar 13 11:11 httpd-2.4.38</span><br><span class="line">-rw-r--r--.  1 root root   9187294 Jan 21 15:03 httpd-2.4.38.tar.gz</span><br><span class="line">-rw-r--r--.  1 root root 528015360 Dec 24 05:44 mysql-5.7.25-1.el7.x86_64.rpm-bundle.tar</span><br><span class="line">drwxr-xr-x.  9 1001 1001       186 Mar 13 10:05 nginx-1.14.2</span><br><span class="line">-rw-r--r--.  1 root root   1015384 Dec  4 14:58 nginx-1.14.2.tar.gz</span><br><span class="line">-rw-------.  1 root root      6664 Oct 17 12:27 original-ks.cfg</span><br><span class="line">-rw-r--r--.  1 root root  14813435 Mar  5 14:30 php-7.3.3.tar.bz2</span><br><span class="line">[root@wenhs-AWS ~]# tar xf php-7.3.3.tar.bz2 </span><br><span class="line">tar (child): lbzip2: Cannot exec: No such file or directory</span><br><span class="line">tar (child): Error is not recoverable: exiting now</span><br><span class="line">tar: Child returned status 2</span><br><span class="line">tar: Error is not recoverable: exiting now</span><br><span class="line">[root@wenhs-AWS ~]# yum -y install bzip2</span><br><span class="line">[root@wenhs-AWS ~]# tar xf php-7.3.3.tar.bz2</span><br><span class="line">[root@wenhs-AWS ~]# cd php-7.3.3/</span><br><span class="line">[root@wenhs-AWS php-7.3.3]# ./configure --prefix=/usr/local/php --with-apxs2=/usr/local/apache/bin/apxs --with-libxml2=/usr/include/libxml2</span><br><span class="line">configure: WARNING: unrecognized options: --with-libxml2</span><br><span class="line">checking for grep that handles long lines and -e... /usr/bin/grep</span><br><span class="line">.......</span><br><span class="line">config.status: creating main/php_config.h</span><br><span class="line">config.status: executing default commands</span><br><span class="line">configure: WARNING: unrecognized options: --with-libxml2</span><br><span class="line">[root@wenhs-AWS php-7.3.3]# echo $?</span><br><span class="line">0</span><br><span class="line">[root@wenhs-AWS php-7.3.3]# make</span><br><span class="line">.......</span><br><span class="line">make: *** [ext/fileinfo/libmagic/apprentice.lo] Error 1		#这是因为系统的内存不足1G造成的,然后需要加上 --disable-fileinfo,然重新编译即可；</span><br><span class="line">[root@wenhs-AWS php-7.3.3]# ./configure --prefix=/usr/local/php --with-apxs2=/usr/local/apache/bin/apxs --with-libxml2=/usr/include/libxml2 --disable-fileinfo</span><br><span class="line">[root@wenhs-AWS php-7.3.3]# make</span><br><span class="line">.......</span><br><span class="line">Don&apos;t forget to run &apos;make test&apos;.</span><br><span class="line"></span><br><span class="line">[root@wenhs-AWS php-7.3.3]# echo $?</span><br><span class="line">0</span><br><span class="line">[root@wenhs-AWS php-7.3.3]# make install</span><br><span class="line">......</span><br><span class="line">Wrote PEAR system config file at: /usr/local/php/etc/pear.conf</span><br><span class="line">You may want to add: /usr/local/php/lib/php to your php.ini include_path</span><br><span class="line">/root/php-7.3.3/build/shtool install -c ext/phar/phar.phar /usr/local/php/bin</span><br><span class="line">ln -s -f phar.phar /usr/local/php/bin/phar</span><br><span class="line">Installing PDO headers:           /usr/local/php/include/php/ext/pdo/</span><br><span class="line">[root@wenhs-AWS php-7.3.3]# echo $?</span><br><span class="line">0</span><br><span class="line">到这里就安装完成了</span><br></pre></td></tr></table></figure>

<p><strong>拓展,把PHP和apache结合</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs-AWS php-7.3.3]# vim /usr/local/apache/conf/httpd.conf</span><br><span class="line"></span><br><span class="line">#加载这个模块</span><br><span class="line">LoadModule php7_module 	modules/libphp7.so</span><br><span class="line">#让apache解析PHP代码</span><br><span class="line">AddHandler php7-script .php</span><br><span class="line">#让apache解析html里的PHP代码</span><br><span class="line">AddType application/x-httpd-php .html</span><br><span class="line"></span><br><span class="line">[root@wenhs-AWS php-7.3.3]# vim /usr/local/apache/htdocs/info.php</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">phpinfo();</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">[root@wenhs-AWS php-7.3.3]# ls /usr/local/php/</span><br><span class="line">bin  etc  include  lib  php  var</span><br><span class="line">[root@wenhs-AWS php-7.3.3]# mkdir /usr/bin/php</span><br><span class="line">[root@wenhs-AWS php-7.3.3]# ln -s /usr/local/php/bin/* /usr/bin/php/</span><br><span class="line">[root@wenhs-AWS php-7.3.3]# mkdir /usr/lib/php</span><br><span class="line">[root@wenhs-AWS php-7.3.3]# ln -s /usr/local/php/lib/ /usr/lib/php/</span><br><span class="line">[root@wenhs-AWS php-7.3.3]# service httpd -k stop</span><br><span class="line">[root@wenhs-AWS php-7.3.3]# service httpd -k start				#用restart回显没有,不直观</span><br><span class="line">httpd (pid 26025) already running</span><br></pre></td></tr></table></figure>

<p><img src="../../img/php.jpg" alt="源码1"></p>
<p>源码安装<a href="https://github.com/itwhs/zabbix" target="_blank" rel="noopener">脚本</a></p>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    
	
	  <div>
        
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://aiwhs.github.io/2018/06/24/yum工具使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="itw">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="itw">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/24/yum工具使用/" class="post-title-link" itemprop="url">yum工具使用</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-06-24 08:15:57" itemprop="dateCreated datePublished" datetime="2018-06-24T08:15:57+08:00">2018-06-24</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-12 15:16:38" itemprop="dateModified" datetime="2019-07-12T15:16:38+08:00">2019-07-12</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux运维/" itemprop="url" rel="index"><span itemprop="name">Linux运维</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h1 id="1-rpm的弊端"><a href="#1-rpm的弊端" class="headerlink" title="1. rpm的弊端"></a>1. rpm的弊端</h1><hr>
<p>前面我们讲了下rpm，那么rpm有什么弊端呢？<br>其弊端是显而易见的，当用rpm安装软件时，若遇到有依赖关系的软件，必须先安装依赖的软件才能继续安装我们要安装的软件，<br>当依赖关系很复杂的情况下，这种安装方式就很让人头疼，所以我们需要另一种安装方式来解决这个问题—-yum安装工具</p>
<h1 id="2-yum的优劣势"><a href="#2-yum的优劣势" class="headerlink" title="2. yum的优劣势"></a>2. yum的优劣势</h1><hr>
<p>yum有什么优势呢？<br>yum最大的优势就是能够解决rpm的依赖问题，yum能够自动解决软件安装时的依赖关系。<br>当然了，有优势就有劣势，人无完人嘛，软件也是一样的。<br>yum的缺陷就是如果在未完成安装的情况下强行中止安装过程，下次再安装时将无法解决依赖关系。<br>Fedora22+、redhat7和centos7等可以通过手动安装dnf工具来解决此问题。<br>dnf是redhat7上用来代替yum的一个工具，其存在的意义就是处理yum的缺陷，但其用法与yum是完全一样的，甚至连选项都是一样的，你可以理解为dnf就是yum，只是换了个名字而已。所以说只要学会了yum就自然会dnf，大家不用担心学了yum又要去学dnf之类的问题</p>
<h1 id="3-什么是yum及其作用"><a href="#3-什么是yum及其作用" class="headerlink" title="3. 什么是yum及其作用"></a>3. 什么是yum及其作用</h1><hr>
<p>那么什么是yum呢？yum是yellowdog update manager的简称，它能够实现rpm管理的所有操作，并能够自动解决各rpm包之间的依赖关系。yum是rpm的前端工具，是基于rpm来实现软件的管理的一个工具。<br>你不能用yum去管理windows的exe程序包，也不能用yum去管理ubuntu的deb程序包，只能用yum来管理redhat系列的rpm包</p>
<h1 id="4-挂载光盘"><a href="#4-挂载光盘" class="headerlink" title="4. 挂载光盘"></a>4. 挂载光盘</h1><hr>
<ul>
<li>插入光盘</li>
<li>执行以下命令</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# mount /dev/cdrom /mnt</span><br><span class="line">mount: /dev/sr0 is write-protected, mounting read-only</span><br><span class="line">[root@wenhs5479 ~]# ls /mnt/</span><br><span class="line">addons  EULA              GPL     isolinux  media.repo  repodata                 RPM-GPG-KEY-redhat-release</span><br><span class="line">EFI     extra_files.json  images  LiveOS    Packages    RPM-GPG-KEY-redhat-beta  TRANS.TBL</span><br><span class="line">[root@wenhs5479 ~]#</span><br></pre></td></tr></table></figure>

<h1 id="5-yum的原理"><a href="#5-yum的原理" class="headerlink" title="5. yum的原理"></a>5. yum的原理</h1><hr>
<p><img src="../../img/yum.jpg" alt="yum1"></p>
<p><strong>yum的工作需要两部分来合作，一部分是yum服务器，另一部分就是client的yum工具。</strong></p>
<p><strong>yum服务器端工作原理</strong></p>
<p>所有要发行的rpm包都放在yum服务器上以提供别人来下载，rpm包根据kernel的版本号，cpu的版本号分别编译发布。yum服务器只要提供简单的下载就可以了，ftp或者http的形式都可以。yum服务器有一个最重要的环节就是整理出每个rpm包的基本信息，包括rpm包对应的版本号、conf文件、binary信息，以及很关键的依赖信息。在yum服务器上提供了createrepo工具，用于把rpm包的基本概要信息做成一张“清单”，这张“清单”就是描述每个rpm包的spec文件中信息。</p>
<p><strong>client端工作原理</strong></p>
<p>client每次调用yum install或者search的时候，都会去解析/etc/yum.repos.d下面所有以.repo结尾的配置文件，这些配置文件指定了yum服务器的地址。yum会定期去更新yum服务器上的rpm包清单，然后把清单下载保存到yum客户端自己的cache里面，根据/etc/yum.conf里配置（默认是/var/cache/yum下面），每次调用yum装包的时候都会去这个cache目录下去找清单，根据清单里的rpm包描述从而来确定安装包的名字、版本号、所需要的依赖包等，然后再去yum服务器下载rpm安装。（前提是不存在rpm包的cache）</p>
<h1 id="6-yum的元数据"><a href="#6-yum的元数据" class="headerlink" title="6. yum的元数据"></a>6. yum的元数据</h1><hr>
<ul>
<li><p>存放位置（repodata目录）</p>
</li>
<li><p>包含的文件及其对应的功能</p>
<ul>
<li><input disabled type="checkbox"> primary.xml.gz<ul>
<li>当前仓库所有rpm包的列表；</li>
<li>依赖关系；</li>
<li>每个rpm包安装生成的文件列表</li>
</ul>
</li>
<li><input disabled type="checkbox"> filelists.xml.gz<ul>
<li>当前仓库所有rpm包的所有文件列表</li>
</ul>
</li>
<li><input disabled type="checkbox"> other.xml.gz<ul>
<li>额外信息，rpm包的修改日志</li>
</ul>
</li>
<li><input disabled type="checkbox"> repomd.xml<ul>
<li>记录的是primary.xml.gz、filelists.xml.gz、other.xml.gz这三个文件的时间戳和校验和</li>
</ul>
</li>
<li><input disabled type="checkbox"> comps*.xml<ul>
<li>rpm包分组信息</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="7-yum的配置文件"><a href="#7-yum的配置文件" class="headerlink" title="7. yum的配置文件"></a>7. yum的配置文件</h1><hr>
<ul>
<li>配置文件有哪些：<ul>
<li><input disabled type="checkbox"> <strong>/etc/yum.conf 作用</strong>：为所有仓库提供公共配置</li>
<li><input disabled type="checkbox"> <strong>/etc/yum.repos.d/*.repo 作用</strong>：为仓库的指向提供配置</li>
</ul>
</li>
<li>yum的repo配置文件中可用的变量：<ul>
<li><input disabled type="checkbox"> <strong>$releaseversion</strong>:当前OS的发行版的主版本号</li>
<li><input disabled type="checkbox"> <strong>$arch</strong>：平台类型</li>
<li><input disabled type="checkbox"> <strong>$basearch</strong>：基础平台</li>
</ul>
</li>
</ul>
<p><strong>为yum定义repo文件：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[Repo_Name]：仓库名称</span><br><span class="line">name：描述信息</span><br><span class="line">baseurl：仓库的具体路径，接受以下三种类型</span><br><span class="line">    ftp://</span><br><span class="line">    http://</span><br><span class="line">    file:///</span><br><span class="line">enabled：可选值｛1｜0｝，1为启用此仓库，0为禁用此仓库</span><br><span class="line">gpgcheck：可选值｛1｜0｝，1为检查软件包来源合法性，0为不检查来源</span><br><span class="line">    如果gpgcheck设为1，则必须用gpgkey定义密钥文件的具体路径</span><br><span class="line">    gpgkey=/PATH/TO/KEY</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.conf</span><br><span class="line">cachedir=/var/cache/yum/$basearch/$releasever   //缓存目录</span><br><span class="line">keepcache=0     //缓存软件包, 1启动 0 关闭</span><br><span class="line">debuglevel=2    //调试级别</span><br><span class="line">logfile=/var/log/yum.log    //日志记录位置</span><br><span class="line">exactarch=1     //检查平台是否兼容</span><br><span class="line">obsoletes=1     //检查包是否废弃</span><br><span class="line">gpgcheck=1      //检查来源是否合法,需要有制作者的公钥信息</span><br><span class="line">plugins=1       //是否启用插件</span><br><span class="line">tolerant=&#123;1|0&#125;  //容错功能，1为开启，0为关闭，当设为0时，如果用yum安装多个软件包且其中某个软件包已经安装过就会报错；当设为1时，当要安装的软件已经安装时自动忽略</span><br><span class="line">installonly_limit=5</span><br><span class="line">bugtracker_url</span><br><span class="line"># metadata_expire=90m //每一个半小时手动检查元数据</span><br><span class="line"># in /etc/yum.repos.d   //包含repos.d目录</span><br></pre></td></tr></table></figure>

<h1 id="8-yum仓库管理"><a href="#8-yum仓库管理" class="headerlink" title="8. yum仓库管理"></a>8. yum仓库管理</h1><hr>
<h4 id="8-1-yum本地仓库"><a href="#8-1-yum本地仓库" class="headerlink" title="8.1 yum本地仓库"></a>8.1 yum本地仓库</h4><ul>
<li>挂载光盘参照本章第4部分内容</li>
<li>复制光盘内容到yum服务器</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# mkdir /opt/myrepo</span><br><span class="line">[root@wenhs5479 ~]# cp -r /mnt/* /opt/myrepo/</span><br><span class="line">[root@wenhs5479 ~]# ls /opt/myrepo/</span><br><span class="line">addons  EULA              GPL     isolinux  media.repo  repodata                 RPM-GPG-KEY-redhat-release</span><br><span class="line">EFI     extra_files.json  images  LiveOS    Packages    RPM-GPG-KEY-redhat-beta  TRANS.TBL</span><br></pre></td></tr></table></figure>

<ul>
<li>配置repo文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# ls /etc/yum.repos.d/</span><br><span class="line">redhat.repo</span><br><span class="line">[root@wenhs5479 ~]# vim /etc/yum.repos.d/myrepo.repo</span><br><span class="line">[root@wenhs5479 ~]# cat /etc/yum.repos.d/myrepo.repo</span><br><span class="line">[myrepo]</span><br><span class="line">name=myrepo</span><br><span class="line">baseurl=file:///opt/myrepo</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">[root@wenhs5479 ~]#</span><br></pre></td></tr></table></figure>

<ul>
<li>清空yum本地缓存</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# yum clean all</span><br><span class="line">Loaded plugins: langpacks, product-id, search-disabled-repos, subscription-manager</span><br><span class="line">This system is not registered with an entitlement server. You can use subscription-manager to register.</span><br><span class="line">Cleaning repos: myrepo</span><br><span class="line">Cleaning up everything</span><br><span class="line">Maybe you want: rm -rf /var/cache/yum, to also free up space taken by orphaned data from disabled or removed repos</span><br></pre></td></tr></table></figure>

<ul>
<li>检验yum本地仓库</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# yum list all</span><br></pre></td></tr></table></figure>

<h4 id="8-2-yum网络仓库"><a href="#8-2-yum网络仓库" class="headerlink" title="8.2 yum网络仓库"></a>8.2 yum网络仓库</h4><ul>
<li>官方网络yum仓库（国外）:速度慢</li>
<li>阿里云yum仓库</li>
<li>163yum仓库</li>
<li>xx大学yum仓库</li>
<li>epel源:软件包相对比较最全的第三方源</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Base/Extras/Updates: 默认国外官方源</span><br><span class="line">[root@wenhs5479 ~]# curl -o /etc/yum.repos.d/CentOS-Base.repo \</span><br><span class="line">http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line"></span><br><span class="line">国外epel源</span><br><span class="line">[root@wenhs5479 ~]# yum -y install epel-release</span><br><span class="line"></span><br><span class="line">阿里云epel源</span><br><span class="line">[root@wenhs5479 ~]# curl -o /etc/yum.repos.d/epel.repo \</span><br><span class="line">http://mirrors.aliyun.com/repo/epel-7.repo</span><br></pre></td></tr></table></figure>

<h4 id="8-3-软件官方仓库"><a href="#8-3-软件官方仓库" class="headerlink" title="8.3 软件官方仓库"></a>8.3 软件官方仓库</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">源查找方式基本一致,zabbix,mysql,saltstack,openstack等等，上官网找</span><br><span class="line">[root@wenhs5479 ~]# vim /etc/yum.repos.d/nginx.repo</span><br><span class="line">[nginx]</span><br><span class="line">name=nginx repo </span><br><span class="line">baseurl=http://nginx.org/packages/centos/7/$basearch/ </span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure>

<h4 id="8-4-redhat7使用centos7的yum源"><a href="#8-4-redhat7使用centos7的yum源" class="headerlink" title="8.4 redhat7使用centos7的yum源"></a>8.4 redhat7使用centos7的yum源</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">1.卸载红帽yum源</span><br><span class="line">[root@wenhs5479 ~]# rpm -e $(rpm -qa|grep yum) --nodeps</span><br><span class="line"></span><br><span class="line">2.删除所有repo相关文件</span><br><span class="line">[root@wenhs5479 ~]# rm -f /etc/yum.conf</span><br><span class="line">[root@wenhs5479 ~]# rm -rf /etc/yum.repos.d/</span><br><span class="line">[root@wenhs5479 ~]# rm -rf /var/cache/yum</span><br><span class="line"></span><br><span class="line">3.下载centos相关yum组件</span><br><span class="line">[root@wenhs5479 ~]# wget https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/yum-3.4.3-154.el7.centos.noarch.rpm</span><br><span class="line">[root@wenhs5479 ~]# wget https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/yum-metadata-parser-1.1.4-10.el7.x86_64.rpm</span><br><span class="line">[root@wenhs5479 ~]# wget https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/yum-plugin-fastestmirror-1.1.31-42.el7.noarch.rpm</span><br><span class="line">[root@wenhs5479 ~]# wget https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/yum-updateonboot-1.1.31-42.el7.noarch.rpm</span><br><span class="line">[root@wenhs5479~]# wget https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/yum-utils-1.1.31-42.el7.noarch.rpm</span><br><span class="line"></span><br><span class="line">如果没有wget命令则使用curl命令</span><br><span class="line">[root@wenhs5479 ~]# curl -o yum-utils-1.1.31-42.el7.noarch.rpm  https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/yum-utils-1.1.31-42.el7.noarch.rpm</span><br><span class="line">[root@wenhs5479 ~]# curl -o yum-3.4.3-154.el7.centos.noarch.rpm  https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/yum-3.4.3-154.el7.centos.noarch.rpm</span><br><span class="line">[root@wenhs5479 ~]# curl -o yum-metadata-parser-1.1.4-10.el7.x86_64.rpm  https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/yum-metadata-parser-1.1.4-10.el7.x86_64.rpm</span><br><span class="line">[root@wenhs5479 ~]# curl -o yum-plugin-fastestmirror-1.1.31-42.el7.noarch.rpm   https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/yum-plugin-fastestmirror-1.1.31-42.el7.noarch.rpm</span><br><span class="line">[root@wenhs5479 ~]# curl -o yum-updateonboot-1.1.31-42.el7.noarch.rpm https://mirrors.aliyun.com/centos/7/os/x86_64/Packages/yum-updateonboot-1.1.31-42.el7.noarch.rpm</span><br><span class="line"></span><br><span class="line">3.安装所有相关组件</span><br><span class="line">[root@wenhs5479 ~]# rpm -ivh yum-* --nodeps</span><br><span class="line"></span><br><span class="line">4.下载base和epel仓库</span><br><span class="line">[root@wenhs5479 ~]# wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span><br><span class="line">[root@wenhs5479 ~]# sed -i &apos;s#\$releasever#7#g&apos; /etc/yum.repos.d/CentOS-Base.repo</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span><br></pre></td></tr></table></figure>

<h1 id="9-yum管理软件"><a href="#9-yum管理软件" class="headerlink" title="9. yum管理软件"></a>9. yum管理软件</h1><h4 id="9-1-yum命令语法："><a href="#9-1-yum命令语法：" class="headerlink" title="9.1 yum命令语法："></a>9.1 yum命令语法：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum [options] [command] [package ...]</span><br></pre></td></tr></table></figure>

<h4 id="9-2-常用的options："><a href="#9-2-常用的options：" class="headerlink" title="9.2 常用的options："></a>9.2 常用的options：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">--nogpgcheck                //如果从网上下载包有时会检查gpgkey，此时可以使用此命令跳过gpgkey的检查</span><br><span class="line">-y                          //自动回答为&quot;yes&quot;</span><br><span class="line">-q                          //静默模式，安装时不输出信息至标准输出</span><br><span class="line">--disablerepo=repoidglob    //临时禁用此处指定的repo</span><br><span class="line">--enablerepo=repoidglob     //临时启用此处指定的repo</span><br><span class="line">--noplugins                 //禁用所有插件</span><br></pre></td></tr></table></figure>

<p><strong>9.3 常用的command：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">list            //列表</span><br><span class="line">    all         //默认项</span><br><span class="line">    available   //列出仓库中有的，但尚未安装的所有可用的包</span><br><span class="line">    installed   //列出已经安装的包</span><br><span class="line">    updates     //可用的升级</span><br><span class="line">    </span><br><span class="line">clean           //清理缓存</span><br><span class="line">    packages</span><br><span class="line">    headers</span><br><span class="line">    metadata</span><br><span class="line">    dbcache</span><br><span class="line">    all</span><br><span class="line"></span><br><span class="line">repolist        //显示repo列表及其简要信息</span><br><span class="line">    all</span><br><span class="line">    enabled     //默认项</span><br><span class="line">    disabled</span><br><span class="line">    </span><br><span class="line">install         //安装</span><br><span class="line">    yum install packages [...]</span><br><span class="line"></span><br><span class="line">update          //升级</span><br><span class="line">    yum update packages [...]</span><br><span class="line">update_to       //升级为指定版本</span><br><span class="line"></span><br><span class="line">downgrade package1 [package2 ...]   //降级</span><br><span class="line"></span><br><span class="line">remove|erase    //卸载</span><br><span class="line"></span><br><span class="line">info    //显示rpm -qi package的结果</span><br><span class="line">    yum info packages</span><br><span class="line">    </span><br><span class="line">provides|whatprovides   //查看指定的文件或特性是由哪个包安装生成的</span><br><span class="line"></span><br><span class="line">search string1 [string2 ...]    //以指定的关键字搜索程序包名及summary信息</span><br><span class="line"></span><br><span class="line">deplist package [package2 ...]  //显示指定包的依赖关系</span><br><span class="line"></span><br><span class="line">history     //查看yum的历史事务信息</span><br><span class="line"></span><br><span class="line">localinstall    //安装本地rpm包，自动解决依赖关系</span><br><span class="line"></span><br><span class="line">grouplist       //列出可用的组</span><br><span class="line"></span><br><span class="line">groupinstall &quot;group name&quot;   //安装一组软件</span><br><span class="line"></span><br><span class="line">createrepo命令    //创建yum仓库的元数据信息</span><br><span class="line">[root@wenhs5479 ~]# yum install createrepo -y</span><br><span class="line">[root@wenhs5479 ~]# createrepo [options] &lt;directory&gt;</span><br><span class="line"></span><br><span class="line">createrepo --update:</span><br><span class="line"></span><br><span class="line">有时候你的软件仓库中含有很多的软件包，虽然只是其中的一小部分有所改动但是你却不必为每个软件包重新产生元数据，这样做明显太浪费时间了。这就是--update 选项诞生的原因。</span><br><span class="line">像之前一样运行 createrepo 命令但是添加了--update</span><br></pre></td></tr></table></figure>

<p><img src="../../img/12979420-e1ce05a338dcd076.png" alt="yum2"></p>
<p><img src="../../img/12979420-76b1b8dd0b1d4dd1.png" alt="yum3"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">使用自己下载的rpm包搭建本地仓库，需要用createrepo去创建仓库元数据</span><br><span class="line"></span><br><span class="line">#  createrepo  -v    /path/to/rpmDir</span><br><span class="line"></span><br><span class="line">SQLite 是一个软件库,实现了自给自足的、无服务器的、零配置的、事务性的 SQL 数据库引擎。</span><br><span class="line">什么是元数据:</span><br><span class="line">元数据(metadata) </span><br><span class="line">1.任何文件系统中的数据分为数据和元数据</span><br><span class="line">2.数据是指普通文件中的实际数据</span><br><span class="line">3.而元数据指用来描述一个文件的特征</span><br><span class="line">4.比如:访问权限,文件拥有者以及文件数据快的分布信息(inode...)等</span><br></pre></td></tr></table></figure>

<h4 id="9-4-具体实例"><a href="#9-4-具体实例" class="headerlink" title="9.4 具体实例"></a>9.4 具体实例</h4><p><strong>9.4.1 搜索软件包</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">列出软件仓库中可用的软件</span><br><span class="line">[root@wenhs5479 ~]# yum list all</span><br><span class="line"></span><br><span class="line">进行模糊查找</span><br><span class="line">[root@wenhs5479 ~]# yum list|grep ftp</span><br><span class="line"></span><br><span class="line">列出软件包详情</span><br><span class="line">[root@wenhs5479 ~]# yum info ftp</span><br></pre></td></tr></table></figure>

<p><strong>9.4.2 安装软件包</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">安装软件只需要给出软件名称</span><br><span class="line">[root@wenhs5479 ~]# yum install traceroute</span><br><span class="line"></span><br><span class="line">安装过程中分析依赖关系后, 直接安装, 无需交互</span><br><span class="line">[root@wenhs5479 ~]# yum -y install php</span><br><span class="line"></span><br><span class="line">安装本地的rpm包, 如果有依赖关系, 会自动从软件仓库中下载所需依赖（非来自.repo定义的软件仓库）</span><br><span class="line">[root@wenhs5479 ~]# yum localinstall /mnt/Packages/bind-9.9.4-50.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">安装网络上rpm包</span><br><span class="line">[root@wenhs5479 ~]# yum install http://repo.zabbix.com/zabbix/3.4/rhel/7/x86_64/zabbix-release-3.4-2.el7.noarch.rpm</span><br></pre></td></tr></table></figure>

<p><strong>9.4.3 重装软件包</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">检查软件是否存在</span><br><span class="line">[root@wenhs5479 ~]# rpm -q vsftpd</span><br><span class="line">vsftpd-2.2.2-24.el6.x86_64</span><br><span class="line"></span><br><span class="line">检查vsftpd软件配置文件</span><br><span class="line">[root@wenhs5479 ~]# rpm -qc vsftpd</span><br><span class="line">/etc/logrotate.d/vsftpd</span><br><span class="line">/etc/pam.d/vsftpd</span><br><span class="line">/etc/vsftpd/ftpusers</span><br><span class="line">/etc/vsftpd/user_list</span><br><span class="line">/etc/vsftpd/vsftpd.conf</span><br><span class="line"></span><br><span class="line">不小心删除vsftpd配置文件</span><br><span class="line">[root@wenhs5479 ~]# rm -f /etc/vsftpd/vsftpd.conf</span><br><span class="line"></span><br><span class="line">重新安装软件</span><br><span class="line">[root@wenhs5479 ~]# yum reinstall vsftpd</span><br><span class="line"></span><br><span class="line">再次检查</span><br><span class="line">[root@wenhs5479 ~]# rpm -qc vsftpd</span><br><span class="line">/etc/logrotate.d/vsftpd</span><br><span class="line">/etc/pam.d/vsftpd</span><br><span class="line">/etc/vsftpd/ftpusers</span><br><span class="line">/etc/vsftpd/user_list</span><br><span class="line">/etc/vsftpd/vsftpd.conf</span><br></pre></td></tr></table></figure>

<p><strong>9.4.4 更新软件包</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">对比Linux已安装的软件和yum仓库中的软件, 有哪些需要升级</span><br><span class="line">[root@wenhs5479 ~]# yum check-update</span><br><span class="line"></span><br><span class="line">更新软件</span><br><span class="line">[root@wenhs5479 ~]#  yum update acl -y</span><br></pre></td></tr></table></figure>

<p><strong>9.4.5 删除软件包</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">先安装一个samba软件</span><br><span class="line">[root@wenhs5479 ~]# yum -y install samba</span><br><span class="line"></span><br><span class="line">删除该软件包,不会删除依赖, 但是我们尽可能不要使用删除软件操作</span><br><span class="line">[root@wenhs5479 ~]# yum -y erase samba</span><br><span class="line">[root@wenhs5479 ~]# yum -y remove samba</span><br></pre></td></tr></table></figure>

<p><strong>9.4.6 与仓库相关的命令</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">列出yum源可用的软件仓库</span><br><span class="line">[root@wenhs5479 ~]# yum repolist</span><br><span class="line"></span><br><span class="line">列出全部yum源可用和禁用的仓库</span><br><span class="line">[root@wenhs5479 ~]# yum repolist all</span><br><span class="line"></span><br><span class="line">查看这个文件或命令属于哪个包</span><br><span class="line">[root@wenhs5479 ~]# yum provides /etc/my.cnf</span><br><span class="line">[root@wenhs5479 ~]# yum provides cd</span><br><span class="line">[root@wenhs5479 ~]# yum provides *bin/pstree</span><br></pre></td></tr></table></figure>

<p><strong>9.4.7 与缓存相关的命令</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">缓存yum源软件仓库, xml元数据文件</span><br><span class="line">[root@wenhs5479 ~]# yum makecache</span><br><span class="line"></span><br><span class="line">缓存软件包, 修改yum全局配置文件</span><br><span class="line">[root@wenhs5479 ~]# vim /etc/yum.conf</span><br><span class="line">[main]</span><br><span class="line">cachedir=/var/cache/yum/$basearch/$releasever</span><br><span class="line">keepcache=1 //启动缓存</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看缓存的xml文件</span><br><span class="line">[root@wenhs5479 ~]# ls /var/cache/yum/x86_64/7/base/</span><br><span class="line"></span><br><span class="line">查看缓存软件包路径</span><br><span class="line">[root@wenhs5479 ~]# ls /var/cache/yum/x86_64/7/</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#另一种缓存rpm包方式</span><br><span class="line"></span><br><span class="line">1.安装插件支持只下载软件包不安装</span><br><span class="line">[root@wenhs5479 ~]# yum -y install yum-plugin-downloadonly</span><br><span class="line">2.将软件下载至指定目录</span><br><span class="line">[root@wenhs5479 ~]# yum -y install --downloadonly --downloaddir=/tmp httpd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">清除所有yum缓存</span><br><span class="line">[root@wenhs5479 ~]# yum clean all</span><br><span class="line"></span><br><span class="line">只清除缓存的软件包</span><br><span class="line">[root@wenhs5479 ~]# yum clean packages</span><br></pre></td></tr></table></figure>

<p><strong>9.4.8 与包组相关的命令</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">列出已经安装和所有可使用的软件组</span><br><span class="line">[root@wenhs5479 ~]# yum groups list</span><br><span class="line"></span><br><span class="line">安装一整个组的软件</span><br><span class="line">[root@wenhs5479 ~]# yum groups install Development tools Compatibility libraries Base Debugging Tools</span><br><span class="line"></span><br><span class="line">yum删除包组</span><br><span class="line">[root@wenhs5479 ~]# yum groups remove  -y Base</span><br></pre></td></tr></table></figure>

<p><strong>9.4.9 与历史记录相关的命令</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">查看历史执行yum命令</span><br><span class="line">[root@wenhs5479 ~]# yum history</span><br><span class="line"></span><br><span class="line">查询历史执行yum命令ID详细信息</span><br><span class="line">[root@wenhs5479 ~]# yum history info N</span><br><span class="line"></span><br><span class="line">撤销历史执行过的yum命令</span><br><span class="line">[root@wenhs5479 ~]# yum history undo N</span><br></pre></td></tr></table></figure>

<p><strong>9.4.10 YUM签名检查机制</strong></p>
<ul>
<li>rpm软件提供组织redhat在构建rpm包时, 使用其私钥private key对 rpm进行签名</li>
<li>客户端在使用rpm为了验证其合法性, 可以使用redhat提供的公钥public key进行签名检查</li>
</ul>
<p>方式1：<strong>指定公钥位置</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# vim /etc/yum.repos.d/CentOS-Base.repo</span><br><span class="line">[base]</span><br><span class="line">name=CentOS-$releasever - Base mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=os&amp;infra=$infra #baseurl=http://mirror.centos.org/centos/$releasever/os/$basearch/</span><br><span class="line">gpgcheck=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br></pre></td></tr></table></figure>

<p>方式2：<strong>提前导入公钥</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line">[root@wenhs5479 ~]# vim /etc/yum.repos.d/CentOS-Base.repo</span><br><span class="line">[base]</span><br><span class="line">name=CentOS-$releasever - Base </span><br><span class="line">mirrorlist=http://mirrorlist.centos.org/?release=$releasever&amp;arch=$basearch&amp;repo=os&amp;infra=$infra</span><br><span class="line">baseurl=http://mirror.centos.org/centos/$releasever/os/$basearch/</span><br><span class="line">gpgcheck=1</span><br></pre></td></tr></table></figure>

<p>方式3：<strong>不进行签名验证</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">不检查软件包的签名</span><br><span class="line">[root@wenhs5479 ~]# yum install httpd --nogpgcheck</span><br></pre></td></tr></table></figure>

<h3 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h3><p>配置本地光盘yum仓库以及网络yum仓库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# mkdir /localhost</span><br><span class="line">[root@wenhs5479 ~]# mount /dev/sr0 /localhost</span><br><span class="line">mount: /dev/sr0 写保护，将以只读方式挂载</span><br><span class="line">[root@wenhs5479 ~]# cat &lt;&lt;END&gt;&gt;/etc/yum.repos.d/localhost.repo</span><br><span class="line">&gt; [localhost]</span><br><span class="line">&gt; name=wenhs5479</span><br><span class="line">&gt; baseurl=file:///localhost/#########本地挂载源路径</span><br><span class="line">&gt; gpgcheck=0################关闭验证</span><br><span class="line">&gt; enabled=1################开启软件源</span><br><span class="line">&gt; END</span><br><span class="line">[root@wenhs5479 ~]# yum clean all</span><br><span class="line">已加载插件：fastestmirror, langpacks</span><br><span class="line">正在清理软件源： base extras localhost updates</span><br><span class="line">Cleaning up list of fastest mirrors</span><br><span class="line">[root@wenhs5479 ~]# yum makecache</span><br><span class="line">已加载插件：fastestmirror, langpacks</span><br><span class="line">Determining fastest mirrors</span><br><span class="line">......</span><br><span class="line">* updates: mirrors.aliyun.com</span><br><span class="line">源标识                              源名称                                状态</span><br><span class="line">base/7/x86_64                       CentOS-7 - Base                       10,019</span><br><span class="line">extras/7/x86_64                     CentOS-7 - Extras                        371</span><br><span class="line">localhost                           wenhs5479                             10,019</span><br><span class="line">updates/7/x86_64                    CentOS-7 - Updates                     1,158</span><br><span class="line">repolist: 21,567</span><br><span class="line">[root@wenhs5479 ~]# </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">网络源,上方列出方法很多</span><br></pre></td></tr></table></figure>

<p>配置yum缓存rpm包（至少阐述两种方式）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.yum makecache</span><br><span class="line"></span><br><span class="line">2.设置 /etc/yum.conf 中的 keepcache 选项为 1：keepcache=1</span><br></pre></td></tr></table></figure>

<p>使用yum安装本地缓存好的rpm包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y install /path/*.rpm</span><br><span class="line"></span><br><span class="line">这个install可以换成localinstall</span><br></pre></td></tr></table></figure>

<p>使用yum删除httpd软件包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y remove httpd</span><br></pre></td></tr></table></figure>

<p>构建企业内部yum仓库服务(请写出详细步骤,至少准备两台虚拟机，使用http方式)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">1.两台虚拟机互通</span><br><span class="line">2.其中一台挂载iso或者把ISO镜像中的东西拷贝在一个目录</span><br><span class="line">3.安装httpd服务,并设置开机自启,防火墙和selinux在内网最好关闭,免得自寻烦恼</span><br><span class="line">4.创建网站的虚拟主机指向拷贝ISO镜像文件的目录,先本机测试,网页能不能访问,能访问再接下一步</span><br><span class="line">5.配置第二台客户机的repo文件,参数如下:</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# cat &lt;&lt;END&gt;&gt;/etc/yum.repos.d/http.repo</span><br><span class="line">&gt; [http]</span><br><span class="line">&gt; name=wenhs5479</span><br><span class="line">&gt; baseurl=http://第一台主机IP加端口,默认80可不写/软件包路径/#########网路挂载源路径</span><br><span class="line">&gt; gpgcheck=0################关闭验证</span><br><span class="line">&gt; enabled=1################开启软件源</span><br><span class="line">&gt; END</span><br><span class="line">[root@wenhs5479 ~]# yum clean all</span><br><span class="line">清理缓存</span><br><span class="line">[root@wenhs5479 ~]# yum makecache</span><br><span class="line">重建缓存</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    
	
	  <div>
        
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://aiwhs.github.io/2018/06/23/软件管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="itw">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="itw">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/23/软件管理/" class="post-title-link" itemprop="url">软件管理</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-06-23 08:15:57" itemprop="dateCreated datePublished" datetime="2018-06-23T08:15:57+08:00">2018-06-23</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-12 15:29:58" itemprop="dateModified" datetime="2019-07-12T15:29:58+08:00">2019-07-12</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux运维/" itemprop="url" rel="index"><span itemprop="name">Linux运维</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h1 id="1-获取程序包的途径"><a href="#1-获取程序包的途径" class="headerlink" title="1. 获取程序包的途径"></a>1. 获取程序包的途径</h1><ul>
<li><p>系统发行版的光盘或官方的服务器</p>
<ul>
<li><input disabled type="checkbox"> <a href="http://mirrors.aliyun.com" target="_blank" rel="noopener">http://mirrors.aliyun.com</a></li>
<li><input disabled type="checkbox"> <a href="http://mirrors.sohu.com" target="_blank" rel="noopener">http://mirrors.sohu.com</a></li>
<li><input disabled type="checkbox"> <a href="http://mirrors.163.com" target="_blank" rel="noopener">http://mirrors.163.com</a></li>
</ul>
</li>
<li><p>项目官方站点</p>
</li>
<li><p>第三方组织</p>
<ul>
<li><input disabled type="checkbox"> <p>Fedora-EPEL（推荐）</p>
</li>
<li><input disabled type="checkbox"> <p>搜索引擎：</p>
<ul>
<li><a href="http://pkgs.org" target="_blank" rel="noopener">http://pkgs.org</a></li>
<li><a href="http://rpmfind.net" target="_blank" rel="noopener">http://rpmfind.net</a></li>
<li><a href="http://rpm.pbone.net" target="_blank" rel="noopener">http://rpm.pbone.net</a></li>
</ul>
</li>
</ul>
</li>
<li><p>自己制作</p>
</li>
</ul>
<h1 id="2-软件包管理器的职责"><a href="#2-软件包管理器的职责" class="headerlink" title="2. 软件包管理器的职责"></a>2. 软件包管理器的职责</h1><ul>
<li>将二进制程序，库文件，配置文件，帮助文件打包成一个文件；</li>
<li>安装软件时按需将二进制文件，库文件，配置文件，帮助文件放到相应的位置；</li>
<li>生成数据库，追踪所安装的每一个文件；</li>
<li>软件卸载时根据安装时生成的数据库将对应的文件删除</li>
</ul>
<h1 id="3-软件包管理器的核心功能"><a href="#3-软件包管理器的核心功能" class="headerlink" title="3. 软件包管理器的核心功能"></a>3. 软件包管理器的核心功能</h1><ul>
<li>制作软件包</li>
<li>安装软件</li>
<li>卸载软件</li>
<li>升级软件</li>
<li>查询软件</li>
<li>校验软件</li>
</ul>
<h1 id="4-软件包管理"><a href="#4-软件包管理" class="headerlink" title="4. 软件包管理"></a>4. 软件包管理</h1><ul>
<li>程序的组成清单（每个包独有）<ul>
<li><input disabled type="checkbox"> 文件清单</li>
<li><input disabled type="checkbox"> 安装或卸载时运行的脚本</li>
</ul>
</li>
<li>数据库（公共）<ul>
<li><input disabled type="checkbox"> 程序包名称及版本</li>
<li><input disabled type="checkbox"> 依赖关系</li>
<li><input disabled type="checkbox"> 功能说明</li>
<li><input disabled type="checkbox"> 安装生成的各文件的文件路径及校验码信息</li>
</ul>
</li>
</ul>
<h1 id="5-软件包分类"><a href="#5-软件包分类" class="headerlink" title="5. 软件包分类"></a>5. 软件包分类</h1><ul>
<li>二进制格式（编译好的，装上就可以用）<ul>
<li><input disabled type="checkbox"> rpm包作者下载源程序，编译配置完成后，制作成rpm包</li>
<li><input disabled type="checkbox"> why would we do that? because：<ul>
<li>有些特性是编译时选定的，如果编译时未选定此特性，将无法使用</li>
<li>rpm包的版本会落后于源码包，甚至落后很多</li>
</ul>
</li>
</ul>
</li>
<li>源码格式（需要编译，也叫定制）<ul>
<li><input disabled type="checkbox"> 命名方式：name-VERSION.tar.gz<ul>
<li>VERSION：major.minor.release</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="6-软件包管理工具"><a href="#6-软件包管理工具" class="headerlink" title="6. 软件包管理工具"></a>6. 软件包管理工具</h1><ul>
<li>分类：<ul>
<li><input disabled type="checkbox"> 前端工具，常用的前端工具有以下这些：<ul>
<li>yum</li>
<li>apt-get</li>
<li>zypper (suse上的rpm前端管理工具)</li>
<li>dnf（Fedora 22+ rpm前端管理工具）</li>
</ul>
</li>
<li><input disabled type="checkbox"> 后端工具，常用的后端工具有以下这些：<ul>
<li>rpm</li>
<li>dpt</li>
</ul>
</li>
</ul>
</li>
<li>注意：<ul>
<li><input disabled type="checkbox"> 前端工具是依赖于后端工具的</li>
<li><input disabled type="checkbox"> 前端工具是为了自动解决后端工具的依赖关系而存在的</li>
</ul>
</li>
</ul>
<h1 id="7-软件安装方式"><a href="#7-软件安装方式" class="headerlink" title="7. 软件安装方式"></a>7. 软件安装方式</h1><ul>
<li>通过前端工具安装</li>
<li>通过后端工具安装</li>
<li>编译安装</li>
</ul>
<h1 id="8-rpm包命名规范"><a href="#8-rpm包命名规范" class="headerlink" title="8. rpm包命名规范"></a>8. rpm包命名规范</h1><p><img src="../../img/rpm_package_name.jpg" alt="版本号"></p>
<ul>
<li>包的组成<ul>
<li><input disabled type="checkbox"> 主包：bind-9.7.1-1.el5.i586.rpm</li>
<li><input disabled type="checkbox"> 子包：bind-libs-9.7.1-1.el5.i586.rpm bind-utils-9.7.1-1.el5.i586.rpm</li>
</ul>
</li>
<li>包名格式<ul>
<li><input disabled type="checkbox"> name-version-release-arch.rpm<ul>
<li>bind-major.minor.release-release.arch.rpm</li>
</ul>
</li>
</ul>
</li>
<li>包名格式说明<ul>
<li><input disabled type="checkbox"> major（主版本号）：重大改进</li>
<li><input disabled type="checkbox"> minor（次版本号）：某个子功能发生重大变化</li>
<li><input disabled type="checkbox"> release（发行号）：修正了部分bug，调整了一点功能</li>
</ul>
</li>
<li>常见的arch<ul>
<li><input disabled type="checkbox"> x86：i386，i486，i586，i686</li>
<li><input disabled type="checkbox"> x86_64：x64，x86_64，amd64</li>
<li><input disabled type="checkbox"> 跟平台无关：noarch</li>
</ul>
</li>
</ul>
<h1 id="9-rpm包管理"><a href="#9-rpm包管理" class="headerlink" title="9. rpm包管理"></a>9. rpm包管理</h1><h3 id="9-1-什么是rpm及其作用"><a href="#9-1-什么是rpm及其作用" class="headerlink" title="9.1 什么是rpm及其作用"></a>9.1 什么是rpm及其作用</h3><ul>
<li>rpm是Redhat Package Manager的简称，用于管理软件包。</li>
<li>rpm有一个强大的数据库/var/lib/rpm。</li>
<li>rpm的管理工作包括软件的安装、卸载、升级、查询、校验、重建</li>
<li>数据库、验证软件包来源合法性等等。</li>
</ul>
<h3 id="9-2-RPM包安装"><a href="#9-2-RPM包安装" class="headerlink" title="9.2 RPM包安装"></a>9.2 RPM包安装</h3><blockquote>
<p>语法: rpm -ivh /PATH/TO/PACKAGE_FILE … </p>
<p>常用选项：</p>
<p>-i: 安装</p>
<p>-v: 显示详细信息</p>
<p>-h: 显示安装进度条</p>
<p>–test: 测试安装，但不真正执行安装过程</p>
<p>–nodeps: 忽略依赖关系</p>
<p>–replacepkgs: 重新安装，替换原有安装</p>
<p>–oldpackage: 降级</p>
<p>–force: 强行安装，可以实现重装或降级</p>
<p>–nodigest: 不检查包的完整性</p>
<p>–nosignature: 不检查包的来源合法性</p>
<p>–noscripts: 不执行程序包脚本片断</p>
<p>%pre：安装前脚本    –nopre</p>
<p>%post：安装后脚本    –nopost</p>
<p>%preun：卸载前脚本    –nopreun</p>
<p>%postun：卸载后脚本    –nopostun</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">安装软件包, 需要指定软件包绝对路径</span><br><span class="line">[root@wens5479 ~]# rpm -ivh tree-1.6.0-10.el7.x86_64.rpm</span><br><span class="line">[root@wens5479 ~]# rpm -ivh vsftpd-3.0.2-22.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">在软件包所在目录下可以不指定绝对路径</span><br><span class="line">[root@wens5479 ~]# cd /mnt/Packages/</span><br><span class="line">[root@wens5479 Packages]# rpm -ivh zsh-5.0.2-28.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">测试一个软件包是否能在该系统上安装</span><br><span class="line">[root@wens5479 ~]# rpm -ivh --test vsftpd-3.0.2-22.el7.x86_64.rpm</span><br><span class="line"></span><br><span class="line">如果软件包存在, 强制再次安装</span><br><span class="line">[root@wens5479 ~]# rpm -ivh --force tree-1.5.3-3.el6.x86_64.rpm</span><br><span class="line"></span><br><span class="line">安装samba服务需要依赖其他组件, 使用--nodeps可重新强制安装</span><br><span class="line">[root@wens5479 ~]# rpm -ivh --nodeps  tree-1.6.0-10.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>

<h3 id="9-3-RPM包查询"><a href="#9-3-RPM包查询" class="headerlink" title="9.3 RPM包查询"></a>9.3 RPM包查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">rpm -q PACKAGE_NAME                 //查询指定的包是否已安装</span><br><span class="line">rpm -qa                             //查询已经安装的所有包</span><br><span class="line">rpm -qi PACKAGE_NAME                //查询指定包的说明信息</span><br><span class="line">rpm -ql PACKAGE_NAME                //查询指定软件包安装后生成的文件列表</span><br><span class="line">rpm -qf /path/to/somefile           //查询指定的文件是由哪个rpm包安装生成的</span><br><span class="line">rpm -qc PACKAGE_NAME                //查询指定包安装的配置文件</span><br><span class="line">rpm -qd PACKAGE_NAME                //查询指定包安装的帮助文件</span><br><span class="line">rpm -q --scripts PACKAGE_NAME       //查询指定包中包含的脚本</span><br><span class="line">rpm -q --whatprovides CAPABILITY    //查询指定的CAPABILITY（能力）由哪个包所提供</span><br><span class="line">如：rpm -q --whatprovides /bin/cat</span><br><span class="line">rpm -q --whatrequires CAPABILITY    //查询指定的CAPABILITY被哪个包所依赖</span><br><span class="line">rpm -q --changelog COMMAND          //查询COMMAND的制作日志</span><br><span class="line">rpm -q --scripts PACKAGE_NAME       //查询指定软件包包含的所有脚本文件</span><br><span class="line">rpm -qR PACKAGE_NAME                //查询指定的软件包所依赖的CAPABILITY</span><br><span class="line">rpm -q --provides PACKAGE_NAME      //列出指定软件包所提供的CAPABILITY</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">rpm -qpi /PATH/TO/PACKAGE_FILE      //查询指定未安装包的说明信息</span><br><span class="line">rpm -qpl /PATH/TO/PACKAGE_FILE      //查询未安装的软件包会产生哪些文件</span><br><span class="line"></span><br><span class="line">查询vsftpd这个rpm包是否安装</span><br><span class="line">[root@wens5479 ~]# rpm -q vsftpd</span><br><span class="line"></span><br><span class="line">模糊查找系统已安装的rpm包</span><br><span class="line">[root@wens5479 ~]# rpm -qa |grep ftp</span><br><span class="line"></span><br><span class="line">查询vsftpd软件包的相关信息</span><br><span class="line">[root@wens5479 ~]# rpm -qi vsftpd</span><br><span class="line"></span><br><span class="line">查询rpm包所安装的文件</span><br><span class="line">[root@wens5479 ~]# rpm -ql vsftpd</span><br><span class="line"></span><br><span class="line">查询rpm包相关的配置文件</span><br><span class="line">[root@wens5479 ~]# rpm -qc vsftpd</span><br><span class="line"></span><br><span class="line">查询配置文件或命令来自于哪个rpm包</span><br><span class="line">[root@wens5479 ~]# rpm -qf /etc/vsftpd/vsftpd.conf</span><br><span class="line">[root@wens5479 ~]# rpm -qf /usr/sbin/vsftpd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查询未安装的软件包会产生哪些文件</span><br><span class="line">[root@wens5479 ~]# rpm -qlp samba-3.6.23-41.el6.x86_64.rpm</span><br><span class="line"></span><br><span class="line">查询未安装的软件包会产生哪些文件</span><br><span class="line">[root@wens5479 ~]# rpm -qip samba-3.6.23-41.el6.x86_64.rpm</span><br></pre></td></tr></table></figure>

<h3 id="9-4-RPM包升级"><a href="#9-4-RPM包升级" class="headerlink" title="9.4 RPM包升级"></a>9.4 RPM包升级</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh /PATH/TO/NEW_PACKAGE_FILE  //如果装有老版本的，则升级；否则，则安装</span><br><span class="line">rpm -Fvh /PATH/TO/NEW_PACKAGE_FILE  //如果装有老版本的，则升级；否则，退出</span><br><span class="line">--oldpackage：降级</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# rpm -Uvh tree-1.6.0-10.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>

<p><strong>升级注意事项：</strong></p>
<ul>
<li>不要对内核做升级操作<ul>
<li><input disabled type="checkbox"> Linux支持多内核版本并存，因此，可直接安装新版本内核</li>
</ul>
</li>
<li>如果原程序包的配置文件安装后曾被修改，升级时，新版本提供的同一个配置文件并不会直接覆盖老版本的配置文件，而把新版本的文件重命名（FILENAME.rpmnew）后保留</li>
</ul>
<h3 id="9-5-RPM包卸载"><a href="#9-5-RPM包卸载" class="headerlink" title="9.5 RPM包卸载"></a>9.5 RPM包卸载</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法：rpm -e PACKAGE_NAME</span><br><span class="line"></span><br><span class="line">先查询, 然后卸载 </span><br><span class="line">[root@wenhs5479 ~]# rpm -qa |grep vsftpd</span><br><span class="line">[root@wenhs5479 ~]# rpm -e vsftpd</span><br><span class="line"></span><br><span class="line">**注意：**如果其他包依赖于要卸载的包，这个被依赖的包是无法卸载的，除非强制卸载，强制卸载后依赖于这个包的其他程序将无法正常工作</span><br></pre></td></tr></table></figure>

<h3 id="9-6-RPM包校验"><a href="#9-6-RPM包校验" class="headerlink" title="9.6 RPM包校验"></a>9.6 RPM包校验</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">如果执行以下命令无内容输出说明此包未被修改过</span><br><span class="line">[root@localhost ~]# rpm -V vsftpd</span><br><span class="line">S.5....T.  c /etc/pam.d/vsftpd</span><br><span class="line">.......T.  c /etc/vsftpd/ftpusers</span><br><span class="line">S.5....T.  c /etc/vsftpd/vsftpd.conf</span><br><span class="line">.M.......    /var/ftp/pub</span><br><span class="line"></span><br><span class="line">S   //文件的容量大小是否被改变</span><br><span class="line">M   //文件的类型或者文件的属性是否被修改</span><br><span class="line">5   //MD5这一种指纹加密的内容已经不同</span><br><span class="line">D   //装置的主/次代码已经改变</span><br><span class="line">L   //路径已经被改变</span><br><span class="line">U   //文件的所属主已被修改</span><br><span class="line">G   //文件的所属组已被修改</span><br><span class="line">T   //文件的创建时间已被改变</span><br></pre></td></tr></table></figure>

<h3 id="9-7-RPM重建数据库"><a href="#9-7-RPM重建数据库" class="headerlink" title="9.7 RPM重建数据库"></a>9.7 RPM重建数据库</h3><p><strong>数据库信息在/var/lib/rpm目录中</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm --rebuilddb     //重建数据库，一定会重新建立</span><br><span class="line">rpm --initdb        //初始化数据库，没有才建立，有就不用建立</span><br></pre></td></tr></table></figure>

<h3 id="9-8-检查软件包来源合法性和完整性"><a href="#9-8-检查软件包来源合法性和完整性" class="headerlink" title="9.8 检查软件包来源合法性和完整性"></a>9.8 检查软件包来源合法性和完整性</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">加密类型：</span><br><span class="line">对称加密    //加密解密使用同一个密钥</span><br><span class="line">公钥加密    //一对密钥，公钥和私钥。公钥隐含于私钥中，可以提取出来并公布出去</span><br><span class="line">单向加密    //只能加密不能解密</span><br><span class="line"></span><br><span class="line">/etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release     //红帽官方公钥</span><br><span class="line"></span><br><span class="line">rpm -K PACKAGE_FILE     //检查指定包有无密钥信息</span><br><span class="line">dsa，gpg            //验证来源合法性，也即验证签名。可以使用--nosignatrue略过此项</span><br><span class="line">sha1，md5           //验证软件包完整性。可以使用--nodigest略过此项</span><br><span class="line">rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release    //导入密钥文件</span><br><span class="line">CentOS 7发行版光盘提供的密钥文件    //RPM-GPG-KEY-CentOS-7</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    
	
	  <div>
        
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://aiwhs.github.io/2018/06/17/systemd讲解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="itw">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="itw">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/17/systemd讲解/" class="post-title-link" itemprop="url">systemd讲解</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-06-17 08:15:57" itemprop="dateCreated datePublished" datetime="2018-06-17T08:15:57+08:00">2018-06-17</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-08 17:29:10" itemprop="dateModified" datetime="2019-07-08T17:29:10+08:00">2019-07-08</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux运维/" itemprop="url" rel="index"><span itemprop="name">Linux运维</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h1 id="1-systemd"><a href="#1-systemd" class="headerlink" title="1. systemd"></a>1. systemd</h1><h4 id="1-1-systemd简介"><a href="#1-1-systemd简介" class="headerlink" title="1.1 systemd简介"></a>1.1 systemd简介</h4><p><code>systemd</code>是用户空间的第一个应用程序，即<code>/sbin/init</code></p>
<p><strong>init程序的类型：</strong></p>
<ul>
<li>SysV风格：init（centos5），实现系统初始化时，随后的初始化操作都是借助于脚本来实现的<ul>
<li><input disabled type="checkbox"> 特点：<ul>
<li>脚本中含有大量的命令，每个命令都要启动一个进程，命令执行完以后就要终止这个进程。如此一来，系统初始化时将大量的创建进程，销毁进程，工作效率会非常低</li>
<li>服务间可能会存在依赖关系，必须严格按照一定的顺序来启动服务，前一个服务没启动完后面的服务就无法执行启动过程。不能并行进行<ul>
<li><input disabled type="checkbox"> 配置文件：/etc/inittab</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Upstart风格：init（centos6），由ubuntu研发的，通过总线形式以接近于并行的方式工作，效率比SysV高<ul>
<li><input disabled type="checkbox"> 特点：<pre><code>- 基于总线方式能够让进程间互相通信的一个应用程序
- 不用等服务启动完成，只要一初始化就可以把自己的状态返回给其他进程</code></pre></li>
<li><input disabled type="checkbox"> 配置文件：/etc/inittab，/etc/init/*.conf</li>
</ul>
</li>
<li>Systemd风格：systemd（centos7）<ul>
<li><input disabled type="checkbox"> 特点：启动速度比SysV和Upstart都快<ul>
<li>不需要通过任何脚本来启动服务，systemd自身就可以启动服务，其本身就是一个强大的解释器，启动服务时不需要sh/bash的参与<ul>
<li>systemd不真正在系统初始化时去启动任何一个服务</li>
<li>只要服务没用到，它告诉你启动了，实际上并没有启动。仅当第一次去访问时才会真正启动服务</li>
</ul>
</li>
</ul>
</li>
<li><input disabled type="checkbox"> 配置文件：/usr/lib/systemd/system，/etc/systemd/system</li>
</ul>
</li>
</ul>
<p>系统启动和服务器进程由<code>systemd</code>系统和服务管理器进行管理。此程序提供了一种方式，可以在启动时和运行中的系统上激活系统资源、服务器守护进程和其他进程。</p>
<p>守护进程是在执行各种任务的后台等待或运行的进程。为了侦听连接，守护进程使用套接字。套接字可以由守护进程创建，或者与守护进程分离，并且可能由另一个进程创建（如systemd），随后在客户端建立连接时将套接字传递到守护进程。</p>
<p>服务通常指的是一个或多个守护进程，但启动或停止一项服务可能会对系统的状态进行一次性更改（如配置网络接口），不会留下守护进程之后继续运行。</p>
<h4 id="1-2-systemd的新特性"><a href="#1-2-systemd的新特性" class="headerlink" title="1.2 systemd的新特性"></a>1.2 systemd的新特性</h4><ul>
<li>系统引导时实现服务并行启动</li>
<li>按需激活进程</li>
<li>系统状态快照</li>
<li>基于依赖关系定义服务控制逻辑</li>
</ul>
<h4 id="1-3-systemd的核心概念Unit"><a href="#1-3-systemd的核心概念Unit" class="headerlink" title="1.3 systemd的核心概念Unit"></a>1.3 systemd的核心概念Unit</h4><p><strong><code>systemd</code>使用<code>unit</code>的概念来管理服务，这些<code>unit</code>表现为一个个配置文件。<br><code>systemd</code>通过对这些配置文件进行标识和配置达到管理服务的目的：</strong></p>
<blockquote>
<p>这些unit文件中主要包含了系统服务、监听socket、保存的系统快照 //及其它与init相关的信息保存至以下目录：</p>
<p><code>/usr/lib/systemd/system</code></p>
<p><code>/run/systemd/system</code></p>
<p><code>/etc/systemd/system</code></p>
</blockquote>
<p><strong>Unit的类型：</strong></p>
<blockquote>
<p><code>Service unit</code>    //文件扩展名为.service，用于定义系统服务 </p>
<p><code>Target unit</code>   //文件扩展名为.target，用于模拟实现“运行级别”</p>
<p><code>runlevel0.target和poweroff.target</code>       //关机</p>
<p><code>runlevel1.target和rescue.target</code>         //单用户模式</p>
<p><code>runlevel2.target和multi-user.target</code>     //对于systemd来说，2/3/4级别没有区别</p>
<p><code>runlevel3.target和multi-user.target</code>     //对于systemd来说，2/3/4级别没有区别</p>
<p><code>runlevel4.target和multi-user.target</code>   //对于systemd来说，2/3/4级别没有区别</p>
<p><code>runlevel5.target和graphical.target</code>     //图形级别</p>
<p><code>runlevel6.target和reboot.target</code>          //重启 </p>
<p><code>Device unit</code>    //文件扩展名为.device，用于定义内核识别的设备 </p>
<p><code>Mount unit</code>    //文件扩展名为.mount，用于定义文件系统挂载点</p>
<p><code>Socket unit</code>   //文件扩展名为.socket，用于标识进程间通信用的socket文件</p>
<p><code>Snapshot unit</code> //文件扩展名为.snapshot，用于管理系统快照 </p>
<p><code>Swap unit</code>     //文件扩展名为.swap，用于标识swap设备</p>
<p><code>Automount unit</code> //文件扩展名为.automount，用于实现文件系统的自动挂载点 </p>
<p><code>Path unit</code>    //文件扩展名为.path，用于定义文件系统中的一个文件或目录</p>
</blockquote>
<p><strong>Unit关键特性</strong></p>
<blockquote>
<p><code>基于socket的激活机制：</code></p>
</blockquote>
<blockquote>
<p>socket与服务程序分离，当有人去访问时才会真正启动服务，以此来实现按需激活进程与服务的并行启动 </p>
</blockquote>
<blockquote>
<p><code>基于bus的激活机制：</code></p>
</blockquote>
<blockquote>
<p>所有使用dbus实现进程间通信的服务，可以在第一次被访问时按需激活 </p>
</blockquote>
<blockquote>
<p><code>基于device的激活机制：</code></p>
</blockquote>
<blockquote>
<p>支持基于device激活的系统服务，可以在特定类型的硬件接入到系统中时，按需激活其所需要用到的服务</p>
</blockquote>
<blockquote>
<p><code>基于path的激活机制：</code></p>
</blockquote>
<blockquote>
<p>某个文件路径变得可用，或里面出现新文件时就激活某服务 </p>
</blockquote>
<blockquote>
<p><code>系统快照：</code></p>
</blockquote>
<blockquote>
<p>保存各unit的当前状态信息于持久存储设备中，必要时能自动载入 </p>
</blockquote>
<blockquote>
<p><code>向后兼容sysv init脚本</code></p>
</blockquote>
<p><strong>不兼容特性</strong></p>
<blockquote>
<p>systemctl命令固定不变 </p>
<p>非由systemd启动的服务，systemctl无法与之通信</p>
<p>只有已经启动的服务在级别切换时才会执行stop，在centos6以前是所有S开头的服务全部start，所有K开头的服务全部stop</p>
<p>系统服务不会读取任何来自标准输入的数据流 //每个服务的unit操作均受5分钟超时时间限制</p>
</blockquote>
<h1 id="2-使用systemctl管理服务"><a href="#2-使用systemctl管理服务" class="headerlink" title="2. 使用systemctl管理服务"></a>2. 使用systemctl管理服务</h1><blockquote>
<p>语法：<code>systemctl COMMAND name[.service｜.target]</code></p>
<p>常用COMMAND：</p>
<p><code>start name.service</code>     //启动服务</p>
<p><code>stop name.service</code>      //停止服务</p>
<p><code>restart name.service</code>    //重启服务</p>
<p><code>status name.service</code>    //查看服务状态</p>
<p><code>try-restart name.service</code>          //条件式重启服务，若服务已经启动则重启，若服务未启动则不做任何操作</p>
<p><code>reload-or-restart name.service</code>      //重载或重启服务，能reload则reload，否则restart</p>
<p><code>reload-or-try-restart name.service</code>  //重载或条件式重启服务，能reload则reload，否则try-restart</p>
<p><code>mask name.service</code>      //禁止设定为开机自启</p>
<p><code>unmask name.service</code>     //取消禁止设定为开机自启</p>
<p><code>list-dependencies name.service</code>      //查看服务的依赖关系</p>
<p><code>is-active name.service</code>      //查看某服务当前激活与否的状态</p>
<p><code>is-enable name.service</code>      //查看服务是否开机自动启动</p>
<p><code>enable name.service</code>     //设定某服务开机自动启动</p>
<p><code>disable name.service</code>   //禁止服务开机自动启动</p>
<p><code>isolate name.target</code>     //切换至某级别，如systemctl isolate graphical.target就是切换至图形界面</p>
<p><code>list-unit-files --type service</code>      //查看所有服务的开机自动启动状态（是否开机自启）</p>
<p><code>list-units --type service</code>        //查看所有已经激活的服务状态信息</p>
<p><code>list-units --type target</code>           //查看所有已装载的级别</p>
<p><code>list-units --type service --all</code>   //查看所有服务（已启动/已停止）的状态信息</p>
<p><code>list -units --type target --all</code>    //查看所有的级别</p>
<p><code>get-default</code>   //查看默认运行级别</p>
<p><code>set-default name.target</code>   //设置默认运行级别</p>
<p><code>rescue</code>     //切换至紧急救援模式（大多数服务不启动，但是会加载驱动）</p>
<p><code>emergency</code>  //切换至emergency模式（驱动不会加载，系统不会初始化，服务不会启动）</p>
<p><code>halt</code>    //关机</p>
<p><code>poweroff</code>   //关机</p>
<p><code>reboot</code>     //重启</p>
<p><code>suspend</code>    //挂起系统，此时不能关机，否则无用</p>
<p><code>hibernate</code>   //创建并保存系统快照，下次系统重启时会自动载入快照</p>
<p><code>hybrid-sleep</code>   //混合睡眠，快照并挂起</p>
</blockquote>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    
	
	  <div>
        
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://aiwhs.github.io/2018/06/16/进程管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="itw">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="itw">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/16/进程管理/" class="post-title-link" itemprop="url">进程管理</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-06-16 08:15:57" itemprop="dateCreated datePublished" datetime="2018-06-16T08:15:57+08:00">2018-06-16</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-12 15:25:19" itemprop="dateModified" datetime="2019-07-12T15:25:19+08:00">2019-07-12</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux运维/" itemprop="url" rel="index"><span itemprop="name">Linux运维</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h1 id="1-进程基本概述"><a href="#1-进程基本概述" class="headerlink" title="1. 进程基本概述"></a>1. 进程基本概述</h1><p><strong>进程是已启动的可执行程序的运行中实例。</strong></p>
<p><code>/proc</code>目录下以数字为名的目录，每一个目录代表一个进程，保存着进程的属性信息。每一个进程的<code>PID</code>是唯一的，就算进程退出了，其它进程也<code>不会占用</code>其PID。</p>
<h2 id="1-1-进程的组成部分"><a href="#1-1-进程的组成部分" class="headerlink" title="1.1 进程的组成部分"></a>1.1 进程的组成部分</h2><ul>
<li>已分配内存的地址空间</li>
<li>安全属性，包括所有权凭据和特权</li>
<li>程序代码的一个或多个执行线程</li>
<li>进程状态</li>
</ul>
<h2 id="1-2-进程的环境"><a href="#1-2-进程的环境" class="headerlink" title="1.2 进程的环境"></a>1.2 进程的环境</h2><ul>
<li>本地和全局变量</li>
<li>当前调度上下文</li>
<li>分配的系统资源，如文件描述符和网络端口</li>
</ul>
<h2 id="1-3-进程的产生"><a href="#1-3-进程的产生" class="headerlink" title="1.3 进程的产生"></a>1.3 进程的产生</h2><ul>
<li><input disabled type="checkbox"> 现有的（父）进程复制自己的地址空间（fork）来创建一个新的（子）进程结构。</li>
<li><input disabled type="checkbox"> 每个新进程分配有一个唯一的进程ID（PID），满足跟踪和安全性之需。PID与父进程ID（PPID）是新进程环境的元素。</li>
<li><input disabled type="checkbox"> 任何进程可创建子进程。所有进程都是第一个系统进程的后代。RHEL7上，第一个系统进程是systemd。</li>
</ul>
<p><img src="../../img/process_time.png" alt="process1"></p>
<p>通过fork例程，<code>子进程继承安全性身份</code>、<code>过去和当前的文件描述符</code>、<code>端口和资源特权</code>、<code>环境变量</code>，以及<code>程序代码</code>。随后，子进程可能exec其自己的程序代码。通常，父进程在子进程运行期间处于<code>睡眠状态</code>，设置一个在子进程完成时发出信号的请求（wait）。在退出时，子进程可能已经关闭或丢弃了其资源和环境，剩余的部分被称作<code>僵停</code>。父进程在子进程退出时收到信号而被唤醒，清理剩余结构，然后继续执行其自己的程序代码。</p>
<h2 id="1-4-进程的分类"><a href="#1-4-进程的分类" class="headerlink" title="1.4 进程的分类"></a>1.4 进程的分类</h2><ul>
<li><strong>前台进程</strong>：与终端相关的进程，通过终端启动的进程</li>
</ul>
<p><code>注意：也可把在前台启动的进程送往后台，以守护模式运行</code></p>
<ul>
<li><strong>守护进程</strong>：<em>daemon</em>，与终端无关的进程（如内核），在系统引导过程中启动的进程</li>
</ul>
<h1 id="2-进程状态"><a href="#2-进程状态" class="headerlink" title="2. 进程状态"></a>2. 进程状态</h1><p><img src="../../img/process_thread_model.png" alt="process2"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Excuting                    //运行态 </span><br><span class="line">Ready                       //就绪态，也可以称作睡眠态</span><br><span class="line">    Uninterruptible sleep   //不可中断的睡眠。不可随时唤醒，只有当IO资源加载成功后才能唤醒</span><br><span class="line">    Interruptible sleep     //可中断的睡眠。可随时唤醒</span><br><span class="line">Zombie                      //僵尸进程。正常运行结束了，但是不释放占据的内存</span><br><span class="line">Stopped                     //停止态，暂停于内存中，但不会被调度，除非手动启动之</span><br></pre></td></tr></table></figure>

<p><strong>进程睡眠的原因：</strong></p>
<p><code>当一个执行中的进程，需要加载额外的IO资源的时候，由于IO设备的速度太慢，所以会转入睡眠状态等待，交出CPU给其他进程，以免浪费剩余执行时间</code></p>
<p>在多任务处理操作系统中，每个CPU（或CPU核心）在一个时间点上处理一个进程。在进程运行时，它对CPU时间和资源分配的直接要求会有变化。进程分配有一个状态，它随着环境要求而改变。</p>
<p><strong>Linux进程状态</strong></p>
<table>
<thead>
<tr>
<th>标志</th>
<th>内核定义的状态名称和描述</th>
</tr>
</thead>
<tbody><tr>
<td>R</td>
<td>TASK_RUNNING：进程正在CPU上执行，或者正在等待运行。处于运行中（或可运行）状态时，进程可能正在执行用户例程或内核例程（系统调用），或者已排队并就绪</td>
</tr>
<tr>
<td>S</td>
<td>TASK_INTERRUPTIBLE：进程处于睡眠状态且正在等待某一条件：硬件请求、系统资源访问或信号。当事件或信号满足该条件时，该进程将返回到运行中</td>
</tr>
<tr>
<td>D</td>
<td>TASK_UNINTERRUPTIBLE：此进程也在睡眠，但与S状态不同，不会响应传递的信号。仅在特定的条件下使用，其中进程中断可能会导致意外的设备状态</td>
</tr>
<tr>
<td>K</td>
<td>TASK_KILLABLE：进程处于睡眠状态，与不可中断的D状态相同，但有所修改，允许等待中的任务通过响应信号而被中断（彻底退出）。实用程序通常将可中断的进程显示为D状态</td>
</tr>
<tr>
<td>T</td>
<td>TASK_STOPPED：进程已被停止（暂停），通常是通过用户或其他进程发出的信号。进程可以通过另一信号返回到运行中状态，继续执行（恢复）</td>
</tr>
<tr>
<td>T</td>
<td>TASK_TRACED：正在被调试的进程也会临时停止，并且共享同一个T状态标志</td>
</tr>
<tr>
<td>Z</td>
<td>EXIT_ZOMBIE：子进程在退出时向父进程发出信号。除进程身份（PID）之外的所有资源都已释放</td>
</tr>
<tr>
<td>X</td>
<td>EXIT_DEAD：当父进程清理（获取）剩余的子进程结构时，进程现在已彻底释放。此状态从不会在进程列出实用程序中看到</td>
</tr>
<tr>
<td>&lt;</td>
<td>高优先级进程</td>
</tr>
<tr>
<td>N</td>
<td>低优先级进程</td>
</tr>
<tr>
<td>+</td>
<td>前台进程组中的进程</td>
</tr>
<tr>
<td>|</td>
<td>多线程进程</td>
</tr>
<tr>
<td>s</td>
<td>会话进程首进程</td>
</tr>
</tbody></table>
<h1 id="3-进程优先级"><a href="#3-进程优先级" class="headerlink" title="3. 进程优先级"></a>3. 进程优先级</h1><h2 id="3-1-linux进程调度与多任务"><a href="#3-1-linux进程调度与多任务" class="headerlink" title="3.1 linux进程调度与多任务"></a>3.1 linux进程调度与多任务</h2><p>现代计算机系统中既包含每次只能执行一个指令的低端处理器，也包含高性能超级计算机，这些超级计算机每台配备数百个CPU，每个CPU上具有多个核心，它们可以并行执行数以百计的指令。但是所有这些系统往往具有一个共同点：<code>它们需要运行的进程数量总是超出实际具有的核心数</code>。</p>
<p>通过<code>时间分片技术</code>，Linux（和其他操作系统）实际能够运行的进程数（和线程数）可以超出可用的实际处理单元数。<code>操作系统进程调度程序将在单个核心上的进程之间进行快速切换</code>，从而给用户一种有多个进程在同时运行的印象。</p>
<p>执行此切换的Linux内核部分称为<code>进程调度程序</code>。</p>
<h2 id="3-2-进程优先级"><a href="#3-2-进程优先级" class="headerlink" title="3.2 进程优先级"></a>3.2 进程优先级</h2><ul>
<li><strong>进程优先级范围</strong>：</li>
</ul>
<ul>
<li>0-139，数字越小，优先级越高</li>
<li>0-99：实时优先级，内核调整</li>
<li>100-139：静态优先级，用户可控制</li>
<li>进程优先级高的特点：</li>
<li>获得更多的CPU运行时间</li>
<li>更优先获得CPU运行的机会</li>
</ul>
<p>要修改进程的优先级可以通过调整进程的nice值来实现，<code>nice值越小</code>，<code>优先级越高</code>：<br>nice值的范围是<code>（-20，19），-20对应100，19对应139</code></p>
<h2 id="3-3-相对优先级"><a href="#3-3-相对优先级" class="headerlink" title="3.3 相对优先级"></a>3.3 相对优先级</h2><p>由于不是每种进程都与其他进程同样重要，可告知调度程序为不同的进程使用不同的调度策略。常规系统上运行的大多数进程所使用的调度策略称为<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">由于并非所有进程都以同样的方式创建，可为采用`SCHED_NORMAL`策略运行的进程指定相对优先级。此优先级称为进程的`nice`值。一个进程可以有40种不同级别的`nice`值。</span><br><span class="line"></span><br><span class="line">这些`nice`级别的范围是从-20到19。默认情况下，进程将继承其父进程的`nice`级别，通常为0</span><br><span class="line"></span><br><span class="line">&gt;` nice`级别越高，表示优先级越低（该进程容易将其CPU使用量让给其他进程） `nice`级别越低，表示优先级越高（该进程更加不倾向于让出CPU）</span><br><span class="line">&gt; 如果不存在资源争用（例如当活动进程数少于可用CPU核心数时），即使`nice`级别高的进程也将仍使用它们可使用的所有可用CPU资源。但当请求CPU时间的进程数超过可用核心数时，`nice`级别较高的进程将比`nice`级别较低的进程收到更少的CPU时间</span><br><span class="line"></span><br><span class="line">## 3.4 nice级别与权限</span><br><span class="line"></span><br><span class="line">为很占CPU资源的进程设置较低的`nice`级别可能会对同一系统上运行的其他进程的性能造成负面影响，所以仅允许root用户设置负`nice`级别以及降低现有进程的`nice`级别。</span><br><span class="line"></span><br><span class="line">普通非特权用户仅允许设置正的`nice`级别。只能对现有进程提升`nice`级别，而不能降低`nice`级别。</span><br><span class="line"></span><br><span class="line">## 3.5 进程优先级调整</span><br><span class="line"></span><br><span class="line"> - **进程优先级调整**：调整nice值</span><br><span class="line"></span><br><span class="line">&gt; 调整已经启动的进程的nice值：</span><br><span class="line">&gt;     renice NI PID</span><br></pre></td></tr></table></figure></p>
<p>[root@wenhs5479 ~]# renice 5 87579<br>87579 (进程 ID) 旧优先级为 0，新优先级为 5</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; 在启动时指定nice值：（-20，19）</span><br><span class="line">&gt;     nice -n NI COMMAND</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<h2 id="root-wenhs5479-nice-n-10-vim-1"><a href="#root-wenhs5479-nice-n-10-vim-1" class="headerlink" title="[root@wenhs5479 ~]# nice -n 10 vim 1"></a>[root@wenhs5479 ~]# nice -n 10 vim 1</h2><p>[root@wenhs5479 ~]# ps -elF|grep vim<br>4 S root      87609  86130  0  90  10 - 37949 poll_s  5344   1 19:13 pts/1    00:00:00 vim 1<br>0 S root      87621  87527  0  80   0 - 28181 pipe_w   988   0 19:14 pts/0    00:00:00 grep –color=auto vim</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 4. 进程管理命令</span><br><span class="line"></span><br><span class="line">Linux系统各进程的相关信息均保存在`/proc/PID`目录下的各文件中</span><br><span class="line"></span><br><span class="line">## 4.1 ps</span><br><span class="line"></span><br><span class="line">`ps(process state)`命令用于列出当前的进程。可以显示详细的进程信息，包括：</span><br><span class="line"></span><br><span class="line"> - 用户识别符（UID）</span><br><span class="line"> - 它确定进程的特权</span><br><span class="line"> - 唯一进程识别符（PID）</span><br><span class="line"> - CPU和已经花费的实时时间</span><br><span class="line"> - 进程在各种位置上分配的内存数量</span><br><span class="line"> - 进程的位置STDOUT，称为控制终端</span><br><span class="line"> - 当前的进程状态</span><br><span class="line"></span><br><span class="line">**ps支持三种选项格式：**</span><br><span class="line"></span><br><span class="line"> - UNIX（POSIX）选项，可以分组但必须以连字符开头</span><br><span class="line"></span><br><span class="line"> - BSD 选项，可以分组但不可与连字符同用</span><br><span class="line"> - GNU 长选项，以双连字符开头</span><br><span class="line"></span><br><span class="line">**ps(process state)，显示进程信息。注意事项**：</span><br><span class="line"></span><br><span class="line"> - 加了［］中括号的，表示内核线程，通常位于顶部</span><br><span class="line"></span><br><span class="line"> - `exiting`或`defunct`表示僵尸进程</span><br><span class="line"></span><br><span class="line">&gt;常用选项：</span><br><span class="line">&gt;</span><br><span class="line">&gt;a    ------   //显示所有与终端有关的进程</span><br><span class="line">&gt;</span><br><span class="line">&gt;u   ------    //显示进程是由哪个用户启动的</span><br><span class="line">&gt;</span><br><span class="line">&gt;x   ------   //显示所有与终端无关的进程</span><br><span class="line">&gt;</span><br><span class="line">&gt;-e     ------ //显示所有进程，与-A效果相同</span><br><span class="line">&gt;</span><br><span class="line">&gt;-l    ------  //以长格式显示</span><br><span class="line">&gt;</span><br><span class="line">&gt;-F   ------   //显示更详细的完整格式的进程信息</span><br><span class="line">&gt;</span><br><span class="line">&gt;-f     ------ //显示更详细的完整格式的进程信息</span><br><span class="line">&gt;</span><br><span class="line">&gt;-H   ------   //以进程层级格式显示进程相关信息</span><br><span class="line">&gt;</span><br><span class="line">&gt;-o    ------  //根据自己的需要选择要显示的字段</span><br></pre></td></tr></table></figure>

<p>[root@wenhs5479 ~]# ps -o pid,comm,ni            //表示只显示进程号，命令，nice值三个字段<br>PID COMMAND          NI<br>86130 bash              0<br>87717 ps                0</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt;aux结果解析：</span><br><span class="line">&gt;</span><br><span class="line">&gt;VSZ -----    //Virtual memory SiZe，虚拟内存集</span><br><span class="line">&gt;</span><br><span class="line">&gt;RSS  -----   //ReSident Size，常驻内存集</span><br><span class="line">&gt;</span><br><span class="line">&gt;STAT   ----- //进程状态</span><br><span class="line">&gt;</span><br><span class="line">&gt;TIME   ----- //运行时的累积时长</span><br></pre></td></tr></table></figure>

<p>[root@wenhs5479 ~]# ps -aux<br>USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND<br>root          1  0.0  0.3 193984  7048 ?        Ss   14:25   0:03 /usr/lib/<br>root          2  0.0  0.0      0     0 ?        S    14:25   0:00 [kthreadd<br>…….</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt;ps命令结果解析：</span><br><span class="line">&gt;</span><br><span class="line">&gt;NI  -----    //nice值</span><br><span class="line">&gt;</span><br><span class="line">&gt;PRI  -----   //优先级</span><br><span class="line">&gt;</span><br><span class="line">&gt;PSR   -----  //进程运行在哪个CPU核心上</span><br><span class="line">&gt;</span><br><span class="line">&gt;RTPTRIO----- //实时优先级</span><br><span class="line">&gt;</span><br><span class="line">&gt;C   -----    //运行的CPU编号</span><br><span class="line">&gt;</span><br><span class="line">&gt;STIME  ----- //进程的启动时间</span><br><span class="line">&gt;</span><br><span class="line">&gt;VSZ   -----  //Virtual memory SiZe，虚拟内存集</span><br><span class="line">&gt;</span><br><span class="line">&gt;RSS   -----  //ReSident Size，常驻内存集</span><br><span class="line">&gt;</span><br><span class="line">&gt;STAT   ----- //进程状态</span><br><span class="line">&gt;</span><br><span class="line">&gt;TIME   ----- //运行时的累积时长</span><br></pre></td></tr></table></figure>

<p>[root@wenhs5479 ~]# ps -elF<br>F S UID         PID   PPID  C PRI  NI ADDR SZ WCHAN    RSS PSR STIME TTY          TIME CMD<br>4 S root          1      0  0  80   0 - 48496 ep_pol  7048   1 14:25 ?        00:00:03 /usr/lib/systemd/systemd –switched-root –system –deserialize 22<br>1 S root          2      0  0  80   0 -     0 kthrea     0   0 14:25 ?        00:00:00 [kthreadd]<br>………</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 4.2 pstree</span><br><span class="line"></span><br><span class="line">**pstree用于显示当前系统上的进程树**</span><br></pre></td></tr></table></figure>

<p>[root@wenhs5479 ~]# pstree<br>systemd─┬─ModemManager───2<em>[{ModemManager}]<br>        ├─NetworkManager─┬─dhclient<br>        │                └─2</em>[{NetworkManager}]<br>        ├─VGAuthService<br>        ├─abrt-watch-log<br>        ├─abrtd<br>        ├─accounts-daemon───2<em>[{accounts-daemon}]<br>        ├─at-spi-bus-laun─┬─dbus-daemon───{dbus-daemon}<br>        │                 └─3</em>[{at-spi-bus-laun}]<br>        ├─at-spi2-registr───2<em>[{at-spi2-registr}]<br>        ├─atd<br>        ├─auditd─┬─audispd─┬─sedispatch<br>        │        │         └─{audispd}<br>        │        └─{auditd}<br>        ├─avahi-daemon───avahi-daemon<br>        ├─boltd───2</em>[{boltd}]<br>        ├─chronyd<br>        ├─colord───2<em>[{colord}]<br>        ├─crond<br>        ├─cupsd<br>        ├─2</em>[dbus-daemon───{dbus-daemon}]<br>        ├─dbus-launch<br>        ├─dconf-service───2<em>[{dconf-service}]<br>        ├─dnsmasq───dnsmasq<br>        ├─escd───{escd}<br>        ├─evolution-addre─┬─evolution-addre───5</em>[{evolution-addre}]<br>        │                 └─4<em>[{evolution-addre}]<br>        ├─evolution-calen─┬─evolution-calen───8</em>[{evolution-calen}]<br>        │                 └─4<em>[{evolution-calen}]<br>        ├─evolution-sourc───3</em>[{evolution-sourc}]<br>        ├─firewalld───{firewalld}<br>        ├─fwupd───4<em>[{fwupd}]<br>        ├─gdm─┬─X───3</em>[{X}]<br>        │     ├─gdm-session-wor─┬─gnome-session-b─┬─abrt-applet───2<em>[{abrt-applet}]<br>        │     │                 │                 ├─gnome-shell─┬─ibus-daemon─┬─ibus-dconf───3</em>[{ibus-dconf}]<br>        │     │                 │                 │             │             ├─ibus-engine-sim───2<em>[{ibus-engine-sim}]<br>        │     │                 │                 │             │             └─2</em>[{ibus-daemon}]<br>        │     │                 │                 │             └─14<em>[{gnome-shell}]<br>        │     │                 │                 ├─gnome-software───3</em>[{gnome-software}]<br>        │     │                 │                 ├─gsd-a11y-settin───3<em>[{gsd-a11y-settin}]<br>        │     │                 │                 ├─gsd-account───3</em>[{gsd-account}]<br>        │     │                 │                 ├─gsd-clipboard───2<em>[{gsd-clipboard}]<br>        │     │                 │                 ├─gsd-color───3</em>[{gsd-color}]<br>        │     │                 │                 ├─gsd-datetime───3<em>[{gsd-datetime}]<br>        │     │                 │                 ├─gsd-disk-utilit───2</em>[{gsd-disk-utilit}]<br>        │     │                 │                 ├─gsd-housekeepin───3<em>[{gsd-housekeepin}]<br>        │     │                 │                 ├─gsd-keyboard───3</em>[{gsd-keyboard}]<br>        │     │                 │                 ├─gsd-media-keys───3<em>[{gsd-media-keys}]<br>        │     │                 │                 ├─gsd-mouse───3</em>[{gsd-mouse}]<br>        │     │                 │                 ├─gsd-power───3<em>[{gsd-power}]<br>        │     │                 │                 ├─gsd-print-notif───2</em>[{gsd-print-notif}]<br>        │     │                 │                 ├─gsd-rfkill───2<em>[{gsd-rfkill}]<br>        │     │                 │                 ├─gsd-screensaver───2</em>[{gsd-screensaver}]<br>        │     │                 │                 ├─gsd-sharing───3<em>[{gsd-sharing}]<br>        │     │                 │                 ├─gsd-smartcard───5</em>[{gsd-smartcard}]<br>        │     │                 │                 ├─gsd-sound───3<em>[{gsd-sound}]<br>        │     │                 │                 ├─gsd-wacom───2</em>[{gsd-wacom}]<br>        │     │                 │                 ├─gsd-xsettings───3<em>[{gsd-xsettings}]<br>        │     │                 │                 ├─nautilus-deskto───3</em>[{nautilus-deskto}]<br>        │     │                 │                 ├─seapplet<br>        │     │                 │                 ├─ssh-agent<br>        │     │                 │                 ├─tracker-extract───13<em>[{tracker-extract}]<br>        │     │                 │                 ├─tracker-miner-a───3</em>[{tracker-miner-a}]<br>        │     │                 │                 ├─tracker-miner-f───3<em>[{tracker-miner-f}]<br>        │     │                 │                 ├─tracker-miner-u───3</em>[{tracker-miner-u}]<br>        │     │                 │                 └─3<em>[{gnome-session-b}]<br>        │     │                 └─2</em>[{gdm-session-wor}]<br>        │     └─3<em>[{gdm}]<br>        ├─geoclue───2</em>[{geoclue}]<br>        ├─gnome-keyring-d───3<em>[{gnome-keyring-d}]<br>        ├─gnome-shell-cal───5</em>[{gnome-shell-cal}]<br>        ├─goa-daemon───4<em>[{goa-daemon}]<br>        ├─goa-identity-se───3</em>[{goa-identity-se}]<br>        ├─gsd-printer───2<em>[{gsd-printer}]<br>        ├─gssproxy───5</em>[{gssproxy}]<br>        ├─gvfs-afc-volume───3<em>[{gvfs-afc-volume}]<br>        ├─gvfs-goa-volume───2</em>[{gvfs-goa-volume}]<br>        ├─gvfs-gphoto2-vo───2<em>[{gvfs-gphoto2-vo}]<br>        ├─gvfs-mtp-volume───2</em>[{gvfs-mtp-volume}]<br>        ├─gvfs-udisks2-vo───2<em>[{gvfs-udisks2-vo}]<br>        ├─gvfsd─┬─gvfsd-trash───2</em>[{gvfsd-trash}]<br>        │       └─2<em>[{gvfsd}]<br>        ├─gvfsd-fuse───5</em>[{gvfsd-fuse}]<br>        ├─gvfsd-metadata───2<em>[{gvfsd-metadata}]<br>        ├─ibus-daemon─┬─ibus-dconf───3</em>[{ibus-dconf}]<br>        │             └─2<em>[{ibus-daemon}]<br>        ├─ibus-portal───2</em>[{ibus-portal}]<br>        ├─2<em>[ibus-x11───2</em>[{ibus-x11}]]<br>        ├─irqbalance<br>        ├─ksmtuned───sleep<br>        ├─libvirtd───16<em>[{libvirtd}]<br>        ├─lsmd<br>        ├─lvmetad<br>        ├─master───qmgr<br>        ├─mcelog<br>        ├─mission-control───3</em>[{mission-control}]<br>        ├─packagekitd───2<em>[{packagekitd}]<br>        ├─pcscd───3</em>[{pcscd}]<br>        ├─polkitd───6<em>[{polkitd}]<br>        ├─pulseaudio───{pulseaudio}<br>        ├─rngd<br>        ├─rpcbind<br>        ├─rsyslogd───2</em>[{rsyslogd}]<br>        ├─rtkit-daemon───2<em>[{rtkit-daemon}]<br>        ├─smartd<br>        ├─sshd───sshd─┬─bash───pstree<br>        │             └─bash<br>        ├─systemd-journal<br>        ├─systemd-logind<br>        ├─systemd-udevd<br>        ├─tracker-store───7</em>[{tracker-store}]<br>        ├─tuned───4<em>[{tuned}]<br>        ├─udisksd───4</em>[{udisksd}]<br>        ├─upowerd───2<em>[{upowerd}]<br>        ├─vmtoolsd───{vmtoolsd}<br>        ├─vmtoolsd───2</em>[{vmtoolsd}]<br>        ├─wpa_supplicant<br>        └─xdg-permission-───2*[{xdg-permission-}]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 4.3 pgrep</span><br><span class="line"></span><br><span class="line">**以grep风格指定只显示哪些进程，在当前系统中找符合某些特性的进程。只显示进程号**</span><br></pre></td></tr></table></figure>

<p>[root@wenhs5479 ~]# pgrep atd<br>6741<br>[root@wenhs5479 ~]# pgrep sshd<br>6718<br>86118<br>[root@wenhs5479 ~]# ps -ef|grep sshd<br>root       6718      1  0 14:26 ?        00:00:00 /usr/sbin/sshd -D<br>root      86118   6718  0 17:56 ?        00:00:00 sshd: root@pts/1,pts/0<br>root      87945  86130  0 19:29 pts/1    00:00:00 grep –color=auto sshd</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 4.4 pidof</span><br><span class="line"></span><br><span class="line">**根据进程名查找其PID号**</span><br></pre></td></tr></table></figure>

<p>[root@wenhs5479 ~]# pidof sshd<br>86118 6718<br>[root@wenhs5479 ~]# pidof atd<br>6741</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 4.5 vmstat</span><br><span class="line"></span><br><span class="line">**虚拟内存状态查看命令**</span><br></pre></td></tr></table></figure>

<p>用法：<br>vmstat [options] [延迟[count]]</p>
<p>选项：<br>-a， –active            非活动内存<br>-f， –forks      启动以来分叉的数量<br>-m， –slabs         slabinfo<br>-n， –one-header        不重新显示标题<br>-s， -  stats        事件计数器统计信息<br>-d，  –disk      磁盘统计信息<br>-D， -  disk-sum        汇总磁盘统计信息<br>-p， -  partition <dev>        分区特定统计信息<br>-S， -  unit <char>        定义显示单位<br>-w， –wide             宽输出<br>-t， -  timestamp        显示时间戳</char></dev></p>
<p>-h， -  help        显示此帮助并退出<br>-V， -  version        输出版本信息并退出</p>
<p><strong>示例</strong></p>
<p>[root@wenhs5479 ~]# vmstat 2                    表示每2秒刷新一次<br>procs ———–memory———- —swap– —–io—- -system– ——cpu—–<br>r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st<br>1  0    520 102648   2104 971616    0    0    30     7   52   99  0  0 99  0  0</p>
<p>0  0    520 102648   2104 971616    0    0     0     0  102  190  0  0 100  0  0<br>0  0    520 102648   2104 971616    0    0     0     0  103  185  0  0 100  0  0<br>0  0    520 102648   2104 971616    0    0     0     0  101  187  0  0 100  0  0<br>^C                    终止掉<br>[root@wenhs5479 ~]# vmstat 2 5            表示每2秒刷新一次，刷新5次后退出<br>procs ———–memory———- —swap– —–io—- -system– ——cpu—–<br>r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st<br>1  0    520 102632   2104 971616    0    0    30     7   52   99  0  0 99  0  0<br>0  0    520 102648   2104 971616    0    0     0     0  100  183  0  0 100  0  0<br>0  0    520 102648   2104 971616    0    0     0     0   87  173  0  0 100  0  0<br>1  0    520 102648   2104 971616    0    0     0     0  108  192  0  0 100  0  0<br>1  0    520 102648   2104 971616    0    0     0     0  108  188  0  0 100  0  0<br>[root@wenhs5479 ~]# </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">**常用的选项：**</span><br><span class="line">` -s`        	  //显示内存的统计数据</span><br></pre></td></tr></table></figure>

<p>[root@wenhs5479 ~]# vmstat<br>procs ———–memory———- —swap– —–io—- -system– ——cpu—–<br>r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st<br>2  0    520 102624   2104 971616    0    0    30     7   51   99  0  0 99  0  0<br>[root@wenhs5479 ~]# </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; **procs：**</span><br><span class="line">&gt;</span><br><span class="line">&gt; `r（running）`  //表示等待运行的队列长度，也即等待运行的进程的个数</span><br><span class="line">&gt;</span><br><span class="line">&gt; `b（block）`    //表示阻塞队列长度，也即处于不可中断睡眠态的进程个数 **memory：**</span><br><span class="line">&gt;</span><br><span class="line">&gt; `swpd`        //交换内存的使用总量</span><br><span class="line">&gt;</span><br><span class="line">&gt; `free`       //空闲物理内存总量</span><br><span class="line">&gt;</span><br><span class="line">&gt; `buffer`      //用于buffer的内存总量</span><br><span class="line">&gt;</span><br><span class="line">&gt; `cache`       //用于cache的内存总量 swap：</span><br><span class="line">&gt;</span><br><span class="line">&gt; `si（swap in）`     //表示从物理内存有多少页面换进swap，也即数据进入swap的数据速率（kb/s）</span><br><span class="line">&gt;</span><br><span class="line">&gt; `so（swap out）`    //表示从swap有多少页面换进物理内存，也即数据离开swap的数据速率（kb/s） io：</span><br><span class="line">&gt;</span><br><span class="line">&gt; `bi（block in）`    //表示磁盘块有多少个被调入内存中，也即从块设备读入数据到系统的速率（kb/s）</span><br><span class="line">&gt;</span><br><span class="line">&gt; `bo（block out）`   //表示有多少个磁盘块从内存中被同步到硬盘上去了，也即保存数据至块设备的速率（kb/s） system：</span><br><span class="line">&gt;</span><br><span class="line">&gt; `in（ interrupts）`     //表示中断的个数，也即中断速率（kb/s）</span><br><span class="line">&gt;</span><br><span class="line">&gt; `cs（context switch）`  //表示上下文切换的次数，也即进程切换速率（kb/s） **CPU：**</span><br><span class="line">&gt;</span><br><span class="line">&gt; `us`      //表示用户空间</span><br><span class="line">&gt;</span><br><span class="line">&gt; `sy`     //表示内核空间</span><br><span class="line">&gt;</span><br><span class="line">&gt; `id`    //表示空闲百分比</span><br><span class="line">&gt;</span><br><span class="line">&gt; `wa`      //表示等待IO完成所占据的时间百分比</span><br><span class="line">&gt;</span><br><span class="line">&gt; `st`    //表示steal，被虚拟化技术偷走的时间（比如运行虚拟机）</span><br><span class="line"></span><br><span class="line"># 5. 控制作业</span><br><span class="line"></span><br><span class="line">## 5.1 作业与会话</span><br><span class="line"></span><br><span class="line">作业控制是`shell`的一种功能，它允许单个`shell`实例运行和管理多个命令。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">作业与在`shell`提示符中输入的每个管道相关联。该管道中的所有进程均是作业的一部分，并且是同一个进程组的成员。（如果在`shell`提示符中仅输入了一条命令，则这条命令可视为命令的最小管道。该命令将是该作业的唯一成员）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">一次只能有一个作业从特定终端窗口读取输入和键盘生成的信号。属于该作业的进程是该控制终端的前台进程。</span><br><span class="line"></span><br><span class="line">该控制终端的后台进程是与该终端相关联的任何其他作业的成员。终端的后台进程无法从终端读取输入或接收键盘生成的中断，但可以写入终端。后台中的作业可能已停止（暂停），也可能正在运行。如果某个正在运行的后台作业尝试从终端读取内容，则该作业将自动暂停。</span><br><span class="line"></span><br><span class="line">每个终端是其自身的会话，并且可以具有一个前台进程和多个独立的后台进程。一个作业只能属于一个会话，也就是属于其控制终端的会话。</span><br><span class="line"></span><br><span class="line">## 5.2 作业分类</span><br><span class="line"></span><br><span class="line">Linux作业分为前台作业与后台作业两种。其各自的特点如下：</span><br><span class="line"></span><br><span class="line">**前台作业**：通过终端启动，且启动后一直占据了命令提示符</span><br><span class="line"></span><br><span class="line">**后台作业**：可以通过终端启动，但启动之后，释放命令提示符，后续的操作在后台完成</span><br><span class="line"></span><br><span class="line">此类作业虽然被送往后台运行，但其依然与终端相关。如果希望送往后台后，剥离与终端的关系需要执行（`nohup COMMAND &amp;`）</span><br><span class="line"></span><br><span class="line">## 5.3 在后台运行作业</span><br><span class="line"></span><br><span class="line">在命令后跟上`&amp;`符号可以生成一个后台作业</span><br></pre></td></tr></table></figure>

<p>[root@wenhs5479 ~]# sleep 1000 &amp;<br>[1] 88234</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">`jobs`命令用于显示当前所有的后台作业</span><br></pre></td></tr></table></figure>

<p>[root@wenhs5479 ~]# jobs<br>[1]+  运行中               sleep 1000 &amp;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">`fg`命令用于将后台作业调至前台运行</span><br></pre></td></tr></table></figure>

<p>[root@wenhs5479 ~]# fg<br>sleep 1000<br>…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">当只有一个后台作业时，直接使用`fg`命令，不跟任何参数即可将后台作业调至前台运行，但是当有多个作业时则必须跟上`%+`作业号，也就是上面命令执行结果中以[]括起来的数字。</span><br></pre></td></tr></table></figure>

<p>[root@wenhs5479 ~]# jobs<br>[1]-  运行中               sleep 1000 &amp;<br>[2]+  运行中               sleep 2000 &amp;<br>[root@wenhs5479 ~]# fg %2<br>sleep 2000<br>…</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">使用ctrl+z可将前台进程发送到后台，此时作业将处于停止状态</span><br></pre></td></tr></table></figure>

<p>[root@wenhs5479 ~]# fg %2<br>sleep 2000<br>^Z<br>[2]+  已停止               sleep 2000<br>[root@wenhs5479 ~]#</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">使用`bg`命令+作业号可使后台已停止的作业重新运行</span><br></pre></td></tr></table></figure>

<p>[root@wenhs5479 ~]# jobs<br>[1]-  运行中               sleep 1000 &amp;<br>[2]+  已停止               sleep 2000<br>[root@wenhs5479 ~]# bg        只有一个停止的情况下不用带%2<br>[2]+ sleep 2000 &amp;<br>[root@wenhs5479 ~]# jobs<br>[1]-  运行中               sleep 1000 &amp;<br>[2]+  运行中               sleep 2000 &amp;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">`kill`加上作业号可以手动杀死指定作业</span><br></pre></td></tr></table></figure>

<p>[root@wenhs5479 ~]# kill %1<br>[1]-  已终止               sleep 1000<br>[root@wenhs5479 ~]# jobs<br>[2]+  运行中               sleep 2000 &amp;<br>[root@wenhs5479 ~]#</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt;`jobs`命令的结果中</span><br><span class="line">&gt;</span><br><span class="line">&gt;`+`     //命令将默认操作的作业   </span><br><span class="line">&gt;`-`     //命令将第二个默认操作的作业</span><br><span class="line"></span><br><span class="line"># 6. 进程间通信</span><br><span class="line">**进程间通信（IPC：Inter Process Communication）**</span><br><span class="line"></span><br><span class="line">**进程间通信方式：**</span><br><span class="line"></span><br><span class="line">- 同一主机</span><br><span class="line">  - 共享内存</span><br><span class="line">  - 信号：Signal</span><br><span class="line">- 不同主机</span><br><span class="line">  - rpc：remote procecure call</span><br><span class="line">  - 基于socket实现进程间通信</span><br><span class="line"></span><br><span class="line"># 7. 使用信号控制进程</span><br><span class="line"></span><br><span class="line">信号是传递至进程的软件中断。信号向执行中的程序报告事件。生成信号的事件可以是错误或外部事件（如I/O请求或计时器过期），或者来自于明确请求（如使用信号发送命令）</span><br><span class="line"></span><br><span class="line">下表列出了系统管理员用于日常进程管理的基本信号。请通过短名称（HUP）或正确名称（SIGHUP）指代信号。</span><br><span class="line"></span><br><span class="line">指定一个信号的方法：</span><br><span class="line"></span><br><span class="line">- 信号号码（数字标识）：`kill -1`</span><br><span class="line">- 信号完整名称：`kill -SIGKILL`</span><br><span class="line">- 信号简写名称：`kill -TERM`或`kill -KILL`或`kill -INT`或`kill -HUP`</span><br><span class="line"></span><br><span class="line">**基本进程管理信号**</span><br><span class="line"></span><br><span class="line">| 信号编号ID | 短名称 | 定义           | 用途                                                         |</span><br><span class="line">| ---------- | ------ | -------------- | ------------------------------------------------------------ |</span><br><span class="line">| 1          | HUP    | 挂起           | 让一个进程不用重启就可以重读配置文件，并让新的配置信息生效   |</span><br><span class="line">| 2          | INT    | 键盘中断       | 中断一个前台进程。ctrl+c就是用的SIGINT信号                   |</span><br><span class="line">| 9          | KILL   | 中断，无法拦截 | 导致立即终止程序。无法被拦截、忽略或处理                     |</span><br><span class="line">| 15默认值   | TERM   | 终止           | 导致程序终止。和SIGKILL不同，可以被拦截、忽略或处理。要求程序终止的友好方式，允许自我清理 |</span><br><span class="line"></span><br><span class="line">**用户可以中断自己的进程，但只有root才能终止由其他人拥有的进程。**</span><br><span class="line"></span><br><span class="line">`kill`命令根据ID向进程发送信号。虽其名称为kill，但该命令可用于发送任何信号，而不仅仅是终止程序的信号</span><br><span class="line"></span><br><span class="line">**语法： kill [-SIGNAL] PID ...**</span><br><span class="line"></span><br><span class="line">显示所有可用的信号（可使用man 7 signal查看帮助信息）</span><br></pre></td></tr></table></figure>

<p>[root@wenhs5479 ~]# kill -l<br>1) SIGHUP     2) SIGINT     3) SIGQUIT     4) SIGILL     5) SIGTRAP<br>6) SIGABRT     7) SIGBUS     8) SIGFPE     9) SIGKILL    10) SIGUSR1<br>11) SIGSEGV    12) SIGUSR2    13) SIGPIPE    14) SIGALRM    15) SIGTERM<br>16) SIGSTKFLT    17) SIGCHLD    18) SIGCONT    19) SIGSTOP    20) SIGTSTP<br>21) SIGTTIN    22) SIGTTOU    23) SIGURG    24) SIGXCPU    25) SIGXFSZ<br>26) SIGVTALRM    27) SIGPROF    28) SIGWINCH    29) SIGIO    30) SIGPWR<br>31) SIGSYS    34) SIGRTMIN    35) SIGRTMIN+1    36) SIGRTMIN+2    37) SIGRTMIN+3<br>38) SIGRTMIN+4    39) SIGRTMIN+5    40) SIGRTMIN+6    41) SIGRTMIN+7    42) SIGRTMIN+8<br>43) SIGRTMIN+9    44) SIGRTMIN+10    45) SIGRTMIN+11    46) SIGRTMIN+12    47) SIGRTMIN+13<br>48) SIGRTMIN+14    49) SIGRTMIN+15    50) SIGRTMAX-14    51) SIGRTMAX-13    52) SIGRTMAX-12<br>53) SIGRTMAX-11    54) SIGRTMAX-10    55) SIGRTMAX-9    56) SIGRTMAX-8    57) SIGRTMAX-7<br>58) SIGRTMAX-6    59) SIGRTMAX-5    60) SIGRTMAX-4    61) SIGRTMAX-3    62) SIGRTMAX-2<br>63) SIGRTMAX-1    64) SIGRTMAX</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">`killall COMMAND`：**killall后面跟进程名，表示将匹配到的以进程名为名的进程全部杀死**</span><br></pre></td></tr></table></figure>

<p>[root@wenhs5479 ~]# ps -ef |grep sleep<br>root      88261  86130  0 19:53 pts/1    00:00:00 sleep 2000<br>root      88584   6321  0 20:05 ?        00:00:00 sleep 60<br>root      88587  86130  0 20:06 pts/1    00:00:00 grep –color=auto sleep<br>[root@wenhs5479 ~]# killall sleep<br>[2]+  已终止               sleep 2000<br>[root@wenhs5479 ~]# ps -ef |grep sleep<br>root      88604   6321  0 20:06 ?        00:00:00 sleep 60<br>root      88606  86130  0 20:06 pts/1    00:00:00 grep –color=auto sleep<br>[root@wenhs5479 ~]# </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 8. 监控进程活动</span><br><span class="line">## 8.1 IO负载</span><br><span class="line">负载平均值代表一段时间内感知的系统负载。Linux通过预期服务等待时间的表示来实施平均负载计算。</span><br><span class="line"></span><br><span class="line">Linux不仅计算进程数，也作为独立的任务计算线程数。运行中线程和等待I/O资源的线程的CPU请求队列对应于R和D进程状态。等待I/O包括处于睡眠而等待预期磁盘和网络响应的任务。</span><br><span class="line"></span><br><span class="line">负载数属于全局计数器计算，是所有CPU的总和数。由于从睡眠返回的任务可能会重新调度到不同的CPU，难以精确的每CPU计数，但累计数的准确度可以保障。显示的平均负载代表所有的CPU。</span><br><span class="line"></span><br><span class="line">**查看cpu核心数**</span><br></pre></td></tr></table></figure>

<p>[root@wenhs5479 ~]# grep ‘model name’ /proc/cpuinfo<br>model name    : Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz<br>model name    : Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz<br>[root@wenhs5479 ~]#</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">一些UNIX系统仅考虑CPU使用率或运行队列长度来指示系统负载。由于具有空闲CPU的系统可能会因为磁盘或网络资源忙而遇到很长时间的等待，因此Linux负载平均值中包含了对I/O的考量。遇到负载平均值很高但CPU活动很低时，请检查磁盘和网络活动。</span><br><span class="line"></span><br><span class="line">Linux中可以使用`top`、`uptime`显示负载平均值的情况。</span><br></pre></td></tr></table></figure>

<p>[root@wenhs5479 ~]# uptime<br>20:09:36 up  5:43,  3 users,  load average: 0.06, 0.03, 0.05</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">此处的`load average`就表示负载平均值，这三个值代表最近1、5和15分钟的负载情况。</span><br><span class="line"></span><br><span class="line">将显示的负载平均值除以系统中的逻辑CPU数。当值低于1表示资源利用率较好，等待时间很短。当值高于1表示资源饱和，而且有一定的服务等待时间。</span><br><span class="line"></span><br><span class="line">空闲CPU队列的负载数为0。每个就绪和等待的线程使计数增加1。总队列数为1时，资源（CPU、磁盘或网络）正在使用中，但没有请求把时间花在等待上。增加的请求数会累积该计数，但由于许多请求可以在时限内处理，资源使用率会很高，而等待时间则不会。</span><br><span class="line"></span><br><span class="line">因为磁盘或网络资源忙碌等待I/O而处于睡眠的进程包含在该计数内，而且使负载平均值增大。虽然不能表示CPU使用率，队列数依然表明用户和程序正在等待资源服务。</span><br><span class="line"></span><br><span class="line">在资源饱和前，平均负载将保持在1以下，因为几乎不会在队列中发现等待的任务。只有资源饱和导致请求留在排队状态并且被负载计算例程计数时，负载平均才会增大。当资源使用率接近100%时，每个增加的请求将开始遭遇服务等待时间。</span><br><span class="line"></span><br><span class="line">## 8.2 实时进程监控</span><br><span class="line">**top用于实现全屏动态显示系统信息**</span><br><span class="line"></span><br><span class="line">&gt;常用选项：</span><br><span class="line">&gt;</span><br><span class="line">&gt;-d    --------  //设置延迟时长，top -d 1表示每隔1秒刷新一次，默认每隔5秒刷新</span><br><span class="line">&gt;</span><br><span class="line">&gt;-b   --------   //批模式翻屏显示，默认只实时显示一屏，若要显示后面的进程信息则可使用-b选项，与-n #合用，可指定显示翻#屏</span><br></pre></td></tr></table></figure>

<p>[root@wenhs5479 ~]# top -b -n 1<br>top - 20:11:24 up  5:45,  3 users,  load average: 0.01, 0.02, 0.05<br>Tasks: 212 total,   1 running, 211 sleeping,   0 stopped,   0 zombie<br>%Cpu(s):  0.0 us,  7.9 sy,  0.0 ni, 92.1 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>KiB Mem :  1863252 total,   176968 free,   789680 used,   896604 buff/cache<br>KiB Swap:  1572860 total,  1572084 free,      776 used.   722344 avail Mem </p>
<p>PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND<br>1 root      20   0  193984   7048   4212 S   0.0  0.4   0:03.34 systemd<br>2 root      20   0       0      0      0 S   0.0  0.0   0:00.02 kthreadd<br>3 root      20   0       0      0      0 S   0.0  0.0   0:00.43 ksoftirqd/0<br>5 root       0 -20       0      0      0 S   0.0  0.0   0:00.00 kworker/0:0H<br>7 root      rt   0       0      0      0 S   0.0  0.0   0:00.06 migration/0<br>8 root      20   0       0      0      0 S   0.0  0.0   0:00.00 rcu_bh<br>9 root      20   0       0      0      0 S   0.0  0.0   0:03.81 rcu_sched<br>10 root       0 -20       0      0      0 S   0.0  0.0   0:00.00 lru-add-drain<br>11 root      rt   0       0      0      0 S   0.0  0.0   0:00.81 watchdog/0<br>12 root      rt   0       0      0      0 S   0.0  0.0   0:00.08 watchdog/1<br>13 root      rt   0       0      0      0 S   0.0  0.0   0:00.05 migration/1<br>14 root      20   0       0      0      0 S   0.0  0.0   0:01.30 ksoftirqd/1</p>
<pre><code>
`load average`：1分钟，5分钟，15分钟

`load average`    :CPU队列中等待运行的任务的个数



&gt;**cpu(s)**：多颗CPU平均负载，按1键显示每颗CPU平均负载。
&gt;
&gt;`us`  //表示用户空间；
&gt;
&gt;`sy` //表示内核空间；
&gt;
&gt;`ni`  //表示调整nice值，CPU占用的比率；
&gt;
&gt;`id`  //表示空闲百分比；
&gt;
&gt;`wa`  //表示等待IO完成所占据的时间百分比；
&gt;
&gt;`hi`  //表示hard interrupt，硬件中断占据的时间百分比；
&gt;
&gt;`si`  //表示软中断占据的时间百分比；
&gt;
&gt;`st`  //表示steal，被虚拟化技术偷走的时间（比如运行虚拟机）
&gt;
&gt;`PR`   //优先级
&gt;
&gt;`NI`    //nice值 
&gt;
&gt;`VIRT`    //虚拟内存集 
&gt;
&gt;`RES`     //常驻内存集 
&gt;
&gt;`SHR`    //共享内存大小 
&gt;
&gt;`S`      //进程状态
&gt;
&gt;
&gt;
&gt;**top**命令交互式子命令：
&gt;
&gt;`M`   //根据驻留内存大小进行排序，默认根据CPU百分比排序
&gt;
&gt;`P`  //根据CPU使用百分比进行排序
&gt;
&gt;`T`  //根据累计时间（占据CPU时长）进行排序
&gt;
&gt;`l`   //是否显示平均负载和启动时间
&gt;
&gt;`t`   //是否显示进程和CPU状态相关信息
&gt;
&gt;`m`  //是否显示内存相关信息
&gt;
&gt;`c`   //是否显示完整的命令行信息
&gt;
&gt;`q`  //退出top命令
&gt;
&gt;`k`   //终止某个进程
&gt;
&gt;`1`  //显示所有CPU的信息
&gt;
&gt;`s`  //修改刷新时间间隔</code></pre>
          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    
	
	  <div>
        
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://aiwhs.github.io/2018/06/03/权限管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="itw">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="itw">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/03/权限管理/" class="post-title-link" itemprop="url">权限管理</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-06-03 08:15:57" itemprop="dateCreated datePublished" datetime="2018-06-03T08:15:57+08:00">2018-06-03</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-10 15:20:01" itemprop="dateModified" datetime="2019-07-10T15:20:01+08:00">2019-07-10</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux运维/" itemprop="url" rel="index"><span itemprop="name">Linux运维</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h1 id="1-权限管理"><a href="#1-权限管理" class="headerlink" title="1. 权限管理"></a>1. 权限管理</h1><p><strong>文件的权限主要针对三类对象进行定义：</strong></p>
<ul>
<li>owner：属主，u</li>
<li>group：属组，g</li>
<li>other：其它，o</li>
</ul>
<p><strong>每个文件针对每个访问者都定义了三种权限：</strong></p>
<table>
<thead>
<tr>
<th>权限</th>
<th>对应的操作对象</th>
<th>权限说明</th>
</tr>
</thead>
<tbody><tr>
<td>r</td>
<td>文件</td>
<td>可读，可以使用类似cat等命令查看文件内容</td>
</tr>
<tr>
<td>w</td>
<td>文件</td>
<td>可写，可以编辑或删除此文件</td>
</tr>
<tr>
<td>x</td>
<td>文件</td>
<td>可执行，eXacutable，可以在命令提示符下当作命令提交给内核运行</td>
</tr>
<tr>
<td>r</td>
<td>目录</td>
<td>可以对此目录执行ls以列出内部的所有文件</td>
</tr>
<tr>
<td>w</td>
<td>目录</td>
<td>可以在此目录中创建文件，也可删除此目录中的文件</td>
</tr>
<tr>
<td>x</td>
<td>目录</td>
<td>可以使用cd切换进此目录，也可以使用ls -l查看内部文件的详细信息</td>
</tr>
</tbody></table>
<p><strong>权限的八进制与十进制转换：</strong></p>
<table>
<thead>
<tr>
<th>权限</th>
<th>二进制</th>
<th>十进制</th>
</tr>
</thead>
<tbody><tr>
<td>—</td>
<td>000</td>
<td>0</td>
</tr>
<tr>
<td>–x</td>
<td>001</td>
<td>1</td>
</tr>
<tr>
<td>-w-</td>
<td>010</td>
<td>2</td>
</tr>
<tr>
<td>-wx</td>
<td>011</td>
<td>3</td>
</tr>
<tr>
<td>r–</td>
<td>100</td>
<td>4</td>
</tr>
<tr>
<td>r-x</td>
<td>101</td>
<td>5</td>
</tr>
<tr>
<td>rw-</td>
<td>110</td>
<td>6</td>
</tr>
<tr>
<td>rwx</td>
<td>111</td>
<td>7</td>
</tr>
</tbody></table>
<h1 id="2-权限管理命令"><a href="#2-权限管理命令" class="headerlink" title="2. 权限管理命令"></a>2. 权限管理命令</h1><h2 id="2-1-修改权限的命令chmod"><a href="#2-1-修改权限的命令chmod" class="headerlink" title="2.1 修改权限的命令chmod"></a>2.1 修改权限的命令chmod</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">用法：chmod [选项] ...模式[，模式] ...文件......</span><br><span class="line">或：chmod [选项] ...八进制模式文件...</span><br><span class="line">或：chmod [选项] ... --reference =参考文件文件......</span><br><span class="line">将每个文件的模式更改为MODE。</span><br><span class="line">使用--reference，将每个FILE的模式更改为RFILE的模式。</span><br><span class="line"></span><br><span class="line">   -c， - 更改类似于详细信息，但仅在进行更改时报告</span><br><span class="line">   -f， --  silent， -  quiet抑制大多数错误消息</span><br><span class="line">   -v， --  verbose为每个处理的文件输出诊断</span><br><span class="line">       --no-preserve-root不要特别处理&apos;/&apos;（默认值）</span><br><span class="line">       --preserve-root无法在&apos;/&apos;上递归操作</span><br><span class="line">       --reference = RFILE使用RFILE的模式而不是MODE值</span><br><span class="line">   -R， - 递归地递归更改文件和目录</span><br><span class="line">      --help显示此帮助信息并退出</span><br><span class="line">      --version显示版本信息并退出</span><br><span class="line">修改某类用户或某些类用户权限：</span><br><span class="line">u,g,o,a（用户类别）</span><br><span class="line"></span><br><span class="line">chmod 用户类别=MODE file,.....</span><br><span class="line">chmod 用户类别=MODE,用户类别=MODE file,.....</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">修改某类的用户某位或某些位权限：</span><br><span class="line">u,g,o,a（用户类别）</span><br><span class="line"></span><br><span class="line">chmod 用户类别+|-MODE file,.....</span><br><span class="line">chmod 用户类别+|-MODE,用户类别+|-MODE file,.....</span><br><span class="line">chmod +|-MODE file,.....</span><br><span class="line">每个MODE的形式为&apos;[ugoa] *（[-+ =]（[rwxXst] * | [ugo]））+ | [-+=] [0-7] +&apos;。</span><br></pre></td></tr></table></figure>

<p><strong>示例</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# ll</span><br><span class="line">总用量 8</span><br><span class="line">-rw-r--r--. 1 root root    0 3月   5 18:35 a</span><br><span class="line">-rw-------. 1 root root 1714 3月   4 17:46 anaconda-ks.cfg</span><br><span class="line">drwxr-xr-x. 2 root root    6 3月   5 18:35 b</span><br><span class="line">-rw-r--r--. 1 root root 1762 3月   4 17:50 initial-setup-ks.cfg</span><br><span class="line">drwxr-xr-x. 3 root root   15 3月   5 19:11 w</span><br><span class="line">[root@wenhs5479 ~]# chmod 777 a</span><br><span class="line">[root@wenhs5479 ~]# ll</span><br><span class="line">总用量 8</span><br><span class="line">-rwxrwxrwx. 1 root root    0 3月   5 18:35 a</span><br><span class="line">-rw-------. 1 root root 1714 3月   4 17:46 anaconda-ks.cfg</span><br><span class="line">drwxr-xr-x. 2 root root    6 3月   5 18:35 b</span><br><span class="line">-rw-r--r--. 1 root root 1762 3月   4 17:50 initial-setup-ks.cfg</span><br><span class="line">drwxr-xr-x. 3 root root   15 3月   5 19:11 w</span><br><span class="line">[root@wenhs5479 ~]# chmod u-x,g-w,o-r a</span><br><span class="line">[root@wenhs5479 ~]# ll</span><br><span class="line">总用量 8</span><br><span class="line">-rw-r-x-wx. 1 root root    0 3月   5 18:35 a</span><br><span class="line">-rw-------. 1 root root 1714 3月   4 17:46 anaconda-ks.cfg</span><br><span class="line">drwxr-xr-x. 2 root root    6 3月   5 18:35 b</span><br><span class="line">-rw-r--r--. 1 root root 1762 3月   4 17:50 initial-setup-ks.cfg</span><br><span class="line">drwxr-xr-x. 3 root root   15 3月   5 19:11 w</span><br></pre></td></tr></table></figure>

<ol>
<li><p>切换到shell脚本所在的目录，执行</p>
</li>
<li><p>以绝对路径的方式执行</p>
</li>
<li><p>直接用bash或sh执行</p>
</li>
<li><p>现行的shell中执行</p>
</li>
</ol>
<p>对于第4种不会创建子进程，而是在父进程中直接执行。</p>
<p>上面的差异是因为子进程不能改变父进程的执行环境，所以CD(内建命令，只有内建命令才可以改变shell 的执行环境)没有成功，但是第4种没有子进程，所以CD成功。</p>
<h2 id="2-2-修改文件属主和属组的命令chown"><a href="#2-2-修改文件属主和属组的命令chown" class="headerlink" title="2.2 修改文件属主和属组的命令chown"></a>2.2 修改文件属主和属组的命令chown</h2><p><strong>chown命令只有管理员可以使用。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[openstack@wenhs5479 ~]$ chown root.root w</span><br><span class="line">chown: 正在更改&quot;w&quot; 的所有者: 不允许的操作</span><br><span class="line">[openstack@wenhs5479 ~]$ sudo chown root.root w</span><br><span class="line"></span><br><span class="line">我们信任您已经从系统管理员那里了解了日常注意事项。</span><br><span class="line">总结起来无外乎这三点：</span><br><span class="line"></span><br><span class="line">    #1) 尊重别人的隐私。</span><br><span class="line">    #2) 输入前要先考虑(后果和风险)。</span><br><span class="line">    #3) 权力越大，责任越大。</span><br><span class="line"></span><br><span class="line">[sudo] openstack 的密码：</span><br><span class="line">openstack 不在 sudoers 文件中。此事将被报告。</span><br><span class="line">[openstack@wenhs5479 ~]$ ll</span><br><span class="line">总用量 2244</span><br><span class="line">-rwsr-xr-x. 1 openstack openstack 2294208 3月   5 19:30 vim</span><br><span class="line">-rw-rw-r--. 1 openstack openstack       0 3月   6 09:31 w</span><br><span class="line">[openstack@wenhs5479 ~]$ </span><br><span class="line">由此可见,普通账户无法更改文件属主属组</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">用法：chown [选项] ... [所有者] [：[组]]文件......</span><br><span class="line">或：chown [选项] ... --reference =参考文件文件......</span><br><span class="line">将每个文件的所有者和/或组更改为所有者和/或组。</span><br><span class="line">使用--reference，将每个FILE的所有者和组更改为RFILE的所有者和组。</span><br><span class="line"></span><br><span class="line">  -c， --changes	类似于详细信息，但仅在进行更改时报告</span><br><span class="line">  -f， --silent, --quiet	抑制大多数错误消息</span><br><span class="line">  -v， --verbose	为每个处理的文件输出诊断</span><br><span class="line">      --deference	会影响每个符号链接的引用（这是</span><br><span class="line">                         默认情况下），而不是符号链接本身</span><br><span class="line">  -h， --no-dereference	影响符号链接而不是任何引用文件</span><br><span class="line">                         （仅适用于可以更改的系统</span><br><span class="line">                         符号链接的所有权）</span><br><span class="line">      --from =当前所有者：当前所属组</span><br><span class="line">                         只当每个文件的所有者和组符合选项所指定时才更改所</span><br><span class="line">有者和组。其中一个可以省略，这时已省略的属性就不</span><br><span class="line">需要符合原有的属性。</span><br><span class="line">      --no-preserve-root	不要特别处理&apos;/&apos;（默认值）</span><br><span class="line">      --preserve-root	无法在&apos;/&apos;上递归操作</span><br><span class="line">      --reference = RFILE使用RFILE的所有者和组而不是</span><br><span class="line">                         指定OWNER：GROUP值</span><br><span class="line">  -R， - 递归地对文件和目录进行递归操作</span><br><span class="line"></span><br><span class="line">以下选项修改-R时遍历层次结构的方式</span><br><span class="line">选项也被指定。如果指定了多个，则仅指定最终</span><br><span class="line">一个生效。</span><br><span class="line"></span><br><span class="line">  -H		如果命令行参数是符号链接到一个目录，遍历它</span><br><span class="line">  -L		遍历到目录的每个符号链接遇到</span><br><span class="line">  -P		不遍历任何符号链接（默认）</span><br><span class="line"></span><br><span class="line">      --help显示此帮助信息并退出</span><br><span class="line">      --version显示版本信息并退出</span><br><span class="line"></span><br><span class="line">如果失踪，所有者不变。如果遗失，则组不变，但已更改</span><br><span class="line">如果在符号所有者之后隐含&apos;：&apos;，则登录组。</span><br><span class="line">OWNER和GROUP可以是数字也可以是符号。</span><br><span class="line"></span><br><span class="line">chown root /u		将/u的属主更改为“root”。</span><br><span class="line">chown root：staff /u		和上面类似，但同时也将其属更改为“staff”。</span><br><span class="line">chown -hR root /u		将/u及其子目录下所有文件的属主更改为“root”。</span><br></pre></td></tr></table></figure>

<p><strong>示例下面练习题比较全</strong></p>
<h2 id="2-3-修改文件的属组命令chgrp"><a href="#2-3-修改文件的属组命令chgrp" class="headerlink" title="2.3 修改文件的属组命令chgrp"></a>2.3 修改文件的属组命令chgrp</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">用法：chgrp [选项] ...用户组文件...</span><br><span class="line">或：chgrp [选项] ... --reference =参考文件文件......</span><br><span class="line">将每个FILE的组更改为GROUP。</span><br><span class="line">使用--reference，将每个FILE的组更改为RFILE的组。</span><br><span class="line"></span><br><span class="line">  -c， - 更改类似于详细信息，但仅在进行更改时报告</span><br><span class="line">  -f， --silent， --quiet		抑制大多数错误消息</span><br><span class="line">  -v， --verbose	为每个处理的文件输出诊断</span><br><span class="line">      --deference	会影响每个符号链接的引用（这是</span><br><span class="line">                         默认情况下），而不是符号链接本身</span><br><span class="line">  -h， --no-dereference	影响符号链接而不是任何引用文件</span><br><span class="line">                         （仅适用于可以更改的系统</span><br><span class="line">                         符号链接的所有权）</span><br><span class="line">      --no-preserve-root	不要特别处理&apos;/&apos;（默认值）</span><br><span class="line">      --preserve-root	无法在&apos;/&apos;上递归操作</span><br><span class="line">      --reference = RFILE使用RFILE的组而不是指定</span><br><span class="line">                         GROUP值</span><br><span class="line">  -R， --recursive	地对文件和目录进行递归操作</span><br><span class="line"></span><br><span class="line">以下选项修改-R时遍历层次结构的方式</span><br><span class="line">选项也被指定。如果指定了多个，则仅指定最终</span><br><span class="line">一个生效。</span><br><span class="line"></span><br><span class="line">  -H	如果命令行参数是符号链接到一个目录，遍历它</span><br><span class="line">  -L	遍历到目录的每个符号链接遇到</span><br><span class="line">  -P	不遍历任何符号链接（默认）</span><br><span class="line"></span><br><span class="line">      --help	显示此帮助信息并退出</span><br><span class="line">      --version	显示版本信息并退出</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# chgrp openstack a</span><br><span class="line">[root@wenhs5479 ~]# ll</span><br><span class="line">总用量 8</span><br><span class="line">-rw-r-x-wx. 1 root openstack    0 3月   5 18:35 a</span><br><span class="line">-rw-------. 1 root root      1714 3月   4 17:46 anaconda-ks.cfg</span><br><span class="line">drwxr-xr-x. 2 root root         6 3月   5 18:35 b</span><br><span class="line">-rw-r--r--. 1 root root      1762 3月   4 17:50 initial-setup-ks.cfg</span><br><span class="line">drwxr-xr-x. 3 root root        15 3月   5 19:11 w</span><br><span class="line"></span><br><span class="line">只能更改属组,较为鸡肋,推荐使用chown,方便快捷</span><br></pre></td></tr></table></figure>

<h1 id="3-遮罩码"><a href="#3-遮罩码" class="headerlink" title="3. 遮罩码"></a>3. 遮罩码</h1><p>为什么文件创建以后默认权限是644？<br>为什么目录创建以后默认权限是755？</p>
<ul>
<li>因为有遮罩码的存在,所以默认权限是644和755,遮罩码用来遮盖一些权限,保证文件的安全性</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# touch a</span><br><span class="line">[root@wenhs5479 ~]# ll</span><br><span class="line">总用量 8</span><br><span class="line">-rw-r--r--. 1 root root    0 3月   5 18:35 a</span><br><span class="line">-rw-------. 1 root root 1714 3月   4 17:46 anaconda-ks.cfg</span><br><span class="line">-rw-r--r--. 1 root root 1762 3月   4 17:50 initial-setup-ks.cfg</span><br><span class="line">[root@wenhs5479 ~]# mkdir b</span><br><span class="line">[root@wenhs5479 ~]# ll</span><br><span class="line">总用量 8</span><br><span class="line">-rw-r--r--. 1 root root    0 3月   5 18:35 a</span><br><span class="line">-rw-------. 1 root root 1714 3月   4 17:46 anaconda-ks.cfg</span><br><span class="line">drwxr-xr-x. 2 root root    6 3月   5 18:35 b</span><br><span class="line">-rw-r--r--. 1 root root 1762 3月   4 17:50 initial-setup-ks.cfg</span><br><span class="line">[root@wenhs5479 ~]#</span><br></pre></td></tr></table></figure>

<p>这是由遮罩码umask来控制的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# umask </span><br><span class="line">0022    \\默认遮罩码</span><br></pre></td></tr></table></figure>

<p><code>umask: 用法:umask [-p] [-S] [模式]</code></p>
<p>从名字就能看出来，遮罩码umask是用来隐藏一些权限的。举例：如果你不想让人家认出你，你会怎么办？</p>
<p><strong>文件最终的权限为：</strong></p>
<ul>
<li>666-umask</li>
</ul>
<p><strong>目录最终的权限为：</strong></p>
<ul>
<li>777-umask</li>
</ul>
<p><strong>文件默认是不能具有执行权限的，如果算得的结果有执行权限则将其权限整体加1。</strong></p>
<p><strong>修改的权限不在遮罩码范围类,也就是改什么权限,就是什么权限</strong></p>
<p><strong>chattr锁定文件：</strong></p>
<ul>
<li><code>chattr +i 文件路径</code>锁定文件，不得移动删除等</li>
<li><code>chattr -i 文件路径</code>    解锁文件</li>
</ul>
<h1 id="4-linux安全上下文与特殊权限"><a href="#4-linux安全上下文与特殊权限" class="headerlink" title="4. linux安全上下文与特殊权限"></a>4. linux安全上下文与特殊权限</h1><h2 id="4-1-linux安全上下文"><a href="#4-1-linux安全上下文" class="headerlink" title="4.1 linux安全上下文"></a>4.1 linux安全上下文</h2><p><strong>前提：进程有属主和属组；文件有属主和属组</strong></p>
<ul>
<li>任何一个可执行程序文件能不能启动为进程，取决于发起者对程序文件是否拥有可执行权限；</li>
<li>启动为进程后，其进程的属主为发起者，属组为发起者所属的组</li>
<li>进程访问文件时的权限取决于进程的发起者：<ul>
<li>进程的发起者是文件的属主时，则应用文件属主权限</li>
<li>进程的发起者是文件的属组时，则应用文件属组权限</li>
<li>应用文件“其它”权限</li>
</ul>
</li>
</ul>
<h2 id="4-2-特殊权限"><a href="#4-2-特殊权限" class="headerlink" title="4.2 特殊权限"></a>4.2 特殊权限</h2><p><strong>linux默认权限是根据linux安全上下文的方式来控制的，而特殊权限的存在打破了linux安全上下文的规则。</strong></p>
<p>SUID(4)(给程序的特殊权限)     //运行程序时，这个程序启动的进程的属主是程序文件自身的属主，而不是启动者为属主</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod u+s file</span><br><span class="line">chmod u-s file</span><br><span class="line">如果file本身原来就有执行权限，则SUID显示为s，否则显示为S</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# chown openstack.openstack /home/openstack/vim </span><br><span class="line">[root@wenhs5479 ~]# ls -al /home/openstack/</span><br><span class="line">总用量 2256</span><br><span class="line">drwx------. 3 openstack openstack      89 3月   5 19:30 .</span><br><span class="line">drwxr-xr-x. 4 root      root           35 3月   5 18:21 ..</span><br><span class="line">-rw-------. 1 openstack openstack      18 3月   5 18:21 .bash_logout</span><br><span class="line">-rw-------. 1 openstack openstack     193 3月   5 18:21 .bash_profile</span><br><span class="line">-rw-------. 1 openstack openstack     231 3月   5 18:21 .bashrc</span><br><span class="line">drwx------. 4 openstack openstack      39 3月   5 18:21 .mozilla</span><br><span class="line">-rwxr-xr-x. 1 openstack openstack 2294208 3月   5 19:30 vim</span><br><span class="line">[root@wenhs5479 ~]# chmod 4755 /home/openstack/vim </span><br><span class="line">[root@wenhs5479 ~]# ls -al /home/openstack/</span><br><span class="line">总用量 2256</span><br><span class="line">drwx------. 3 openstack openstack      89 3月   5 19:30 .</span><br><span class="line">drwxr-xr-x. 4 root      root           35 3月   5 18:21 ..</span><br><span class="line">-rw-------. 1 openstack openstack      18 3月   5 18:21 .bash_logout</span><br><span class="line">-rw-------. 1 openstack openstack     193 3月   5 18:21 .bash_profile</span><br><span class="line">-rw-------. 1 openstack openstack     231 3月   5 18:21 .bashrc</span><br><span class="line">drwx------. 4 openstack openstack      39 3月   5 18:21 .mozilla</span><br><span class="line">-rwsr-xr-x. 1 openstack openstack 2294208 3月   5 19:30 vim</span><br><span class="line">[root@wenhs5479 ~]# /home/openstack/vim s</span><br><span class="line">------------------------------------------------------------------------</span><br><span class="line">[root@wenhs5479 ~]# ps -ef |grep vim</span><br><span class="line">opensta+ 116362 109853  0 19:32 pts/1    00:00:00 /home/openstack/vim s</span><br><span class="line">root     116420 116367  0 19:32 pts/2    00:00:00 grep --color=auto vim</span><br></pre></td></tr></table></figure>

<p>SGID(2)(给目录的特殊权限)     //运行程序时，这个程序启动的进程的属组是程序文件自身的属组，而不是启动者所属的基本组</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">默认情况下，用户创建文件时，其属组为此用户所属的基本组；</span><br><span class="line">一旦某目录被设定了SGID，则对此目录有写权限的用户在此目录中创建的文件或目录，其所属的组 \</span><br><span class="line">为此设定了SGID的目录的属组</span><br><span class="line">chmod g+s DIR</span><br><span class="line">chmod g-s DIR</span><br><span class="line">如果file本身原来就有执行权限，则SGID显示为s，否则显示为S</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# chmod g+s w</span><br><span class="line">[root@wenhs5479 ~]# ll</span><br><span class="line">总用量 8</span><br><span class="line">-rw-r-x-wx. 1 root      openstack    0 3月   5 18:35 a</span><br><span class="line">-rw-------. 1 root      root      1714 3月   4 17:46 anaconda-ks.cfg</span><br><span class="line">drwxr-xr-x. 2 root      root         6 3月   5 18:35 b</span><br><span class="line">-rw-r--r--. 1 root      root      1762 3月   4 17:50 initial-setup-ks.cfg</span><br><span class="line">drwxr-sr-x. 3 openstack openstack   15 3月   5 19:11 w</span><br><span class="line">[root@wenhs5479 ~]# cd w</span><br><span class="line">[root@wenhs5479 w]# ls</span><br><span class="line">e</span><br><span class="line">[root@wenhs5479 w]# ll</span><br><span class="line">总用量 0</span><br><span class="line">drwxr-xr-x. 3 openstack openstack 15 3月   5 19:11 e</span><br><span class="line">[root@wenhs5479 w]# touch 1</span><br><span class="line">[root@wenhs5479 w]# ll</span><br><span class="line">总用量 0</span><br><span class="line">-rw-r--r--. 1 root      openstack  0 3月   6 09:44 1</span><br><span class="line">drwxr-xr-x. 3 openstack openstack 15 3月   5 19:11 e</span><br><span class="line">[root@wenhs5479 w]# mkdir 2</span><br><span class="line">[root@wenhs5479 w]# ll</span><br><span class="line">总用量 0</span><br><span class="line">-rw-r--r--. 1 root      openstack  0 3月   6 09:44 1</span><br><span class="line">drwxr-sr-x. 2 root      openstack  6 3月   6 09:45 2</span><br><span class="line">drwxr-xr-x. 3 openstack openstack 15 3月   5 19:11 e</span><br><span class="line">[root@wenhs5479 w]#</span><br></pre></td></tr></table></figure>

<p>Sticky(1) (给目录的特殊权限)      //在一个公共目录，每个人都能创建文件，删除自己的文件，但是不能删除别人创建的文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod o+t DIR</span><br><span class="line">chmod o-t DIR</span><br><span class="line">如果DIR本身原来就有执行权限，则Sticky显示为t，否则显示为T</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">4755    //有SUID，文件权限为755</span><br><span class="line">2755    //有SGID，文件权限为755</span><br><span class="line">1755    //有Sticky，文件权限为755</span><br><span class="line">7755    //有SUID、SGID、Sticky，文件权限为755</span><br><span class="line">这里前面的4、2、1分别表示SUID、SGID、Sticky</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[test@wenhs5479 test]$ ll</span><br><span class="line">总用量 0</span><br><span class="line">-rw-rw-r-T. 1 openstack openstack 0 3月   6 09:51 openstack</span><br><span class="line">-rw-rw-r--. 1 test      test      0 3月   6 09:53 test2</span><br><span class="line">[test@wenhs5479 test]$ rm -rf openstack </span><br><span class="line">rm: 无法删除&quot;openstack&quot;: 不允许的操作</span><br><span class="line">[test@wenhs5479 test]$ sudo rm -rf openstack </span><br><span class="line">[sudo] test 的密码：</span><br><span class="line">[test@wenhs5479 test]$ ll</span><br><span class="line">总用量 0</span><br><span class="line">-rw-rw-r--. 1 test test 0 3月   6 09:53 test2</span><br><span class="line">[test@wenhs5479 test]$</span><br></pre></td></tr></table></figure>

<p><strong>管理员的权限是一个流氓用户,一般情况下都可以为所欲为,普通账号的话,无法删除别人创建的东西</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[test@wenhs5479 test]$ touch openstack</span><br><span class="line">[test@wenhs5479 test]$ sudo chown openstack.openstack openstack </span><br><span class="line">[test@wenhs5479 test]$ ll</span><br><span class="line">总用量 0</span><br><span class="line">-rw-rw-r--. 1 openstack openstack 0 3月   6 09:57 openstack</span><br><span class="line">-rw-rw-r--. 1 test      test      0 3月   6 09:53 test2</span><br><span class="line">[test@wenhs5479 test]$ sudo chmod 7777 openstack </span><br><span class="line">[test@wenhs5479 test]$ ll</span><br><span class="line">总用量 0</span><br><span class="line">-rwsrwsrwt. 1 openstack openstack 0 3月   6 09:57 openstack</span><br><span class="line">-rw-rw-r--. 1 test      test      0 3月   6 09:53 test2</span><br><span class="line">[test@wenhs5479 test]$ sudo rm -rf openstack </span><br><span class="line">[test@wenhs5479 test]$ ll</span><br><span class="line">总用量 0</span><br><span class="line">-rw-rw-r--. 1 test test 0 3月   6 09:53 test2</span><br><span class="line">[test@wenhs5479 test]$</span><br></pre></td></tr></table></figure>

<h1 id="5-文件系统访问控制列表facl"><a href="#5-文件系统访问控制列表facl" class="headerlink" title="5. 文件系统访问控制列表facl"></a>5. 文件系统访问控制列表facl</h1><p><strong>facl（Filesystem Access Control List），利用文件扩展保存额外的访问控制权限。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">语法：setfacl [-bkndRLP] &#123; -m|-M|-x|-X ... &#125; file ...</span><br><span class="line">    -m      //设定,修改文件的当前ACL</span><br><span class="line">        u:UID:perm</span><br><span class="line">        g:GID:perm</span><br><span class="line">    setfacl -m u:test:rw file</span><br><span class="line">    setfacl -m g:test:rw file</span><br><span class="line">    如果要为某个目录设定默认的访问控制列表，只需要设定时在u或g前面加上d即可。 如：//setfacl -dm u:test:rw file，此时在此目录中创建的文件均继承此访问控制列表所设置的权限</span><br><span class="line">    -x      //取消,从文件的ACL中删除条目</span><br><span class="line">        u:UID</span><br><span class="line">        g:GID</span><br><span class="line">    setfacl -x u:test file</span><br><span class="line">    setfacl -x g:test file</span><br><span class="line">    -b      //Remove all ,删除所有扩展ACL条目</span><br><span class="line">     -d， --default	操作适用于默认ACL    </span><br><span class="line">语法：getfacl [-aceEsRLPtpndvh] file ...</span><br><span class="line">getfacl file</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">文件权限应用次序：</span><br><span class="line">默认情况下：</span><br><span class="line">    Owner --&gt; Group --&gt; Other</span><br><span class="line">有设置facl的情况下：</span><br><span class="line">    Owner --&gt; facl,user --&gt; Group --&gt; facl,group --&gt; Other</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# setfacl -m u:openstack:rwx jbgsn </span><br><span class="line">[root@wenhs5479 ~]# ll</span><br><span class="line">总用量 8</span><br><span class="line">-rwxrwxrwx. 1 root root 1714 3月   4 17:46 anaconda-ks.cfg</span><br><span class="line">-rwxrwxrwx. 1 root root 1762 3月   4 17:50 initial-setup-ks.cfg</span><br><span class="line">-rw-rwxr--+ 1 root root    0 3月   6 10:29 jbgsn</span><br><span class="line">drwxr-xr-x. 2 root root    6 3月   6 10:28 wenhs</span><br><span class="line">[root@wenhs5479 ~]# getfa</span><br><span class="line">getfacl   getfattr  </span><br><span class="line">[root@wenhs5479 ~]# getfacl jbgsn </span><br><span class="line"># file: jbgsn</span><br><span class="line"># owner: root</span><br><span class="line"># group: root</span><br><span class="line">user::rw-</span><br><span class="line">user:openstack:rwx</span><br><span class="line">group::r--</span><br><span class="line">mask::rwx</span><br><span class="line">other::r--</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# setfacl -x u:openstack jbgsn </span><br><span class="line">[root@wenhs5479 ~]# ll</span><br><span class="line">总用量 8</span><br><span class="line">-rwxrwxrwx. 1 root root 1714 3月   4 17:46 anaconda-ks.cfg</span><br><span class="line">-rwxrwxrwx. 1 root root 1762 3月   4 17:50 initial-setup-ks.cfg</span><br><span class="line">-rw-r--r--+ 1 root root    0 3月   6 10:29 jbgsn</span><br><span class="line">drwxr-xr-x. 2 root root    6 3月   6 10:28 wenhs</span><br><span class="line">[root@wenhs5479 ~]# getfacl jbgsn </span><br><span class="line"># file: jbgsn</span><br><span class="line"># owner: root</span><br><span class="line"># group: root</span><br><span class="line">user::rw-</span><br><span class="line">group::r--</span><br><span class="line">mask::r--</span><br><span class="line">other::r--</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# setfacl -b jbgsn </span><br><span class="line">[root@wenhs5479 ~]# ll</span><br><span class="line">总用量 8</span><br><span class="line">-rwxrwxrwx. 1 root root 1714 3月   4 17:46 anaconda-ks.cfg</span><br><span class="line">-rwxrwxrwx. 1 root root 1762 3月   4 17:50 initial-setup-ks.cfg</span><br><span class="line">-rw-r--r--. 1 root root    0 3月   6 10:29 jbgsn</span><br><span class="line">drwxr-xr-x. 2 root root    6 3月   6 10:28 wenhs</span><br><span class="line">[root@wenhs5479 ~]# getfacl jbgsn </span><br><span class="line"># file: jbgsn</span><br><span class="line"># owner: root</span><br><span class="line"># group: root</span><br><span class="line">user::rw-</span><br><span class="line">group::r--</span><br><span class="line">other::r--</span><br></pre></td></tr></table></figure>

<h1 id="6-sudo"><a href="#6-sudo" class="headerlink" title="6. sudo"></a>6. sudo</h1><p>sudo可以实现某个用户能够以另外哪一个用户的身份通过哪些主机执行什么命令</p>
<p><strong>sudo的配置文件：/etc/sudoers</strong></p>
<p>使用visudo命令进行sudo的配置，每一行就是一个sudo条目，条目格式如下：</p>
<ul>
<li>who which_hosts=(runas) command<ul>
<li>who：User_Alias，表示运行命令者的身份</li>
<li>which_hosts：Host_Alias，通过哪些主机</li>
<li>runas：Runas_Alias，以哪个用户的身份</li>
<li>command：Cmnd_Alias，运行哪些命令</li>
</ul>
</li>
</ul>
<p><strong>别名必须全部而且只能使用大写英文字母的组合，可以使用感叹号取反</strong></p>
<p><strong>别名分类：</strong></p>
<ul>
<li>用户别名：<ul>
<li>User_Alias NETWORKADMIN =<ul>
<li>用户的用户名</li>
<li>组名，使用%引导</li>
<li>还可以其它已经定义的用户别名</li>
</ul>
</li>
</ul>
</li>
<li>主机别名：<ul>
<li>Host_Alias =<ul>
<li>主机名</li>
<li>IP地址</li>
<li>网络地址</li>
<li>其它主机别名</li>
</ul>
</li>
</ul>
</li>
<li>Runas别名：<ul>
<li>Runas_Alias =<ul>
<li>用户名</li>
<li>%组名</li>
<li>其它的Runas别名</li>
</ul>
</li>
</ul>
</li>
<li>命令别名：<ul>
<li>Cmnd_Alias =<ul>
<li>命令路径</li>
<li>目录（此目录内的所有命令）</li>
<li>其它已定义的命令别名</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">sudo - 以其他用户身份执行一条命令</span><br><span class="line"></span><br><span class="line">usage: sudo -h | -K | -k | -V</span><br><span class="line">usage: sudo -v [-AknS] [-g group] [-h host] [-p prompt] [-u user]</span><br><span class="line">usage: sudo -l [-AknS] [-g group] [-h host] [-p prompt] [-U user] [-u user] [command]</span><br><span class="line">usage: sudo [-AbEHknPS] [-r role] [-t type] [-C num] [-g group] [-h host] [-p prompt] [-T timeout] [-u user]</span><br><span class="line">            [VAR=value] [-i|-s] [&lt;command&gt;]</span><br><span class="line">usage: sudo -e [-AknS] [-r role] [-t type] [-C num] [-g group] [-h host] [-p prompt] [-T timeout] [-u user]</span><br><span class="line">            file ...</span><br><span class="line"></span><br><span class="line">选项：</span><br><span class="line">  -A, --askpass                 使用助手程序进行密码提示</span><br><span class="line">  -b, --background              在后台运行命令</span><br><span class="line">  -C, --close-from=num          关闭所有 &gt;= num 的文件描述符</span><br><span class="line">  -E, --preserve-env            在执行命令时保留用户环境</span><br><span class="line">      --preserve-env=list       保留特定的环境变量</span><br><span class="line">  -e, --edit                    编辑文件而非执行命令</span><br><span class="line">  -g, --group=group             以指定的用户组或 ID 执行命令</span><br><span class="line">  -H, --set-home                将 HOME 变量设为目标用户的主目录。</span><br><span class="line">  -h, --help                    显示帮助消息并退出</span><br><span class="line">  -h, --host=host               在主机上运行命令(如果插件支持)</span><br><span class="line">  -i, --login                   以目标用户身份运行一个登录 shell；可同时指定一条命令</span><br><span class="line">  -K, --remove-timestamp        完全移除时间戳文件</span><br><span class="line">  -k, --reset-timestamp         无效的时间戳文件,默认认证信息在5分钟后失效</span><br><span class="line">  -l, --list                    列出用户权限或检查某个特定命令；对于长格式，使用两次</span><br><span class="line">  -n, --non-interactive         非交互模式，不提示</span><br><span class="line">  -P, --preserve-groups         保留组向量，而非设置为目标的组向量</span><br><span class="line">  -p, --prompt=prompt           使用指定的密码提示</span><br><span class="line">  -r, --role=role               以指定的角色创建 SELinux 安全环境</span><br><span class="line">  -S, --stdin                   从标准输入读取密码</span><br><span class="line">  -s, --shell                   以目标用户运行 shell；可同时指定一条命令</span><br><span class="line">  -t, --type=type               以指定的类型创建 SELinux 安全环境</span><br><span class="line">  -T, --command-timeout=timeout 在达到指定时间限制后终止命令</span><br><span class="line">  -U, --other-user=user         在列表模式中显示用户的权限</span><br><span class="line">  -u, --user=user               以指定用户或 ID 运行命令(或编辑文件),默认为root</span><br><span class="line">  -V, --version                 显示版本信息并退出</span><br><span class="line">  -v, --validate                更新用户的时间戳而不执行命令,因为sudo在第一次执行时或是在N分钟内没有执行（N默认为5）会问密码，这个参数,是重新做一次确认，如果超过N分钟，也会问密码</span><br><span class="line">  --                            停止处理命令行参数</span><br></pre></td></tr></table></figure>

<h1 id="7-管理命令"><a href="#7-管理命令" class="headerlink" title="7. 管理命令"></a>7. 管理命令</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">w   //显示当前登录到系统的用户有哪些，以及其正在做什么 </span><br><span class="line">[root@wenhs5479 ~]# w</span><br><span class="line"> 18:50:08 up 11:16,  3 users,  load average: 0.00, 0.01, 0.05</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">test     :0       :0               一17   ?xdm?   5:31   0.49s /usr/libexec/gnome-session-binary --session gnome-classic</span><br><span class="line">root     pts/1    192.168.131.100  17:51    0.00s  0.48s  0.04s w</span><br><span class="line">root     pts/0    192.168.131.100  13:59    1:45m  0.26s  0.26s -bash</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sleep   //睡眠，写脚本为防止上一个命令没执行完下一命令就开始执行时可以加上sleep #,表示停顿#秒后再执行后面的命令</span><br><span class="line">sleep NUMBER[SUFFIX]...</span><br><span class="line">SUFFIX：</span><br><span class="line">      s:秒，默认</span><br><span class="line">      m：分</span><br><span class="line">      h：小时</span><br><span class="line">      d：天</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# echo wenhs;sleep 5s;echo qingjiubaba</span><br><span class="line">wenhs</span><br><span class="line">qingjiubaba</span><br><span class="line">[root@wenhs5479 ~]#</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">last    //显示/var/log/wtmp文件，显示用户登录历史及系统重启历史                </span><br><span class="line">-n #        //显示最近#次的相关信息  </span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# last</span><br><span class="line">root     pts/1        192.168.131.100  Tue Mar  5 17:51   still logged in   </span><br><span class="line">root     pts/0        192.168.131.100  Tue Mar  5 13:59   still logged in   </span><br><span class="line">root     pts/3        192.168.131.100  Tue Mar  5 09:51 - 15:54  (06:02)    </span><br><span class="line">root     pts/2        192.168.131.100  Tue Mar  5 09:06 - 15:54  (06:47)    </span><br><span class="line">root     pts/1        192.168.131.100  Tue Mar  5 09:05 - 11:05  (02:00)    </span><br><span class="line">test     pts/1        :0               Tue Mar  5 09:05 - 09:05  (00:00)    </span><br><span class="line">root     pts/0        192.168.131.100  Mon Mar  4 14:24 - 11:04  (20:39)    </span><br><span class="line">test     pts/0        :0               Mon Mar  4 14:23 - 14:24  (00:00)    </span><br><span class="line">root     pts/1        192.168.131.100  Mon Mar  4 09:53 - 16:34  (06:40)    </span><br><span class="line">test     pts/0        :0               Mon Mar  4 09:52 - 09:55  (00:02)    </span><br><span class="line">test     :0           :0               Mon Mar  4 17:52   still logged in   </span><br><span class="line">reboot   system boot  3.10.0-957.el7.x Mon Mar  4 17:50 - 18:54 (1+01:04)   </span><br><span class="line"></span><br><span class="line">wtmp begins Mon Mar  4 17:50:11 2019</span><br><span class="line">[root@wenhs5479 ~]#</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">lastb   //显示/var/log/btmp文件，显示用户错误的登录尝试                </span><br><span class="line">-n #        //显示最近#次的相关信息  </span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# lastb</span><br><span class="line"></span><br><span class="line">btmp begins Mon Mar  4 17:50:18 2019</span><br><span class="line">[root@wenhs5479 ~]# lastb -n 10</span><br><span class="line"></span><br><span class="line">btmp begins Mon Mar  4 17:50:18 2019</span><br><span class="line">[root@wenhs5479 ~]#</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">lastlog //显示每个用户最近一次成功登录信息                </span><br><span class="line">-u username     //显示特定用户最近的登录信息      </span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# lastlog </span><br><span class="line">用户名           端口     来自             最后登陆时间</span><br><span class="line">root             pts/1    192.168.131.100  二 3月  5 17:51:22 +0800 2019</span><br><span class="line">bin                                        **从未登录过**</span><br><span class="line">daemon                                     **从未登录过**</span><br><span class="line">adm                                        **从未登录过**</span><br><span class="line">lp                                         **从未登录过**</span><br><span class="line">sync                                       **从未登录过**</span><br><span class="line">shutdown                                   **从未登录过**</span><br><span class="line">halt                                       **从未登录过**</span><br><span class="line">mail                                       **从未登录过**</span><br><span class="line">operator                                   **从未登录过**</span><br><span class="line">games                                      **从未登录过**</span><br><span class="line">ftp                                        **从未登录过**</span><br><span class="line">nobody                                     **从未登录过**</span><br><span class="line">systemd-network                            **从未登录过**</span><br><span class="line">dbus                                       **从未登录过**</span><br><span class="line">polkitd                                    **从未登录过**</span><br><span class="line">libstoragemgmt                             **从未登录过**</span><br><span class="line">colord                                     **从未登录过**</span><br><span class="line">rpc                                        **从未登录过**</span><br><span class="line">saned                                      **从未登录过**</span><br><span class="line">gluster                                    **从未登录过**</span><br><span class="line">amandabackup                               **从未登录过**</span><br><span class="line">saslauth                                   **从未登录过**</span><br><span class="line">abrt                                       **从未登录过**</span><br><span class="line">rtkit                                      **从未登录过**</span><br><span class="line">pulse                                      **从未登录过**</span><br><span class="line">radvd                                      **从未登录过**</span><br><span class="line">unbound                                    **从未登录过**</span><br><span class="line">chrony                                     **从未登录过**</span><br><span class="line">rpcuser                                    **从未登录过**</span><br><span class="line">nfsnobody                                  **从未登录过**</span><br><span class="line">qemu                                       **从未登录过**</span><br><span class="line">tss                                        **从未登录过**</span><br><span class="line">usbmuxd                                    **从未登录过**</span><br><span class="line">geoclue                                    **从未登录过**</span><br><span class="line">ntp                                        **从未登录过**</span><br><span class="line">sssd                                       **从未登录过**</span><br><span class="line">setroubleshoot                             **从未登录过**</span><br><span class="line">gdm                                        **从未登录过**</span><br><span class="line">gnome-initial-setup :0                        一 3月  4 17:50:45 +0800 2019</span><br><span class="line">sshd                                       **从未登录过**</span><br><span class="line">avahi                                      **从未登录过**</span><br><span class="line">postfix                                    **从未登录过**</span><br><span class="line">tcpdump                                    **从未登录过**</span><br><span class="line">test             pts/0                     二 3月  5 16:47:27 +0800 2019</span><br><span class="line">openstack        pts/1                     二 3月  5 18:21:56 +0800 2019</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# lastlog -u test</span><br><span class="line">用户名           端口     来自             最后登陆时间</span><br><span class="line">test             pts/0                     二 3月  5 16:47:27 +0800 2019</span><br><span class="line">[root@wenhs5479 ~]#</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">basename        //显示路径最后文件名  </span><br><span class="line">dirname			//显示目录名称</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# mkdir -p w/e/n/h/s/;touch w/e/n/h/s/1.txt</span><br><span class="line">[root@wenhs5479 ~]# ls</span><br><span class="line">a  anaconda-ks.cfg  b  initial-setup-ks.cfg  w</span><br><span class="line">[root@wenhs5479 ~]# basename w/e/n/h/s/1.txt </span><br><span class="line">1.txt</span><br><span class="line">[root@wenhs5479 ~]# dirname w/e/n/h/s/1.txt </span><br><span class="line">w/e/n/h/s</span><br><span class="line">[root@wenhs5479 ~]#</span><br></pre></td></tr></table></figure>

<h3 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h3><hr>
<p>1、新建一个没有家目录的用户openstack</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# useradd -M  openstack</span><br><span class="line">[root@wenhs5479 ~]# su - openstack</span><br><span class="line">su: 警告：无法更改到 /home/openstack 目录: 没有那个文件或目录</span><br><span class="line">-bash-4.2$ pwd</span><br><span class="line">/root</span><br><span class="line">-bash-4.2$</span><br></pre></td></tr></table></figure>

<p>2、复制/etc/skel为/home/openstack</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# cp -r /etc/skel/ /home/openstack/</span><br><span class="line">[root@wenhs5479 ~]# ls /home/</span><br><span class="line">openstack  test</span><br><span class="line">[root@wenhs5479 ~]# su - openstack</span><br><span class="line">上一次登录：二 3月  5 17:56:51 CST 2018pts/1 上</span><br><span class="line">[openstack@wenhs5479 ~]$ pwd</span><br><span class="line">/home/openstack</span><br><span class="line">[openstack@wenhs5479 ~]$</span><br></pre></td></tr></table></figure>

<p>3、改变/home/openstack及其内部文件的属主属组均为openstack</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# chown -R openstack.openstack /home/openstack/</span><br><span class="line">[root@wenhs5479 ~]# ls -al /home/openstack/</span><br><span class="line">总用量 12</span><br><span class="line">drwxr-xr-x. 3 openstack openstack  78 3月   5 18:02 .</span><br><span class="line">drwxr-xr-x. 4 root  root   31 3月   5 18:02 ..</span><br><span class="line">-rw-r--r--. 1 openstack openstack  18 3月   5 18:02 .bash_logout</span><br><span class="line">-rw-r--r--. 1 openstack openstack 193 3月   5 18:02 .bash_profile</span><br><span class="line">-rw-r--r--. 1 openstack openstack 231 3月   5 18:02 .bashrc</span><br><span class="line">drwxr-xr-x. 4 openstack openstack  39 3月   5 18:02 .mozilla</span><br></pre></td></tr></table></figure>

<p>4、设置/home/openstack及其内部的文件，属组和其它用户没有任何访问权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# chmod -R g-rwx /home/openstack/</span><br><span class="line">[root@wenhs5479 ~]# chmod -R o-rwx /home/openstack/</span><br><span class="line">[root@wenhs5479 ~]# ls -al /home/openstack/</span><br><span class="line">总用量 12</span><br><span class="line">drwx------. 3 openstack openstack  78 3月   5 18:21 .</span><br><span class="line">drwxr-xr-x. 4 root      root       35 3月   5 18:21 ..</span><br><span class="line">-rw-------. 1 openstack openstack  18 3月   5 18:21 .bash_logout</span><br><span class="line">-rw-------. 1 openstack openstack 193 3月   5 18:21 .bash_profile</span><br><span class="line">-rw-------. 1 openstack openstack 231 3月   5 18:21 .bashrc</span><br><span class="line">drwx------. 4 openstack openstack  39 3月   5 18:21 .mozilla</span><br><span class="line">[root@wenhs5479 ~]# ls -al /home/</span><br><span class="line">总用量 4</span><br><span class="line">drwxr-xr-x.  4 root      root        35 3月   5 18:21 .</span><br><span class="line">dr-xr-xr-x. 17 root      root       224 3月   4 17:44 ..</span><br><span class="line">drwx------.  3 openstack openstack   78 3月   5 18:21 openstack</span><br><span class="line">drwx------. 16 test      test      4096 3月   5 09:56 test</span><br><span class="line">[root@wenhs5479 ~]#</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    
	
	  <div>
        
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://aiwhs.github.io/2018/06/02/用户和组管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="itw">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="itw">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/06/02/用户和组管理/" class="post-title-link" itemprop="url">用户和组管理</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-06-02 08:15:57" itemprop="dateCreated datePublished" datetime="2018-06-02T08:15:57+08:00">2018-06-02</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-12 15:49:19" itemprop="dateModified" datetime="2019-07-12T15:49:19+08:00">2019-07-12</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux运维/" itemprop="url" rel="index"><span itemprop="name">Linux运维</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h1 id="1-用户和组管理"><a href="#1-用户和组管理" class="headerlink" title="1.用户和组管理"></a>1.用户和组管理</h1><p>先把实验环境centos7.5主机名改好:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# hostname wenhs5479</span><br><span class="line">[root@localhost ~]# bash</span><br><span class="line">[root@wenhs5479 ~]#</span><br></pre></td></tr></table></figure>

<h2 id="1-1-用户和组的概念"><a href="#1-1-用户和组的概念" class="headerlink" title="1.1 用户和组的概念"></a>1.1 用户和组的概念</h2><ol>
<li><strong>系统上的每个进程（运行的程序）都要做为特定用户运行。</strong></li>
<li><strong>每个文件是由一个特定的用户拥有。</strong></li>
<li><strong>访问文件和目录是受到用户限制的。</strong></li>
<li><strong>进程能够以何种方式访问文件和目录，是由与进程相关联的用户决定的。组：更加方便、有效的对文件赋权的一种方式 。</strong></li>
</ol>
<h4 id="Authentication：认证"><a href="#Authentication：认证" class="headerlink" title="Authentication：认证"></a>Authentication：认证</h4><h4 id="Authorization：授权"><a href="#Authorization：授权" class="headerlink" title="Authorization：授权"></a>Authorization：授权</h4><h4 id="Accouting：审计"><a href="#Accouting：审计" class="headerlink" title="Accouting：审计"></a>Accouting：审计</h4><h2 id="1-2-用户分类"><a href="#1-2-用户分类" class="headerlink" title="1.2 用户分类"></a>1.2 用户分类</h2><ol>
<li><strong>UID范围是0-65535及2的16次方</strong></li>
<li><strong>超级管理员的UID是0</strong></li>
<li><strong>1-200是系统用户，有系统分配给进程使用</strong></li>
<li><strong>201-999是系统用户，用来运行服务账户，不需要登录系统（动态分配）</strong></li>
<li><strong>1000-65535是普通用户</strong></li>
<li><strong>注意:在Linux7之前的惯例是UID1-499是系统用户（为守护类进程获取系统资源而完成权限指派的用户），UID500-60000是普通用户（为了完成交互式登录使用的用户）</strong></li>
</ol>
<h2 id="1-3-Linux安全上下文"><a href="#1-3-Linux安全上下文" class="headerlink" title="1.3 Linux安全上下文"></a>1.3 Linux安全上下文</h2><h5 id="运行中的程序：进程（process）"><a href="#运行中的程序：进程（process）" class="headerlink" title="运行中的程序：进程（process）"></a>运行中的程序：进程（process）</h5><ul>
<li>以进程发起者的身份运行<ul>
<li><input disabled type="checkbox"> root：vim</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# ps -ef |grep vim</span><br><span class="line">root      86222  83478  0 09:53 pts/2    00:00:00 vim aaa</span><br><span class="line">root      86244  86089  0 09:53 pts/3    00:00:00 grep --color=auto vim</span><br><span class="line">[root@wenhs5479 ~]#</span><br></pre></td></tr></table></figure>

<ul>
<li><input disabled type="checkbox"> test：vim</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# ps -ef |grep vim</span><br><span class="line">test      86407  86345  0 09:55 pts/2    00:00:00 vim aaa</span><br><span class="line">root      86413  86089  0 09:55 pts/3    00:00:00 grep --color=auto vim</span><br><span class="line">[root@wenhs5479 ~]#</span><br></pre></td></tr></table></figure>

<ul>
<li>进程所能够访问的所有资源的权限取决于进程的发起者的身份</li>
</ul>
<h5 id="Linux通过安全上下文的概念完成用户权限的指派。"><a href="#Linux通过安全上下文的概念完成用户权限的指派。" class="headerlink" title="Linux通过安全上下文的概念完成用户权限的指派。"></a>Linux通过安全上下文的概念完成用户权限的指派。</h5><ul>
<li>先判断用户是否是某文件的属主</li>
<li>再判断用户是否属于某个组</li>
<li>最后定其为其他用户</li>
</ul>
<h2 id="1-4-Linux用户组类别"><a href="#1-4-Linux用户组类别" class="headerlink" title="1.4 Linux用户组类别"></a>1.4 Linux用户组类别</h2><ul>
<li>私有组：创建用户时，如果没有为其指定所属的组，系统会自动为其创建一个与用户名相同的组</li>
</ul>
<ul>
<li>基本组：优先使用基本组，由系统分配给系统进程使用,用户的默认组</li>
<li>附加组(额外组)：默认组以外的其它组, 基本组不能满足授权要求，创建附加组，用户可以属于多个附加组</li>
</ul>
<h1 id="2-Linux用户和组相关的配置文件"><a href="#2-Linux用户和组相关的配置文件" class="headerlink" title="2. Linux用户和组相关的配置文件"></a>2. Linux用户和组相关的配置文件</h1><table>
<thead>
<tr>
<th>配置文件</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>/etc/passwd</td>
<td>用户及其属性信息（名称、uid、基本组id等等）</td>
</tr>
<tr>
<td>/etc/group</td>
<td>组及其属性信息</td>
</tr>
<tr>
<td>/etc/shadow</td>
<td>用户密码及其相关属性</td>
</tr>
<tr>
<td>/etc/gshadow</td>
<td>组密码及其相关属性。在用户执行基本组切换时使用</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>配置文件</th>
<th>/etc/passwd</th>
<th>/etc/group</th>
<th>注释说明(用户)</th>
</tr>
</thead>
<tbody><tr>
<td>第一字段</td>
<td>用户名</td>
<td>组名</td>
<td>用户的账户名称</td>
</tr>
<tr>
<td>第二字段</td>
<td>密码占位符</td>
<td>组密码</td>
<td>存放账户的口令，暂时是x表示，密码保存在/etc/shadow中</td>
</tr>
<tr>
<td>第三字段</td>
<td>UID</td>
<td>GID</td>
<td>用户标识号</td>
</tr>
<tr>
<td>第四字段</td>
<td>GID</td>
<td>以当前组为附加组的用户列表(分隔符为逗号)</td>
<td>组标识号</td>
</tr>
<tr>
<td>第五字段</td>
<td>用户的描述信息</td>
<td></td>
<td>用户的详细信息</td>
</tr>
<tr>
<td>第六字段</td>
<td>用户家目录</td>
<td></td>
<td>用户家目录，root家目录是/root普通用户的家目录在/home/username,可自定义</td>
</tr>
<tr>
<td>第七字段</td>
<td>用户的登录shell</td>
<td></td>
<td>用户登陆的linux使用的shell cat/etc/shells</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>配置文件</th>
<th>/etc/shadow</th>
<th>注释说明</th>
</tr>
</thead>
<tbody><tr>
<td>第一字段</td>
<td>登录名</td>
<td>用户的账户名称</td>
</tr>
<tr>
<td>第二字段</td>
<td>加密后的密码</td>
<td>用户密码，这是加密过的口令（未设置密码为！！）</td>
</tr>
<tr>
<td>第三字段</td>
<td>最近一次更改密码的日期</td>
<td>从1970年到最近一次更改密码时间之间过了多少天</td>
</tr>
<tr>
<td>第四字段</td>
<td>密码的最小使用期限</td>
<td>密码最少使用几天才可以更改密码(0表示无限制)</td>
</tr>
<tr>
<td>第五字段</td>
<td>密码的最大使用期限</td>
<td>密码使用多少天需要修改密码(默认99999永不过期)</td>
</tr>
<tr>
<td>第六字段</td>
<td>密码警告时间段</td>
<td>密码过期前多少天提醒用户更改密码(默认过期提前7天警告)</td>
</tr>
<tr>
<td>第七字段</td>
<td>密码禁用期</td>
<td>在此期限内, 用户依然可以登陆系统并更改密码, 指定天数过后, 账户被锁定</td>
</tr>
<tr>
<td>第八字段</td>
<td>帐号的过期日期</td>
<td>从1970年起,账户在这个日期前可使用，到期后失效</td>
</tr>
<tr>
<td>第九字段</td>
<td>保留字段</td>
<td>保留</td>
</tr>
</tbody></table>
<h2 id="2-2-加密方法"><a href="#2-2-加密方法" class="headerlink" title="2.2 加密方法"></a>2.2 加密方法</h2><ul>
<li><input disabled type="checkbox"> <strong>对称加密</strong>：加密和解密使用同一个密钥</li>
<li><input disabled type="checkbox"> <strong>公钥加密</strong>：每个密码都成对出现，一个为私钥（secret key），一个为公钥（public key）</li>
<li><input disabled type="checkbox"> <strong>单向加密</strong>：也叫散列加密，提取数据特征码，能加密不能解密，常用于做数据完整性校验</li>
</ul>
<p>单向加密特点：</p>
<ul>
<li>雪崩效应（初始条件的微小改变，将会引起结果的巨大改变）</li>
<li>定长输出MD5：<ul>
<li>Message Digest，128位定长输出</li>
<li>SHA1：Secure Hash Algorithm，160位定长输出</li>
<li>SHA224：224位定长输出SHA256：256位定长输出</li>
<li>SHA384：384位定长输出</li>
<li>SHA512：512位定长输出</li>
</ul>
</li>
</ul>
<h2 id="2-3-Linux用户密码加密方式"><a href="#2-3-Linux用户密码加密方式" class="headerlink" title="2.3 Linux用户密码加密方式"></a>2.3 Linux用户密码加密方式</h2><h6 id="Linux密码是使用的单向加密方式进行加密。"><a href="#Linux密码是使用的单向加密方式进行加密。" class="headerlink" title="Linux密码是使用的单向加密方式进行加密。"></a>Linux密码是使用的单向加密方式进行加密。</h6><p>想一个问题，如果两个同事使用的是同样的密码，那么在配置文件中是不是就显示密码一样呢？如果一样是不是就不安全了呢？那么又如何解决此问题呢？</p>
<p>答案是在加密前给用户设置的密码加上一点杂质，再对这个杂质+用户密码一起使用单向加密。由于单向加密的雪崩效应，就算两人设置的密码是一样的，但因为杂质的不同，最终的结果也会截然不同。</p>
<h6 id="密码复杂性策略："><a href="#密码复杂性策略：" class="headerlink" title="密码复杂性策略："></a>密码复杂性策略：</h6><ul>
<li>使用数字、大写字母、小写字母及特殊字符中至少3种</li>
<li>足够长</li>
<li>使用随机密码，不要使用有意义的单词或数字</li>
<li>定期更换，不要使用最近曾经使用过的密码</li>
</ul>
<h1 id="3-用户和组相关的管理命令"><a href="#3-用户和组相关的管理命令" class="headerlink" title="3. 用户和组相关的管理命令"></a>3. 用户和组相关的管理命令</h1><h3 id="3-1-1-用户创建命令useradd"><a href="#3-1-1-用户创建命令useradd" class="headerlink" title="3.1.1 用户创建命令useradd"></a>3.1.1 用户创建命令useradd</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">用法：useradd [选项] 登录</span><br><span class="line">      useradd -D</span><br><span class="line">      useradd -D [选项]</span><br><span class="line"></span><br><span class="line">选项：</span><br><span class="line">  -b, --base-dir BASE_DIR					新账户的主目录的基目录</span><br><span class="line">  -c, --comment COMMENT        		 新账户的 GECOS 字段,注释信息</span><br><span class="line">  -d, --home-dir HOME_DIR      			 新账户的主目录,指定用户的家目录。此目录必须不能事先存在，否则将不会从/etc/skel中复制环境设置文件</span><br><span class="line">  -D, --defaults										显示或更改默认的 useradd 配置,直接打印/etc/default/useradd文件的内容或配合其它选项(例如-s SHELL）直接修改/etc/default/useradd文件中的默认值</span><br><span class="line">  -e, --expiredate EXPIRE_DATE  		新账户的过期日期</span><br><span class="line">  -f, --inactive INACTIVE      				 新账户的密码不活动期</span><br><span class="line">  -g, --gid GROUP								新账户主组的名称或 ID,指定用户所属基本组，可为组名或GID</span><br><span class="line">  -G, --groups GROUPS						新账户的附加组列表,附加组，可以有多个，用逗号隔开。组groupname必须事先存在</span><br><span class="line">  -h, --help                  							 显示此帮助信息并推出</span><br><span class="line">  -k, --skel SKEL_DIR							使用此目录作为骨架目录</span><br><span class="line">  -K, --key KEY=VALUE           			不使用 /etc/login.defs 中的默认值</span><br><span class="line">  -l, --no-log-init									不要将此用户添加到最近登录和登录失败数据库</span><br><span class="line">  -m, --create-home								创建用户的主目录</span><br><span class="line">  -M, --no-create-home						创建用户时不给其创建家目录</span><br><span class="line">  -N, --no-user-group							不创建同名的组</span><br><span class="line">  -o, --non-unique								允许使用重复的 UID 创建用户</span><br><span class="line">  -p, --password PASSWORD				加密后的新账户密码</span><br><span class="line">  -r, --system                  						创建一个系统账户</span><br><span class="line">  -R, --root CHROOT_DIR    			     chroot 到的目录</span><br><span class="line">  -s, --shell SHELL								新账户的登录 shell,这里的shell最好使用/etc/shells里面有的shell， /etc/shells指定了当前系统可用的安全shell</span><br><span class="line">  -u, --uid UID										新账户的用户 ID,[UID_MIN,UID_MAX]定义在/etc/login.defs文件中</span><br><span class="line">  -U, --user-group								创建与用户同名的组</span><br><span class="line">  -Z, --selinux-user SEUSER				为 SELinux 用户映射使用指定 SEUSER</span><br></pre></td></tr></table></figure>

<p><strong>例子:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# groupadd -g 1234 wenhs-test</span><br><span class="line">[root@wenhs5479 ~]# useradd -u 5479 -g 1234 -G root -c wenhs-test -d /home/wenhs-test -s /bin/bash wenhs </span><br><span class="line">[root@wenhs5479 ~]# id wenhs</span><br><span class="line">uid=5479(wenhs) gid=1234(wenhs-test) 组=1234(wenhs-test),0(root)</span><br><span class="line">[root@wenhs5479 ~]# su wenhs -c id</span><br><span class="line">uid=5479(wenhs) gid=1234(wenhs-test) 组=1234(wenhs-test),0(root) 环境=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</span><br><span class="line">[root@wenhs5479 ~]# su - wenhs</span><br><span class="line">上一次登录：二 3月  5 10:46:31 CST 2019pts/2 上</span><br><span class="line">[wenhs@wenhs5479 ~]$ pwd</span><br><span class="line">/home/wenhs-test</span><br><span class="line">[wenhs@wenhs5479 ~]$</span><br></pre></td></tr></table></figure>

<h2 id="3-1-2-用户删除命令userdel"><a href="#3-1-2-用户删除命令userdel" class="headerlink" title="3.1.2 用户删除命令userdel"></a>3.1.2 用户删除命令userdel</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">用法：userdel [选项] 登录</span><br><span class="line"></span><br><span class="line">选项：</span><br><span class="line">  -f, --force                   force some actions that would fail otherwise</span><br><span class="line">                                e.g. removal of user still logged in</span><br><span class="line">                                or files, even if not owned by the user</span><br><span class="line">  -h, --help                    显示此帮助信息并推出</span><br><span class="line">  -r, --remove                  删除主目录和邮件池,删除用户的同时删除其家目录（userdel默认不会删除其家目录）</span><br><span class="line">  -R, --root CHROOT_DIR         chroot 到的目录</span><br><span class="line">  -Z, --selinux-user            为用户删除所有的 SELinux 用户映射</span><br></pre></td></tr></table></figure>

<p><strong>例子:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# ls /home/</span><br><span class="line">test  wenhs-test</span><br><span class="line">[root@wenhs5479 ~]# userdel wenhs </span><br><span class="line">[root@wenhs5479 ~]# ls /home/</span><br><span class="line">test  wenhs-test</span><br><span class="line">[root@wenhs5479 ~]# </span><br><span class="line">[root@wenhs5479 ~]# rm -rf /home/wenhs-test</span><br><span class="line">[root@wenhs5479 ~]# ls /home/</span><br><span class="line">test</span><br><span class="line">[root@wenhs5479 ~]# useradd -u 5479 -g 1234 -G root -c wenhs-test -d /home/wenhs-test -s /bin/bash wenhs </span><br><span class="line">正在创建信箱文件: 文件已存在</span><br><span class="line">[root@wenhs5479 ~]# ls /home/</span><br><span class="line">test  wenhs-test</span><br><span class="line">[root@wenhs5479 ~]# userdel -r wenhs </span><br><span class="line">[root@wenhs5479 ~]# ls /home/</span><br><span class="line">test</span><br><span class="line">[root@wenhs5479 ~]#</span><br></pre></td></tr></table></figure>

<h2 id="3-1-3-查看用户帐号的信息命令id"><a href="#3-1-3-查看用户帐号的信息命令id" class="headerlink" title="3.1.3 查看用户帐号的信息命令id"></a>3.1.3 查看用户帐号的信息命令id</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">用法：id [OPTION] ... [USER]</span><br><span class="line">打印指定USER的用户和组信息，</span><br><span class="line">当前用户或（当省略USER时）。</span><br><span class="line"></span><br><span class="line">   -a				 ignore，与其他版本兼容</span><br><span class="line">   -Z， --context	仅打印当前用户的安全上下文</span><br><span class="line">   -g， --group	仅打印有效的组ID</span><br><span class="line">   -G， --groupss	打印所有组ID</span><br><span class="line">   -n， --name	为-ugG打印名称而不是数字</span><br><span class="line">   -r， --real	使用-ugG打印真实ID而不是有效ID</span><br><span class="line">   -u， --user	仅打印有效的用户ID</span><br><span class="line">   -z， --zero	分隔带有NUL字符的条目，而不是空格;</span><br><span class="line">                    	不允许使用默认格式</span><br><span class="line">      --help	显示此帮助信息并退出</span><br><span class="line">      --version	显示版本信息并退出</span><br><span class="line"></span><br><span class="line">如果不附带任何选项，程序会显示一些可供识别用户身份的有用信息。</span><br></pre></td></tr></table></figure>

<p><strong>例子</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">查看当前登录的用户的信息：</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# id</span><br><span class="line">uid=0(root) gid=0(root) 组=0(root) 环境=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# id root</span><br><span class="line">uid=0(root) gid=0(root) 组=0(root)</span><br></pre></td></tr></table></figure>

<h2 id="3-1-4-修改用户帐号属性的命令"><a href="#3-1-4-修改用户帐号属性的命令" class="headerlink" title="3.1.4 修改用户帐号属性的命令"></a>3.1.4 修改用户帐号属性的命令</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">usermod   修改用户属性</span><br><span class="line">用法：usermod [选项] 登录</span><br><span class="line"></span><br><span class="line">选项：</span><br><span class="line">  -c, --comment 注释            GECOS 字段的新值</span><br><span class="line">  -d, --home HOME_DIR           用户的新主目录</span><br><span class="line">  -e, --expiredate EXPIRE_DATE  设定帐户过期的日期为 EXPIRE_DATE</span><br><span class="line">  -f, --inactive INACTIVE       过期 INACTIVE 天数后，设定密码为失效状态</span><br><span class="line">  -g, --gid GROUP               强制使用 GROUP 为新主组</span><br><span class="line">  -G, --groups GROUPS           新的附加组列表 GROUPS,不使用-a选项，会覆盖此前的附加组</span><br><span class="line">  -a, --append GROUP            将用户追加至上边 -G 中提到的附加组中，</span><br><span class="line">                                并不从其它组中删除此用户</span><br><span class="line">  -h, --help                    显示此帮助信息并推出</span><br><span class="line">  -l, --login LOGIN             新的登录名称</span><br><span class="line">  -L, --lock                    锁定用户帐号,被锁定的帐号在/etc/shadow文件中密码前面会有一个！感叹号</span><br><span class="line">  -m, --move-home              (仅于 -d 一起使用),改变用户家目录的同时把原来家目录的文件移动到新的家目录中</span><br><span class="line">  -o, --non-unique              允许使用重复的(非唯一的) UID</span><br><span class="line">  -p, --password PASSWORD       将加密过的密码 (PASSWORD) 设为新密码</span><br><span class="line">  -R, --root CHROOT_DIR         chroot 到的目录</span><br><span class="line">  -s, --shell SHELL             该用户帐号的新登录 shell</span><br><span class="line">  -u, --uid UID                 用户帐号的新 UID</span><br><span class="line">  -U, --unlock                  解锁用户帐号</span><br><span class="line">  -Z, --selinux-user  SEUSER       用户账户的新 SELinux 用户映射</span><br><span class="line"></span><br><span class="line">chsh  修改用户的默认shell</span><br><span class="line">语法：chsh [options] [username]</span><br><span class="line">    -s SHELL</span><br></pre></td></tr></table></figure>

<p><strong>例子:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# usermod -u 1111 -a -G test -e 2019-3-12 wenhs</span><br><span class="line">[root@wenhs5479 ~]# id wenhs</span><br><span class="line">uid=1111(wenhs) gid=1234(wenhs-test) 组=1234(wenhs-test),0(root),1000(test)</span><br><span class="line">[root@wenhs5479 ~]# usermod -d /opt/wenhs -m wenhs</span><br><span class="line">[root@wenhs5479 ~]# su - wenhs</span><br><span class="line">[wenhs@wenhs5479 ~]$ pwd</span><br><span class="line">/opt/wenhs</span><br><span class="line">[wenhs@wenhs5479 ~]$ </span><br><span class="line">[root@wenhs5479 ~]# tail -2 /etc/passwd</span><br><span class="line">test:x:1000:1000:test:/home/test:/bin/bash</span><br><span class="line">wenhs:x:1111:1234:wenhs-test:/opt/wenhs:/bin/bash</span><br><span class="line">[root@wenhs5479 ~]# usermod -L wenhs</span><br><span class="line">[root@wenhs5479 ~]# tail -1 /etc/shadow</span><br><span class="line">wenhs:!$6$4lQmyzDt$3l.uEIwhu6kb5Df.6knVKxYHneVkTkovZL0PtNmjQU7LyOB9mTayyS3Vdba/sznEQl40AdLN9P3ZwNOsL6DEb/:17960:0:99999:7::17967:</span><br><span class="line">[root@wenhs5479 ~]# usermod -U wenhs</span><br><span class="line">[root@wenhs5479 ~]# tail -1 /etc/shadow</span><br><span class="line">wenhs:$6$4lQmyzDt$3l.uEIwhu6kb5Df.6knVKxYHneVkTkovZL0PtNmjQU7LyOB9mTayyS3Vdba/sznEQl40AdLN9P3ZwNOsL6DEb/:17960:0:99999:7::17967:</span><br><span class="line">[root@wenhs5479 ~]# chsh -s /bin/sh wenhs</span><br><span class="line">Changing shell for wenhs.</span><br><span class="line">Shell changed.</span><br><span class="line">[root@wenhs5479 ~]# tail -1 /etc/passwd</span><br><span class="line">wenhs:x:1111:1234:wenhs-test:/opt/wenhs:/bin/sh</span><br></pre></td></tr></table></figure>

<h2 id="3-1-5-切换用户命令su"><a href="#3-1-5-切换用户命令su" class="headerlink" title="3.1.5 切换用户命令su"></a>3.1.5 切换用户命令su</h2><table>
<thead>
<tr>
<th>切换用户的方式</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td>su USERNAME</td>
<td>非登录式切换，即不会读取目标用户的配置文件</td>
</tr>
<tr>
<td>su - USERNAME</td>
<td>登录式切换，即会读取目标用户的配置文件。完全切换</td>
</tr>
<tr>
<td>su -</td>
<td>不指定用户时默认切换至root用户</td>
</tr>
</tbody></table>
<p><code>root su至其他用户不需要密码，非root用户su至其他用户时需要输入目标用户的密码</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">用法：</span><br><span class="line"> su [选项] [-] [USER [参数]...]</span><br><span class="line"></span><br><span class="line">将有效用户 id 和组 id 更改为 USER 的 id。</span><br><span class="line">单个 - 视为 -l。如果未指定 USER，将假定为 root。</span><br><span class="line"></span><br><span class="line">选项：</span><br><span class="line"> -m, -p, --preserve-environment  不重置环境变量</span><br><span class="line"> -g, --group &lt;组&gt;             指定主组</span><br><span class="line"> -G, --supp-group &lt;组&gt;        指定一个辅助组</span><br><span class="line"></span><br><span class="line"> -, -l, --login                  使 shell 成为登录 shell</span><br><span class="line"> -c, --command &lt;命令&gt;            使用 -c 向 shell 传递一条命令</span><br><span class="line"> --session-command &lt;命令&gt;        使用 -c 向 shell 传递一条命令</span><br><span class="line">                                 而不创建新会话</span><br><span class="line"> -f, --fast                      向shell 传递 -f 选项(csh 或 tcsh)</span><br><span class="line"> -s, --shell &lt;shell&gt;             若 /etc/shells 允许，则运行 shell</span><br><span class="line"></span><br><span class="line"> -h, --help     显示此帮助并退出</span><br><span class="line"> -V, --version  输出版本信息并退出</span><br></pre></td></tr></table></figure>

<p><strong>例子:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# su wenhs -c pwd</span><br><span class="line">/root</span><br><span class="line">[root@wenhs5479 ~]# su - wenhs</span><br><span class="line">上一次登录：二 3月  5 11:39:52 CST 2019pts/2 上</span><br><span class="line">-sh-4.2$ su -</span><br><span class="line">密码：</span><br><span class="line">上一次登录：二 3月  5 09:51:32 CST 2019从 192.168.131.100pts/3 上</span><br><span class="line">[root@wenhs5479 ~]#</span><br></pre></td></tr></table></figure>

<p><strong>bash的配置文件：</strong></p>
<table>
<thead>
<tr>
<th>配置文件类型</th>
<th>配置文件路径</th>
</tr>
</thead>
<tbody><tr>
<td>全局配置</td>
<td>/etc/profile</td>
</tr>
<tr>
<td>全局配置</td>
<td>/etc/profile.d/*.sh</td>
</tr>
<tr>
<td>全局配置</td>
<td>/etc/bashrc</td>
</tr>
<tr>
<td>个人配置</td>
<td>~/.bash_profile</td>
</tr>
<tr>
<td>个人配置</td>
<td>～/.bashrc</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>配置文件类型</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>profile类</td>
<td>为交互式登录的shell提供配置，用来设定环境变量、运行命令或脚本</td>
</tr>
<tr>
<td>bashrc类</td>
<td>为非交互式登录的shell提供配置，用来设定本地变量、定义命令别名</td>
</tr>
</tbody></table>
<p><strong>登录式shell如何读取配置文件？</strong></p>
<h5 id="etc-profile-–-gt-etc-profile-d-sh-–-gt-bash-profile-–-gt-bashrc-–-gt-etc-bashrc"><a href="#etc-profile-–-gt-etc-profile-d-sh-–-gt-bash-profile-–-gt-bashrc-–-gt-etc-bashrc" class="headerlink" title="/etc/profile –&gt; /etc/profile.d/*.sh –&gt; ~/.bash_profile –&gt; ~/.bashrc –&gt; /etc/bashrc"></a>/etc/profile –&gt; /etc/profile.d/*.sh –&gt; ~/.bash_profile –&gt; ~/.bashrc –&gt; /etc/bashrc</h5><h2 id="3-2-密码管理"><a href="#3-2-密码管理" class="headerlink" title="3.2 密码管理"></a>3.2 密码管理</h2><h3 id="3-2-1-密码管理命令passwd"><a href="#3-2-1-密码管理命令passwd" class="headerlink" title="3.2.1 密码管理命令passwd"></a>3.2.1 密码管理命令passwd</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">用法: passwd [选项...] &lt;帐号名称&gt;</span><br><span class="line">  -k, --keep-tokens       保持身份验证令牌不过期</span><br><span class="line">  -d, --delete            删除已命名帐号的密码(只有根用户才能进行此操作)</span><br><span class="line">  -l, --lock              锁定指名帐户的密码(仅限 root 用户)</span><br><span class="line">  -u, --unlock            解锁指名账户的密码(仅限 root 用户)</span><br><span class="line">  -e, --expire            终止指名帐户的密码(仅限 root 用户)</span><br><span class="line">  -f, --force             强制执行操作</span><br><span class="line">  -x, --maximum=DAYS      密码的最长有效时限(只有根用户才能进行此操作)</span><br><span class="line">  -n, --minimum=DAYS      密码的最短有效时限(只有根用户才能进行此操作)</span><br><span class="line">  -w, --warning=DAYS      在密码过期前多少天开始提醒用户(只有根用户才能进行此操作)</span><br><span class="line">  -i, --inactive=DAYS     当密码过期后经过多少天该帐号会被禁用(只有根用户才能进行此操作)</span><br><span class="line">  -S, --status            报告已命名帐号的密码状态(只有根用户才能进行此操作)</span><br><span class="line">  --stdin                 从标准输入读取令牌(只有根用户才能进行此操作),例：echo &quot;redhat&quot;｜passwd --stdin user1</span><br><span class="line"></span><br><span class="line">Help options:</span><br><span class="line">  -?, --help              显示此帮助消息</span><br><span class="line">  --usage                 显示简要用法信息</span><br></pre></td></tr></table></figure>

<h3 id="3-2-2-改变用户密码过期信息命令chage"><a href="#3-2-2-改变用户密码过期信息命令chage" class="headerlink" title="3.2.2 改变用户密码过期信息命令chage"></a>3.2.2 改变用户密码过期信息命令chage</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">用法：chage [选项] 登录</span><br><span class="line"></span><br><span class="line">选项：</span><br><span class="line">  -d, --lastday 最近日期        将最近一次密码设置时间设为“最近日期”</span><br><span class="line">  -E, --expiredate 过期日期     将帐户过期时间设为“过期日期”</span><br><span class="line">  -h, --help                    显示此帮助信息并推出</span><br><span class="line">  -I, --inactive INACITVE       过期 INACTIVE 天数后，设定密码为失效状态</span><br><span class="line">  -l, --list                    显示帐户年龄信息</span><br><span class="line">  -m, --mindays 最小天数        将两次改变密码之间相距的最小天数设为“最小天数”</span><br><span class="line">  -M, --maxdays 最大天数        将两次改变密码之间相距的最大天数设为“最大天数”</span><br><span class="line">  -R, --root CHROOT_DIR         chroot 到的目录</span><br><span class="line">  -W, --warndays 警告天数       将过期警告天数设为“警告天数”</span><br></pre></td></tr></table></figure>

<h3 id="3-2-3-密码生成工具openssl"><a href="#3-2-3-密码生成工具openssl" class="headerlink" title="3.2.3 密码生成工具openssl"></a>3.2.3 密码生成工具openssl</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">语法：openssl command [ command_opts ] [ command_args ]</span><br><span class="line">    command     //包含标准命令、消息摘要命令、加密命令</span><br><span class="line">        version     //查看程序版本号</span><br><span class="line">        dgst        //提取特征码</span><br><span class="line">        passwd      //生成密码</span><br><span class="line">        rand        //生成伪随机数</span><br><span class="line">提取特征码</span><br><span class="line">[root@wenhs5479 ~]# openssl dgst -md5 /etc/fstab</span><br><span class="line">MD5(/etc/fstab)= 01453950193b2f75895174159b092db1</span><br><span class="line">生成密码 openssl passwd -1 -salt string        //string一般为8位</span><br><span class="line">[root@wenhs5479 ~]# openssl passwd -1 -salt wenhs123</span><br><span class="line">Password: </span><br><span class="line">$1$wenhs123$hHZLFuQVNhKMU4bROKERX0</span><br><span class="line"></span><br><span class="line">生成随机数 openssl rand -base64 NUM</span><br><span class="line">NUM表示随机数的长度</span><br><span class="line">[root@wenhs5479 ~]# openssl rand -base64 20</span><br><span class="line">A2H5Ny5/QrcfkYAcfM13beTMq7Q=</span><br></pre></td></tr></table></figure>

<h2 id="3-3-组管理"><a href="#3-3-组管理" class="headerlink" title="3.3 组管理"></a>3.3 组管理</h2><h3 id="3-3-1-创建组命令groupadd"><a href="#3-3-1-创建组命令groupadd" class="headerlink" title="3.3.1 创建组命令groupadd"></a>3.3.1 创建组命令groupadd</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">用法：groupadd [选项] 组</span><br><span class="line"></span><br><span class="line">选项:</span><br><span class="line">  -f, --force		如果组已经存在则成功退出</span><br><span class="line">			并且如果 GID 已经存在则取消 -g</span><br><span class="line">  -g, --gid GID                 为新组使用 GID</span><br><span class="line">  -h, --help                    显示此帮助信息并推出</span><br><span class="line">  -K, --key KEY=VALUE           不使用 /etc/login.defs 中的默认值</span><br><span class="line">  -o, --non-unique              允许创建有重复 GID 的组</span><br><span class="line">  -p, --password PASSWORD       为新组使用此加密过的密码</span><br><span class="line">  -r, --system                  创建一个系统账户</span><br><span class="line">  -R, --root CHROOT_DIR         chroot 到的目录</span><br></pre></td></tr></table></figure>

<h3 id="3-3-2-修改组信息命令groupmod"><a href="#3-3-2-修改组信息命令groupmod" class="headerlink" title="3.3.2 修改组信息命令groupmod"></a>3.3.2 修改组信息命令groupmod</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">用法：groupmod [选项] 组</span><br><span class="line"></span><br><span class="line">选项:</span><br><span class="line">  -g, --gid GID                 将组 ID 改为 GID</span><br><span class="line">  -h, --help                    显示此帮助信息并推出</span><br><span class="line">  -n, --new-name NEW_GROUP      改名为 NEW_GROUP</span><br><span class="line">  -o, --non-unique              允许使用重复的 GID</span><br><span class="line">  -p, --password PASSWORD	将密码更改为(加密过的) PASSWORD</span><br><span class="line">  -R, --root CHROOT_DIR         chroot 到的目录</span><br></pre></td></tr></table></figure>

<h3 id="3-3-3-删除组命令groupdel"><a href="#3-3-3-删除组命令groupdel" class="headerlink" title="3.3.3 删除组命令groupdel"></a>3.3.3 删除组命令groupdel</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">用法：groupdel [选项] 组</span><br><span class="line">删除组时只需要指定组名即可</span><br><span class="line">选项:</span><br><span class="line">  -h, --help                    显示此帮助信息并推出</span><br><span class="line">  -R, --root CHROOT_DIR         chroot 到的目录</span><br></pre></td></tr></table></figure>

<h3 id="3-3-4-给组设定密码命令gpasswd"><a href="#3-3-4-给组设定密码命令gpasswd" class="headerlink" title="3.3.4 给组设定密码命令gpasswd"></a>3.3.4 给组设定密码命令gpasswd</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">用法：gpasswd [选项] 组</span><br><span class="line">不带任何参数表示给组设密码</span><br><span class="line"></span><br><span class="line">选项：</span><br><span class="line">  -a, --add USER                向组 GROUP 中添加用户 USER</span><br><span class="line">  -d, --delete USER             从组 GROUP 中添加或删除用户</span><br><span class="line">  -h, --help                    显示此帮助信息并推出</span><br><span class="line">  -Q, --root CHROOT_DIR         要 chroot 进的目录</span><br><span class="line">  -r, --delete-password         remove the GROUP&apos;s password</span><br><span class="line">  -R, --restrict                向其成员限制访问组 GROUP</span><br><span class="line">  -M, --members USER,...        设置组 GROUP 的成员列表</span><br><span class="line">  -A, --administrators ADMIN,...	设置组的管理员列表</span><br><span class="line">除非使用 -A 或 -M 选项，不能结合使用这些选项。</span><br></pre></td></tr></table></figure>

<h3 id="3-3-5-切换组命令newgrp"><a href="#3-3-5-切换组命令newgrp" class="headerlink" title="3.3.5 切换组命令newgrp"></a>3.3.5 切换组命令newgrp</h3><h5 id="将当前用户临时切换至新的基本组，这里需要用到gpasswd设置的组密码，使用newgrp登录至新的基本组后可以使用exit退出，退出后其原基本组不变"><a href="#将当前用户临时切换至新的基本组，这里需要用到gpasswd设置的组密码，使用newgrp登录至新的基本组后可以使用exit退出，退出后其原基本组不变" class="headerlink" title="将当前用户临时切换至新的基本组，这里需要用到gpasswd设置的组密码，使用newgrp登录至新的基本组后可以使用exit退出，退出后其原基本组不变"></a>将当前用户临时切换至新的基本组，这里需要用到gpasswd设置的组密码，使用newgrp登录至新的基本组后可以使用exit退出，退出后其原基本组不变</h5><p><strong>例子:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# groupadd www</span><br><span class="line">[root@wenhs5479 ~]# gpasswd www</span><br><span class="line">正在修改 www 组的密码</span><br><span class="line">新密码：</span><br><span class="line">请重新输入新密码：</span><br><span class="line">[root@wenhs5479 ~]# su - test</span><br><span class="line">上一次登录：二 3月  5 09:55:17 CST 2019pts/2 上</span><br><span class="line">[test@wenhs5479 ~]$ id</span><br><span class="line">uid=1000(test) gid=1000(test) 组=1000(test),10(wheel) 环境=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</span><br><span class="line">[test@wenhs5479 ~]$ newgrp www</span><br><span class="line">密码：</span><br><span class="line">[test@wenhs5479 ~]$ id</span><br><span class="line">uid=1000(test) gid=1235(www) 组=1235(www),10(wheel),1000(test) 环境=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</span><br><span class="line">[test@wenhs5479 ~]$ exit</span><br><span class="line">exit</span><br><span class="line">[test@wenhs5479 ~]$ id</span><br><span class="line">uid=1000(test) gid=1000(test) 组=1000(test),10(wheel) 环境=unconfined_u:unconfined_r:unconfined_t:s0-s0:c0.c1023</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    
	
	  <div>
        
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://aiwhs.github.io/2018/05/27/账号和权限管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="itw">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="itw">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/05/27/账号和权限管理/" class="post-title-link" itemprop="url">账号和权限管理</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-05-27 08:15:57" itemprop="dateCreated datePublished" datetime="2018-05-27T08:15:57+08:00">2018-05-27</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-08 14:39:28" itemprop="dateModified" datetime="2019-07-08T14:39:28+08:00">2019-07-08</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux运维/" itemprop="url" rel="index"><span itemprop="name">Linux运维</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h1 id="一、用户和组账号的概述；"><a href="#一、用户和组账号的概述；" class="headerlink" title="一、用户和组账号的概述；"></a>一、用户和组账号的概述；</h1><h2 id="1-概念：用户：包含一个名和密码，人在计算机中的体现方式，包含root、普通用户、程序用户；"><a href="#1-概念：用户：包含一个名和密码，人在计算机中的体现方式，包含root、普通用户、程序用户；" class="headerlink" title="1.概念：用户：包含一个名和密码，人在计算机中的体现方式，包含root、普通用户、程序用户；"></a>1.概念：用户：包含一个名和密码，人在计算机中的体现方式，包含root、普通用户、程序用户；</h2><pre><code>组：用户的集合，批量管理用户群权限，包含基本组、附加组（一个用户只能属于一个基本组，但是可以属于多个附加组）；
权限：限制用户访问资源（文件、app、进程、硬件等）；
UID：每个用户账号都有一个数字标识（身份证），root（0）、普通用户（500-60000）、程序用户（1-499）；
GID：每个组账号的唯一身份标识；root（0）、普通组账号（500-60000）、程序组账号（1-499）；</code></pre><h2 id="2-用户和组的文件；"><a href="#2-用户和组的文件；" class="headerlink" title="2.用户和组的文件；"></a>2.用户和组的文件；</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/etc/passwd	##账号文件</span><br><span class="line">/etc/shadow	##密码文件</span><br><span class="line">/etc/group	##组账号文件</span><br><span class="line">/etc/gshadow	##组密码文件，很少使用</span><br></pre></td></tr></table></figure>

<h2 id="3-用户账号文件格式：-etc-passwd"><a href="#3-用户账号文件格式：-etc-passwd" class="headerlink" title="3.用户账号文件格式：/etc/passwd"></a>3.用户账号文件格式：/etc/passwd</h2><pre><code>用户名：密码占位符：UID：GID：全名：家目录：登陆shell解释器
密码占位符：可能是以密文的字符串代表或者X密码占位符；
登陆shell解释器：用户默认的的解释器，默认情况用户使用/bin/bash作为shell，若修改为/sbin/nologin（禁止登陆），</code></pre><h2 id="4-用户密码文件格式；-etc-shadow"><a href="#4-用户密码文件格式；-etc-shadow" class="headerlink" title="4.用户密码文件格式；/etc/shadow"></a>4.用户密码文件格式；/etc/shadow</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">用户名：MD5加密的密码字串信息：上次修改密码到现在的时间：密码最短有效天数：密码最长有效天数：提前几天警	告用户密码将要过期：在密码过期多少天后禁用账户：账号失效时间（默认为空，表示永久）；保留字段</span><br><span class="line">密码字串信息：</span><br><span class="line">!!：未初始化密码，新建用户的默认状态</span><br><span class="line">密码字符串：修改密码后的状态</span><br><span class="line">!!加密字符串或*加密字符串：密码被锁定，不能登陆</span><br><span class="line">空：登陆不需要密码，只能本地登录（无需密码）</span><br></pre></td></tr></table></figure>

<h2 id="5-组账号文件：-etc-group"><a href="#5-组账号文件：-etc-group" class="headerlink" title="5.组账号文件：/etc/group"></a>5.组账号文件：/etc/group</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">组名：密码占位符：GID：成员列表</span><br></pre></td></tr></table></figure>

<h1 id="二、用户及组账号的管理；"><a href="#二、用户及组账号的管理；" class="headerlink" title="二、用户及组账号的管理；"></a>二、用户及组账号的管理；</h1><h2 id="1-用户的管理："><a href="#1-用户的管理：" class="headerlink" title="1.用户的管理："></a>1.用户的管理：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">增：useradd 选项 用户名</span><br><span class="line">选项：-d	##指定家目录		</span><br><span class="line">     -M   ##不指定家目录</span><br><span class="line">	 -s	  ##指定用户的登陆shell</span><br><span class="line">	 -g	  ##指定用户的基本组</span><br><span class="line">	 -G	  ##指定用户的附加组（可指定GID）</span><br><span class="line">删：userdel -r 用户名</span><br><span class="line">    删除用户的同时也将家目录一并删除</span><br><span class="line">改：usermod 选项 用户名</span><br><span class="line">选项：包含创建用户的所有选项</span><br><span class="line">  	 passwd 用户名		##为用户设置密码</span><br><span class="line">	 passwd 选项 用户名</span><br><span class="line">	 选项：-d	##清空用户的密码（不用密码登录）</span><br><span class="line">		  -l		##锁定用户</span><br><span class="line">		  -u		##解锁用户</span><br><span class="line">		  -S		##查看用户锁定状态</span><br><span class="line">	chsh -s 解释器目录 用户名	##更改用户的shell解释器</span><br><span class="line">查：</span><br><span class="line">	grep 用户名 /etc/passwd		##查看账号信息</span><br><span class="line">	id 用户名	##显示用户UID和所属组</span><br><span class="line">	w		##查看当前主机的登陆情况</span><br></pre></td></tr></table></figure>

<h2 id="2-组的管理："><a href="#2-组的管理：" class="headerlink" title="2.组的管理："></a>2.组的管理：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">增：groupadd 组名</span><br><span class="line">	选项-g可指定GID；</span><br><span class="line">删：groupdel 组名</span><br><span class="line">改：gpasswd 选项 用户名 组名</span><br><span class="line">选项：-a 	##将单个用户添加到某个组</span><br><span class="line">	 -M  ##将多个用户添加到某个组，用户之间用逗号隔开</span><br><span class="line">	 -d	 ##将某个用户在某个组中删除</span><br><span class="line">查：</span><br><span class="line">	groups 用户名		##查看用户属于哪个组</span><br><span class="line">	grep 组名	/etc/group		##查看组信息</span><br></pre></td></tr></table></figure>

<h1 id="三、管理目录及文件的属性；"><a href="#三、管理目录及文件的属性；" class="headerlink" title="三、管理目录及文件的属性；"></a>三、管理目录及文件的属性；</h1><h2 id="1-概念："><a href="#1-概念：" class="headerlink" title="1.概念："></a>1.概念：</h2><ul>
<li><p><code>访问权限</code>：读取（r）、写入（w）、执行（x）</p>
</li>
<li><p><code>归属</code>：属主：拥有该文件的用户</p>
</li>
<li><p><code>属组</code>：拥有该文件的组账号</p>
</li>
</ul>
<h2 id="2-查看文件或目录的属性："><a href="#2-查看文件或目录的属性：" class="headerlink" title="2.查看文件或目录的属性："></a>2.查看文件或目录的属性：</h2><p>  ls -ld 目录或文件位置</p>
<p>  <code>格式</code>：文件类型、权限、inode数量、属主、属组、大小、日期、文件名<br>  权限列表：</p>
<ul>
<li><p><code>第一个字符</code>：文件类型，d目录、b块设备文件、c字符设备文件、l链接文件、-普通文件；</p>
</li>
<li><p><code>第2-4个字符</code>：属主对文件的权限；</p>
</li>
<li><p><code>第5-7个字符</code>：属组对文件的权限；</p>
</li>
<li><p><code>第8-10个字符</code>：任何用户对文件的权限；</p>
<p>权限的表示：</p>
</li>
<li><p><code>r</code>：读取，查看内容，也可以用4表示；</p>
</li>
<li><p><code>w</code>：写入，写入（删除、更改、移动等）内容，也可用2表示；</p>
</li>
<li><p><code>x</code>：执行，执行此文件或cd到此目录，也可用1表示；</p>
<h2 id="3-设置文件或目录的权限；"><a href="#3-设置文件或目录的权限；" class="headerlink" title="3.设置文件或目录的权限；"></a>3.设置文件或目录的权限；</h2><p>  语法：chmod [ugoa] [+-=] [rwx] 文件或目录<br>  举例：chmod g-x, o-r 文件或目录<br>  选项：-R 表示递归权限，目录下的子目录子文件继承父级目录的权限；<br>  语法：chmod 775 文件或目录</p>
</li>
</ul>
<h2 id="4-设置目录或文件的归属；"><a href="#4-设置目录或文件的归属；" class="headerlink" title="4.设置目录或文件的归属；"></a>4.设置目录或文件的归属；</h2><pre><code>语法：chown 属主 文件或目录        ##设置其属主
     chown :属组 文件或目录        ##设置其属组
     chown 属主:属组 文件或目录        ##设置其属主和属组
注：选项-R 递归可将其子目录子文件继承父级目录的归属；</code></pre><h1 id="四、扩展："><a href="#四、扩展：" class="headerlink" title="四、扩展："></a>四、扩展：</h1><h2 id="1-umask文件反权限："><a href="#1-umask文件反权限：" class="headerlink" title="1.umask文件反权限："></a>1.umask文件反权限：</h2><ul>
<li><p><code>umask</code>            ##查看系统的默认权限反掩码值，文件最大权限为666，目录最大权限为777</p>
</li>
<li><p><code>umask ###</code>            ##手动更改文件权限的反掩码值，更改后创建文件或目录验证反掩码值</p>
</li>
</ul>
<h2 id="2-chattr锁定文件："><a href="#2-chattr锁定文件：" class="headerlink" title="2.chattr锁定文件："></a>2.chattr锁定文件：</h2><ul>
<li><p><code>chattr +i 文件路径</code>    ##锁定文件，不得移动删除等</p>
</li>
<li><p><code>chattr -i 文件路径</code>    ##解锁文件</p>
</li>
</ul>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    
	
	  <div>
        
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://aiwhs.github.io/2018/05/19/软件包管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="itw">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="itw">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/05/19/软件包管理/" class="post-title-link" itemprop="url">软件包管理</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-05-19 08:15:57" itemprop="dateCreated datePublished" datetime="2018-05-19T08:15:57+08:00">2018-05-19</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-10 15:21:33" itemprop="dateModified" datetime="2019-07-10T15:21:33+08:00">2019-07-10</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux运维/" itemprop="url" rel="index"><span itemprop="name">Linux运维</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h1 id="一、了解linux中的应用程序："><a href="#一、了解linux中的应用程序：" class="headerlink" title="一、了解linux中的应用程序："></a>一、了解linux中的应用程序：</h1><h2 id="1-系统的组成：硬件、系统、内核、shell解释器、应用程序"><a href="#1-系统的组成：硬件、系统、内核、shell解释器、应用程序" class="headerlink" title="1.系统的组成：硬件、系统、内核、shell解释器、应用程序"></a>1.系统的组成：硬件、系统、内核、shell解释器、应用程序</h2><p>  应用程序：APP、安装在OS上完成特定功能的软件 </p>
<h2 id="2-linux应用程序的类型："><a href="#2-linux应用程序的类型：" class="headerlink" title="2.linux应用程序的类型："></a>2.linux应用程序的类型：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">*.rpm ##redhat系统默认的软件格式（使用了二进制的文件格式，代码相对来说比较封闭）</span><br><span class="line">		  rpm软件包名称格式：软件名-版本-发布次数-os平台-硬件平台（32bit/64bit）.rpm</span><br><span class="line">		  硬件平台：32位：i386、i586、i686</span><br><span class="line">		 	 64位：x86.64</span><br><span class="line">			 不区分硬件架构：noarch</span><br><span class="line">*.deb ##debian分支默认的软件格式</span><br><span class="line">源码软件 ##通用软件格式，压缩格式（xz、gz、bz2）的文件，也是生成rpm等包的基础</span><br><span class="line">自带安装程序或免安装软件</span><br></pre></td></tr></table></figure>

<h2 id="3-程序文件存放位置："><a href="#3-程序文件存放位置：" class="headerlink" title="3.程序文件存放位置："></a>3.程序文件存放位置：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/etc/ ##rpm包的配置文件</span><br><span class="line">/var/log/ ##日志文件</span><br><span class="line">/usr/share/doc/ ##软件的说明文档		</span><br><span class="line">/usr/bin/ ##普通用户可运行的程序命令</span><br><span class="line">/usr/sbin/ ##root可运行的程序命令</span><br></pre></td></tr></table></figure>

<h1 id="二、rpm命令管理软件包；"><a href="#二、rpm命令管理软件包；" class="headerlink" title="二、rpm命令管理软件包；"></a>二、rpm命令管理软件包；</h1><h2 id="1-了解rpm；"><a href="#1-了解rpm；" class="headerlink" title="1.了解rpm；"></a>1.了解rpm；</h2><p>  rpm是redhat推出的包管理机制，用来管理（增删改查）软件包，rpm对于软件包的依赖关系处理时，选择忽略；</p>
<h2 id="2-查询功能；"><a href="#2-查询功能；" class="headerlink" title="2.查询功能；"></a>2.查询功能；</h2><ul>
<li><code>rpm -qa</code>     ##查询当前系统安装的所有rpm包</li>
<li><code>rpm -ql</code> 软件名  ##查询软件包的所有有关文件</li>
<li><code>rpm -qi</code> 软件名  ##查看软件包的详细信息</li>
<li><code>rpm -qf</code> 文件名  ##查看此文件由哪个软件包提供的</li>
</ul>
<h2 id="3-安装、卸载、升级rpm软件包；"><a href="#3-安装、卸载、升级rpm软件包；" class="headerlink" title="3.安装、卸载、升级rpm软件包；"></a>3.安装、卸载、升级rpm软件包；</h2><p> 安装：</p>
<ul>
<li><p><code>rpm -ivh</code> 软件包的路径 –nodeps    ##忽略依赖关系进行安装软件包，举例：包vsftpd</p>
<p>升级：</p>
</li>
<li><p><code>rpm -F</code> 软件包的路径        ##为已安装的软件包升级</p>
</li>
<li><p><code>rpm -U</code> 软件包的路径        ##为已安装的软件包升级，若未安装进行安装</p>
<p>卸载：</p>
</li>
<li><p><code>rpm -e</code> 软件包名 –nodeps    ##忽略依赖关系并进行卸载，常用</p>
</li>
</ul>
<h2 id="4-特殊用法："><a href="#4-特殊用法：" class="headerlink" title="4.特殊用法："></a>4.特殊用法：</h2><ul>
<li><p><code>--force</code>：强制安装，当已经安装的软件的文件丢失或者被损坏时用到，或系统中以存在新版本需要安装旧版本时；</p>
</li>
<li><p><code>--nodeps</code>：忽略依赖关系，安装或卸载时用到；</p>
</li>
<li><p><code>--import</code>：导入iso的公钥（检查包的合法性和完整性，不导入会在安装时报warning）</p>
</li>
</ul>
<h1 id="三、yum命令管理软件包；"><a href="#三、yum命令管理软件包；" class="headerlink" title="三、yum命令管理软件包；"></a>三、yum命令管理软件包；</h1><h2 id="1-yum概述：C-S架构"><a href="#1-yum概述：C-S架构" class="headerlink" title="1.yum概述：C/S架构"></a>1.yum概述：C/S架构</h2><ul>
<li><p><code>服务端</code>：为客户端提供软件包的源，可以理解为一个服务站，可以使用ftp文件服务器提供yum的源，或者http（apache、    nginx）提供基于web的源，或者是本地file上传的文件；</p>
</li>
<li><p><code>客户端</code>：使用yum命令安装软件包</p>
</li>
</ul>
<h2 id="2-yum服务端的搭建："><a href="#2-yum服务端的搭建：" class="headerlink" title="2.yum服务端的搭建："></a>2.yum服务端的搭建：</h2><p>  将软件包集中在服务端的某个目录下；<br>  createrepo -g /mnt/repodata/repomd.xml ./软件包位置</p>
<h2 id="3-yum的客户端的配置；"><a href="#3-yum的客户端的配置；" class="headerlink" title="3.yum的客户端的配置；"></a>3.yum的客户端的配置；</h2><p>  客户端使用yum命令进行安装、卸载、查找软件；</p>
<p>  1）.yum命令系统自动安装，可以通过以下命令进行查看；</p>
<ul>
<li><p><code>enable yum</code>        //查看yum命令是外部命令还是内部命令</p>
</li>
<li><p><code>which yum</code>        //查看外部命令的位置</p>
</li>
<li><p><code>yum provides */yum</code>    //查看yum命令的提供软件包</p>
<p>2）.配置yum仓库，源的文件；</p>
</li>
<li><p><code>mount  /dev/cdrom  /mnt</code>        //在虚拟机中将光盘镜像文件挂在到/mnt目录下</p>
</li>
<li><p><code>rm  -rf  /etc/yum.repos.d/*</code></p>
</li>
<li><p><code>vi /etc/yum.repos.d/centos.repo</code></p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[local]		//自定义名称，标记</span><br><span class="line">name=local	//是对repo文件的描述</span><br><span class="line">baseurl=file:///mnt		//yum服务器的访问路径，可以指定多个；</span><br><span class="line">enabled=1	//为1代表开启此源，为0代表关闭此源，关闭后yum 默认不会找到此源，需要使用yum --enablerepo=</span><br><span class="line">名称；</span><br><span class="line">gpgcheck=0	//为0代表不进行gpg公钥的检查，为1代表进行检查，为了保证软件包的完整性，rpm --import 公钥</span><br><span class="line">目录，进行导入公钥；</span><br><span class="line">gpgkey=file:///		//指定软件校验公钥的存放位置</span><br><span class="line">:wq</span><br></pre></td></tr></table></figure>

<p>yum源支持的协议：</p>
<ul>
<li><p><a href="ftp://192.168.100.100/" target="_blank" rel="noopener">ftp://192.168.100.100/</a></p>
</li>
<li><p><a href="http://192.168.100.100/" target="_blank" rel="noopener">http://192.168.100.100/</a></p>
</li>
<li><p>file:///mnt/</p>
</li>
</ul>
<p> 3）.yum的配置文件；</p>
<pre><code>/etc/yum.conf    //主配置文件，主要了解以下配置项：
keepcache=0 //将安装的软件包缓存到本地一份；                
cachedir=/var/cache/yum/$basearch/$releasever    //指定缓存软件包的路径；
logfile=/var/log/yum.log        //yum的日志文件</code></pre><h2 id="4-yum的用法（增删改查）："><a href="#4-yum的用法（增删改查）：" class="headerlink" title="4.yum的用法（增删改查）："></a>4.yum的用法（增删改查）：</h2><p>查（查找）：</p>
<ul>
<li><p><code>yum list</code>    //查看所有软件包</p>
</li>
<li><p><code>yum repolist</code>    //列出可用yum源</p>
</li>
<li><p><code>yum search 软件名(关键字）</code>    //查找软件</p>
</li>
<li><p><code>yum grouplist</code>    //列出所有可安装的yum源的软件组</p>
</li>
<li><p><code>yum groupinfo &quot;软件组名&quot;</code>    //查看软件组中软件包</p>
</li>
<li><p><code>yum provides */命令</code>        //查看提供此命令的软件包</p>
<p>增（安装）：</p>
</li>
<li><p><code>yum -y install 软件包名</code></p>
</li>
<li><p><code>yum -y groupinstall 软件组名</code></p>
<p>删（卸载）：</p>
</li>
<li><p><code>yum -y remove 软件包名</code></p>
</li>
<li><p><code>yum -y erase 软件包名</code></p>
</li>
<li><p><code>yum -y groupremove 软件组名</code></p>
<p>改(修改yum本身)：</p>
</li>
<li><p><code>yum clean all</code>    //清空yum的所有缓存，出错常用</p>
</li>
<li><p><code>yum -y update</code>    //更新系统，升级所有包，改变软件设置和系统设置,系统版本内核都升级</p>
</li>
<li><p><code>yum -y upgrade</code>        //升级所有包，不改变软件设置和系统设置，系统版本升级，内核不改变</p>
</li>
</ul>
<h1 id="四、源代码包的管理；"><a href="#四、源代码包的管理；" class="headerlink" title="四、源代码包的管理；"></a>四、源代码包的管理；</h1><h2 id="1-为什么要用源码安装；"><a href="#1-为什么要用源码安装；" class="headerlink" title="1.为什么要用源码安装；"></a>1.为什么要用源码安装；</h2><p>  部分软件无rpm包<br>  源码包是最新的，可以得到新功能和补丁<br>  源码编译安装实现功能定制，满足企业需求</p>
<h2 id="2-源码包编译安装的流程；"><a href="#2-源码包编译安装的流程；" class="headerlink" title="2.源码包编译安装的流程；"></a>2.源码包编译安装的流程；</h2><ol>
<li>wget或lftp形式下载源码包安装文件（也可以在windows中下载，完成后上传到linux中）；</li>
<li>解压软件包，通常包的格式都为.tar.gz或.tar.bz2，通常都解压到/usr/src/目录下；</li>
<li>配置安装目录，定制功能，由./configure –prefix=安装目录 … 命令来完成；</li>
<li>编译：生成二进制可执行文件，make命令来完成；</li>
<li>安装：复制文件到系统目录中，make install 命令来完成；</li>
<li>修改配置，启动服务，测试，投入使用；</li>
</ol>
<h2 id="3-源码安装的条件；"><a href="#3-源码安装的条件；" class="headerlink" title="3.源码安装的条件；"></a>3.源码安装的条件；</h2><p>  源代码编译安装必须要安装的两个工具：make、gcc（包含在装系统时，开发工具包中）</p>
<h2 id="4-编译安装的卸载；"><a href="#4-编译安装的卸载；" class="headerlink" title="4.编译安装的卸载；"></a>4.编译安装的卸载；</h2><p>  删除安装目录即可；</p>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    
	
	  <div>
        
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  
  <p class="site-author-name" itemprop="name">itw</p>
  <div class="site-description motion-element" itemprop="description"></div>
</div>


  <nav class="site-state motion-element">
    
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">51</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    

    
      
      
      <div class="site-state-item site-state-categories">
        
        
        
          
        
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span>
        
      </div>
    

    
      
      
      <div class="site-state-item site-state-tags">
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">标签</span>
        
      </div>
    
  </nav>



  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>











          
          
        </div>
      </div>

      

      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">itw</span>

  

  
</div>


<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>
<!-- <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.2.0</div>
-->



<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共183.1k字</span>
</div>

        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>










  
  













  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>




  <script src="/js/utils.js?v=7.2.0"></script>

  <script src="/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.2.0"></script>



  

  <script src="/js/next-boot.js?v=7.2.0"></script>

  

  

  

  

  



  




  

  

  

  

  

  

  

  

  

  

  

  

  


  

   <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;"></canvas> 
   <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
   <script type="text/javascript" src="/js/fireworks.js"></script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
