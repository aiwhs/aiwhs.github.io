<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
<style>
    .pace .pace-progress {
        background: #1E92FB; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #1E92FB;    /*上边框颜色*/
        border-left-color: #1E92FB;    /*左边框颜色*/
    }
</style>
<meta name="theme-color" content="#222">




  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-pace-theme-minimal.min.css?v=1.0.2">



















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">

<link rel="stylesheet" href="/css/main.css?v=7.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    }
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="itw">
<meta property="og:url" content="http://aiwhs.github.io/page/4/index.html">
<meta property="og:site_name" content="itw">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="itw">



  <link rel="alternate" href="/atom.xml" title="itw" type="application/atom+xml">



  
  
  <link rel="canonical" href="http://aiwhs.github.io/page/4/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  
  <title>itw</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
    <a href="https://github.com/aiwhs" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; left: 0; transform: scale(-1, 1);" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style></a>
	
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">itw</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://aiwhs.github.io/2018/10/20/shell脚本基础/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="itw">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="itw">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/20/shell脚本基础/" class="post-title-link" itemprop="url">shell脚本基础</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-10-20 08:15:57" itemprop="dateCreated datePublished" datetime="2018-10-20T08:15:57+08:00">2018-10-20</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-09 15:52:12" itemprop="dateModified" datetime="2019-07-09T15:52:12+08:00">2019-07-09</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux运维/" itemprop="url" rel="index"><span itemprop="name">Linux运维</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h1 id="1-变量"><a href="#1-变量" class="headerlink" title="1.变量"></a>1.变量</h1><h2 id="1-1-什么是变量？"><a href="#1-1-什么是变量？" class="headerlink" title="1.1 什么是变量？"></a>1.1 什么是变量？</h2><p>变量即可以变化的量</p>
<h2 id="1-2-变量名称注意事项"><a href="#1-2-变量名称注意事项" class="headerlink" title="1.2 变量名称注意事项"></a>1.2 变量名称注意事项</h2><ul>
<li>只能包含字母、数字、下划线，并且不能以数字开头</li>
<li>不应该跟系统中已有的环境变量重名，尽量不要全部使用大写，尽量不要用“_”下划线开头</li>
<li>最好做到见名知义</li>
<li>不能使用程序中的保留字，例如if、for等</li>
</ul>
<h2 id="1-3-变量类型"><a href="#1-3-变量类型" class="headerlink" title="1.3 变量类型"></a>1.3 变量类型</h2><ul>
<li>字符型</li>
<li>数值型<ul>
<li><input disabled type="checkbox"> 整型</li>
<li><input disabled type="checkbox"> 浮点型</li>
</ul>
</li>
<li>布尔型</li>
</ul>
<h2 id="1-4-变量操作"><a href="#1-4-变量操作" class="headerlink" title="1.4 变量操作"></a>1.4 变量操作</h2><ul>
<li>设置变量</li>
<li>引用变量</li>
<li>撤销变量</li>
</ul>
<blockquote>
<p>单引号与双引号的区别</p>
</blockquote>
<h2 id="1-5-bash变量类型"><a href="#1-5-bash变量类型" class="headerlink" title="1.5 bash变量类型"></a>1.5 bash变量类型</h2><ul>
<li>环境变量</li>
<li>本地变量（局部变量）</li>
<li>位置变量</li>
<li>特殊变量（bash内置的，用来保存某些特殊数据的变量，也称系统变量）</li>
</ul>
<h4 id="1-5-1-本地变量"><a href="#1-5-1-本地变量" class="headerlink" title="1.5.1 本地变量"></a>1.5.1 本地变量</h4><blockquote>
<p>VAR_NAME=VALUE<br>本地变量，作用域为当前shell进程。对当前shell外的其它shell进程，包括当前shell的父shell、子shell进程均无效</p>
</blockquote>
<blockquote>
<p>local VAR_NAME=VALUE<br>局部变量，作用域为当前代码段，常用于函数</p>
</blockquote>
<h4 id="1-5-2-环境变量"><a href="#1-5-2-环境变量" class="headerlink" title="1.5.2 环境变量"></a>1.5.2 环境变量</h4><blockquote>
<p>export VAR_NAME=VALUE<br>作用域为当前shell进程及其子进程</p>
</blockquote>
<h4 id="1-5-3-位置变量"><a href="#1-5-3-位置变量" class="headerlink" title="1.5.3 位置变量"></a>1.5.3 位置变量</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$1，$2，$3，....       //用来引用脚本的参数</span><br><span class="line">    shift [num]         //位置变量使用完以后退出，后面的参数向前推进</span><br></pre></td></tr></table></figure>

<h4 id="1-5-4-特殊变量"><a href="#1-5-4-特殊变量" class="headerlink" title="1.5.4 特殊变量"></a>1.5.4 特殊变量</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$#      //是传给脚本的参数个数</span><br><span class="line">$0      //是脚本本身的名字</span><br><span class="line">$!      //是shell最后运行的后台Process的PID</span><br><span class="line">$@      //是传给脚本的所有参数的列表</span><br><span class="line">$*      //是以一个单字符串显示所有向脚本传递的参数，与位置变量不同，参数可超过9个</span><br><span class="line">$$      //是脚本运行的当前进程ID号</span><br><span class="line">$?      //是显示上条命令的退出状态，0表示没有错误，其他表示有错误</span><br></pre></td></tr></table></figure>

<h4 id="1-5-5-bash内建环境变量"><a href="#1-5-5-bash内建环境变量" class="headerlink" title="1.5.5 bash内建环境变量"></a>1.5.5 bash内建环境变量</h4><blockquote>
<p>PATH</p>
<p>SHELL</p>
<p>UID</p>
<p>HISTSIZE</p>
<p>HOME</p>
<p>PWD</p>
<p>HISTFILE</p>
<p>PS1</p>
</blockquote>
<h4 id="1-5-6-只读变量（常量）"><a href="#1-5-6-只读变量（常量）" class="headerlink" title="1.5.6 只读变量（常量）"></a>1.5.6 只读变量（常量）</h4><blockquote>
<p>readonly VAR_NAME=VALUE<br>不能修改值，不能销毁，只能等shell进程终止时随之消亡</p>
</blockquote>
<h1 id="2-脚本基础"><a href="#2-脚本基础" class="headerlink" title="2. 脚本基础"></a>2. 脚本基础</h1><h2 id="2-1-什么是脚本？"><a href="#2-1-什么是脚本？" class="headerlink" title="2.1 什么是脚本？"></a>2.1 什么是脚本？</h2><p><strong>按实际需要，结合命令流程控制机制实现的源程序。说白点就是命令的堆砌。</strong></p>
<h2 id="2-2-程序返回值"><a href="#2-2-程序返回值" class="headerlink" title="2.2 程序返回值"></a>2.2 程序返回值</h2><p><strong>程序执行以后有两类返回值：</strong></p>
<ul>
<li>程序执行的结果</li>
<li>程序状态返回代码（0-255）<ul>
<li><input disabled type="checkbox"> 0：正确执行</li>
<li><input disabled type="checkbox"> 1-255：错误执行，1、2、127系统预留，有特殊意义</li>
</ul>
</li>
</ul>
<h2 id="2-3-脚本测试"><a href="#2-3-脚本测试" class="headerlink" title="2.3 脚本测试"></a>2.3 脚本测试</h2><p>bash如何测试脚本是否有错误？报错后如何排查？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bash -n scriptname      //检查脚本是否有语法错误</span><br><span class="line">bash -x scriptname      //单步执行，检查脚本错在哪里</span><br></pre></td></tr></table></figure>

<h2 id="2-4-写脚本注意事项"><a href="#2-4-写脚本注意事项" class="headerlink" title="2.4 写脚本注意事项"></a>2.4 写脚本注意事项</h2><ul>
<li>禁止将未成功执行过的代码直接写进脚本</li>
<li>脚本中的命令一定要用绝对路径</li>
</ul>
<h2 id="2-5-shell算术运算"><a href="#2-5-shell算术运算" class="headerlink" title="2.5 shell算术运算"></a>2.5 shell算术运算</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">A=3</span><br><span class="line">B=6</span><br><span class="line"></span><br><span class="line">let C=$A+$B         //let 算术运算表达式</span><br><span class="line"></span><br><span class="line">C=$[$A+$B]          //$[算术运算表达式]</span><br><span class="line"></span><br><span class="line">C=$(($A+$B))         //$((算术运算表达式))</span><br><span class="line"></span><br><span class="line">C=`expr $A + $B`    //expr 算术运算表达式，表达式中各操作数及运算符之间要有空隔，而且要使用命令引用</span><br></pre></td></tr></table></figure>

<h2 id="2-6-命令间的逻辑关系"><a href="#2-6-命令间的逻辑关系" class="headerlink" title="2.6 命令间的逻辑关系"></a>2.6 命令间的逻辑关系</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">逻辑与：&amp;&amp;</span><br><span class="line">    第一个条件为假时，第二个条件不用再判断，最终结果已经有</span><br><span class="line">    第一个条件为真时，第二个条件必须得判断</span><br><span class="line">逻辑或：||</span><br><span class="line">    前一个命令的结果为真时，第二个命令就不执行</span><br><span class="line">    前一个命令的结果为假时，第二个命令必须执行</span><br></pre></td></tr></table></figure>

<p><strong>示例:</strong></p>
<p>1.写一个脚本，要求如下：</p>
<ul>
<li>设定变量Fa的值为/etc/passwd</li>
<li>依次向/etc/passwd中的每个用户问好，并且说出对方的ID是什么。结果输出如下：<ul>
<li><input disabled type="checkbox"> Hello,root，your UID is 0.</li>
</ul>
</li>
<li>统计当前系统一个有多少个用户并输出</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;1.sh &lt;&lt;&apos;EOF&apos;</span><br><span class="line">#!/bin/bash</span><br><span class="line">Fa=/etc/passwd</span><br><span class="line">number=`cat $Fa | wc -l`</span><br><span class="line">#下面是一个管道，下面循环读文件中的每一行</span><br><span class="line">cat $Fa |</span><br><span class="line">while read line</span><br><span class="line">do</span><br><span class="line">    user=`echo $line|awk -F &apos;:&apos; &apos;&#123;print $1&#125;&apos;`</span><br><span class="line">    #代表以 ：分段$1就是取第1段</span><br><span class="line">    uid=`echo $line|awk -F &apos;:&apos; &apos;&#123;print $3&#125;&apos;`</span><br><span class="line">    echo &quot;Hello, $user, Your UID is $uid&quot;</span><br><span class="line">done</span><br><span class="line">echo &quot;&quot;</span><br><span class="line">#前面求得的用户数</span><br><span class="line">echo &quot;====Number of users:$number====&quot;</span><br><span class="line">echo &quot;&quot;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>2.写一个脚本，传递两个整数给此脚本，让脚本分别计算并显示这两个整数的和，差，积，商</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;2.sh &lt;&lt;&apos;EOF&apos;</span><br><span class="line">#!/bin/bash</span><br><span class="line">read -p &quot;请输入第一个数字:&quot; a</span><br><span class="line">read -p &quot;请输入第二个数字:&quot; b</span><br><span class="line">echo &quot;$a+$b=&quot;$[a+b]</span><br><span class="line">echo &quot;$a-$b=&quot;$[a-b]</span><br><span class="line">echo &quot;$a×$b=&quot;$[a*b]</span><br><span class="line">echo &quot;$a÷$b=$(printf &quot;%.2f&quot; $(echo &quot;scale=2;$a/$b&quot;|bc))&quot;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>3.写一个脚本，要求如下：</p>
<ul>
<li>创建目录/tmp/scripts</li>
<li>切换至此目录中</li>
<li>复制/etc/pam.d目录至当前目录，并重命名为test</li>
<li>将当前目录的test及其里面的文件和子目录的属主改为redhat</li>
<li>将test及其子目录中的文件的其它用户的权限改为没有任何权限</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;3.sh &lt;&lt;&apos;EOF&apos;</span><br><span class="line">#!/bin/bash</span><br><span class="line">rm -f /tmp/scripts/test/* || echo &quot;正常报错,不影响脚本执行&quot;</span><br><span class="line">rmdir /tmp/scripts/test || echo &quot;正常报错,不影响脚本执行&quot;</span><br><span class="line">userdel -r redhat || echo &quot;正常报错,不影响脚本执行&quot;</span><br><span class="line">rmdir /tmp/scripts/ || echo &quot;正常报错,不影响脚本执行&quot;</span><br><span class="line">mkdir /tmp/scripts</span><br><span class="line">cd /tmp/scripts/</span><br><span class="line">cp -r /etc/pam.d ./test</span><br><span class="line">useradd redhat</span><br><span class="line">chown -R redhat ./test</span><br><span class="line">chmod -R o=--- ./test</span><br><span class="line">cd ~</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>4.写一个脚本，要求如下：</p>
<ul>
<li>显示当前系统日期和时间，而后创建目录/tmp/lstest</li>
<li>切换工作目录至/tmp/lstest</li>
<li>创建目录a1d，b56e，6test</li>
<li>创建空文件xy，x2y，732</li>
<li>列出当前目录下以a，x或者6开头的文件或目录</li>
<li>列出当前目录下以字母开头，后跟一个任意数字，而后跟任意长度字符的文件或目录</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;4.sh &lt;&lt;&apos;EOF&apos;</span><br><span class="line">#!/bin/bash</span><br><span class="line">date</span><br><span class="line">rm -rf /tmp/lstest || echo &quot;正常报错,不影响脚本执行&quot;</span><br><span class="line">mkdir /tmp/lstest</span><br><span class="line">cd /tmp/lstest/</span><br><span class="line">mkdir -p a1d b56e 6test</span><br><span class="line">touch xy x2y 732</span><br><span class="line">echo &quot;======&quot;</span><br><span class="line">find a* x* 6*</span><br><span class="line">echo &quot;======&quot;</span><br><span class="line">ls |egrep -i &quot;^[a-z][0-9]&quot;</span><br><span class="line">cd ~</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    
	
	  <div>
        
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://aiwhs.github.io/2018/10/14/正则表达式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="itw">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="itw">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/14/正则表达式/" class="post-title-link" itemprop="url">正则表达式</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-10-14 08:15:57" itemprop="dateCreated datePublished" datetime="2018-10-14T08:15:57+08:00">2018-10-14</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-09 15:45:06" itemprop="dateModified" datetime="2019-07-09T15:45:06+08:00">2019-07-09</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux运维/" itemprop="url" rel="index"><span itemprop="name">Linux运维</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>



<h1 id="1-正则表达式分类"><a href="#1-正则表达式分类" class="headerlink" title="1. 正则表达式分类"></a>1. 正则表达式分类</h1><p><strong>正则表达式：REGEXP，REGular EXPression。</strong><br><strong>正则表达式分为两类：</strong></p>
<ul>
<li>Basic REGEXP（基本正则表达式）</li>
<li>Extended REGEXP（扩展正则表达式）</li>
</ul>
<h1 id="2-基本正则表达式"><a href="#2-基本正则表达式" class="headerlink" title="2. 基本正则表达式"></a>2. 基本正则表达式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">元字符</span><br><span class="line">    .           //任意单个字符</span><br><span class="line">    []          //匹配指定范围内的任意单个字符</span><br><span class="line">    [^]         //匹配指定范围外的任意单个字符</span><br><span class="line">匹配次数（贪婪模式）</span><br><span class="line">    *           //匹配其前面的任意单个字符任意次</span><br><span class="line">    .*          //任意长度的任意字符</span><br><span class="line">    \?          //匹配其前面的任意单个字符1次或0次</span><br><span class="line">    \+          //匹配其前面的任意单个字符至少1次</span><br><span class="line">    \&#123;m,n\&#125;     //匹配其前面的任意单个字符至少m次，至多n次</span><br><span class="line">位置锚定</span><br><span class="line">    ^           //锚定行首，此字符后面的任意单个字符必须出现在行首</span><br><span class="line">    $           //锚定行尾，此字符前面的任意单个字符必须出现在行尾</span><br><span class="line">    ^$          //空白行</span><br><span class="line">    \&lt;或\b       //锚定词首，其后面的任意单个字符必须作为单词首部出现</span><br><span class="line">    \&gt;或\b       //锚定词尾，其前面的任意单个字符必须作为单词尾部出现</span><br><span class="line">分组</span><br><span class="line">    \(\)</span><br><span class="line">    例：\(ab\)*</span><br><span class="line">    后向引用</span><br><span class="line">        \1      //引用第一个左括号以及与之对应的右括号所包括的所有内容</span><br><span class="line">        \2      //引用第二个左括号以及与之对应的右括号所包括的所有内容</span><br></pre></td></tr></table></figure>

<h1 id="3-扩展正则表达式"><a href="#3-扩展正则表达式" class="headerlink" title="3. 扩展正则表达式"></a>3. 扩展正则表达式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">字符匹配</span><br><span class="line">    .       //匹配任意单个字符</span><br><span class="line">    []      //匹配指定范围内的任意单个字符</span><br><span class="line">    [^]     //匹配指定范围外的任意单个字符</span><br><span class="line">次数匹配</span><br><span class="line">    *       //匹配其前面的任意单个字符任意次</span><br><span class="line">    ?       //匹配其前面的任意单个字符1次或0次</span><br><span class="line">    +       //匹配其前面的任意单个字符至少1次</span><br><span class="line">    &#123;m,n&#125;   //匹配其前面的任意单个字符至少m次，至多n次</span><br><span class="line"></span><br><span class="line">位置锚定</span><br><span class="line">    ^       //锚定行首，此字符后面的任意单个字符必须出现在行首</span><br><span class="line">    $       //锚定行尾，此字符前面的任意单个字符必须出现在行尾</span><br><span class="line">    ^$      //空白行</span><br><span class="line">    \&lt;或\b       //锚定词首，其后面的任意单个字符必须作为单词首部出现</span><br><span class="line">    \&gt;或\b       //锚定词尾，其前面的任意单个字符必须作为单词尾部出现</span><br><span class="line">分组</span><br><span class="line">    ()      //分组</span><br><span class="line">    \1，\2，\3，....</span><br><span class="line">   例：(ab)*</span><br><span class="line">    后向引用</span><br><span class="line">        \1      //引用第一个左括号以及与之对应的右括号所包括的所有内容</span><br><span class="line">        \2      //引用第二个左括号以及与之对应的右括号所包括的所有内容</span><br><span class="line">或者</span><br><span class="line">    |       //or 默认匹配｜的整个左侧或者整个右侧的内容</span><br><span class="line">    例：C|cat表示C或者cat，要想表示Cat或者cat则需要使用分组，如(C|c)at</span><br></pre></td></tr></table></figure>


          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    
	
	  <div>
        
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://aiwhs.github.io/2018/10/13/NFS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="itw">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="itw">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/13/NFS/" class="post-title-link" itemprop="url">NFS</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-10-13 08:15:57" itemprop="dateCreated datePublished" datetime="2018-10-13T08:15:57+08:00">2018-10-13</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-12 14:40:53" itemprop="dateModified" datetime="2019-07-12T14:40:53+08:00">2019-07-12</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux运维/" itemprop="url" rel="index"><span itemprop="name">Linux运维</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h1 id="1-nfs简介"><a href="#1-nfs简介" class="headerlink" title="1. nfs简介"></a>1. nfs简介</h1><h3 id="1-1-nfs特点"><a href="#1-1-nfs特点" class="headerlink" title="1.1 nfs特点"></a>1.1 nfs特点</h3><ul>
<li>NFS（Network File<br>System）即网络文件系统，是FreeBSD支持的文件系统中的一种，它允许网络中的计算机之间通过TCP/IP网络共享资源</li>
<li>在NFS的应用中，本地NFS的客户端应用可以透明地读写位于远端NFS服务器上的文件，就像访问本地文件一样</li>
<li>nfs适用于Linux与Unix之间实现文件共享，不能实现Linux与Windows间的文件共享功能</li>
<li>nfs是运行在应用层的协议，其监听于2049/tcp和2049/udp套接字上 </li>
<li>nfs服务只能基于IP进行认证，这也是它的缺点之一</li>
</ul>
<h3 id="1-2-使用nfs的好处"><a href="#1-2-使用nfs的好处" class="headerlink" title="1.2 使用nfs的好处"></a>1.2 使用nfs的好处</h3><ul>
<li>节省本地存储空间，将常用的数据存放在一台NFS服务器上且可以通过网络访问，那么本地终端将可以减少自身存储空间的使用</li>
<li>用户不需要在网络中的每个机器上都建有Home目录，Home目录可以放在NFS服务器上且可以在网络上被访问使用</li>
<li>一些存储设备如软驱、CDROM和Zip（一种高储存密度的磁盘驱动器与磁盘）等都可以在网络上被别的机器使用。这可以减少整个网络上可移动介质设备的数量</li>
</ul>
<h3 id="1-3-nfs的体系组成"><a href="#1-3-nfs的体系组成" class="headerlink" title="1.3 nfs的体系组成"></a>1.3 nfs的体系组成</h3><p>nfs体系至少有两个主要部分：</p>
<ul>
<li>一台nfs服务器</li>
<li>若干台客户机</li>
</ul>
<p>nfs体系的架构图如下：</p>
<p><img src="../../img/nfstixi.jpg" alt="nfs1"></p>
<blockquote>
<p>客户机通过TCP/IP网络远程访问存放在NFS服务器上的数据 在NFS服务器正式启用前，需要根据实际环境和需求，配置一些NFS参数</p>
</blockquote>
<h3 id="1-4-nfs的应用场景"><a href="#1-4-nfs的应用场景" class="headerlink" title="1.4 nfs的应用场景"></a>1.4 nfs的应用场景</h3><p>nfs有很多实际应用场景，以下是一些常用的场景：</p>
<ul>
<li>多个机器共享一台CDROM或其他设备。这对于在多台机器中安装软件来说更加便宜与方便</li>
<li>在大型网络中，配置一台中心NFS服务器用来放置所有用户的home目录可能会带来便利。这些目录能被输出到网络以便用户不管在哪台工作站上登录，总能得到相同的home目录</li>
<li>不同客户端可在NFS上观看影视文件，节省本地空间</li>
<li>在客户端完成的工作数据，可以备份保存到NFS服务器上用户自己的路径下</li>
</ul>
<h1 id="2-nfs工作机制"><a href="#2-nfs工作机制" class="headerlink" title="2.nfs工作机制"></a>2.nfs工作机制</h1><p><strong>nfs是基于rpc来实现网络文件系统共享的。所以我们先来说说rpc。</strong></p>
<h3 id="2-1-RPC"><a href="#2-1-RPC" class="headerlink" title="2.1 RPC"></a>2.1 RPC</h3><p>RPC（Remote Procedure Call Protocol），远程过程调用协议，它是一种通过网络从远程计算机程序上请求服务，而不需要了解底层网络技术的协议。</p>
<p>RPC协议假定某些传输协议的存在，如TCP或UDP，为通信程序之间携带信息数据。在OSI网络通信模型中，RPC跨越了传输层和应用层。</p>
<p>RPC采用客户机/服务器模式。请求程序就是一个客户机，而服务提供程序就是一个服务器。</p>
<p><img src="../../img/rpc.jpg" alt="nfs2"></p>
<p>rpc工作机制如上图所示，下面来描述一下它：</p>
<ul>
<li>客户端程序发起一个RPC系统调用基于TCP协议发送给另一台主机（服务端）</li>
<li>服务端监听在某个套接字上，当收到客户端的系统调用请求以后，将收到的请求和其所传递的参数通过本地的系统调用执行一遍，并将结果返回给本地的服务进程</li>
<li>服务端的服务进程收到返回的执行结果后将其封装成响应报文，再通过rpc协议返回给客户端</li>
<li>客户端调用进程接收答复信息，获得进程结果，然后调用执行继续进行</li>
</ul>
<h3 id="2-2-NIS"><a href="#2-2-NIS" class="headerlink" title="2.2 NIS"></a>2.2 NIS</h3><p>NIS(Network Information System)，网络信息系统，是对主机帐号等系统提供集中管理的网络服务。</p>
<p>用户登录任何一台NIS客户机都会从NIS服务器进行登录认证，可实现用户帐号的集中管理。</p>
<p>NIS协议是明文的，所以NIS一般不建议在公网中使用而通常在局域网中使用。</p>
<p>此章主要是讲NFS，所以NIS的配置这里就不详说了，有兴趣的朋友可以去网上搜索。</p>
<h3 id="2-3-nfs工作机制"><a href="#2-3-nfs工作机制" class="headerlink" title="2.3 nfs工作机制"></a>2.3 nfs工作机制</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">NFS服务器端运行着四个进程：</span><br><span class="line">    nfsd</span><br><span class="line">    mountd</span><br><span class="line">    idmapd</span><br><span class="line">    portmapper</span><br><span class="line"></span><br><span class="line">idmapd  实现用户帐号的集中映射，把所有的帐号都映射为NFSNOBODY，但是在访问时却能以本地用户的身份去访问</span><br><span class="line"></span><br><span class="line">mountd  用于验证客户端是否在允许访问此NFS文件系统的客户端列表中，在则允许访问（发放一个令牌，持令牌去找nfsd），否则拒绝访问</span><br><span class="line">        mountd的服务端口是随机的，由rpc服务（portmapper）提供随机端口号</span><br><span class="line"></span><br><span class="line">nfsd    nfs的守护进程，监听在2049/tcp和2049/udp端口上</span><br><span class="line">        不负责文件存储（由NFS服务器本地内核负责调度存储），用于理解客户端发起的rpc请求，并将其转交给本地内核，而后存储在指定的文件系统上</span><br><span class="line"></span><br><span class="line">portmapper  NFS服务器的rpc服务，其监听于111/TCP和111/UDP套接字上，用于管理远程过程调用（RPC）</span><br></pre></td></tr></table></figure>

<p>下面通过一个例子来说明NFS的简单工作流程：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">需求：查看file文件的信息，此file存储在远程NFS服务端主机上（挂载在本地目录/shared/nfs中）</span><br></pre></td></tr></table></figure>

<p><img src="../../img/nfsprocedure.jpg" alt="nfs3"></p>
<ul>
<li>客户端发起查看file信息的指令（ls<br>file）给内核，内核通过NFS模块得知此文件并不是本地文件系统中的文件，而是在远程NFS主机上的一个文件</li>
<li>客户端主机的内核通过RPC协议把查看file信息的指令（系统调用）封装成rpc请求通过TCP的111端口发送给NFS服务端主机的portmapper</li>
<li>NFS服务端主机的portmapper（RPC服务进程）告诉客户端说NFS服务端的mountd服务在某某端口上，你去找它验证</li>
</ul>
<blockquote>
<p>因为mountd在提供服务时必须要向portmapper注册一个端口号，所以portmapper是知道其工作于哪个端口的</p>
</blockquote>
<ul>
<li>客户端得知服务端的mountd进程端口号后，通过已知的服务端mountd端口号请求验证</li>
<li>mountd收到验证请求后验证发起请求的客户端是否在允许访问此NFS文件系统的客户端列表中，在则允许访问（发放一个令牌，持令牌去找nfsd），否则拒绝访问</li>
<li>验证通过后客户端持mountd发放的令牌去找服务端的nfsd进程，请求查看某文件</li>
<li>服务端的nfsd进程发起本地系统调用，向内核请求查看客户端要查看的文件的信息</li>
<li>服务端的内核执行nfsd请求的系统调用，并将结果返回给nfsd服务</li>
<li>nfsd进程收到内核返回的结果后将其封装成rpc请求报文并通过tcp/ip协议返回给客户端</li>
</ul>
<h1 id="3-exports文件的格式"><a href="#3-exports文件的格式" class="headerlink" title="3.exports文件的格式"></a>3.exports文件的格式</h1><p>nfs的主配置文件是/etc/exports，在此文件中，可以定义NFS系统的输出目录（即共享目录）、访问权限和允许访问的主机等参数。该文件默认为空，没有配置输出任何共享目录，这是基于安全性的考虑，如此即使系统启动了NFS服务也不会输出任何共享资源。</p>
<p>exports文件中每一行提供了一个共享目录的设置，其命令格式为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">格式： 共享目录的路径 允许访问的NFS客户端（共享权限参数）</span><br><span class="line">&lt;输出目录&gt; [客户端1(选项1,选项2,...)] [客户端2(选项1,选项2,...)]</span><br><span class="line"></span><br><span class="line">请注意，NFS客户端地址与权限之间没有空格。</span><br><span class="line">NFS输出保护需要用到kerberos加密（none，sys，krb5，krb5i，krb5p），格式sec=XXX</span><br><span class="line">none：以匿名身份访问，如果要允许写操作，要映射到nfsnobody用户，同时布尔值开关要打开，setsebool nfsd_anon_write 1</span><br><span class="line">sys：文件的访问是基于标准的文件访问，如果没有指定，默认就是sys， 信任任何发送过来用户名</span><br><span class="line">krb5：客户端必须提供标识，客户端的表示也必须是krb5，基于域环境的认证</span><br><span class="line">krb5i：在krb5的基础上做了加密的操作，对用户的密码做了加密，但是传输的数据没有加密</span><br><span class="line">krb5p：所有的数据都加密</span><br></pre></td></tr></table></figure>

<p>其中，除输出目录是必选参数外，其他参数均是可选项。另外，格式中的输出目录和客户端之间、客户端与客户端之间都使用空格分隔，但客户端与选项之间不能有空格。</p>
<p>客户端是指网络中可以访问这个NFS共享目录的计算机。客户端的指定非常灵活，可为单个主机的IP或域名，亦可为某个子网或域中的主机等。</p>
<p><strong>客户端常用的指定方式：</strong></p>
<table>
<thead>
<tr>
<th>客户端</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.160.65</td>
<td>指定IP地址的主机</td>
</tr>
<tr>
<td>192.168.160.0/24(或192.168.160.*)</td>
<td>指定子网中的所有主机</td>
</tr>
<tr>
<td><a href="http://www.wenhs5479.com" target="_blank" rel="noopener">www.wenhs5479.com</a></td>
<td>指定域名的主机</td>
</tr>
<tr>
<td>*.wenhs5479.com</td>
<td>指定wenhs5479.com域中的所有主机</td>
</tr>
<tr>
<td>*(或缺省)</td>
<td>所有主机</td>
</tr>
<tr>
<td>选项用来设置共享目录的访问权限、用户映射等。exports文件中的选项比较多，一般可分为三类：</td>
<td></td>
</tr>
</tbody></table>
<ul>
<li>访问权限选项（用于控制共享目录的访问权限）</li>
<li>用户映射选项<ul>
<li><input disabled type="checkbox"> 默认情况下，当客户端访问NFS服务器时，若远程访问的用户是root用户，则NFS服务器会将其映射成一个本地的匿名用户（该用户为nfsnobody），并将其所属的用户组也映射成匿名用户组（该用户组也为nfsnobody），如此有助于提高系统的安全性。</li>
</ul>
</li>
<li>其他选项</li>
</ul>
<p><strong>访问权限选项：</strong></p>
<table>
<thead>
<tr>
<th>访问权限选项</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>ro</td>
<td>设置输出目录只读</td>
</tr>
<tr>
<td>rw</td>
<td>设置输出目录可读写</td>
</tr>
</tbody></table>
<p><strong>用户映射选项：</strong></p>
<table>
<thead>
<tr>
<th>用户映射选项</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>all_squash</td>
<td>将远程访问的所有普通用户及所属组都映射为匿名用户或用户组(nfsnobody)</td>
</tr>
<tr>
<td>no_all_squash</td>
<td>不将远程访问的所有普通用户及所属用户组都映射为匿名用户或用户组(默认设置)</td>
</tr>
<tr>
<td>root_squash</td>
<td>将root用户及所属用户组都映射为匿名用户或用户组(默认设置)</td>
</tr>
<tr>
<td>no_root_squash</td>
<td>不将root用户及所属用户组都映射为匿名用户或用户组</td>
</tr>
<tr>
<td>anonuid=xxx</td>
<td>将远程访问的所有用户都映射为匿名用户，并指定该匿名用户为本地用户帐户(UID=xxx)</td>
</tr>
<tr>
<td>anongid=xxx</td>
<td>将远程访问的所有用户组都映射为匿名用户组，并指定该匿名用户组为本地用户组(GID=xxx)</td>
</tr>
</tbody></table>
<p><strong>常用的其他选项：</strong></p>
<table>
<thead>
<tr>
<th>其他选项</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>secure</td>
<td>限制客户端只能从小于1024的TCP/IP端口连接NFS服务器(默认设置)</td>
</tr>
<tr>
<td>insecure</td>
<td>允许客户端从大于1024的TCP/IP端口连接NFS服务器</td>
</tr>
<tr>
<td>sync</td>
<td>将数据同步写入内存缓冲区或磁盘中，效率较低，但可保证数据一致性</td>
</tr>
<tr>
<td>async</td>
<td>将数据先保存在内存缓冲区中，必要时才写入磁盘</td>
</tr>
<tr>
<td>wdelay</td>
<td>检查是否有相关的写操作，如果有则这些写操作一起执行，可提高效率(默认设置)</td>
</tr>
<tr>
<td>no_wdelay</td>
<td>若有写操作则立即执行，应与sync配置使用</td>
</tr>
<tr>
<td>subtree_check</td>
<td>若输出目录是一个子目录，则NFS服务器将检查其父目录的权限(默认设置)</td>
</tr>
<tr>
<td>no_subtree_check</td>
<td>即使输出目录是一个子目录，NFS服务亦不检查其父目录的权限，可提高效率</td>
</tr>
<tr>
<td>nohide</td>
<td>若将一个目录挂载到另一个目录之上，则原来的目录通常就被隐藏起来或看起来像空的一样。要禁用这种行为，需启用hide选项</td>
</tr>
</tbody></table>
<h1 id="4-nfs管理"><a href="#4-nfs管理" class="headerlink" title="4. nfs管理"></a>4. nfs管理</h1><p><strong>nfs安装：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">安装</span><br><span class="line">    yum -y install nfs-utils</span><br><span class="line"></span><br><span class="line">启动</span><br><span class="line">    systemctl start rpcbind nfs-server</span><br></pre></td></tr></table></figure>

<p><strong>使用shoumount命令测试NFS服务器的输出目录状态：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法：showmount [选项] [NFS服务器名称或地址]</span><br><span class="line">常用的选项有：</span><br><span class="line">    -a  显示指定NFS服务器的所有客户端主机及其所连接的目录</span><br><span class="line">    -d  显示指定的NFS服务器中已被客户端连接的所有输出目录</span><br><span class="line">    -e  显示指定的NFS服务器上所有输出的共享目录</span><br></pre></td></tr></table></figure>

<p><strong>在客户端挂载NFS文件系统：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t nfs SERVER:/path/to/sharedfs /path/to/mount_point</span><br></pre></td></tr></table></figure>

<p><strong>在客户端设置开机自动挂载nfs：编辑/etc/fstab文件，添加如下格式的内容</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SERVER:/PATH/TO/EXPORTED_FS /mnt_point nfs defaults,_netdev 0 0</span><br></pre></td></tr></table></figure>

<p>客户端挂载时可以使用的特殊选项：</p>
<ul>
<li>rsize：其值是从服务器读取的字节数（缓冲）。默认为1024。若使用比较高的值，如8192，可以提高传输速度</li>
<li>wsize：其值是写入到服务器的字节数（缓冲）。默认为1024。若使用比较高的值，如8192，可以提高传输速度</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">exportfs        维护exports文件导出的文件系统表的专用工具</span><br><span class="line">    -a      输出在/etc/exports文件中所设置的所有目录</span><br><span class="line">    -r      重新读取/etc/exports文件中的设置，并使其立即生效，无需重启服务</span><br><span class="line">    -u      停止输出某一目录</span><br><span class="line">    -v      在输出目录时将目录显示到屏幕上</span><br></pre></td></tr></table></figure>

<p><strong>检查输出目录所使用的选项：</strong></p>
<p>在配置文件/etc/exports中，即使在命令行中只设置了一两个选项，但在真正输出目录时，实际上还带有很多默认的选项。通过查看/var/lib/nfs/etab文件，可以看到具体使用了何选项</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# cat /var/lib/nfs/etab </span><br><span class="line">/nfs/upload	192.168.160.0/24(rw,sync,wdelay,hide,nocrossmnt,secure,root_squash,no_all_squash,no_subtree_check,secure_locks,acl,no_pnfs,anonuid=300,anongid=300,sec=sys,rw,secure,root_squash,no_all_squash)</span><br><span class="line">/nfs/shared	*(ro,sync,wdelay,hide,nocrossmnt,secure,root_squash,no_all_squash,no_subtree_check,secure_locks,acl,no_pnfs,anonuid=65534,anongid=65534,sec=sys,ro,secure,root_squash,no_all_squash)</span><br></pre></td></tr></table></figure>

<h2 id="实验-搭建NFS服务器"><a href="#实验-搭建NFS服务器" class="headerlink" title="实验:搭建NFS服务器"></a>实验:搭建NFS服务器</h2><h4 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a>搭建环境</h4><ul>
<li>服务器地址为192.168.160.66/24，客户端地址为192.168.160.65/24</li>
</ul>
<p><strong>搭建一个NFS服务器</strong></p>
<ul>
<li>开放/nfs/shared目录，供所有用户查阅资料</li>
<li>开放/nfs/upload目录为192.168.160.0/24网段的数据上传目录，并将所有用户及所属的用户组都映射为nfs-upload，其UID与GID均为300。</li>
</ul>
<h4 id="NFS应用场景及好处"><a href="#NFS应用场景及好处" class="headerlink" title="NFS应用场景及好处"></a>NFS应用场景及好处</h4><p><strong>NFS一些常用的场景及好处：</strong></p>
<ul>
<li>多个客户端需要资源时可以连接到NFS服务器，将自己所需文件下载下来；</li>
<li>将用户都需要的文件放到一个共享的目录里面，既方便用户需要的时候下载，有可以大大节省磁盘空间；</li>
<li>可以用作备份数据，当数据丢失时，只需要简单的几条命令就可以将数据下载下来；</li>
<li>不论任何时间，任何地点，随时可以登录，文件总是一样。</li>
</ul>
<h4 id="NFS配置"><a href="#NFS配置" class="headerlink" title="NFS配置"></a>NFS配置</h4><p><strong>在服务端和客户端安装nfs-utils</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install nfs-utils* rpcbind*</span><br></pre></td></tr></table></figure>

<ul>
<li>在服务端启动服务</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start rpcbind nfs-server</span><br></pre></td></tr></table></figure>

<ul>
<li>在客户端启动服务</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start rpcbind</span><br></pre></td></tr></table></figure>

<ul>
<li>创建/nfs/shared目录,将shared目录共享给所有用户使用：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">首先创建共享目录，</span><br><span class="line">mkdir -p /nfs&#123;/shared,/upload&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">在修改/etc/exports文件，添加如下代码：</span><br><span class="line">/nfs/shared *(ro,sync)</span><br><span class="line">重新启动服务</span><br><span class="line">systemctl restart rpcbind nfs-server</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">在客户端查看服务器的共享目录</span><br><span class="line">[root@wenhs ~]# showmount -e 192.168.160.66</span><br><span class="line">Export list for 192.168.160.66:</span><br><span class="line">/nfs/shared *</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">在客户端将/nfs/shared挂在到/nfs/shared目录下</span><br><span class="line">mount -t nfs 192.168.160.66:/nfs/shared /nfs/shared</span><br></pre></td></tr></table></figure>

<ul>
<li>创建/nfs/upload目录，创建用户和组为nfs-upload，指定UID与GID为300，</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">创建/nfs/upload目录，</span><br><span class="line">mkdir /nfs/upload</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">创建用户nfs-upload，UID与GID为300,</span><br><span class="line">useradd -r -u 300 nfs-upload</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">修改/nfs/exports文件，</span><br><span class="line">/nfs/upload 192.168.160.0/24(rw,anonuid=300,anongid=300,sync)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">客户端查看NFS服务器共享的目录，</span><br><span class="line">[root@wenhs ~]# showmount -e 192.168.160.66</span><br><span class="line">Export list for 192.168.160.66:</span><br><span class="line">/nfs/shared *</span><br><span class="line">/nfs/upload 192.168.160.0/24</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">挂载共享目录，</span><br><span class="line">mount -t nfs 192.168.160.66:/nfs/upload /nfs/upload</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">这时候不能在客户端进行写操作，需要在服务器端将所属主和属组改为nfs-upload，</span><br><span class="line">chown nfs-upload.nfs-upload /nfs/upload</span><br></pre></td></tr></table></figure>

<ul>
<li>NFS扩展<ul>
<li>客户端开机自动挂载</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">编辑/etc/fstab文件，添加如下内容：</span><br><span class="line">192.168.160.66:/nfs/upload /nfs/upload nfs defaults,_netdev 0 0</span><br></pre></td></tr></table></figure>

<p>最终效果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs upload]# df -Th</span><br><span class="line">文件系统                   类型      容量  已用  可用 已用% 挂载点</span><br><span class="line">/dev/mapper/centos-root    xfs        36G  6.4G   30G   18% /</span><br><span class="line">devtmpfs                   devtmpfs  1.9G     0  1.9G    0% /dev</span><br><span class="line">tmpfs                      tmpfs     1.9G     0  1.9G    0% /dev/shm</span><br><span class="line">tmpfs                      tmpfs     1.9G   13M  1.9G    1% /run</span><br><span class="line">tmpfs                      tmpfs     1.9G     0  1.9G    0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1                  xfs      1014M  233M  782M   23% /boot</span><br><span class="line">/dev/mapper/centos-home    xfs        18G   37M   18G    1% /home</span><br><span class="line">tmpfs                      tmpfs     378M  4.0K  378M    1% /run/user/42</span><br><span class="line">tmpfs                      tmpfs     378M   36K  378M    1% /run/user/0</span><br><span class="line">/dev/sr0                   iso9660    11G   11G     0  100% /run/media/root/CentOS 7 x86_64</span><br><span class="line">192.168.160.66:/nfs/upload nfs4       13G  5.8G  6.7G   47% /nfs/upload</span><br><span class="line">192.168.160.66:/nfs/shared nfs4       13G  5.8G  6.7G   47% /nfs/shared</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    
	
	  <div>
        
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://aiwhs.github.io/2018/09/30/FTP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="itw">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="itw">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/09/30/FTP/" class="post-title-link" itemprop="url">FTP</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-09-30 08:15:57" itemprop="dateCreated datePublished" datetime="2018-09-30T08:15:57+08:00">2018-09-30</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-11 20:25:43" itemprop="dateModified" datetime="2019-07-11T20:25:43+08:00">2019-07-11</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux运维/" itemprop="url" rel="index"><span itemprop="name">Linux运维</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>



<h1 id="1-ftp简介"><a href="#1-ftp简介" class="headerlink" title="1. ftp简介"></a>1. ftp简介</h1><p>网络文件共享服务主流的主要有三种，分别是ftp、nfs、samba。</p>
<p>FTP是File Transfer Protocol（文件传输协议）的简称，用于internet上的控制文件的双向传输。</p>
<p>FTP也是一个应用程序，基于不同的操作系统有不同的FTP应用程序，而所有这些应用程序都遵守同一种协议以传输文件。</p>
<p>在FTP的使用当中，用户经常遇到两种概念：<strong>下载</strong>和<strong>上传</strong></p>
<table>
<thead>
<tr>
<th>下载(Download)</th>
<th>上传(Upload)</th>
</tr>
</thead>
<tbody><tr>
<td>从远程主机拷贝文件至自己的计算机上</td>
<td>将文件从自己的计算机上拷贝至远程主机上</td>
</tr>
</tbody></table>
<h1 id="2-ftp架构"><a href="#2-ftp架构" class="headerlink" title="2. ftp架构"></a>2. ftp架构</h1><p>FTP工作于应用层，监听于tcp的21号端口，是一种C/S架构的应用程序。其有多种客户端和服务端的应用程序，下面来简单介绍一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">客户端工具					服务端软件</span><br><span class="line">ftp							</span><br><span class="line">lftp,lftpget				wu-ftpd</span><br><span class="line">wget,curl					proftpd（提供web接口的一种ftp服务端程序）</span><br><span class="line">filezilla					pureftp</span><br><span class="line">gftp（Linux GUI）			vsftpd（Very Secure）</span><br><span class="line">商业软件（flashfxp,cuteftp）	ServU（windows平台的一种强大ftp服务端程序）</span><br></pre></td></tr></table></figure>

<h1 id="3-ftp数据连接模式"><a href="#3-ftp数据连接模式" class="headerlink" title="3. ftp数据连接模式"></a>3. ftp数据连接模式</h1><p>ftp有2种数据连接模式：<strong>命令连接</strong>和<strong>数据连接</strong></p>
<ul>
<li>命令连接：是指文件管理类命令，始终在线的持久性连接，直到用户退出登录为止</li>
<li>数据连接：是指数据传输，按需创建及关闭的连接</li>
</ul>
<p>其中数据连接需要关注的有2点:</p>
<ul>
<li>数据传输格式 </li>
<li>数据传输模式</li>
</ul>
<p>数据传输格式有以下两种：</p>
<ul>
<li>文件传输</li>
<li>二进制传输</li>
</ul>
<p>数据传输模式也有2种：</p>
<ul>
<li>主动模式：由服务器端创建数据连接</li>
<li>被动模式：由客户端创建数据连接</li>
</ul>
<p>两种数据传输模式的建立过程：</p>
<table>
<thead>
<tr>
<th>传输模式</th>
<th>建立过程</th>
</tr>
</thead>
<tbody><tr>
<td>主动模式</td>
<td>命令连接： Client（1025）–&gt; Server（21） 客户端以一个随机端口（大于1023）来连服务器端的21号端口  数据连接： Server（20/tcp） –&gt; Client（1025+1） 服务器端以自己的20号端口去连客户端创建命令连接时使用的随机端口+1的端口号</td>
</tr>
<tr>
<td>被动模式</td>
<td>命令连接： Client（1110） –&gt; Server（21） 客户端以一个随机端口来连成服务器端的21号端口 数据连接： Client（1110+1） –&gt; Server（随机端口） 客户端以创建命令连接的端口+1的端口号去连服务器端通过命令连接告知自己的一个随机端口号来创建数据连接</td>
</tr>
</tbody></table>
<blockquote>
<p>主动模式有个弊端，因为客户端的端口是随机的，客户端如果开了防火墙， 则服务器端去连客户端创建数据连接时可能会被拒绝<br>被动模式有个弊端，因为服务端的端口是随机的，服务端如果开了防火墙， 则客户器端去连服务端创建数据连接时可能会被拒绝<br>所以,最好认清关系,然后开放相应端口,由于部分端口随机,最好就是客户端关闭防火墙,采用主动连接方式</p>
</blockquote>
<h1 id="4-用户认证"><a href="#4-用户认证" class="headerlink" title="4. 用户认证"></a>4. 用户认证</h1><p>ftp的用户主要有三种：</p>
<ul>
<li>虚拟用户：仅用于访问某特定服务中的资源</li>
<li>系统用户：可以登录系统的真实用户</li>
<li>匿名用户</li>
</ul>
<h1 id="5-vsftpd"><a href="#5-vsftpd" class="headerlink" title="5.vsftpd"></a>5.vsftpd</h1><p>此处我们要说的ftp应用程序是vsftpd，这也是在公司中用得最多的一款ftp软件。</p>
<h2 id="vsftpd配置"><a href="#vsftpd配置" class="headerlink" title="vsftpd配置"></a>vsftpd配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/etc/pam.d/vsftpd       vsftpd用户认证配置文件</span><br><span class="line">/etc/vsftpd/            配置文件目录</span><br><span class="line">/etc/vsftpd/vsftpd.conf     主配置文件</span><br><span class="line"></span><br><span class="line">匿名用户（映射为ftp用户）的共享资源位置是/var/ftp</span><br><span class="line">系统用户通过ftp访问的资源位置为用户的家目录</span><br><span class="line">虚拟用户通过ftp访问的资源位置为给虚拟用户指定的映射成为的系统用户的家目录</span><br></pre></td></tr></table></figure>

<p><strong>vsftpd常见的配置参数：</strong></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>anonymous_enable=YES</td>
<td>启用匿名用户登录</td>
</tr>
<tr>
<td>anon_upload_enable=YES</td>
<td>允许匿名用户上传</td>
</tr>
<tr>
<td>anon_mkdir_write_enable=YES</td>
<td>允许匿名用户创建目录，但是不能删除</td>
</tr>
<tr>
<td>anon_other_write_enable=YES</td>
<td>允许匿名用户创建和删除目录</td>
</tr>
<tr>
<td>local_enable=YES</td>
<td>启用本地用户登录</td>
</tr>
<tr>
<td>write_enable=YES</td>
<td>允许本地用户有写权限</td>
</tr>
<tr>
<td>local_umask=022</td>
<td>通过ftp上传文件的默认遮罩码</td>
</tr>
<tr>
<td>chroot_local_user=YES</td>
<td>禁锢所有的ftp本地用户于其家目录中</td>
</tr>
<tr>
<td>chroot_list_enable=YES</td>
<td>开启禁锢文件列表,需要与chroot_list_file参数一起使用</td>
</tr>
<tr>
<td>chroot_list_file=/etc/vsftpd/chroot_list</td>
<td>指定禁锢列表文件路径,在此文件里面的用户将被禁锢在其家目录中</td>
</tr>
<tr>
<td>allow_writeable_chroot=YES</td>
<td>允许被禁锢的用户家目录有写权限</td>
</tr>
<tr>
<td>xferlog_enable=YES</td>
<td>是否启用传输日志，记录ftp传输过程</td>
</tr>
<tr>
<td>xferlog_std_format=YES</td>
<td>传输日志是否使用标准格式</td>
</tr>
<tr>
<td>xferlog_file=/var/log/xferlog</td>
<td>指定传输日志存储的位置</td>
</tr>
<tr>
<td>chown_uploads=YES</td>
<td>是否启用改变上传文件属主的功能</td>
</tr>
<tr>
<td>chown_username=whoever</td>
<td>指定要将上传的文件的属主改为哪个用户,此用户必须在系统中存在</td>
</tr>
<tr>
<td>pam_service_name=vsftpd</td>
<td>指定vsftpd使用/etc/pam.d下的,哪个pam配置文件进行用户认证</td>
</tr>
<tr>
<td>userlist_enable=YES</td>
<td>是否启用控制用户登录的列表文件：默认为/etc/vsftpd/user_list文件</td>
</tr>
<tr>
<td>userlist_deny=YES</td>
<td>是否拒绝userlist指定的列表文件中存在的用户登录ftp</td>
</tr>
<tr>
<td>max_clients=#</td>
<td>最大并发连接数</td>
</tr>
<tr>
<td>max_per_ip=#</td>
<td>每个IP可同时发起的并发请求数</td>
</tr>
<tr>
<td>anon_max_rate</td>
<td>匿名用户的最大传输速率，单位是“字节/秒”</td>
</tr>
<tr>
<td>local_max_rate</td>
<td>本地用户的最大传输速率，单位是“字节/秒”</td>
</tr>
<tr>
<td>dirmessage_enable=YES</td>
<td>启用某目录下的.message描述信息,假定有一个目录为/upload，在其下创建一个文件名为.message，在文件内写入一些描述信息，则当用户切换至/upload目录下时会自动显示.message文件中的内容</td>
</tr>
<tr>
<td>message_file</td>
<td>设置访问一个目录时获得的目录信息文件的文件名,默认是.message</td>
</tr>
<tr>
<td>idle_session_timeout=600</td>
<td>设置默认的断开不活跃session的时间</td>
</tr>
<tr>
<td>data_connection_timeout=120</td>
<td>设置数据传输超时时间</td>
</tr>
<tr>
<td>ftpd_banner=”Welcome to chenlf FTP service.”</td>
<td>定制欢迎信息，登录ftp时自动显示</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">虚拟用户的配置：</span><br><span class="line">    所有的虚拟用户会被统一映射为一个指定的系统帐号，访问的共享位置即为此系统帐号的家目录</span><br><span class="line">    各虚拟用户可被赋予不同的访问权限，通过匿名用户的权限控制参数进行指定</span><br><span class="line"></span><br><span class="line">    虚拟用户帐号的存储方式：</span><br><span class="line">    1.文件：编辑文件，此文件需要被编码为hash格式。</span><br><span class="line">        奇数行为用户名</span><br><span class="line">        偶数行为密码</span><br><span class="line">    2.关系型数据库的表中：</span><br><span class="line">        通过即时查询数据库完成用户认证</span><br><span class="line">        mysql库：pam要依赖于pam_mysql软件，可以通过epel源yum安装</span><br></pre></td></tr></table></figure>

<h2 id="实验要求"><a href="#实验要求" class="headerlink" title="实验要求"></a>实验要求</h2><ul>
<li>安装vsftpd服务</li>
<li>配置匿名用户ftp</li>
<li>配置虚拟用户ftp</li>
<li>配置系统用户ftp</li>
<li>安装并配置完成后要使用ftp客户端工具登录验证</li>
</ul>
<h2 id="搭建环境"><a href="#搭建环境" class="headerlink" title="搭建环境"></a>搭建环境</h2><ul>
<li>本实验所用vm15虚拟机里面安装的centos7.6系统；</li>
<li>防火墙、selinux已关闭；</li>
</ul>
<p><strong>本实验所用地址如下：</strong></p>
<table>
<thead>
<tr>
<th>主机名</th>
<th>角色</th>
<th>IP地址</th>
</tr>
</thead>
<tbody><tr>
<td>wenhs5479</td>
<td>服务器</td>
<td>192.168.161.140</td>
</tr>
<tr>
<td>wenhs-docker-ce</td>
<td>客户端</td>
<td>192.168.160.142</td>
</tr>
<tr>
<td>YM-WENHS</td>
<td>win10客户端</td>
<td>192.168.161.137</td>
</tr>
</tbody></table>
<h2 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h2><ul>
<li>安装依赖的程序,本地源没有需要安装的依赖程序，利用网络源安装）并修改yum源</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# cd /etc/yum.repos.d/</span><br><span class="line">[root@wenhs5479 yum.repos.d]# wget http://mirrors.163.com/.help/CentOS7-Base-163.repo</span><br><span class="line">--2019-04-17 14:56:14--  http://mirrors.163.com/.help/CentOS7-Base-163.repo</span><br><span class="line">正在解析主机 mirrors.163.com (mirrors.163.com)... 59.111.0.251</span><br><span class="line">正在连接 mirrors.163.com (mirrors.163.com)|59.111.0.251|:80... 已连接。</span><br><span class="line">已发出 HTTP 请求，正在等待回应... 200 OK</span><br><span class="line">长度：1572 (1.5K) [application/octet-stream]</span><br><span class="line">正在保存至: “CentOS7-Base-163.repo”</span><br><span class="line"></span><br><span class="line">100%[=============================================&gt;] 1,572       --.-K/s 用时 0s      </span><br><span class="line"></span><br><span class="line">2019-04-17 14:56:15 (100 MB/s) - 已保存 “CentOS7-Base-163.repo” [1572/1572])</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 yum.repos.d]# sed -i &apos;s/\$releasever/7/g&apos; /etc/yum.repos.d/CentOS7-Base-163.repo</span><br><span class="line">[root@wenhs5479 yum.repos.d]# sed -i &apos;s/^enabled=.*/enabled=1/g&apos; /etc/yum.repos.d/CentOS7-Base-163.repo</span><br><span class="line">[root@wenhs5479 yum.repos.d]# yum clean all</span><br><span class="line">[root@wenhs5479 yum.repos.d]# yum -y install epel-release</span><br><span class="line">[root@wenhs5479 yum.repos.d]# yum -y install vsftpd</span><br></pre></td></tr></table></figure>

<ul>
<li>启动服务</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# systemctl start vsftpd</span><br></pre></td></tr></table></figure>

<h3 id="匿名用户"><a href="#匿名用户" class="headerlink" title="匿名用户"></a>匿名用户</h3><ul>
<li>配置匿名用户，利用匿名用户访问ftp</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">在客户端安装ftp命令,以匿名用户登录FTP，匿名账号为anonymous，密码直接确认</span><br><span class="line">[root@wenhs-docker-ce ~]# yum install -y ftp</span><br><span class="line"></span><br><span class="line">匿名用户默认开启,若没有开启则将NO改为YES</span><br><span class="line">[root@wenhs5479 ~]# vim /etc/vsftpd/vsftpd.conf</span><br><span class="line">anonymous_enable=YES</span><br><span class="line"></span><br><span class="line">登录192.168.161.140 ftp服务器，账号为anonymous，密码直接确认</span><br><span class="line">[root@wenhs-docker-ce ~]# ftp 192.168.161.140</span><br><span class="line">Connected to 192.168.161.140 (192.168.161.140).</span><br><span class="line">220 (vsFTPd 3.0.2)</span><br><span class="line">Name (192.168.161.140:root): anonymous</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password:</span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line"></span><br><span class="line">登录之后 ，ls 可以看到，匿名用户访问的是pub目录</span><br><span class="line">ftp&gt; ls</span><br><span class="line">227 Entering Passive Mode (192,168,161,140,167,7).</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">drwxr-xr-x    2 0        0               6 Oct 30 19:45 pub</span><br><span class="line">226 Directory send OK.</span><br><span class="line"></span><br><span class="line">进入pub目录，在ftp目录中创建目录，目录没有权限创建</span><br><span class="line">ftp&gt; cd pub</span><br><span class="line">250 Directory successfully changed.	</span><br><span class="line">ftp&gt; mkdir wenhs</span><br><span class="line">550 Permission denied.</span><br><span class="line">win10客户端见下方第一张图</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">要想在ftp目录中写，就必须修改配置</span><br><span class="line">[root@wenhs5479 ~]# vim /etc/vsftpd/vsftpd.conf</span><br><span class="line">找到这两行取消这注释，或者重新再写</span><br><span class="line">anon_upload_enable=YES #允许匿名用户上传</span><br><span class="line">anon_mkdir_write_enable=YES #允许匿名用户创建目录</span><br><span class="line">添加一行</span><br><span class="line">anon_other_write_enable=YES #允许匿名用户除创建和上传之外的权限，如删除、重命名</span><br><span class="line">：wq #保存退出</span><br><span class="line"></span><br><span class="line">因为匿名用户登录ftp所用的账户是ftp用户，所以将/var/ftp/pub的属主和属组改为ftp</span><br><span class="line">[root@wenhs5479 ~]# chown ftp.ftp /var/ftp/pub</span><br><span class="line"></span><br><span class="line">重启vsftpd服务</span><br><span class="line">[root@wenhs5479 ~]# systemctl restart vsftpd</span><br><span class="line"></span><br><span class="line">再在/var/ftp/pub目录下创建目录，这时可以写</span><br><span class="line">ftp&gt; mkdir wenhs</span><br><span class="line">257 &quot;/pub/wenhs&quot; created</span><br><span class="line">ftp&gt; ls</span><br><span class="line">227 Entering Passive Mode (192,168,161,140,208,210).</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">drwx------    2 14       50              6 Apr 17 07:54 wenhs</span><br><span class="line">226 Directory send OK.</span><br><span class="line">win10客户端见下方第二张图</span><br></pre></td></tr></table></figure>

<p><img src="../../img/ftp1.png" alt="ftp1"></p>
<p><img src="../../img/ftp2.png" alt="ftp2"></p>
<h3 id="系统用户"><a href="#系统用户" class="headerlink" title="系统用户"></a>系统用户</h3><ul>
<li>配置系统用户，利用wenhs用户进行访问</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">还原匿名用户配置，注销添加的配置文件</span><br><span class="line">#anon_mkdir_write_enable=YES</span><br><span class="line">#anon_other_write_enable=YES</span><br><span class="line">#anon_upload_enable=YES</span><br><span class="line"></span><br><span class="line">创建wenhs用户，并设置密码</span><br><span class="line">[root@wenhs5479 ~]# useradd wenhs</span><br><span class="line">[root@wenhs5479 ~]# echo 123456 |passwd --stdin wenhs</span><br><span class="line">更改用户 wenhs 的密码 。</span><br><span class="line">passwd：所有的身份验证令牌已经成功更新。</span><br><span class="line"></span><br><span class="line">修改/etc/vsftpd/vsftpd.conf配置文件，开启如下参数</span><br><span class="line">local_enable=YES</span><br><span class="line">write_eanble=YES</span><br><span class="line">local_umask=022</span><br><span class="line"></span><br><span class="line">重启vsftpd服务</span><br><span class="line">[root@wenhs5479 ~]# systemctl restart vsftpd</span><br><span class="line"></span><br><span class="line">利用wenhs登录FTP服务器，账号为wenhs，密码为123456</span><br><span class="line">[root@wenhs-docker-ce ~]# ftp 192.168.161.140</span><br><span class="line">Connected to 192.168.161.140 (192.168.161.140).</span><br><span class="line">220 (vsFTPd 3.0.2)</span><br><span class="line">Name (192.168.161.140:root): wenhs</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password:</span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line"></span><br><span class="line">查看登录到ftp服务器的家目录</span><br><span class="line">ftp&gt; ls</span><br><span class="line">227 Entering Passive Mode (192,168,161,140,224,15).</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">226 Directory send OK.</span><br><span class="line">ftp&gt; cd ..</span><br><span class="line">250 Directory successfully changed.</span><br><span class="line">ftp&gt; ls</span><br><span class="line">227 Entering Passive Mode (192,168,161,140,216,85).</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">drwx------   16 1000     1000         4096 Mar 24 12:03 test</span><br><span class="line">drwx------    3 1001     1001           78 Apr 17 08:07 wenhs</span><br><span class="line">226 Directory send OK.</span><br><span class="line">ftp&gt; pwd</span><br><span class="line">257 &quot;/home&quot;		可以看出利用wenhs账户登录ftp，ftp家目录就是wenhs用户的家目录</span><br><span class="line"></span><br><span class="line">为了系统安全，将用户锁定在家目录里面，修改配置文件，取消注释或则添加一条</span><br><span class="line">chroot_local_user=YES #禁锢所有FTP本地用户在其家目录中</span><br><span class="line"></span><br><span class="line">重新启动vsftpd服务后，再次登录，wenhs用户无法登录</span><br><span class="line">[root@wenhs-docker-ce ~]# ftp 192.168.161.140</span><br><span class="line">Connected to 192.168.161.140 (192.168.161.140).</span><br><span class="line">220 (vsFTPd 3.0.2)</span><br><span class="line">Name (192.168.161.140:root): wenhs</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password:</span><br><span class="line">500 OOPS: vsftpd: refusing to run with writable root inside chroot()</span><br><span class="line">Login failed.			#登录失败</span><br><span class="line">421 Service not available, remote server has closed connection</span><br><span class="line">ftp&gt; </span><br><span class="line"></span><br><span class="line">修改配置文件，添加一条</span><br><span class="line">allow_writeable_chroot=YES 	#允许被禁锢</span><br><span class="line"></span><br><span class="line">重启vsftpd服务，再次登录wenhs用户</span><br><span class="line">[root@wenhs-docker-ce ~]# ftp 192.168.161.140</span><br><span class="line">Connected to 192.168.161.140 (192.168.161.140).</span><br><span class="line">220 (vsFTPd 3.0.2)</span><br><span class="line">Name (192.168.161.140:root): wenhs</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password:</span><br><span class="line">230 Login successful.		#登录成功</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt;</span><br><span class="line"></span><br><span class="line">利用wemhs用户上传文件，利用windows上传文件见下图</span><br><span class="line">ftp&gt; put qwer</span><br><span class="line">local: qwer remote: qwer</span><br><span class="line">227 Entering Passive Mode (192,168,161,140,24,173).</span><br><span class="line">150 Ok to send data.</span><br><span class="line">226 Transfer complete.</span><br><span class="line">ftp&gt; ls</span><br><span class="line">227 Entering Passive Mode (192,168,161,140,173,125).</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">-rw-r--r--    1 1001     1001            0 Apr 17 08:33 qwer</span><br><span class="line">-rw-r--r--    1 1001     1001         2783 Apr 17 08:26 web1.txt</span><br><span class="line">-rw-r--r--    1 1001     1001         3583 Apr 17 08:26 wenhs_apache.sh</span><br><span class="line">226 Directory send OK.</span><br><span class="line">ftp&gt; get web1.txt</span><br><span class="line">local: web1.txt remote: web1.txt</span><br><span class="line">227 Entering Passive Mode (192,168,161,140,217,253).</span><br><span class="line">150 Opening BINARY mode data connection for web1.txt (2783 bytes).</span><br><span class="line">226 Transfer complete.</span><br><span class="line">2783 bytes received in 0.000122 secs (22811.48 Kbytes/sec)</span><br><span class="line">ftp&gt; exit</span><br><span class="line">221 Goodbye.</span><br><span class="line">[root@wenhs-docker-ce ~]# ls</span><br><span class="line">anaconda-ks.cfg       qwer     initial-setup-ks.cfg  web1.txt</span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/demo_deng/article/details/9622559" target="_blank" rel="noopener">遇到了个问题,点这里解决</a><br><img src="../../img/ftp3.png" alt="ftp3"></p>
<h3 id="虚拟用户"><a href="#虚拟用户" class="headerlink" title="虚拟用户"></a>虚拟用户</h3><ul>
<li>配置虚拟用户，创建一个本地用户whs，两个虚拟用户分别为tom，list。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">注销如下两行，恢复上面改动的配置，删除用户</span><br><span class="line">allow_writeable_chroot=YES</span><br><span class="line">chroot_local_user=YES</span><br><span class="line"></span><br><span class="line">安装依赖程序在本章开头第一步已经安装完成</span><br><span class="line"></span><br><span class="line">创建文本格式的用户名、密码列表（创建的列表规则为奇数用户名，偶数为用户密码）</span><br><span class="line">[root@wenhs5479 ~]# cat &lt;&lt;EOF &gt;&gt;/etc/vsftpd/user.list</span><br><span class="line">&gt; tom</span><br><span class="line">&gt; 123456</span><br><span class="line">&gt; list</span><br><span class="line">&gt; 123456</span><br><span class="line">&gt; EOF</span><br><span class="line">[root@wenhs5479 ~]# cat /etc/vsftpd/user.list </span><br><span class="line">tom</span><br><span class="line">123456</span><br><span class="line">list</span><br><span class="line">123456</span><br><span class="line"></span><br><span class="line">安装db4工具（依赖前面的epel_release包），将创建/etc/vsftpd/user.list文件使用db4工具进行转换</span><br><span class="line">[root@wenhs5479 ~]# yum -y install db4*</span><br><span class="line">[root@wenhs5479 ~]# db_load -T -t hash -f /etc/vsftpd/user.list /etc/vsftpd/user.db</span><br><span class="line"></span><br><span class="line">为了提高虚拟用户账号的安全性，将文件权限设置为600</span><br><span class="line">[root@wenhs5479 ~]# chmod 600 /etc/vsftpd/user.*</span><br><span class="line"></span><br><span class="line">添加虚拟用户的映射账号、创建ftp根目录，并将权限改为755</span><br><span class="line">[root@wenhs5479 ~]# useradd -d /var/vftproot -s /sbin/nologin whs</span><br><span class="line">[root@wenhs5479 ~]# ll -d /var/vftproot/</span><br><span class="line">drwx------. 3 whs whs 78 4月  17 16:51 /var/vftproot/</span><br><span class="line">[root@wenhs5479 ~]# chmod 755 /var/vftproot/</span><br><span class="line">[root@wenhs5479 ~]# ll -d /var/vftproot/</span><br><span class="line">drwxr-xr-x. 3 whs whs 78 4月  17 16:51 /var/vftproot/</span><br><span class="line"></span><br><span class="line">为虚拟用户建立PAM认证，修改/etc/pam.d/vsftpd文件，将文件里面的内容删除或者注销（留下第一行）,并添加两行内容（防止出现问题，先备份一份）</span><br><span class="line">[root@wenhs5479 ~]# cp /etc/pam.d/vsftpd&#123;,.bak&#125;</span><br><span class="line">[root@wenhs5479 ~]# vim /etc/pam.d/vsftpd</span><br><span class="line">#%PAM-1.0</span><br><span class="line">auth    required        pam_userdb.so   db=/etc/vsftpd/user </span><br><span class="line">account required        pam_userdb.so   db=/etc/vsftpd/user</span><br><span class="line"></span><br><span class="line">修改/etc/vsftpd/vsftpd.conf配置文件，添加虚拟用户支持</span><br><span class="line">guest_enable=YES</span><br><span class="line">guest_username=whs</span><br><span class="line"></span><br><span class="line">修改/etc/vsftpd/vsftpd.conf配置文件，建立虚拟用户配置文件</span><br><span class="line">user_config_dir=/etc/vsftpd/whs_dir</span><br><span class="line">allow_writeable_chroot=YES</span><br><span class="line"></span><br><span class="line">创建虚拟用户目录（/etc/vsftpd/whs_dir），为两个虚拟用户创建不同的配置文件(创建两个用户配置文件)</span><br><span class="line">[root@wenhs5479 ~]# mkdir /etc/vsftpd/whs_dir</span><br><span class="line">[root@wenhs5479 ~]# cd /etc/vsftpd/whs_dir/</span><br><span class="line">[root@wenhs5479 whs_dir]# touch tom list</span><br><span class="line"></span><br><span class="line">设置tom用户可上传文件、创建目录；设置list用户只有默认的下载权限（/etc/vsftpd/whs_dir/list文件为空）</span><br><span class="line">[root@wenhs5479 whs_dir]# vim /etc/vsftpd/whs_dir/tom</span><br><span class="line">anon_upload_enable=YES</span><br><span class="line">anon_mkdir_write_enable=YES</span><br><span class="line">:wq</span><br><span class="line">注：虚拟用户是通过匿名访问的，所以要开启匿名访问功能。</span><br><span class="line"></span><br><span class="line">重启服务</span><br><span class="line">[root@wenhs5479 ~]# systemctl restart vsftpd</span><br><span class="line"></span><br><span class="line">用tom虚拟用户登录ftp服务器，验证是否可以上传文件，创建目录但不能删除目录</span><br><span class="line">[root@wenhs-docker-ce ~]# ftp 192.168.161.140</span><br><span class="line">Connected to 192.168.161.140 (192.168.161.140).</span><br><span class="line">220 (vsFTPd 3.0.2)</span><br><span class="line">Name (192.168.161.140:root): tom</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password:		#密码为123456</span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt; mkdir 123</span><br><span class="line">257 &quot;/123&quot; created</span><br><span class="line">ftp&gt; ls</span><br><span class="line">227 Entering Passive Mode (192,168,161,140,102,65).</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">drwx------    2 1002     1002            6 Apr 17 09:05 123</span><br><span class="line">226 Directory send OK.</span><br><span class="line">ftp&gt; rmdir 123</span><br><span class="line">550 Permission denied.		#权限拒绝</span><br><span class="line">ftp&gt; </span><br><span class="line"></span><br><span class="line">利用list用户登录到ftp服务器，验证是否只能查看</span><br><span class="line">[root@wenhs-docker-ce ~]# ftp 192.168.161.140</span><br><span class="line">Connected to 192.168.161.140 (192.168.161.140).</span><br><span class="line">220 (vsFTPd 3.0.2)</span><br><span class="line">Name (192.168.161.140:root): list</span><br><span class="line">331 Please specify the password.</span><br><span class="line">Password:		#密码123456</span><br><span class="line">230 Login successful.</span><br><span class="line">Remote system type is UNIX.</span><br><span class="line">Using binary mode to transfer files.</span><br><span class="line">ftp&gt; ls</span><br><span class="line">227 Entering Passive Mode (192,168,161,140,26,179).</span><br><span class="line">150 Here comes the directory listing.</span><br><span class="line">drwx------    2 1002     1002            6 Apr 17 09:05 123</span><br><span class="line">226 Directory send OK.</span><br><span class="line">ftp&gt; mkdir 456</span><br><span class="line">550 Permission denied.		#权限拒绝</span><br><span class="line">ftp&gt; </span><br><span class="line">win10测试和linux客户端验证一样效果</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    
	
	  <div>
        
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://aiwhs.github.io/2018/09/29/openssh/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="itw">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="itw">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/09/29/openssh/" class="post-title-link" itemprop="url">openssh</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-09-29 08:15:57" itemprop="dateCreated datePublished" datetime="2018-09-29T08:15:57+08:00">2018-09-29</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-12 15:03:46" itemprop="dateModified" datetime="2019-07-12T15:03:46+08:00">2019-07-12</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux运维/" itemprop="url" rel="index"><span itemprop="name">Linux运维</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h1 id="1-使用-SSH-访问远程命令行"><a href="#1-使用-SSH-访问远程命令行" class="headerlink" title="1. 使用 SSH 访问远程命令行"></a>1. 使用 SSH 访问远程命令行</h1><h3 id="1-1-OpenSSH-简介"><a href="#1-1-OpenSSH-简介" class="headerlink" title="1.1 OpenSSH 简介"></a>1.1 OpenSSH 简介</h3><p><code>OpenSSH</code>这一术语指系统中使用的<code>Secure Shell</code>软件的软件实施。用于在远程系统上安全运行<code>shell</code>。如果您在可提供<code>ssh</code>服务的远程<code>Linux</code>系统中拥有用户帐户，则<code>ssh</code>是通常用来远程登录到该系统的命令。ssh命令也可用于在远程系统中运行命令。</p>
<p>常见的远程登录工具有：</p>
<ul>
<li>telnet</li>
<li>ssh</li>
<li>dropbear</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">telnet      //远程登录协议，23/TCP</span><br><span class="line">    认证明文</span><br><span class="line">    数据传输明文</span><br><span class="line">(由于其不安全性,现如今使用telnet远程登录的比较少了,一般用这个命令来测试端口是否开启)</span><br><span class="line"></span><br><span class="line">ssh         //Secure SHell，应用层协议，22/TCP</span><br><span class="line">    通信过程及认证过程是加密的，主机认证</span><br><span class="line">    用户认证过程加密</span><br><span class="line">    数据传输过程加密</span><br><span class="line">   (相对较安全,不容易被破解)</span><br><span class="line">    </span><br><span class="line">dropbear    //嵌入式系统专用的SSH服务器端和客户端工具</span><br></pre></td></tr></table></figure>

<h3 id="1-2-SSH-版本"><a href="#1-2-SSH-版本" class="headerlink" title="1.2 SSH 版本"></a>1.2 SSH 版本</h3><p><code>openssh</code>有两个版本，分别为v1和v2，其特点如下：</p>
<blockquote>
<p>v1：基于CRC-32做MAC，无法防范中间人（man-in-middle）攻击</p>
<p>v2：双方主机协议选择安全的MAC方式。基于DH算法做密钥交换，基于RSA或DSA算法实现身份认证</p>
</blockquote>
<h3 id="1-3-SSH-认证方式"><a href="#1-3-SSH-认证方式" class="headerlink" title="1.3 SSH 认证方式"></a>1.3 SSH 认证方式</h3><p><code>openssh</code>有两种认证方式，分别是：</p>
<ul>
<li><p>基于口令认证:输入用户名和密码</p>
</li>
<li><p>基于密钥认证</p>
<ul>
<li><input disabled type="checkbox"> 客户端建立两把钥匙(公钥与私钥)</li>
<li><input disabled type="checkbox"> 将公钥数据上传到服务器上</li>
<li><input disabled type="checkbox"> 将公钥放置服务器端的正确目录与文件名（scp 或 ssh-copy-id）</li>
</ul>
</li>
</ul>
<p><img src="../../img/ssh1.png" alt="ssh1"></p>
<h3 id="1-4-openSSH-的工作模式"><a href="#1-4-openSSH-的工作模式" class="headerlink" title="1.4 openSSH 的工作模式"></a>1.4 openSSH 的工作模式</h3><p><strong><code>openSSH</code>是基于C/S架构工作的。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">服务器端    //sshd，配置文件在/etc/ssh/sshd_config</span><br><span class="line"></span><br><span class="line">客户端     //ssh，配置文件在/etc/ssh/ssh_config</span><br><span class="line">    ssh-keygen      //密钥生成器</span><br><span class="line">    ssh-copy-id     //将公钥传输至远程服务器</span><br><span class="line">    scp             //跨主机安全复制工具</span><br></pre></td></tr></table></figure>

<h3 id="1-4-Secure-Shell-示例"><a href="#1-4-Secure-Shell-示例" class="headerlink" title="1.4 Secure Shell 示例"></a>1.4 Secure Shell 示例</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">以当前用户身份创建远程交互式shell，然后在结束时使用exit命令返回到之前的shell</span><br><span class="line">[D:\~]$ ssh ec2-user@13.231.194.216</span><br><span class="line">Password: </span><br><span class="line">Last login: Mon Apr  1 07:55:44 UTC 2019 on pts/0</span><br><span class="line">[root@ip-10-0-10-33 ~]# exit</span><br><span class="line">logout</span><br><span class="line">[ec2-user@ip-10-0-10-33 ~]$</span><br><span class="line"></span><br><span class="line">以其他用户身份（remoteuser）在选定主机（remotehost）上连接到远程`shell`</span><br><span class="line">[root@ip-10-0-10-33 ~]# ssh wenhs@13.231.194.216</span><br><span class="line">wenhs@13.231.194.216&apos;s password:</span><br><span class="line">[wenhs@ip-10-0-10-33 ~]$ exit</span><br><span class="line">logout</span><br><span class="line">Connection to 10.0.10.33 closed.</span><br><span class="line"></span><br><span class="line">以远程用户身份（remoteuser）在远程主机（remotehost）上通过将输出返回到本地显示器的方式来执行单一命令</span><br><span class="line">[root@ip-10-0-10-33 ~]# ip a s eth0</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9001 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 06:56:68:17:b8:b4 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.10.33/24 brd 10.0.10.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::456:68ff:fe17:b8b4/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">[root@ip-10-0-10-33 ~]# ssh ec2-user@13.231.194.216 &apos;/usr/sbin/ip a s ens33&apos;</span><br><span class="line">ec2-user@13.231.194.216&apos;s password:</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 9001 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 06:56:68:17:b8:b4 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.10.33/24 brd 10.0.10.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::456:68ff:fe17:b8b4/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line">w命令可以显示当前登录到计算机的用户列表。这对于显示哪些用户使用ssh从哪些远程位置进行了登录以及执行了何种操作等内容特别有用</span><br><span class="line">[root@ip-10-0-10-33 ~]# w</span><br><span class="line"> 16:46:39 up  1:02,  3 users,  load average: 0.00, 0.00, 0.00</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">root     :0       :0               15:44   ?xdm?  59.79s  0.25s /usr/libexec/gnome-ses</span><br><span class="line">root     pts/0    :0               15:45    1.00s  0.15s  0.01s w</span><br><span class="line">root     pts/3    ym-wenhs-pc-d4b1 16:31   21.00s  0.04s  0.04s -bash</span><br></pre></td></tr></table></figure>

<h3 id="1-5-SSH-主机密钥"><a href="#1-5-SSH-主机密钥" class="headerlink" title="1.5 SSH 主机密钥"></a>1.5 SSH 主机密钥</h3><p><code>ssh</code>通过公钥加密的方式保持通信安全。当某一ssh客户端连接到ssh服务器时，在该客户端登录之前，服务器会向其发送公钥副本。这可用于为通信渠道设置安全加密，并可验证客户端的服务器。</p>
<p>当用户第一次使用<code>ssh</code>连接到特定服务器时，<code>ssh</code>命令可在用户的<code>~/.ssh/known_hosts</code>文件中存储该服务器的公钥。在此之后每当用户进行连接时，客户端都会通过对比<code>~/.ssh/known_hosts</code>文件中的服务器条目和服务器发送的公钥，确保从服务器获得相同的公钥。如果公钥不匹配，客户端会假定网络通信已遭劫持或服务器已被入侵，并且中断连接。</p>
<p>这意味着，如果服务器的公钥发生更改（由于硬盘出现故障导致公钥丢失，或者出于某些正当理由替换公钥），用户则需要更新其<code>~/.ssh/known_hosts</code>文件并删除旧的条目才能够进行登录。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">主机ID存储在本地客户端系统上的 ~/.ssh/known_hosts 中</span><br><span class="line">[root@ip-10-0-10-33 ~]# cat ~/.ssh/known_hosts </span><br><span class="line">|1|8rW60XdgmpybvWPLSWEQcnZGDpM=|lc4gt9vvnAXZdb44tQszjQz5pGs= ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBAJ9X6VwmkCjY9IVN6m0qJOJt1WkXdbF/urbikUSm0g0rWHOYaMoAkDVzirHFgK7BKDzqLDe/v8gIZcysmUBt+o=</span><br><span class="line">|1|PtGqIyYZtZx2jTb3cNeqKNWJz+E=|43R/vnypv9OEmwnPzm1Yoj4dz5U= ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBAJ9X6VwmkCjY9IVN6m0qJOJt1WkXdbF/urbikUSm0g0rWHOYaMoAkDVzirHFgK7BKDzqLDe/v8gIZcysmUBt+o=</span><br><span class="line"></span><br><span class="line">主机密钥存储在SSH服务器上的 /etc/ssh/ssh_host_key* 中</span><br><span class="line">[root@ip-10-0-10-33 ~]# ls /etc/ssh/*key*</span><br><span class="line">/etc/ssh/ssh_host_dsa_key</span><br><span class="line">/etc/ssh/ssh_host_dsa_key.pub</span><br><span class="line">/etc/ssh/ssh_host_ecdsa_key</span><br><span class="line">/etc/ssh/ssh_host_ecdsa_key.pub</span><br><span class="line">/etc/ssh/ssh_host_ed25519_key</span><br><span class="line">/etc/ssh/ssh_host_ed25519_key.pub</span><br><span class="line">/etc/ssh/ssh_host_rsa_key</span><br><span class="line">/etc/ssh/ssh_host_rsa_key.pub</span><br></pre></td></tr></table></figure>

<h1 id="2-配置基于-SSH-密钥的身份验证"><a href="#2-配置基于-SSH-密钥的身份验证" class="headerlink" title="2. 配置基于 SSH 密钥的身份验证"></a>2. 配置基于 SSH 密钥的身份验证</h1><p>用户可通过使用公钥身份验证进行<code>ssh</code>登录身份验证。<code>ssh</code>允许用户使用私钥-公钥方案进行身份验证。这意味着将生成私钥和公钥这两个密钥。私钥文件用作身份验证凭据，像密码一样，必须妥善保管。公钥复制到用户希望登录的系统，用于验证私钥。公钥并不需要保密。拥有公钥的ssh服务器可以发布仅持有您私钥的系统才可解答的问题。因此，可以根据所持有的密钥进行验证。如此一来，就不必在每次访问系统时键入密码，但安全性仍能得到保证。</p>
<p><strong>使用<code>ssh-keygen</code>命令生成密码。将会生成私钥<code>~/.ssh/id_rsa</code>和公钥<code>~/.ssh/id_rsa.pub</code>。</strong></p>
<p><strong><em>注意：</em></strong></p>
<blockquote>
<p>生成密钥时，系统将提供指定密码的选项，在访问私钥时必须提供该密码。如果私钥被偷，除颁发者之外的其他任何人很难使用该私钥，因为已使用密码对其进行保护。这样，在攻击者破解并使用私钥前，会有足够的时间生成新的密钥对并删除所有涉及旧密钥的内容。</p>
</blockquote>
<p>生成<code>ssh</code>密钥后，密钥将默认存储在家目录下的<code>.ssh/</code>目录中。私钥和公钥的权限就分别为<code>600</code>和<code>644</code>。<code>.ssh</code>目录权限必须是<code>700</code>。</p>
<p>在可以使用基于密钥的身份验证前，需要将公钥复制到目标系统上。可以使用<code>ssh-copy-id</code>完成这一操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@ip-10-0-10-33 ~]# ssh-copy-id remoteuser@remotehost</span><br></pre></td></tr></table></figure>

<p>通过<code>ssh-copy-id</code>将密钥复制到另一系统时，它默认复制<code>~/.ssh/id_rsa.pub</code>文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">SSH密钥演示</span><br><span class="line">使用 ssh-keygen 创建公钥-私钥对</span><br><span class="line">[root@ip-10-0-10-33 ~]# ssh-keygen -t rsa</span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file in which to save the key (/root/.ssh/id_rsa): </span><br><span class="line">Enter passphrase (empty for no passphrase): </span><br><span class="line">Enter same passphrase again: </span><br><span class="line">Your identification has been saved in /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved in /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:QTqn8+Ml2UR0cRlD/PlOhcX3xoqIUQH/tM8OfM7G9t8 root@ip-10-0-10-33</span><br><span class="line">The key&apos;s randomart image is:</span><br><span class="line">+---[RSA 2048]----+</span><br><span class="line">|        o.o.o+=+ |</span><br><span class="line">|       o o.. .o.+|</span><br><span class="line">|      o o.o .  =+|</span><br><span class="line">|       +.o o ...*|</span><br><span class="line">|      o So..o. oo|</span><br><span class="line">|       o.+...o. o|</span><br><span class="line">|        = o o.+o |</span><br><span class="line">|       . +   *+ o|</span><br><span class="line">|        .    o+.E|</span><br><span class="line">+----[SHA256]-----+</span><br><span class="line"></span><br><span class="line">使用 ssh-copy-id 将公钥复制到远程系统上的正确位置</span><br><span class="line">[root@wenhs5479 ~]# ls ~/.ssh/</span><br><span class="line">id_rsa  id_rsa.pub</span><br><span class="line">[root@wenhs5479 ~]# ssh-copy-id -i ~/.ssh/id_rsa.pub root@192.168.42.88</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;/root/.ssh/id_rsa.pub&quot;</span><br><span class="line">The authenticity of host &apos;192.168.42.88 (192.168.42.88)&apos; can&apos;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:qwQZf/VtSahPu/kpd9GE2x3GUPwRqgnJc4SEotVRwdQ.</span><br><span class="line">ECDSA key fingerprint is MD5:0d:a1:e4:e8:03:ad:0b:32:c2:1f:bd:f1:4f:a6:84:9c.</span><br><span class="line">Are you sure you want to continue connecting (yes/no)? yes</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed</span><br><span class="line">/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys</span><br><span class="line">root@192.168.42.88&apos;s password:</span><br><span class="line"></span><br><span class="line">Number of key(s) added: 1</span><br><span class="line"></span><br><span class="line">Now try logging into the machine, with:   &quot;ssh &apos;root@192.168.42.88&apos;&quot;</span><br><span class="line">and check to make sure that only the key(s) you wanted were added.</span><br><span class="line"></span><br><span class="line">使用 ssh 命令无命令登录远程主机</span><br><span class="line">[root@wenhs5479 ~]# ssh root@192.168.42.88</span><br><span class="line">Last login: Mon Apr  1 17:59:03 2019 from ym-wenhs-pc-c311</span><br><span class="line">[root@wenhs5479 ~]# ip a s ens32</span><br><span class="line">2: ens32: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:8a:2a:2e brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.42.88/24 brd 192.168.42.255 scope global noprefixroute dynamic ens32</span><br><span class="line">       valid_lft 2080sec preferred_lft 2080sec</span><br><span class="line">    inet6 fe80::ed8d:7e09:d472:34a5/64 scope link noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">使用 scp 命令传送文件到远程主机</span><br><span class="line">[root@wenhs5479 ~]# scp test.sh root@192.168.42.88:/tmp</span><br><span class="line">root@192.168.42.88&apos;s password:</span><br><span class="line">test.sh                                                       100%   45    29.8KB/s   00:00</span><br><span class="line"></span><br><span class="line">使用 scp 命令从远程主机上下载文件到本地</span><br><span class="line">[root@wenhs5479 ~]# ls</span><br><span class="line">anaconda-ks.cfg  test.sh</span><br><span class="line">[root@wenhs5479 ~]# rm -f test.sh</span><br><span class="line">[root@wenhs5479 ~]# ls</span><br><span class="line">anaconda-ks.cfg  </span><br><span class="line">[root@wenhs5479 ~]# scp root@192.168.42.88:/tmp/test.sh .</span><br><span class="line">root@192.168.42.88&apos;s password:</span><br><span class="line">test.sh                                                       100%   45    39.1KB/s   00:00</span><br><span class="line">[root@wenhs5479 ~]# ls</span><br><span class="line">anaconda-ks.cfg    test.sh</span><br><span class="line"></span><br><span class="line">scp命令常用选项</span><br><span class="line">    -r      //递归复制</span><br><span class="line">    -p      //保持权限</span><br><span class="line">    -P      //端口</span><br><span class="line">    -q      //静默模式</span><br><span class="line">    -a      //全部复制</span><br></pre></td></tr></table></figure>

<h1 id="3-自定义-SSH-服务配置"><a href="#3-自定义-SSH-服务配置" class="headerlink" title="3. 自定义 SSH 服务配置"></a>3. 自定义 SSH 服务配置</h1><p>虽然<code>OpenSSH</code>服务器通常无需修改，但会提供其他安全措施，可以在配置文件<code>/etc/ssh/sshd_config</code>中修改<code>OpenSSH</code>服务器的各个方面。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PermitRootLogin &#123;yes|no&#125;    //是否允许root用户远程登录系统</span><br><span class="line">PermitRootLogin without-password    //仅允许root用户基于密钥方式远程登录</span><br><span class="line">PasswordAuthentication &#123;yes|no&#125;     //是否启用密码身份验证，默认开启</span><br></pre></td></tr></table></figure>

<h1 id="4-SSH-安全注意事项"><a href="#4-SSH-安全注意事项" class="headerlink" title="4. SSH 安全注意事项"></a>4. SSH 安全注意事项</h1><ul>
<li>密码应该经常换且足够复杂</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# tr -dc A-Za-z0-9_ &lt; /dev/urandom | head -c 30 |xargs</span><br><span class="line">Ic6TRUmCqafpaUoZcqDiWBiEWphTvk</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# openssl rand 20 -base64</span><br><span class="line">GcGX26V2/rrwMy9+5SOgPkVnspA=   //生成20位随机密码</span><br></pre></td></tr></table></figure>

<ul>
<li>使用非默认端口</li>
<li>限制登录客户端地址</li>
<li>仅监听特定的IP地址</li>
<li>禁止管理员直接登录</li>
<li>仅允许有限制用户登录<ul>
<li><input disabled type="checkbox"> AllowUsers</li>
<li><input disabled type="checkbox"> AllowGroups</li>
</ul>
</li>
<li>使用基于密钥的认证</li>
<li>禁止使用空密码</li>
<li>禁止使用SSHv1版本</li>
<li>设定空闲会话超时时长</li>
<li>利用防火墙设置ssh访问策略</li>
<li>限制ssh的访问频度和并发在线数</li>
<li>做好日志的备份，经常分析（集中于某台服务器）</li>
</ul>
<p><strong>实验</strong></p>
<p><strong>1.说明密钥认证的过程</strong></p>
<p><img src="../../img/ssh2.jpg" alt="ssh2">*</p>
<ul>
<li>Client端向Server端发起SSH连接请求。</li>
<li>Server端向Client端发起版本协商。</li>
<li>协商结束后Server端发送Host Key公钥 Server Key公钥，随机数等信息。到这里所有通信是不加密的。</li>
<li>Client端返回确认信息，同时附带用公钥加密过的一个随机数，用于双方计算Session Key。</li>
<li>进入认证阶段。从此以后所有通信均加密。</li>
<li>认证成功后，进入交互阶段。</li>
</ul>
<p><strong>2.手动配置密钥认证登录</strong></p>
<p><strong>生成密钥对</strong></p>
<pre><code>$ ssh-keygen</code></pre><p>此处可选择生成密钥的文件路径，默认为~/.ssh/id_rsa<br>密码为可选。</p>
<p><strong>拷贝公钥到服务器</strong></p>
<p>方式一：</p>
<pre><code>$ ssh-copy-id -i ~/.ssh/id_rsa.pub xxx@host</code></pre><p>方式二：</p>
<p>手动拷贝id_rsa.pub到服务器上，并收到添加认证文件。</p>
<pre><code>$ cat id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</code></pre><p><strong>服务器配置</strong></p>
<p>配置服务器上/etc/ssh/sshd_config文件，修改以下配置项</p>
<pre><code>RSAAuthentication yes
PubkeyAuthentication yes
AuthorizedKeysFile  .ssh/authorized_keys
修改后，重启sshd服务，根据不同的系统使用相应命令</code></pre><p><strong>登录</strong></p>
<p>直接登录</p>
<pre><code>$ ssh user@host</code></pre><p>如果配置成功，则不需要密码直接登录。</p>
<p><strong>问题</strong></p>
<p>配置成功后，仍提示密码输入<br>主要原因在于服务器上认证文件及所在目录的权限问题<br>详情排查步骤可查看文章配置ssh公钥登录提示还是输入密码</p>
<p><strong>解决方法：</strong></p>
<pre><code>$ chmod 755 ~/home/xxxuser</code></pre>
          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    
	
	  <div>
        
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://aiwhs.github.io/2018/09/23/计划任务/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="itw">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="itw">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/09/23/计划任务/" class="post-title-link" itemprop="url">计划任务</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-09-23 08:15:57" itemprop="dateCreated datePublished" datetime="2018-09-23T08:15:57+08:00">2018-09-23</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-08 19:14:50" itemprop="dateModified" datetime="2019-07-08T19:14:50+08:00">2019-07-08</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux运维/" itemprop="url" rel="index"><span itemprop="name">Linux运维</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h1 id="1-crond计划任务概述"><a href="#1-crond计划任务概述" class="headerlink" title="1. crond计划任务概述"></a>1. crond计划任务概述</h1><p>什么是计划任务，计划任务类似于我们平时生活中的闹钟。<br>在<code>Linux</code>系统的计划任务服务<code>crond</code>可以满足周期性执行任务的需求。<br><code>crond</code>进程每分钟会处理一次计划任务, 计划任务主要是做一些周期性的任务目前最主要的用途是定时备份数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Schedule one-time tasks with at.   一次性调度执行 at</span><br><span class="line">Schedule recurring jobs with cron. 循环调度执行 cron</span><br><span class="line">Schedule recurring system jobs. 所有计划任务执行中的输出都会以邮件的方式发送给指定用户, 除非重定向</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">循环调度执行cron 进程每分钟会处理一次计划任务</span><br><span class="line">[root@wenhs5479 ~]# systemctl status crond.service </span><br><span class="line">● crond.service - Command Scheduler</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/crond.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since 日 2019-03-24 19:26:36 CST; 3min 22s ago</span><br><span class="line"> Main PID: 9443 (crond)</span><br><span class="line">   CGroup: /system.slice/crond.service</span><br><span class="line">           └─9443 /usr/sbin/crond -n</span><br><span class="line"></span><br><span class="line">3月 24 19:26:36 wenhs5479 systemd[1]: Started Command Scheduler.</span><br><span class="line">3月 24 19:26:36 wenhs5479 crond[9443]: (CRON) INFO (RANDOM_DEL...</span><br><span class="line">3月 24 19:26:37 wenhs5479 crond[9443]: (CRON) INFO (running wi...</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show in full.</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# ps aux |grep crond</span><br><span class="line">root       9443  0.4  0.0 126284  1716 ?        Ss   19:26   0:01 /usr/sbin/crond -n</span><br><span class="line">root      11960  0.0  0.0 112728   988 pts/0    S+   19:30   0:00 grep --color=auto crond</span><br><span class="line">[root@wenhs5479 ~]#</span><br></pre></td></tr></table></figure>

<p><strong>计划任务分为以下两种情况：</strong></p>
<ul>
<li>系统级别的定时任务:</li>
</ul>
<blockquote>
<p>清理系统缓存<br> 临时文件清理<br> 系统信息采集<br> 日志文件切割</p>
</blockquote>
<ul>
<li>用户级别的定时任务:</li>
</ul>
<blockquote>
<p>定时同步互联网时间<br> 定时备份系统配置文件<br>  定时备份数据库文件</p>
</blockquote>
<h1 id="2-crond配置文件详解"><a href="#2-crond配置文件详解" class="headerlink" title="2. crond配置文件详解"></a>2. crond配置文件详解</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">文件              说明</span><br><span class="line">/etc/crontab        //crontab配置文件</span><br><span class="line">/etc/cron.deny      //该文件中所列用户不允许使用crontab命令</span><br><span class="line">/var/spool/cron/*   //所有用户定时文件都存放此目录,文件以用户名命名</span><br><span class="line">/var/log/cron       //定时任务执行后的日志文件,可用来回溯</span><br></pre></td></tr></table></figure>

<h1 id="3-crond计划任务管理"><a href="#3-crond计划任务管理" class="headerlink" title="3. crond计划任务管理"></a>3. crond计划任务管理</h1><p><strong>crond任务管理</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">参数          含义                指定示例</span><br><span class="line">[root@wenhs5479 ~]# crontab --help</span><br><span class="line">-e      编辑crontab文件内容       crontab -e</span><br><span class="line">-l      查看crontab文件内容       crontab -l</span><br><span class="line">-r      删除crontab文件内容       crontab -r</span><br><span class="line">-u      管理其他用户的计划任务 crontab -u wenhs5479 -l</span><br><span class="line">注意: crontab &#123;-l -e&#125;实际上就是在操作/var/spool/cron/username</span><br><span class="line"></span><br><span class="line">如何进行计划任务的备份？</span><br></pre></td></tr></table></figure>

<p><strong>crond时间含义</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># Example of job definition:</span><br><span class="line"># .---------------- minute (0 - 59) //分钟</span><br><span class="line"># |  .------------- hour (0 - 23)   //小时</span><br><span class="line"># |  |  .---------- day of month (1 - 31)   //日期</span><br><span class="line"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr //月份</span><br><span class="line"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat  //星期</span><br><span class="line"># |  |  |  |  |</span><br><span class="line"># *  *  *  *  *   command to be executed</span><br><span class="line"></span><br><span class="line">*    表示任意的(分、时、日、月、周)时间都执行</span><br><span class="line">-    表示一个时间范围段, 如5-7点</span><br><span class="line">,    表示分隔时段, 如6,0,4表示周六、日、四</span><br><span class="line">*/n  表示每隔n单位时间, 如*/10 每10分钟</span><br></pre></td></tr></table></figure>

<p><strong>crond编写示例</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">00 02 * * * command      //每天2:00整 </span><br><span class="line">00 02 1 * * command      //每月1号2:00整 </span><br><span class="line">00 02 14 2 * command     //每年2月14号2:00整 </span><br><span class="line">00 02 * * 7 command      //每周日2:00整 </span><br><span class="line">00 02 * 6 5 command      //每年6月的周五2:00整</span><br><span class="line">00 02 14 * 7 command     //每月14号2:00整或每周日2:00整，这两个时间都执行</span><br><span class="line">00 02 14 2 7 command     //每年 2 月 14 号 2:00 整 或者 每周日 2:00 整，这两个时间都执行 </span><br><span class="line">00 02 * * * command      //每天2:00整</span><br><span class="line">*  02 * * * command      //每天2:00中的每一分钟 (错误示范)</span><br><span class="line">* * * * *  command       //每分钟执行command</span><br><span class="line">* * 14 2 *  command      //2月14号的每分钟(错误示范)</span><br><span class="line">*/5 * * * *  command     //每隔5分钟 </span><br><span class="line">00 02 * 1,5,8 * command  //每年1,5,8月的每天2:00整 </span><br><span class="line">00 02 1-8 * *  command   //每月1到8号的2:00整</span><br></pre></td></tr></table></figure>

<p><strong>crond书写规范</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1.为计划任务增加必要的注释</span><br><span class="line">[root@wenhs5479 ~]# crontab -l</span><br><span class="line">##time sync</span><br><span class="line">*/5 * * * * /usr/sbin/ntpdate time1.aliyun.com &amp;&gt;/dev/null</span><br><span class="line"></span><br><span class="line">2.规范计划任务执行脚本存放的路径/scripts/</span><br><span class="line">[root@wenhs5479 ~]# crontab -l</span><br><span class="line">##backup www to /backup</span><br><span class="line">30 01 * * * /bin/sh /scripts/www_backup.sh &amp;&gt;/dev/null</span><br><span class="line"></span><br><span class="line">3.执行shell脚本任务前加/bin/sh, 脚本结尾加&amp;&gt;/dev/null</span><br><span class="line">调试好后应屏蔽debug输出信息,避免产生系统垃圾占用过多inode, 如需输出日志, 可重定向至日志文件</span><br><span class="line">[root@wenhs5479 ~]# crontab -l</span><br><span class="line">####backup www to /backup</span><br><span class="line">30 01 * * * /bin/sh /scripts/www_backup.sh &amp;&gt;/tmp/www_backup.log</span><br></pre></td></tr></table></figure>

<h1 id="4-crond配置编写实例"><a href="#4-crond配置编写实例" class="headerlink" title="4. crond配置编写实例"></a>4. crond配置编写实例</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# crontab -e</span><br><span class="line"></span><br><span class="line">每天凌晨切割nginx日志</span><br><span class="line">05 00 * * * /bin/bash -x /scripts/cut_nginx.sh &amp;&gt; /scripts/log/nginx.log</span><br><span class="line"></span><br><span class="line">每天5点备份数据库</span><br><span class="line">00 05 * * * /bin/bash -x /scripts/dump_sql.sh &amp;&gt;/scripts/log/mysql.log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">1.我们所有的crond服务是运行的程序。而crontab命令用户用来设置定时规则的命令。</span><br><span class="line">2.crond服务是企业生产工作中常用的重要服务，at很少使用，可以忽略。</span><br><span class="line">3.几乎每个服务器都会用到crond服务。</span><br></pre></td></tr></table></figure>

<h1 id="5-crond计划任务调试"><a href="#5-crond计划任务调试" class="headerlink" title="5. crond计划任务调试"></a>5. crond计划任务调试</h1><blockquote>
<ol>
<li>调整任务每分钟执行, 检测是否是否正常, 有些任务不要频繁执行</li>
<li>调整系统时间然后在检测任务, 生产不建议直接使用此方式 执行脚本, 将脚本执行输出写入指定日志文件, 观察日志内容是否正常</li>
<li>注意一些任务命令带来的问题echo “itw” &gt;&gt;/tmp/test.log &amp;&gt;/dev/null</li>
<li>命令使用绝对路径, 防止无法找到命令导致定时任务执行故障</li>
<li>查看/var/log/cron日志进行调试</li>
</ol>
</blockquote>
<p>建议: 将需要定期执行的任务写入脚本中, 建立/scripts目录统一存放脚本, 脚本中命令必须使用绝对路径,手动执行脚本检测输出是否正常, 然后将脚本加入计划任务测试, 测试后无问题将脚本输出写入对应的日志文件中即可。</p>
<p><strong>计划任务添加步骤：</strong></p>
<ul>
<li>手动执行保证执行命令的正确结果</li>
<li>编写脚本<ul>
<li><input disabled type="checkbox"> 脚本需要统一路径/scripts</li>
<li><input disabled type="checkbox"> 脚本开头建议填写注释信息, 包括执行时间、周期、任务</li>
<li><input disabled type="checkbox"> 脚本内容复制执行成功的命令至脚本文件中(减少每个环节出错几率)</li>
<li><input disabled type="checkbox"> 脚本内容尽可能的优化, 使用一些变量或使用简单的判断语句</li>
<li><input disabled type="checkbox"> 脚本执行的输出信息不要随意打印, 可以重定向至其他位置保留或丢入黑洞</li>
</ul>
</li>
<li>执行脚本<ul>
<li><input disabled type="checkbox"> 使用bash执行, 防止脚本没有增加执行权限(/bin/bash)</li>
<li><input disabled type="checkbox"> 执行命令以及脚本成功后并复制该命令</li>
</ul>
</li>
<li>编写计划任务<ul>
<li><input disabled type="checkbox"> 加上必要的注释信息, 人、时间、任务</li>
<li><input disabled type="checkbox"> 设定计划任务执行的周期</li>
<li><input disabled type="checkbox"> 加入执行脚本的命令</li>
</ul>
</li>
<li>调试计划任务<ul>
<li><input disabled type="checkbox"> 增加任务频率测试、调整系统时间测试(不能用于生产)</li>
<li><input disabled type="checkbox"> 检查环境变量问题、检查crond服务产生日志进行排查</li>
</ul>
</li>
</ul>
<h2 id="6-at-一次性"><a href="#6-at-一次性" class="headerlink" title="6.at (一次性)"></a>6.at (一次性)</h2><p>at      在指定的时间执行命令。</p>
<p>atq     列出用户的等待执行的作业；在用户是超级用户的情况下，列出所 有人的作业。</p>
<p>atrm    删除作业。</p>
<p>-V      在标准错误上输出版本号。</p>
<p>-m      当作业完成时即使没有输出也给用户发邮件。</p>
<p>-f file 从文件而不是标准输入中读取作业信息。</p>
<p>-l      是 atq 的别名。</p>
<p> -d      是 atrm 的别名。</p>
<p>-c      连接命令行中列出的作业并输出到标准输出。</p>
<p><strong>实验：</strong></p>
<p><strong>在linux系统中备份脚本backup.sh需要再每周1-5的每天下午1点和晚上8点执行，下列哪个cron命令可以完成（D）</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a. 00 13,20 * 1-5 * backup.sh</span><br><span class="line">b. 0 13,20 1,5 * * backup.sh</span><br><span class="line">c. * 13,20 * * 1-5 backup.sh</span><br><span class="line">d. 00 13,20 * * 1-5 backup.sh</span><br></pre></td></tr></table></figure>

<blockquote>
<p>A:一月到五月的每天下午一点和晚上八点执行备份脚本<br>B:每个月的一号和五号的下午一点和晚上八点会执行备份脚本<br>C:每周一到周五的下午一点中的每一分钟和晚上八点的每一分钟执行一次备份脚本<br>D:符合题意要求</p>
</blockquote>
<p><strong>2.新建/scripts/httpd.sh文件，并让/scripts/httpd.sh脚本在每天的00:10分执行</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10	00	* 	*	*	/bin/bash /scripts/httpd.sh</span><br></pre></td></tr></table></figure>

<p><strong>3.新建/backup目录,每周一下午5:50将/backup目录下的所有文件打包成 backup.tar.gz</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">50	17	*	*	1	/usr/bin/tar –czf backup.tar.gz /backup</span><br></pre></td></tr></table></figure>

<p><strong>4.写一个定时任务，每天0点5分把/var/log/nginx下7天前的文件转移到/backup/xxxx_xx_xx的目录中</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5	0	*/7	*	*	/usr/bin/mv /var/log/nginx /backup$(date +&quot;%Y-%m-%d&quot;)/</span><br></pre></td></tr></table></figure>

<p><strong>5.系统脚本/scripts/which.sh，如何定时每隔7分钟执行一次？</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/7	*	*	*	*  source /scripts/which.sh</span><br></pre></td></tr></table></figure>

<p><strong>6.如何不小心删除了/var/spool/cron/root文件，该如何恢复。</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /var/log/cron | grep -i &quot;whoami&quot; &gt; grep &quot;CMD&quot; | awk -F &apos;(&apos; &apos;&#123;print $3&#125;&apos; | awk -F &apos;)&apos; &apos;&#123;print $1&#125;&apos; | sort -u &gt; cmd_tmp</span><br></pre></td></tr></table></figure>

<p><strong>backup_crontab.sh</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env bash</span><br><span class="line"></span><br><span class="line">BACKUP_DIRECTORY=&quot;$&#123;HOME&#125;/crontab_backup&quot;</span><br><span class="line"></span><br><span class="line">if [ ! -e &quot;$&#123;BACKUP_DIRECTORY&#125;&quot; ]; then</span><br><span class="line">        mkdir -p $&#123;BACKUP_DIRECTORY&#125;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">crontab -l &gt; $&#123;BACKUP_DIRECTORY&#125;/$(date &apos;+%Y%m%d&apos;).txt</span><br></pre></td></tr></table></figure>


          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    
	
	  <div>
        
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://aiwhs.github.io/2018/09/22/LVM管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="itw">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="itw">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/09/22/LVM管理/" class="post-title-link" itemprop="url">LVM管理</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-09-22 08:15:57" itemprop="dateCreated datePublished" datetime="2018-09-22T08:15:57+08:00">2018-09-22</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-12 14:34:11" itemprop="dateModified" datetime="2019-07-12T14:34:11+08:00">2019-07-12</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux运维/" itemprop="url" rel="index"><span itemprop="name">Linux运维</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h1 id="1-lvm的应用场景及其弊端"><a href="#1-lvm的应用场景及其弊端" class="headerlink" title="1. lvm的应用场景及其弊端"></a>1. lvm的应用场景及其弊端</h1><blockquote>
<p>应用场景：<br> 随着公司的发展，数据增长较快，最初规划的磁盘容量不够用了</p>
<p>弊端：<br>数据不是直接存放在硬盘上，而是在硬盘的上面又虚拟出来一层逻辑卷存放数据，故而增加了磁盘数据恢复的难度</p>
</blockquote>
<h1 id="2-物理卷、卷组、逻辑卷"><a href="#2-物理卷、卷组、逻辑卷" class="headerlink" title="2. 物理卷、卷组、逻辑卷"></a>2. 物理卷、卷组、逻辑卷</h1><p><img src="../../img/lvm.jpg" alt="lvm1"></p>
<blockquote>
<p>物理卷(PV)：把常规的块设备（硬盘，分区等可以读写数据的设备）通过pvcreate命令对其进行初始化，就成了物理卷</p>
<p>卷组(VG):把多个物理卷的容量组成一个逻辑整体，可以从里面灵活分配容量</p>
<p>逻辑卷(LV):从卷组中划分部分空间成为一个可以读写数据的逻辑单元。需要对其格式化然后挂载使用</p>
</blockquote>
<h1 id="3-lvm管理"><a href="#3-lvm管理" class="headerlink" title="3. lvm管理"></a>3. lvm管理</h1><h3 id="3-1-部署lvm"><a href="#3-1-部署lvm" class="headerlink" title="3.1 部署lvm"></a>3.1 部署lvm</h3><blockquote>
<p>创建lvm步骤：</p>
<p>a) 添加物理磁盘，创建物理卷 </p>
<p>b) 创建卷组，将物理卷加入卷组</p>
<p>c) 在卷组中划分逻辑卷</p>
<p>d) 格式化逻辑卷 </p>
<p>e)挂载使用</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">1.准备物理磁盘</span><br><span class="line">[root@wenhs5479 ~]# lsblk |grep &quot;sd[b-f]&quot;</span><br><span class="line">sdb               8:16   0    3G  0 disk </span><br><span class="line">sdc               8:32   0    3G  0 disk </span><br><span class="line">sdd               8:48   0    3G  0 disk </span><br><span class="line">sde               8:64   0    3G  0 disk </span><br><span class="line">sdf               8:80   0    5G  0 disk</span><br><span class="line"></span><br><span class="line">1.将磁盘加入pv</span><br><span class="line">[root@wenhs5479 ~]# pvcreate /dev/sd[b-f]</span><br><span class="line">  Physical volume &quot;/dev/sdb&quot; successfully created.</span><br><span class="line">  Physical volume &quot;/dev/sdc&quot; successfully created.</span><br><span class="line">  Physical volume &quot;/dev/sdd&quot; successfully created.</span><br><span class="line">  Physical volume &quot;/dev/sde&quot; successfully created.</span><br><span class="line">  Physical volume &quot;/dev/sdf&quot; successfully created.</span><br><span class="line">检查pv创建情况</span><br><span class="line">[root@wenhs5479 ~]# pvs</span><br><span class="line">  PV         VG     Fmt  Attr PSize   PFree</span><br><span class="line">  /dev/sda2  centos lvm2 a--  &lt;14.00g    0 </span><br><span class="line">  /dev/sdb          lvm2 ---    3.00g 3.00g</span><br><span class="line">  /dev/sdc          lvm2 ---    3.00g 3.00g</span><br><span class="line">  /dev/sdd          lvm2 ---    3.00g 3.00g</span><br><span class="line">  /dev/sde          lvm2 ---    3.00g 3.00g</span><br><span class="line">  /dev/sdf          lvm2 ---    5.00g 5.00g</span><br><span class="line"></span><br><span class="line">2.创建名为wenhs的卷组</span><br><span class="line">[root@wenhs5479 ~]# vgcreate wenhs /dev/sdb</span><br><span class="line">  Volume group &quot;wenhs&quot; successfully created</span><br><span class="line"></span><br><span class="line">//检查卷组</span><br><span class="line">[root@wenhs5479 ~]# vgs</span><br><span class="line">  VG     #PV #LV #SN Attr   VSize   VFree </span><br><span class="line">  centos   1   2   0 wz--n- &lt;14.00g     0 </span><br><span class="line">  wenhs    1   0   0 wz--n-  &lt;3.00g &lt;3.00g</span><br><span class="line"></span><br><span class="line">3.创建逻辑卷, 分配名称, 以及大小, 指定卷组</span><br><span class="line">[root@wenhs5479 ~]# lvcreate -L 500M -n lv1 wenhs</span><br><span class="line">WARNING: xfs signature detected on /dev/wenhs/lv1 at offset 0. Wipe it? [y/n]: y</span><br><span class="line">  Wiping xfs signature on /dev/wenhs/lv1.</span><br><span class="line">  Logical volume &quot;lv1&quot; created.</span><br><span class="line">  </span><br><span class="line">检查逻辑卷</span><br><span class="line">[root@wenhs5479 ~]# lvscan </span><br><span class="line">  ACTIVE            &apos;/dev/wenhs/lv1&apos; [500.00 MiB] inherit</span><br><span class="line">  ACTIVE            &apos;/dev/centos/swap&apos; [1.50 GiB] inherit</span><br><span class="line">  ACTIVE            &apos;/dev/centos/root&apos; [&lt;12.50 GiB] inherit</span><br><span class="line"></span><br><span class="line">4.格式化文件系统</span><br><span class="line">[root@wenhs5479 ~]# mkfs.xfs /dev/wenhs/lv1 </span><br><span class="line">meta-data=/dev/wenhs/lv1         isize=512    agcount=4, agsize=32000 blks</span><br><span class="line">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">         =                       crc=1        finobt=0, sparse=0</span><br><span class="line">data     =                       bsize=4096   blocks=128000, imaxpct=25</span><br><span class="line">         =                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=1</span><br><span class="line">log      =internal log           bsize=4096   blocks=855, version=2</span><br><span class="line">         =                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br><span class="line"></span><br><span class="line">挂载并使用</span><br><span class="line">[root@wenhs5479 ~]# mkdir /lv1</span><br><span class="line">[root@wenhs5479 ~]# mount /dev/wenhs/lv1 /lv1/</span><br><span class="line">[root@wenhs5479 ~]# df -Th</span><br><span class="line">文件系统                类型      容量  已用  可用 已用% 挂载点</span><br><span class="line">/dev/mapper/centos-root xfs        13G  6.8G  5.8G   54% /</span><br><span class="line">devtmpfs                devtmpfs  1.9G     0  1.9G    0% /dev</span><br><span class="line">tmpfs                   tmpfs     1.9G     0  1.9G    0% /dev/shm</span><br><span class="line">tmpfs                   tmpfs     1.9G   13M  1.9G    1% /run</span><br><span class="line">tmpfs                   tmpfs     1.9G     0  1.9G    0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1               xfs      1014M  181M  834M   18% /boot</span><br><span class="line">tmpfs                   tmpfs     378M  4.0K  378M    1% /run/user/42</span><br><span class="line">tmpfs                   tmpfs     378M   32K  378M    1% /run/user/0</span><br><span class="line">/dev/sr0                iso9660    11G   11G     0  100% /run/media/root/CentOS 7 x86_64</span><br><span class="line">/dev/mapper/wenhs-lv1   xfs       497M   26M  472M    6% /lv1</span><br><span class="line">[root@wenhs5479 ~]#</span><br></pre></td></tr></table></figure>

<h3 id="3-2-卷组管理"><a href="#3-2-卷组管理" class="headerlink" title="3.2 卷组管理"></a>3.2 卷组管理</h3><ul>
<li>扩展卷组，将新磁盘加入卷组</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1.新硬盘加入pv</span><br><span class="line">[root@wenhs5479 ~]# pvcreate /dev/sdc</span><br><span class="line">  Physical volume &quot;/dev/sdc&quot; successfully created.</span><br><span class="line">  </span><br><span class="line">2.使用vgextend扩展</span><br><span class="line">[root@wenhs5479 ~]# vgextend wenhs /dev/sdc</span><br><span class="line">  Volume group &quot;wenhs&quot; successfully extended</span><br></pre></td></tr></table></figure>

<ul>
<li>缩减卷组，将指定磁盘从卷组中删除</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vgreduce datavg /dev/sdb</span><br><span class="line">  Removed &quot;/dev/sdb&quot; from volume group &quot;datavg&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>数据迁移卷组，同一卷组的磁盘才可以进行在线迁移</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1.检查当前逻辑卷VG中PV使用情况</span><br><span class="line">[root@wenhs5479 ~]# pvs</span><br><span class="line">  PV         VG     Fmt  Attr PSize   PFree </span><br><span class="line">  /dev/sda2  centos lvm2 a--  &lt;14.00g     0 </span><br><span class="line">  /dev/sdb   wenhs  lvm2 a--   &lt;3.00g &lt;2.51g</span><br><span class="line">  /dev/sdc   wenhs  lvm2 a--   &lt;3.00g &lt;3.00g</span><br><span class="line">  </span><br><span class="line">2.pvmove在线数据迁移至其他pv </span><br><span class="line">[root@wenhs5479 ~]# pvmove /dev/sdb</span><br><span class="line">  /dev/sdb: Moved: 10.40%</span><br><span class="line">  /dev/sdb: Moved: 100.00%</span><br><span class="line"></span><br><span class="line">3.检查是否将sdb数据迁移至sdc </span><br><span class="line">[root@wenhs5479 ~]# pvs</span><br><span class="line">  PV         VG     Fmt  Attr PSize   PFree </span><br><span class="line">  /dev/sda2  centos lvm2 a--  &lt;14.00g     0 </span><br><span class="line">  /dev/sdb   wenhs  lvm2 a--   &lt;3.00g &lt;3.00g</span><br><span class="line">  /dev/sdc   wenhs  lvm2 a--   &lt;3.00g &lt;2.51g</span><br></pre></td></tr></table></figure>

<h3 id="3-3-逻辑卷管理"><a href="#3-3-逻辑卷管理" class="headerlink" title="3.3 逻辑卷管理"></a>3.3 逻辑卷管理</h3><ul>
<li>逻辑卷扩展，逻辑卷的扩展取决于卷组中的容量，逻辑卷扩展的容量不能超过卷组的容量</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# vgs</span><br><span class="line">  VG     #PV #LV #SN Attr   VSize   VFree</span><br><span class="line">  centos   1   2   0 wz--n- &lt;14.00g    0 </span><br><span class="line">  wenhs    2   1   0 wz--n-   5.99g 5.50g</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1.扩展lv逻辑卷</span><br><span class="line">增加800M分配给逻辑卷 &#123;注意: 800M +800M 不一样&#125;</span><br><span class="line">[root@wenhs5479 ~]# lvextend -L +800M /dev/wenhs/lv1 </span><br><span class="line">  Size of logical volume wenhs/lv1 changed from 500.00 MiB (125 extents) to &lt;1.27 GiB (325 extents).</span><br><span class="line">  Logical volume wenhs/lv1 successfully resized.</span><br><span class="line">分配磁盘池中多少百分比给逻辑卷</span><br><span class="line">[root@wenhs5479 ~]# lvextend -l +50%free /dev/wenhs/lv1</span><br><span class="line">  Size of logical volume wenhs/lv1 changed from &lt;1.27 GiB (325 extents) to 3.63 GiB (930 extents).</span><br><span class="line">  Logical volume wenhs/lv1 successfully resized.</span><br><span class="line"></span><br><span class="line">2.扩展fs文件系统</span><br><span class="line">xfs扩容</span><br><span class="line">[root@wenhs5479 ~]# xfs_growfs /dev/wenhs/lv1 </span><br><span class="line">meta-data=/dev/mapper/wenhs-lv1  isize=512    agcount=4, agsize=32000 blks</span><br><span class="line">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">         =                       crc=1        finobt=0 spinodes=0</span><br><span class="line">data     =                       bsize=4096   blocks=128000, imaxpct=25</span><br><span class="line">         =                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=1</span><br><span class="line">log      =internal               bsize=4096   blocks=855, version=2</span><br><span class="line">         =                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br><span class="line">data blocks changed from 128000 to 332800</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# lvs</span><br><span class="line">  LV   VG     Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  root centos -wi-ao---- &lt;12.50g                                                    </span><br><span class="line">  swap centos -wi-ao----   1.50g                                                    </span><br><span class="line">  lv1  wenhs  -wi-ao----  &lt;1.27g</span><br><span class="line">//ext扩容</span><br><span class="line">[root@wenhs5479 ~]# xfs_growfs /dev/wenhs/lv1 </span><br><span class="line">meta-data=/dev/mapper/wenhs-lv1  isize=512    agcount=11, agsize=32000 blks</span><br><span class="line">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">         =                       crc=1        finobt=0 spinodes=0</span><br><span class="line">data     =                       bsize=4096   blocks=332800, imaxpct=25</span><br><span class="line">         =                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=1</span><br><span class="line">log      =internal               bsize=4096   blocks=855, version=2</span><br><span class="line">         =                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br><span class="line">data blocks changed from 332800 to 952320</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# lvs</span><br><span class="line">  LV   VG     Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert</span><br><span class="line">  root centos -wi-ao---- &lt;12.50g                                                    </span><br><span class="line">  swap centos -wi-ao----   1.50g                                                    </span><br><span class="line">  lv1  wenhs  -wi-ao----   3.63g</span><br></pre></td></tr></table></figure>

<ul>
<li>对ext4文件系统的逻辑卷裁剪容量</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">首先自己创建一个1G的逻辑卷作为裁剪的对象</span><br><span class="line">[root@wenhs5479 ~]# lvcreate -n extdisk -L 1G wenhs </span><br><span class="line">  Logical volume &quot;extdisk&quot; created.</span><br><span class="line">  </span><br><span class="line">[root@wenhs5479 ~]# mkfs.ext4 /dev/wenhs/extdisk </span><br><span class="line">mke2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">文件系统标签=</span><br><span class="line">OS type: Linux</span><br><span class="line">块大小=4096 (log=2)</span><br><span class="line">分块大小=4096 (log=2)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">65536 inodes, 262144 blocks</span><br><span class="line">13107 blocks (5.00%) reserved for the super user</span><br><span class="line">第一个数据块=0</span><br><span class="line">Maximum filesystem blocks=268435456</span><br><span class="line">8 block groups</span><br><span class="line">32768 blocks per group, 32768 fragments per group</span><br><span class="line">8192 inodes per group</span><br><span class="line">Superblock backups stored on blocks: </span><br><span class="line">	32768, 98304, 163840, 229376</span><br><span class="line"></span><br><span class="line">Allocating group tables: 完成                            </span><br><span class="line">正在写入inode表: 完成                            </span><br><span class="line">Creating journal (8192 blocks): 完成</span><br><span class="line">Writing superblocks and filesystem accounting information: 完成</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# mkdir -p /wenhs/extdisk</span><br><span class="line">[root@wenhs5479 ~]# mount /dev/wenhs/extdisk /wenhs/extdisk/</span><br><span class="line">[root@wenhs5479 ~]# cp /etc/host* /wenhs/extdisk/</span><br><span class="line"></span><br><span class="line">1、如果已经挂载，必须先卸载</span><br><span class="line">[root@wenhs5479 ~]# umount /dev/wenhs/extdisk</span><br><span class="line"></span><br><span class="line">2、裁剪容量，必须是先检测文件系统</span><br><span class="line">[root@wenhs5479 ~]# e2fsck -f /dev/wenhs/extdisk </span><br><span class="line">e2fsck 1.42.9 (28-Dec-2013)</span><br><span class="line">第一步: 检查inode,块,和大小</span><br><span class="line">第二步: 检查目录结构</span><br><span class="line">第3步: 检查目录连接性</span><br><span class="line">Pass 4: Checking reference counts</span><br><span class="line">第5步: 检查簇概要信息</span><br><span class="line">/dev/wenhs/extdisk: 16/65536 files (0.0% non-contiguous), 12960/262144 blocks</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# resize2fs /dev/wenhs/extdisk 500M</span><br><span class="line">resize2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">Resizing the filesystem on /dev/wenhs/extdisk to 128000 (4k) blocks.</span><br><span class="line">The filesystem on /dev/wenhs/extdisk is now 128000 blocks long.</span><br><span class="line"></span><br><span class="line">3、调整完毕后采取裁剪逻辑卷容量</span><br><span class="line">[root@wenhs5479 ~]# lvreduce -L 500M /dev/wenhs/extdisk </span><br><span class="line">  WARNING: Reducing active logical volume to 500.00 MiB.</span><br><span class="line">  THIS MAY DESTROY YOUR DATA (filesystem etc.)</span><br><span class="line">Do you really want to reduce wenhs/extdisk? [y/n]: y</span><br><span class="line">  Size of logical volume wenhs/extdisk changed from 1.00 GiB (256 extents) to 500.00 MiB (125 extents).</span><br><span class="line">  Logical volume wenhs/extdisk successfully resized.</span><br><span class="line"></span><br><span class="line">4、强烈建议裁剪后，再次检测文件系统</span><br><span class="line">[root@wenhs5479 ~]# e2fsck -f /dev/wenhs/extdisk </span><br><span class="line">e2fsck 1.42.9 (28-Dec-2013)</span><br><span class="line">第一步: 检查inode,块,和大小</span><br><span class="line">第二步: 检查目录结构</span><br><span class="line">第3步: 检查目录连接性</span><br><span class="line">Pass 4: Checking reference counts</span><br><span class="line">第5步: 检查簇概要信息</span><br><span class="line">/dev/wenhs/extdisk: 16/32768 files (6.3% non-contiguous), 10646/128000 blocks</span><br><span class="line"></span><br><span class="line">5、挂载测试</span><br><span class="line">如果能够挂载，一般说明裁剪成功，文件系统没有损坏</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# mount /dev/wenhs/extdisk /wenhs/extdisk/</span><br><span class="line">[root@wenhs5479 ~]# df -Th</span><br><span class="line">文件系统                  类型      容量  已用  可用 已用% 挂载点</span><br><span class="line">/dev/mapper/centos-root   xfs        13G  6.8G  5.8G   54% /</span><br><span class="line">devtmpfs                  devtmpfs  1.9G     0  1.9G    0% /dev</span><br><span class="line">.....</span><br><span class="line">/dev/mapper/wenhs-lv1     xfs       3.7G   27M  3.7G    1% /lv1</span><br><span class="line">/dev/mapper/wenhs-extdisk ext4      460M  1.6M  424M    1% /wenhs/extdisk&lt;-----而且文件系统容量被刷新了</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>缩减逻辑卷注意事项：</strong></p>
<ol>
<li>不能在线缩减，得先卸载；</li>
<li>确保缩减后的空间大小依然能存储原有的所有数据；</li>
<li>在缩减之前应该先强行检查文件，以确保文件系统处于一致性状态。使用命令e2fsck -f /PATH/TO/LV</li>
<li>只能缩减ext系列的,而xfs文件系统不适用</li>
</ol>
</blockquote>
<p><strong>示例：</strong></p>
<p>1.查看/etc/目录大小</p>
<pre><code>du -sh /etc</code></pre><p>2.查看磁盘使用分区情况</p>
<pre><code>lsblk</code></pre><p>3.查看innode使用情况</p>
<pre><code>df -i /path/to/device</code></pre><p>4.查看磁盘block使用情况</p>
<pre><code>df -h</code></pre><p>5.查看分区使用格式</p>
<pre><code>df -Th</code></pre><p>6.查看一个设备的UUID</p>
<pre><code>blkid /path/to/device</code></pre><p>7.解释/etc/fstab中每段含义</p>
<pre><code>第一列表示设备的名称
第二列表示该设备的挂载点
第三列是文件系统
第四列是挂载选项
第五列是dump选项（用一个数字表示）
第六列（接下来的数字）表示文件系统检查选项</code></pre><p><a href="https://blog.csdn.net/richerg85/article/details/17917129" target="_blank" rel="noopener">详解</a></p>
<p>8.一个ext4的文件分区，当使用touch test.file命令创建一个新文件是报错，报错的信息提示磁盘已满，但是采用df –h 命令查看磁盘大小时，只是用了60%的磁盘空间，为什么会出现这个情况，说说你的理由.</p>
<pre><code>innode使用完了,会有这样的错误</code></pre><p><strong>磁盘分区方案</strong></p>
<blockquote>
<p>在虚拟机中添加一块20GB的SCISI磁盘<br>在新硬盘中建立一个5GB的分区，一个10G的分区<br>一个格式化为ext4的文件系统,一个格式化为xfs的文件系统<br>新建两个目录站点进行挂载, 要求开机自动挂载该分区</p>
</blockquote>
<p><strong>LVM磁盘管理方案</strong></p>
<blockquote>
<p>在虚拟机环境中，新添加两块SCISI硬盘设备，完成硬盘检测及分区<br>建立逻辑卷mbvg, 格式化为ext4文件系统,分配1G逻辑分区供/box目录使用<br>第二块逻辑分区, 格式化为xfs文件系统, 分配1G逻辑分区供/xfs目录使用<br>最后使用扩容方案将/box站点扩展到2.8G磁盘使用空间, 将/xfs目录扩展到2G</p>
</blockquote>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    
	
	  <div>
        
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://aiwhs.github.io/2018/09/16/磁盘管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="itw">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="itw">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/09/16/磁盘管理/" class="post-title-link" itemprop="url">磁盘管理</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-09-16 08:15:57" itemprop="dateCreated datePublished" datetime="2018-09-16T08:15:57+08:00">2018-09-16</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-12 15:19:10" itemprop="dateModified" datetime="2019-07-12T15:19:10+08:00">2019-07-12</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux运维/" itemprop="url" rel="index"><span itemprop="name">Linux运维</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<p><strong><em>实验准备:</em></strong></p>
<p><img src="../../img/disk.jpg" alt="disk"></p>
<p><strong><em>工具准备</em></strong>:(centos7.5)配好软件源的情况下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install util-linux gdisk parted coreutils procps-ng</span><br><span class="line">安装这些软件包,以下实验不会缺少,无命令的情况</span><br></pre></td></tr></table></figure>

<p><strong><em>实验要求:</em></strong></p>
<blockquote>
<p>P:主分区;</p>
<p>E:扩展分区;</p>
<p>L:逻辑分区</p>
<p>磁盘2:1P+1E(4L)空间自由分配</p>
<p>磁盘3:用gpt格式分区空间自由分配</p>
<p>磁盘4:2P+1E(4L)空间自由分配</p>
<p>磁盘5:3P+1E(4L)空间自由分配</p>
<p>磁盘6:全盘做swap分区</p>
<p>并且设置开机自动挂载</p>
</blockquote>
<h1 id="1-磁盘基本概述"><a href="#1-磁盘基本概述" class="headerlink" title="1. 磁盘基本概述"></a>1. 磁盘基本概述</h1><h3 id="1-1-磁盘分类"><a href="#1-1-磁盘分类" class="headerlink" title="1.1 磁盘分类"></a>1.1 磁盘分类</h3><ul>
<li>固态硬盘</li>
<li>机械硬盘</li>
<li>服务器硬盘</li>
</ul>
<h3 id="1-2-固态硬盘的优缺点"><a href="#1-2-固态硬盘的优缺点" class="headerlink" title="1.2 固态硬盘的优缺点"></a>1.2 固态硬盘的优缺点</h3><p><strong>优点：</strong></p>
<ul>
<li>读写速度快</li>
<li>防震抗摔性强</li>
<li>低功耗</li>
<li>无躁音</li>
<li>体积小，携带方便</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>容量比机械硬盘小</li>
<li>寿命比机械硬盘短</li>
<li>制造成本高所以价格比机械硬盘高</li>
</ul>
<h3 id="1-3-Linux中磁盘命名方式"><a href="#1-3-Linux中磁盘命名方式" class="headerlink" title="1.3 Linux中磁盘命名方式"></a>1.3 Linux中磁盘命名方式</h3><p>Linux中磁盘的命名方式与磁盘的接口有关，规则如下：</p>
<ul>
<li>传统IDE接口硬盘：<code>/dev/hd[a-z]</code></li>
<li>SCISI接口硬盘：<code>/dev/sd[a-z]</code></li>
<li>虚拟化硬盘：<code>/dev/vd[a-z]</code></li>
</ul>
<p>在设备名称的定义规则如下, 其他的分区可以以此类推<br>系统的第一块SCSI接口的硬盘名称为<code>/dev/sda</code><br>系统的第二块SCSI接口的硬盘名称为<code>/dev/sdb</code><br>系统中分区由数字编号表示, 1-4留给主分区使用和扩展分区, 逻辑分区从5开始</p>
<blockquote>
<p><em>第一块磁盘</em><br>/dev/sda<br><em>第一块磁盘的第一个分区</em><br>/dev/sda1<br><em>第二块磁盘的第一个分区</em><br> /dev/sdb1</p>
</blockquote>
<h3 id="1-4-MBR与GPT"><a href="#1-4-MBR与GPT" class="headerlink" title="1.4 MBR与GPT"></a>1.4 MBR与GPT</h3><p>在使用新磁盘之前，你必须对其进行分区。<code>MBR（Master Boot Record）</code>和<code>GPT（GUID Partition Table）</code>是在磁盘上存储分区信息的两种不同方式。这些分区信息包含了分区从哪里开始的信息，这样操作系统才知道哪个扇区是属于哪个分区的，以及哪个分区是可以启动的。在磁盘上创建分区时，你必须在MBR和GPT之间做出选择</p>
<p><code>MBR</code>是<code>Master Boot Record</code>的简称，也就是主引导记录，是位于磁盘最前边的一段引导（<code>Loader</code>）代码，主要用来引导操作系统的加载与启动</p>
<p><strong>特点：</strong></p>
<ol>
<li>MBR支持最大2TB磁盘，它无法处理大于2TB容量的磁盘</li>
<li>只支持最多4个主分区。若想要更多分区，需要创建扩展分区，并在其中创建逻辑分区</li>
</ol>
<p><code>GPT</code>磁盘是指使用GUID分区表的磁盘，GUID磁盘分区表（<code>GUID Partition Table</code>，缩写：GPT）其含义为“全局唯一标识磁盘分区表”，是一个实体硬盘的分区表的结构布局的标准</p>
<p><strong>特点：</strong></p>
<ol>
<li>GPT对磁盘大小没有限制</li>
<li>最多可以创建128个分区</li>
</ol>
<p><strong><em>注意：</em></strong></p>
<blockquote>
<p>MBR与GPT之间互相转换会导致数据丢失</p>
</blockquote>
<p><a href="https://baike.baidu.com/item/GPT%E7%A3%81%E7%9B%98/12761414" target="_blank" rel="noopener">GPT磁盘概述</a>和 <a href="http://www.udaxia.com/wtjd/6117.html" target="_blank" rel="noopener">MBR与GPT的区别</a></p>
<h1 id="2-磁盘容量检查"><a href="#2-磁盘容量检查" class="headerlink" title="2. 磁盘容量检查"></a>2. 磁盘容量检查</h1><p>使用<code>df</code>命令查看磁盘容量，不加参数以k为单位：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">df -i   //查看inode使用情况</span><br><span class="line">df -h   //以G或者T或者M人性化方式显示</span><br><span class="line">df -T   //查看文件类型</span><br><span class="line"></span><br><span class="line">使用df命令查看磁盘，下面分别介绍每列什么含义</span><br><span class="line">[root@wenhs5479 ~]# df -h</span><br><span class="line">文件系统                 容量  已用  可用 已用% 挂载点</span><br><span class="line">/dev/mapper/centos-root   13G  5.8G  6.8G   46% /</span><br><span class="line">devtmpfs                 1.9G     0  1.9G    0% /dev</span><br><span class="line">tmpfs                    1.9G     0  1.9G    0% /dev/shm</span><br><span class="line">tmpfs                    1.9G   13M  1.9G    1% /run</span><br><span class="line">tmpfs                    1.9G     0  1.9G    0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1               1014M  181M  834M   18% /boot</span><br><span class="line">tmpfs                    378M  8.0K  378M    1% /run/user/42</span><br><span class="line">tmpfs                    378M   28K  378M    1% /run/user/0</span><br><span class="line">/dev/sr0                  11G   11G     0  100% /run/media/root/CentOS 7 x86_64</span><br><span class="line">[root@wenhs5479 ~]#</span><br></pre></td></tr></table></figure>

<p>使用<code>lsblk</code>查看分区情况：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# lsblk </span><br><span class="line">NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda               8:0    0   15G  0 disk </span><br><span class="line">├─sda1            8:1    0    1G  0 part /boot</span><br><span class="line">└─sda2            8:2    0   14G  0 part </span><br><span class="line">  ├─centos-root 253:0    0 12.5G  0 lvm  /</span><br><span class="line">  └─centos-swap 253:1    0  1.5G  0 lvm  [SWAP]</span><br><span class="line">sdb               8:16   0    3G  0 disk </span><br><span class="line">sdc               8:32   0    3G  0 disk </span><br><span class="line">sdd               8:48   0    3G  0 disk </span><br><span class="line">sde               8:64   0    3G  0 disk </span><br><span class="line">sdf               8:80   0    5G  0 disk </span><br><span class="line">sr0              11:0    1   10G  0 rom  /run/media/root/CentOS 7 x86_64</span><br><span class="line">[root@wenhs5479 ~]#</span><br></pre></td></tr></table></figure>

<p>使用<code>du</code>命令查看目录或者文件的容量，不加参数以<code>k</code>为单位：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">du -sh opt  //人性化输出显示大小</span><br><span class="line">-s：列出总和</span><br><span class="line">-h：人性化显示容量信息</span><br></pre></td></tr></table></figure>

<h1 id="3-磁盘分区"><a href="#3-磁盘分区" class="headerlink" title="3. 磁盘分区"></a>3. 磁盘分区</h1><p>分区之前, 需要先给虚拟机添加一块磁盘，以便于我们做后续的实验vmware虚拟机，请按如下进行操作:</p>
<blockquote>
<p>1.找到对应虚拟主机点击右键, 选择设置</p>
<p>2.在硬件向导里面点击添加按钮, 在硬件类型中选中“硬盘”, 点击下一步</p>
<p>3.磁盘类型选择默认, 然后创建新虚拟磁盘, 调整大小(不要勾选立即分配空间)</p>
<p>4.最后点击下一步, 完成即可</p>
</blockquote>
<p><strong>分区工具有fdisk和gdisk，当硬盘小于2T的时候我们应该用fdisk来分区，而当硬盘大于2T的时候则应用gdisk来进行分区</strong></p>
<h3 id="3-1-fdisk分区"><a href="#3-1-fdisk分区" class="headerlink" title="3.1 fdisk分区"></a>3.1 fdisk分区</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line">生产分区建议: 如无特殊需求, 直接使用整个磁盘即可, 无需分区</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# fdisk -l</span><br><span class="line"></span><br><span class="line">磁盘 /dev/sda：16.1 GB, 16106127360 字节，31457280 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line">磁盘标签类型：dos</span><br><span class="line">磁盘标识符：0x000b2288</span><br><span class="line"></span><br><span class="line">   设备 Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sda1   *        2048     2099199     1048576   83  Linux</span><br><span class="line">/dev/sda2         2099200    31457279    14679040   8e  Linux LVM</span><br><span class="line"></span><br><span class="line">磁盘 /dev/sdb：3221 MB, 3221225472 字节，6291456 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line"></span><br><span class="line">磁盘 /dev/sdc：3221 MB, 3221225472 字节，6291456 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line"></span><br><span class="line">磁盘 /dev/sdd：3221 MB, 3221225472 字节，6291456 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line"></span><br><span class="line">磁盘 /dev/sde：3221 MB, 3221225472 字节，6291456 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line"></span><br><span class="line">磁盘 /dev/sdf：5368 MB, 5368709120 字节，10485760 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line"></span><br><span class="line">磁盘 /dev/mapper/centos-root：13.4 GB, 13417578496 字节，26206208 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line"></span><br><span class="line">磁盘 /dev/mapper/centos-swap：1610 MB, 1610612736 字节，3145728 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# fdisk /dev/sdb</span><br><span class="line">Command (m for help): m //输入m列出常用的命令</span><br><span class="line">Command action</span><br><span class="line">   a   toggle a bootable flag   //切换分区启动标记</span><br><span class="line">   b   edit bsd disklabel     //编辑sdb磁盘标签</span><br><span class="line">   c   toggle the dos compatibility flag    //切换dos兼容模式</span><br><span class="line">   d   delete a partition     //删除分区</span><br><span class="line">   l   list known partition types   //显示分区类型</span><br><span class="line">   m   print this menu      //显示帮助菜单</span><br><span class="line">   n   add a new partition  //新建分区</span><br><span class="line">   o   create a new empty DOS partition table   //创建新的空白分区表</span><br><span class="line">   p   print the partition table       //显示分区表的信息</span><br><span class="line">   q   quit without saving changes  //不保存退出</span><br><span class="line">   s   create a new empty Sun disklabel //创建新的Sun磁盘标签</span><br><span class="line">   t   change a partition&apos;s system id   //修改分区ID,可以通过l查看id</span><br><span class="line">   u   change display/entry units       //修改容量单位,磁柱或扇区</span><br><span class="line">   v   verify the partition table       //检验分区表</span><br><span class="line">   w   write table to disk and exit     //保存退出</span><br><span class="line">   x   extra functionality (experts only)   //拓展功能</span><br><span class="line"></span><br><span class="line">创建主分区</span><br><span class="line">命令(输入 m 获取帮助)：n</span><br><span class="line">Partition type:</span><br><span class="line">   p   primary (0 primary, 0 extended, 4 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p): p</span><br><span class="line">分区号 (1-4，默认 1)：1</span><br><span class="line">起始 扇区 (2048-6291455，默认为 2048)：</span><br><span class="line">将使用默认值 2048</span><br><span class="line">Last 扇区, +扇区 or +size&#123;K,M,G&#125; (2048-6291455，默认为 6291455)：+1G</span><br><span class="line">分区 1 已设置为 Linux 类型，大小设为 1 GiB</span><br><span class="line"></span><br><span class="line">创建扩展分区</span><br><span class="line">命令(输入 m 获取帮助)：n</span><br><span class="line">Partition type:</span><br><span class="line">   p   primary (1 primary, 0 extended, 3 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p): e</span><br><span class="line">分区号 (2-4，默认 2)：2</span><br><span class="line">起始 扇区 (2099200-6291455，默认为 2099200)：</span><br><span class="line">将使用默认值 2099200</span><br><span class="line">Last 扇区, +扇区 or +size&#123;K,M,G&#125; (2099200-6291455，默认为 6291455)：</span><br><span class="line">将使用默认值 6291455</span><br><span class="line">分区 2 已设置为 Extended 类型，大小设为 2 GiB    //默认划分所有空间给扩展分区</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">创建逻辑分区</span><br><span class="line">命令(输入 m 获取帮助)：n</span><br><span class="line">Partition type:</span><br><span class="line">   p   primary (1 primary, 1 extended, 2 free)</span><br><span class="line">   l   logical (numbered from 5)</span><br><span class="line">Select (default p): l</span><br><span class="line">添加逻辑分区 5</span><br><span class="line">起始 扇区 (2101248-6291455，默认为 2101248)：</span><br><span class="line">将使用默认值 2101248</span><br><span class="line">Last 扇区, +扇区 or +size&#123;K,M,G&#125; (2101248-6291455，默认为 6291455)：+400M</span><br><span class="line">分区 5 已设置为 Linux 类型，大小设为 400 MiB</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：n</span><br><span class="line">Partition type:</span><br><span class="line">   p   primary (1 primary, 1 extended, 2 free)</span><br><span class="line">   l   logical (numbered from 5)</span><br><span class="line">Select (default p): l</span><br><span class="line">添加逻辑分区 6</span><br><span class="line">起始 扇区 (2922496-6291455，默认为 2922496)：</span><br><span class="line">将使用默认值 2922496</span><br><span class="line">Last 扇区, +扇区 or +size&#123;K,M,G&#125; (2922496-6291455，默认为 6291455)：+400M</span><br><span class="line">分区 6 已设置为 Linux 类型，大小设为 400 MiB</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：n</span><br><span class="line">Partition type:</span><br><span class="line">   p   primary (1 primary, 1 extended, 2 free)</span><br><span class="line">   l   logical (numbered from 5)</span><br><span class="line">Select (default p): l</span><br><span class="line">添加逻辑分区 7</span><br><span class="line">起始 扇区 (3743744-6291455，默认为 3743744)：</span><br><span class="line">将使用默认值 3743744</span><br><span class="line">Last 扇区, +扇区 or +size&#123;K,M,G&#125; (3743744-6291455，默认为 6291455)：+400M</span><br><span class="line">分区 7 已设置为 Linux 类型，大小设为 400 MiB</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：n</span><br><span class="line">Partition type:</span><br><span class="line">   p   primary (1 primary, 1 extended, 2 free)</span><br><span class="line">   l   logical (numbered from 5)</span><br><span class="line">Select (default p): l</span><br><span class="line">添加逻辑分区 8</span><br><span class="line">起始 扇区 (4564992-6291455，默认为 4564992)：</span><br><span class="line">将使用默认值 4564992</span><br><span class="line">Last 扇区, +扇区 or +size&#123;K,M,G&#125; (4564992-6291455，默认为 6291455)：+400M</span><br><span class="line">分区 8 已设置为 Linux 类型，大小设为 400 MiB</span><br><span class="line"></span><br><span class="line">查看分区创建</span><br><span class="line">命令(输入 m 获取帮助)：p</span><br><span class="line"></span><br><span class="line">磁盘 /dev/sdb：3221 MB, 3221225472 字节，6291456 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line">磁盘标签类型：dos</span><br><span class="line">磁盘标识符：0xda681974</span><br><span class="line"></span><br><span class="line">   设备 Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1            2048     2099199     1048576   83  Linux</span><br><span class="line">/dev/sdb2         2099200     6291455     2096128    5  Extended</span><br><span class="line">/dev/sdb5         2101248     2920447      409600   83  Linux</span><br><span class="line">/dev/sdb6         2922496     3741695      409600   83  Linux</span><br><span class="line">/dev/sdb7         3743744     4562943      409600   83  Linux</span><br><span class="line">/dev/sdb8         4564992     5384191      409600   83  Linux</span><br><span class="line"></span><br><span class="line">保存分区</span><br><span class="line">命令(输入 m 获取帮助)：w</span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line">正在同步磁盘。</span><br><span class="line"></span><br><span class="line">检查磁盘是否是MBR分区方式</span><br><span class="line">[root@wenhs5479 ~]# fdisk -l /dev/sdb</span><br><span class="line"></span><br><span class="line">磁盘 /dev/sdb：3221 MB, 3221225472 字节，6291456 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line">磁盘标签类型：dos</span><br><span class="line">磁盘标识符：0xda681974</span><br><span class="line"></span><br><span class="line">   设备 Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1            2048     2099199     1048576   83  Linux</span><br><span class="line">/dev/sdb2         2099200     6291455     2096128    5  Extended</span><br><span class="line">/dev/sdb5         2101248     2920447      409600   83  Linux</span><br><span class="line">/dev/sdb6         2922496     3741695      409600   83  Linux</span><br><span class="line">/dev/sdb7         3743744     4562943      409600   83  Linux</span><br><span class="line">/dev/sdb8         4564992     5384191      409600   83  Linux</span><br><span class="line">[root@wenhs5479 ~]#</span><br><span class="line"></span><br><span class="line">刷新内核立即生效,无需重启</span><br><span class="line">[root@wenhs5479 ~]# partprobe /dev/sdb</span><br></pre></td></tr></table></figure>

<h3 id="3-2-gdisk分区"><a href="#3-2-gdisk分区" class="headerlink" title="3.2 gdisk分区"></a>3.2 gdisk分区</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# gdisk /dev/sdc </span><br><span class="line">GPT fdisk (gdisk) version 0.8.10</span><br><span class="line"></span><br><span class="line">Partition table scan:</span><br><span class="line">  MBR: not present</span><br><span class="line">  BSD: not present</span><br><span class="line">  APM: not present</span><br><span class="line">  GPT: not present</span><br><span class="line"></span><br><span class="line">Creating new GPT entries.</span><br><span class="line"></span><br><span class="line">Command (? for help): n</span><br><span class="line">Partition number (1-128, default 1): 1</span><br><span class="line">First sector (34-6291422, default = 2048) or &#123;+-&#125;size&#123;KMGTP&#125;: </span><br><span class="line">Last sector (2048-6291422, default = 6291422) or &#123;+-&#125;size&#123;KMGTP&#125;: +500M</span><br><span class="line">Current type is &apos;Linux filesystem&apos;</span><br><span class="line">Hex code or GUID (L to show codes, Enter = 8300): L</span><br><span class="line">0700 Microsoft basic data  0c01 Microsoft reserved    2700 Windows RE          </span><br><span class="line">3000 ONIE boot             3001 ONIE config           4100 PowerPC PReP boot   </span><br><span class="line">4200 Windows LDM data      4201 Windows LDM metadata  7501 IBM GPFS            </span><br><span class="line">7f00 ChromeOS kernel       7f01 ChromeOS root         7f02 ChromeOS reserved   </span><br><span class="line">8200 Linux swap            8300 Linux filesystem      8301 Linux reserved      </span><br><span class="line">8302 Linux /home           8400 Intel Rapid Start     8e00 Linux LVM           </span><br><span class="line">a500 FreeBSD disklabel     a501 FreeBSD boot          a502 FreeBSD swap        </span><br><span class="line">a503 FreeBSD UFS           a504 FreeBSD ZFS           a505 FreeBSD Vinum/RAID  </span><br><span class="line">a580 Midnight BSD data     a581 Midnight BSD boot     a582 Midnight BSD swap   </span><br><span class="line">a583 Midnight BSD UFS      a584 Midnight BSD ZFS      a585 Midnight BSD Vinum  </span><br><span class="line">a800 Apple UFS             a901 NetBSD swap           a902 NetBSD FFS          </span><br><span class="line">a903 NetBSD LFS            a904 NetBSD concatenated   a905 NetBSD encrypted    </span><br><span class="line">a906 NetBSD RAID           ab00 Apple boot            af00 Apple HFS/HFS+      </span><br><span class="line">af01 Apple RAID            af02 Apple RAID offline    af03 Apple label         </span><br><span class="line">af04 AppleTV recovery      af05 Apple Core Storage    be00 Solaris boot        </span><br><span class="line">bf00 Solaris root          bf01 Solaris /usr &amp; Mac Z  bf02 Solaris swap        </span><br><span class="line">bf03 Solaris backup        bf04 Solaris /var          bf05 Solaris /home       </span><br><span class="line">bf06 Solaris alternate se  bf07 Solaris Reserved 1    bf08 Solaris Reserved 2  </span><br><span class="line">bf09 Solaris Reserved 3    bf0a Solaris Reserved 4    bf0b Solaris Reserved 5  </span><br><span class="line">c001 HP-UX data            c002 HP-UX service         ea00 Freedesktop $BOOT   </span><br><span class="line">eb00 Haiku BFS             ed00 Sony system partitio  ed01 Lenovo system partit</span><br><span class="line">Press the &lt;Enter&gt; key to see more codes: </span><br><span class="line">ef00 EFI System            ef01 MBR partition scheme  ef02 BIOS boot partition </span><br><span class="line">fb00 VMWare VMFS           fb01 VMWare reserved       fc00 VMWare kcore crash p</span><br><span class="line">fd00 Linux RAID            </span><br><span class="line">Hex code or GUID (L to show codes, Enter = 8300): 8200</span><br><span class="line">Changed type of partition to &apos;Linux swap&apos;</span><br><span class="line"></span><br><span class="line">Command (? for help): p</span><br><span class="line">Disk /dev/sdc: 6291456 sectors, 3.0 GiB</span><br><span class="line">Logical sector size: 512 bytes</span><br><span class="line">Disk identifier (GUID): F595A6CC-7ACB-479F-9AE7-586204B8585F</span><br><span class="line">Partition table holds up to 128 entries</span><br><span class="line">First usable sector is 34, last usable sector is 6291422</span><br><span class="line">Partitions will be aligned on 2048-sector boundaries</span><br><span class="line">Total free space is 5267389 sectors (2.5 GiB)</span><br><span class="line"></span><br><span class="line">Number  Start (sector)    End (sector)  Size       Code  Name</span><br><span class="line">   1            2048         1026047   500.0 MiB   8200  Linux swap</span><br><span class="line"></span><br><span class="line">Command (? for help): w</span><br><span class="line"></span><br><span class="line">Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING</span><br><span class="line">PARTITIONS!!</span><br><span class="line"></span><br><span class="line">Do you want to proceed? (Y/N): y</span><br><span class="line">OK; writing new GUID partition table (GPT) to /dev/sdc.</span><br><span class="line">The operation has completed successfully.</span><br><span class="line">[root@wenhs5479 ~]#</span><br><span class="line"></span><br><span class="line">检查磁盘是否是gpt格式</span><br><span class="line">[[root@wenhs5479 ~]# fdisk -l /dev/sdc</span><br><span class="line">WARNING: fdisk GPT support is currently new, and therefore in an experimental phase. Use at your own discretion.</span><br><span class="line"></span><br><span class="line">磁盘 /dev/sdc：3221 MB, 3221225472 字节，6291456 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line">磁盘标签类型：gpt</span><br><span class="line">Disk identifier: F595A6CC-7ACB-479F-9AE7-586204B8585F</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#         Start          End    Size  Type            Name</span><br><span class="line"> 1         2048      1026047    500M  Linux swap      Linux swap</span><br><span class="line"> 2      1026048      3123199      1G  Linux filesyste Linux filesystem</span><br><span class="line"> 3      3123200      5220351      1G  Linux LVM       Linux LVM</span><br><span class="line"> 4      5220352      6291422    523M  Linux filesyste Linux filesystem</span><br><span class="line">[root@wenhs5479 ~]#</span><br><span class="line"></span><br><span class="line">安装parted, 刷新内核立即生效,无需重启</span><br><span class="line">[root@wenhs5479 ~]# partprobe /dev/sdc</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"> 磁盘4-磁盘6步骤与上面类似,步骤省略,下面直接做出分好区的效果:</span><br><span class="line"> [root@wenhs5479 ~]# lsblk </span><br><span class="line">NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda               8:0    0   15G  0 disk </span><br><span class="line">├─sda1            8:1    0    1G  0 part /boot</span><br><span class="line">└─sda2            8:2    0   14G  0 part </span><br><span class="line">  ├─centos-root 253:0    0 12.5G  0 lvm  /</span><br><span class="line">  └─centos-swap 253:1    0  1.5G  0 lvm  [SWAP]</span><br><span class="line">sdb               8:16   0    3G  0 disk </span><br><span class="line">├─sdb1            8:17   0    1G  0 part </span><br><span class="line">├─sdb2            8:18   0    1K  0 part </span><br><span class="line">├─sdb5            8:21   0  400M  0 part </span><br><span class="line">├─sdb6            8:22   0  400M  0 part </span><br><span class="line">├─sdb7            8:23   0  400M  0 part </span><br><span class="line">└─sdb8            8:24   0  400M  0 part </span><br><span class="line">sdc               8:32   0    3G  0 disk </span><br><span class="line">├─sdc1            8:33   0  500M  0 part </span><br><span class="line">├─sdc2            8:34   0    1G  0 part </span><br><span class="line">├─sdc3            8:35   0    1G  0 part </span><br><span class="line">└─sdc4            8:36   0  523M  0 part </span><br><span class="line">sdd               8:48   0    3G  0 disk </span><br><span class="line">├─sdd1            8:49   0  500M  0 part </span><br><span class="line">├─sdd2            8:50   0  500M  0 part </span><br><span class="line">├─sdd3            8:51   0    1K  0 part </span><br><span class="line">├─sdd5            8:53   0  500M  0 part </span><br><span class="line">├─sdd6            8:54   0  500M  0 part </span><br><span class="line">├─sdd7            8:55   0  500M  0 part </span><br><span class="line">└─sdd8            8:56   0  567M  0 part </span><br><span class="line">sde               8:64   0    3G  0 disk </span><br><span class="line">├─sde1            8:65   0  500M  0 part </span><br><span class="line">├─sde2            8:66   0  500M  0 part </span><br><span class="line">├─sde3            8:67   0  500M  0 part </span><br><span class="line">├─sde4            8:68   0    1K  0 part </span><br><span class="line">├─sde5            8:69   0  400M  0 part </span><br><span class="line">├─sde6            8:70   0  400M  0 part </span><br><span class="line">├─sde7            8:71   0  400M  0 part </span><br><span class="line">└─sde8            8:72   0  367M  0 part </span><br><span class="line">sdf               8:80   0    5G  0 disk </span><br><span class="line">└─sdf1            8:81   0    5G  0 part </span><br><span class="line">sr0              11:0    1   10G  0 rom  /run/media/root/CentOS 7 x86_64</span><br><span class="line">[root@wenhs5479 ~]#</span><br><span class="line"></span><br><span class="line">做的用fdisk和gdisk的时候发现,选项不区分大小写,是同一个字母就行</span><br></pre></td></tr></table></figure>

<h1 id="4-磁盘格式化"><a href="#4-磁盘格式化" class="headerlink" title="4. 磁盘格式化"></a>4. 磁盘格式化</h1><p>使用<code>mkfs</code>命令格式化磁盘，创建文件系统</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">mkfs常用的选项有</span><br><span class="line">-b  //设定数据区块占用空间大小，目前支持1024、2048、4096 bytes每个块。</span><br><span class="line">-t  //用来指定什么类型的文件系统，可以是ext3，ext4, xfs</span><br><span class="line">-i  //设定inode的大小</span><br><span class="line">-N  //设定inode数量，防止Inode数量不够导致磁盘不足</span><br><span class="line">-L  //预设该分区的标签label</span><br><span class="line"></span><br><span class="line">格式化整个sdb磁盘为ext4文件系统</span><br><span class="line">[root@wenhs5479 ~]# mkfs.ext4 /dev/sde5</span><br><span class="line">mke2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">文件系统标签=</span><br><span class="line">OS type: Linux</span><br><span class="line">块大小=1024 (log=0)</span><br><span class="line">分块大小=1024 (log=0)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">102400 inodes, 409600 blocks</span><br><span class="line">20480 blocks (5.00%) reserved for the super user</span><br><span class="line">第一个数据块=1</span><br><span class="line">Maximum filesystem blocks=34078720</span><br><span class="line">50 block groups</span><br><span class="line">8192 blocks per group, 8192 fragments per group</span><br><span class="line">2048 inodes per group</span><br><span class="line">Superblock backups stored on blocks: </span><br><span class="line">	8193, 24577, 40961, 57345, 73729, 204801, 221185, 401409</span><br><span class="line"></span><br><span class="line">Allocating group tables: 完成                            </span><br><span class="line">正在写入inode表: 完成                            </span><br><span class="line">Creating journal (8192 blocks): 完成</span><br><span class="line">Writing superblocks and filesystem accounting information: 完成</span><br><span class="line"></span><br><span class="line">也可以使用-t指定方式创建ext4文件系统</span><br><span class="line">[root@wenhs5479 ~]# mkfs -t ext4 /dev/sdd1</span><br><span class="line">mke2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">文件系统标签=</span><br><span class="line">OS type: Linux</span><br><span class="line">块大小=1024 (log=0)</span><br><span class="line">分块大小=1024 (log=0)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">128016 inodes, 512000 blocks</span><br><span class="line">25600 blocks (5.00%) reserved for the super user</span><br><span class="line">第一个数据块=1</span><br><span class="line">Maximum filesystem blocks=34078720</span><br><span class="line">63 block groups</span><br><span class="line">8192 blocks per group, 8192 fragments per group</span><br><span class="line">2032 inodes per group</span><br><span class="line">Superblock backups stored on blocks: </span><br><span class="line">	8193, 24577, 40961, 57345, 73729, 204801, 221185, 401409</span><br><span class="line"></span><br><span class="line">Allocating group tables: 完成                            </span><br><span class="line">正在写入inode表: 完成                            </span><br><span class="line">Creating journal (8192 blocks): 完成</span><br><span class="line">Writing superblocks and filesystem accounting information: 完成 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">也可以格式化sdb1分区为xfs文件系统</span><br><span class="line">[root@wenhs5479 ~]# mkfs.xfs -f /dev/sdb1</span><br><span class="line">meta-data=/dev/sdb1              isize=512    agcount=4, agsize=65536 blks</span><br><span class="line">         =                       sectsz=512   attr=2, projid32bit=1</span><br><span class="line">         =                       crc=1        finobt=0, sparse=0</span><br><span class="line">data     =                       bsize=4096   blocks=262144, imaxpct=25</span><br><span class="line">         =                       sunit=0      swidth=0 blks</span><br><span class="line">naming   =version 2              bsize=4096   ascii-ci=0 ftype=1</span><br><span class="line">log      =internal log           bsize=4096   blocks=2560, version=2</span><br><span class="line">         =                       sectsz=512   sunit=0 blks, lazy-count=1</span><br><span class="line">realtime =none                   extsz=4096   blocks=0, rtextents=0</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">本实验要求的分区格式化好后,所有分区uuid:(过程和上面步骤没什么区别,省略几步,下面结果)</span><br><span class="line">[root@wenhs5479 /]# blkid</span><br><span class="line">/dev/sda1: UUID=&quot;0baabdb7-1561-475f-a00d-feea834670d2&quot; TYPE=&quot;xfs&quot; </span><br><span class="line">/dev/sda2: UUID=&quot;d9dYRR-lnKG-1AqO-cX3P-quXR-2kRw-BkM3hf&quot; TYPE=&quot;LVM2_member&quot; </span><br><span class="line">/dev/sr0: UUID=&quot;2018-11-26-14-22-58-00&quot; LABEL=&quot;CentOS 7 x86_64&quot; TYPE=&quot;iso9660&quot; PTTYPE=&quot;dos&quot; </span><br><span class="line">/dev/mapper/centos-root: UUID=&quot;cddc67f0-68fb-41a0-8c98-a565533a561c&quot; TYPE=&quot;xfs&quot; </span><br><span class="line">/dev/mapper/centos-swap: UUID=&quot;6a31f820-9e58-4c40-8078-3699c6b7ba3c&quot; TYPE=&quot;swap&quot; </span><br><span class="line">/dev/sdb1: UUID=&quot;fdd731d0-b742-49e6-928b-f97792857d70&quot; TYPE=&quot;xfs&quot; </span><br><span class="line">/dev/sdb5: UUID=&quot;8d7734d9-2a1d-4055-b451-396a69af11c8&quot; TYPE=&quot;xfs&quot; </span><br><span class="line">/dev/sdb6: UUID=&quot;fb082cf2-930a-4d68-8589-b0ba5f053f0e&quot; TYPE=&quot;xfs&quot; </span><br><span class="line">/dev/sdb7: UUID=&quot;62f98999-f107-411e-9420-6b45f0d33290&quot; TYPE=&quot;xfs&quot; </span><br><span class="line">/dev/sdb8: UUID=&quot;356460eb-76d4-4f58-9109-bcbcf034da63&quot; TYPE=&quot;xfs&quot; </span><br><span class="line">/dev/sdc1: UUID=&quot;42e4f949-54c8-44be-9b7a-d1941aca22e4&quot; TYPE=&quot;xfs&quot; PARTLABEL=&quot;Linux swap&quot; PARTUUID=&quot;3baf047e-dd0f-45d8-8c7c-5e440ab8c708&quot; </span><br><span class="line">/dev/sdc2: UUID=&quot;096205bf-5812-48bd-9249-50eff34947ab&quot; TYPE=&quot;xfs&quot; PARTLABEL=&quot;Linux filesystem&quot; PARTUUID=&quot;467f7093-fe79-4e4c-b965-9be6edbb38bb&quot; </span><br><span class="line">/dev/sdc3: UUID=&quot;542f3d7a-a7c9-4e9c-ab4a-44de311bef2c&quot; TYPE=&quot;xfs&quot; PARTLABEL=&quot;Linux LVM&quot; PARTUUID=&quot;4bfd6bf6-18b6-451c-8c77-52fc5cc0af1d&quot; </span><br><span class="line">/dev/sdc4: UUID=&quot;db704344-29bc-40c7-9f32-8ae7db01e377&quot; TYPE=&quot;xfs&quot; PARTLABEL=&quot;Linux filesystem&quot; PARTUUID=&quot;aa13f902-862b-4596-8b63-c6fe8ebf3d4e&quot; </span><br><span class="line">/dev/sdd1: UUID=&quot;90467e05-c13f-472e-8cd3-09891c31b358&quot; TYPE=&quot;ext4&quot; </span><br><span class="line">/dev/sdd2: UUID=&quot;7be8d199-a9f4-4143-9d5d-ff974b79e407&quot; TYPE=&quot;xfs&quot; </span><br><span class="line">/dev/sdd5: UUID=&quot;bdc0cea3-b01f-4c9f-99af-89196de79b9d&quot; TYPE=&quot;xfs&quot; </span><br><span class="line">/dev/sdd6: UUID=&quot;8949e094-62e7-443b-b2f0-803e7aec46db&quot; TYPE=&quot;xfs&quot; </span><br><span class="line">/dev/sdd7: UUID=&quot;19609546-019f-407b-8d00-2c24c946ab0b&quot; TYPE=&quot;xfs&quot; </span><br><span class="line">/dev/sdd8: UUID=&quot;8375-C857&quot; TYPE=&quot;vfat&quot; </span><br><span class="line">/dev/sde1: SEC_TYPE=&quot;msdos&quot; UUID=&quot;810A-0A20&quot; TYPE=&quot;vfat&quot; </span><br><span class="line">/dev/sde2: TYPE=&quot;minix&quot; </span><br><span class="line">/dev/sde3: SEC_TYPE=&quot;msdos&quot; UUID=&quot;7C60-97A1&quot; TYPE=&quot;vfat&quot; </span><br><span class="line">/dev/sde5: UUID=&quot;da19400c-0031-4760-ae55-04af2e489a5f&quot; TYPE=&quot;ext4&quot; </span><br><span class="line">/dev/sde6: UUID=&quot;d204164c-ba60-4212-9419-8f119073721f&quot; SEC_TYPE=&quot;ext2&quot; TYPE=&quot;ext3&quot; </span><br><span class="line">/dev/sde7: UUID=&quot;457da609-3d59-46c3-9931-d82e0ac67157&quot; TYPE=&quot;ext2&quot; </span><br><span class="line">/dev/sde8: UUID=&quot;556daed2-163d-4980-a17b-9ea368e3b883&quot; UUID_SUB=&quot;0f4fb522-66a1-4fb3-8db3-0a02f937ce88&quot; TYPE=&quot;btrfs&quot; </span><br><span class="line">/dev/sdf: UUID=&quot;9a7627ff-c6d4-46a3-ae4f-ea3f7cedb161&quot; TYPE=&quot;swap&quot; PTTYPE=&quot;gpt&quot; </span><br><span class="line">[root@wenhs5479 /]#</span><br></pre></td></tr></table></figure>

<h1 id="5-磁盘挂载"><a href="#5-磁盘挂载" class="headerlink" title="5. 磁盘挂载"></a>5. 磁盘挂载</h1><p>在上面的内容中讲到了磁盘的分区和格式化, 那么格式化完了后, 如何使用, 这就涉及到了挂载这块磁盘</p>
<blockquote>
<p>挂载分区前需要创建挂载点, 挂载点以目录形式出现<br> 如果往挂载点目录写入数据, 实际上会写入到该分区 挂载点建议是空目录,<br>不是也不影响挂载分区的使用，但是会隐藏原有的文件</p>
</blockquote>
<h3 id="5-1-临时挂载磁盘"><a href="#5-1-临时挂载磁盘" class="headerlink" title="5.1 临时挂载磁盘"></a>5.1 临时挂载磁盘</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">命令：mount挂载磁盘，实质为文件系统指定访问入口</span><br><span class="line">mount -t       //指定文件系统挂载分区，如ext3，ext4, xfs</span><br><span class="line">mount -a       //重新读取/etc/fstab配置文件的所有分区</span><br><span class="line">mount -o       //指定挂载参数</span><br><span class="line"></span><br><span class="line">fstab被损坏情况下,让只读文件系统可写（正常情况下不使用）</span><br><span class="line">[root@localhost ~]#mount -o rw,remount /  </span><br><span class="line"></span><br><span class="line">创建挂载目录并挂载</span><br><span class="line">[root@wenhs5479 /]# mkdir $(ls /dev/ |grep &apos;sd[b-f][1-8]&apos;)</span><br><span class="line">[root@wenhs5479 /]# ls</span><br><span class="line">bin   home   mnt   run   sdb5  sdc1  sdd1  sdd6  sde2  sde6  sys</span><br><span class="line">boot  lib    opt   sbin  sdb6  sdc2  sdd2  sdd7  sde3  sde7  tmp</span><br><span class="line">dev   lib64  proc  sdb1  sdb7  sdc3  sdd3  sdd8  sde4  sde8  usr</span><br><span class="line">etc   media  root  sdb2  sdb8  sdc4  sdd5  sde1  sde5  srv   var</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 /]# mount /dev/sdb1 /sdb1</span><br></pre></td></tr></table></figure>

<h3 id="5-2-永久挂载磁盘"><a href="#5-2-永久挂载磁盘" class="headerlink" title="5.2 永久挂载磁盘"></a>5.2 永久挂载磁盘</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">使用blkid命令获取各分区的UUID</span><br><span class="line">[root@wenhs5479 /]# blkid |grep &quot;sdb1&quot;</span><br><span class="line">/dev/sdb1: UUID=&quot;fdd731d0-b742-49e6-928b-f97792857d70&quot; TYPE=&quot;xfs&quot;</span><br><span class="line"></span><br><span class="line">使用UUID挂载磁盘sdb1分区至于db1, 临时挂载</span><br><span class="line">[root@wenhs5479 /]# mount UUID=&quot;fdd731d0-b742-49e6-928b-f97792857d70&quot; /sdb1</span><br><span class="line">[root@wenhs5479 /]# df -h</span><br><span class="line">文件系统                 容量  已用  可用 已用% 挂载点</span><br><span class="line">/dev/mapper/centos-root   13G  5.8G  6.8G   46% /</span><br><span class="line">devtmpfs                 1.9G     0  1.9G    0% /dev</span><br><span class="line">tmpfs                    1.9G     0  1.9G    0% /dev/shm</span><br><span class="line">tmpfs                    1.9G   13M  1.9G    1% /run</span><br><span class="line">tmpfs                    1.9G     0  1.9G    0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1               1014M  181M  834M   18% /boot</span><br><span class="line">tmpfs                    378M  8.0K  378M    1% /run/user/42</span><br><span class="line">tmpfs                    378M   24K  378M    1% /run/user/0</span><br><span class="line">/dev/sr0                  11G   11G     0  100% /run/media/root/CentOS 7 x86_64</span><br><span class="line">/dev/sdb1               1014M   33M  982M    4% /sdb1</span><br><span class="line">[root@wenhs5479 /]#</span><br><span class="line"></span><br><span class="line">也可以把下面这行写到/etc/fstab中，永久挂载, 开机自动挂载</span><br><span class="line">[root@localhost ~]# tail -1 /etc/fstab    </span><br><span class="line">UUID=e271b5b2-b1ba-4b18-bde5-66e394fb02d9 /db1 xfs  defaults 0  0</span><br><span class="line"></span><br><span class="line">加载fstab配置文件, 同时检测语法是否有错误</span><br><span class="line">[root@localhost ~]# mount –a</span><br></pre></td></tr></table></figure>

<p><code>fstab</code>配置文件介绍：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 /]# vim /etc/fstab </span><br><span class="line"></span><br><span class="line">分区标识(UUID或设备名)                    挂载点 文件类型    挂载参数    不检查 不备份</span><br><span class="line">UUID=e271b5b2-b1ba-4b18-bde5-66e394fb02d9 /db1     xfs     defaults    0     0</span><br><span class="line"></span><br><span class="line">挂载参数, 可写fstab配置文件, 也可以mount时使用-o参数指定</span><br><span class="line">参数              参数意义                               系统默认值</span><br><span class="line">async           系统每隔一段时间把内存数据写入磁盘中，</span><br><span class="line">sync            实时同步内存和磁盘中数据；</span><br><span class="line">suid，nosuid     允许/不允许分区有suid属性                suid</span><br><span class="line">rw，ro           可以指定文件系统是只读(ro)或可写(rw)       rw</span><br><span class="line">exec，noexec     允许/不允许可执行文件执行，不要挂载根分区    exec</span><br><span class="line">user，nouser     允许/不允许root外的其他用户挂载分区        nouser</span><br><span class="line">auto，noauto     开机自动挂载/不自动挂载                    auto</span><br><span class="line">default         默认文件系统挂载设置 rw, suid, dev, exec, auto, nouser, async</span><br><span class="line"></span><br><span class="line">加载所有配置</span><br><span class="line">[root@localhost ~]# mount -a</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">fstab文件添加内容如下:</span><br><span class="line">UUID=fdd731d0-b742-49e6-928b-f97792857d70	/sdb1	xfs	defaults	0	0</span><br><span class="line">UUID=8d7734d9-2a1d-4055-b451-396a69af11c8	/sdb5	xfs	defaults	0	0</span><br><span class="line">UUID=fb082cf2-930a-4d68-8589-b0ba5f053f0e	/sdb6	xfs	defaults	0	0</span><br><span class="line">UUID=62f98999-f107-411e-9420-6b45f0d33290	/sdb7	xfs	defaults	0	0</span><br><span class="line">UUID=356460eb-76d4-4f58-9109-bcbcf034da63	/sdb8	xfs	defaults	0	0</span><br><span class="line">UUID=42e4f949-54c8-44be-9b7a-d1941aca22e4	/sdc1	xfs	defaults	0	0</span><br><span class="line">UUID=096205bf-5812-48bd-9249-50eff34947ab	/sdc2	xfs	defaults	0	0</span><br><span class="line">UUID=542f3d7a-a7c9-4e9c-ab4a-44de311bef2c	/sdc3	xfs	defaults	0	0</span><br><span class="line">UUID=db704344-29bc-40c7-9f32-8ae7db01e377	/sdc4	xfs	defaults	0	0</span><br><span class="line">UUID=90467e05-c13f-472e-8cd3-09891c31b358	/sdd1	ext4	defaults	0	0</span><br><span class="line">UUID=7be8d199-a9f4-4143-9d5d-ff974b79e407	/sdd2	xfs	defaults	0	0</span><br><span class="line">UUID=bdc0cea3-b01f-4c9f-99af-89196de79b9d	/sdd5	xfs	defaults	0	0</span><br><span class="line">UUID=8949e094-62e7-443b-b2f0-803e7aec46db	/sdd6	xfs	defaults	0	0</span><br><span class="line">UUID=19609546-019f-407b-8d00-2c24c946ab0b	sdd7	xfs	defaults	0	0</span><br><span class="line">UUID=8375-C857	/sdd8	vfat	defaults	0	0</span><br><span class="line">UUID=810A-0A20	/sde1	vfat	defaults	0	0</span><br><span class="line">UUID=7C60-97A1	/sde3	vfat	defaults	0	0</span><br><span class="line">UUID=da19400c-0031-4760-ae55-04af2e489a5f	/sde5	ext4	defaults	0	0</span><br><span class="line">UUID=d204164c-ba60-4212-9419-8f119073721f	/sde6	ext3	defaults	0	0</span><br><span class="line">UUID=457da609-3d59-46c3-9931-d82e0ac67157	/sde7	ext2	defaults	0	0</span><br><span class="line">UUID=556daed2-163d-4980-a17b-9ea368e3b883	/sde8	btrfs	defaults	0	0</span><br><span class="line">UUID=9a7627ff-c6d4-46a3-ae4f-ea3f7cedb161	swap	swap	defaults	0	0</span><br><span class="line"></span><br><span class="line">挂载后:</span><br><span class="line">[root@wenhs5479 /]# df -Th</span><br><span class="line">文件系统                类型      容量  已用  可用 已用% 挂载点</span><br><span class="line">/dev/mapper/centos-root xfs        13G  5.8G  6.8G   46% /</span><br><span class="line">devtmpfs                devtmpfs  1.9G     0  1.9G    0% /dev</span><br><span class="line">tmpfs                   tmpfs     1.9G     0  1.9G    0% /dev/shm</span><br><span class="line">tmpfs                   tmpfs     1.9G   13M  1.9G    1% /run</span><br><span class="line">tmpfs                   tmpfs     1.9G     0  1.9G    0% /sys/fs/cgroup</span><br><span class="line">/dev/sda1               xfs      1014M  181M  834M   18% /boot</span><br><span class="line">tmpfs                   tmpfs     378M  8.0K  378M    1% /run/user/42</span><br><span class="line">tmpfs                   tmpfs     378M   24K  378M    1% /run/user/0</span><br><span class="line">/dev/sr0                iso9660    11G   11G     0  100% /run/media/root/CentOS 7 x86_64</span><br><span class="line">/dev/sdb1               xfs      1014M   33M  982M    4% /sdb1</span><br><span class="line">/dev/sdb5               xfs       397M   21M  377M    6% /sdb5</span><br><span class="line">/dev/sdb6               xfs       397M   21M  377M    6% /sdb6</span><br><span class="line">/dev/sdb7               xfs       397M   21M  377M    6% /sdb7</span><br><span class="line">/dev/sdb8               xfs       397M   21M  377M    6% /sdb8</span><br><span class="line">/dev/sdc1               xfs       497M   26M  472M    6% /sdc1</span><br><span class="line">/dev/sdc2               xfs      1014M   33M  982M    4% /sdc2</span><br><span class="line">/dev/sdc3               xfs      1014M   33M  982M    4% /sdc3</span><br><span class="line">/dev/sdc4               xfs       520M   27M  494M    6% /sdc4</span><br><span class="line">/dev/sdd1               ext4      477M  2.3M  445M    1% /sdd1</span><br><span class="line">/dev/sdd2               xfs       497M   26M  472M    6% /sdd2</span><br><span class="line">/dev/sdd5               xfs       497M   26M  472M    6% /sdd5</span><br><span class="line">/dev/sdd6               xfs       497M   26M  472M    6% /sdd6</span><br><span class="line">/dev/sdd7               xfs       497M   26M  472M    6% /sdd7</span><br><span class="line">/dev/sdd8               vfat      566M  4.0K  566M    1% /sdd8</span><br><span class="line">/dev/sde1               vfat      500M     0  500M    0% /sde1</span><br><span class="line">/dev/sde3               vfat      500M     0  500M    0% /sde3</span><br><span class="line">/dev/sde5               ext4      380M  2.3M  354M    1% /sde5</span><br><span class="line">/dev/sde6               ext3      380M  2.3M  358M    1% /sde6</span><br><span class="line">/dev/sde7               ext2      388M  2.3M  366M    1% /sde7</span><br><span class="line">/dev/sde8               btrfs     367M   17M  286M    6% /sde8</span><br></pre></td></tr></table></figure>

<h3 id="5-3-卸载挂载磁盘"><a href="#5-3-卸载挂载磁盘" class="headerlink" title="5.3 卸载挂载磁盘"></a>5.3 卸载挂载磁盘</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">umount -lf  //强制卸载挂载</span><br><span class="line"></span><br><span class="line">使用站点目录卸载</span><br><span class="line">[root@wenhs5479 /]# umount /sdb1</span><br><span class="line">//使用设备名卸载/dev/sdb1</span><br><span class="line">[root@wenhs5479 /]# umount /dev/sdc1</span><br><span class="line"></span><br><span class="line">umount不能卸载的情况</span><br><span class="line">[root@wenhs5479 sdd6]# umount /sdd6</span><br><span class="line">umount: /sdd6：目标忙。</span><br><span class="line">        (有些情况下通过 lsof(8) 或 fuser(1) 可以</span><br><span class="line">         找到有关使用该设备的进程的有用信息)</span><br><span class="line">[root@wenhs5479 sdd6]#</span><br><span class="line">如上情况解决办法有两种, 切换至其他目录 或使用&apos;-l&apos;选项强制卸载    </span><br><span class="line">[root@wenhs5479 sdd6]# umount -l /sdd6</span><br></pre></td></tr></table></figure>

<h1 id="6-交换分区SWAP"><a href="#6-交换分区SWAP" class="headerlink" title="6. 交换分区SWAP"></a>6. 交换分区SWAP</h1><p>交换分区SWAP就是LINUX下的虚拟内存分区,它的作用是在物理内存使用完之后,将磁盘空间(也就是SWAP分区)虚拟成内存来使用。</p>
<p>交换分区一般指定虚拟内存的大小为实际内存的1.5~2倍。如果实际内存超过8GB，可以直接划分16GB给虚拟内存即可，如果虚拟内存不够用的情况，须增加一个虚拟磁盘，由于不能给原有的磁盘重新分区，所以可以选择新建。</p>
<h3 id="6-1-创建swapfile"><a href="#6-1-创建swapfile" class="headerlink" title="6.1 创建swapfile"></a>6.1 创建swapfile</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# dd if=/dev/zero of=/root/swap1 bs=1M count=1024</span><br><span class="line">记录了1024+0 的读入</span><br><span class="line">记录了1024+0 的写出</span><br><span class="line">1073741824字节(1.1 GB)已复制，10.765 秒，99.7 MB/秒</span><br><span class="line"></span><br><span class="line">if：指定源  一般写/dev/zero</span><br><span class="line">of：指定目标</span><br><span class="line">bs：定义块大小</span><br><span class="line">count：数量</span><br></pre></td></tr></table></figure>

<h3 id="6-2-格式化swap分区"><a href="#6-2-格式化swap分区" class="headerlink" title="6.2 格式化swap分区"></a>6.2 格式化swap分区</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# mkswap -f /root/swap1 </span><br><span class="line">正在设置交换空间版本 1，大小 = 1048572 KiB</span><br><span class="line">无标签，UUID=ba5026d4-bf6b-4070-ac1f-e0dd74bed49b</span><br></pre></td></tr></table></figure>

<h3 id="6-3-检测当前swap分区情况"><a href="#6-3-检测当前swap分区情况" class="headerlink" title="6.3 检测当前swap分区情况"></a>6.3 检测当前swap分区情况</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# free -mh</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           3.7G        863M        284M        169M        2.6G        2.3G</span><br><span class="line">Swap:          6.5G          0B        6.5G				#系统默认1.5Gswap分区,sdf盘5G的swap</span><br></pre></td></tr></table></figure>

<h3 id="6-4-开启新建的SWAP分区"><a href="#6-4-开启新建的SWAP分区" class="headerlink" title="6.4 开启新建的SWAP分区"></a>6.4 开启新建的SWAP分区</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# swapon /root/swap1</span><br><span class="line">swapon: /root/swap1：不安全的权限 0644，建议使用 0600。</span><br><span class="line">[root@wenhs5479 ~]# free -mh</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           3.7G        864M        283M        169M        2.6G        2.3G</span><br><span class="line">Swap:          7.5G          0B        7.5G			#分区多出来1G</span><br><span class="line">[root@wenhs5479 ~]#//swap</span><br></pre></td></tr></table></figure>

<h3 id="6-5-关闭新建的swap分区"><a href="#6-5-关闭新建的swap分区" class="headerlink" title="6.5 关闭新建的swap分区"></a>6.5 关闭新建的swap分区</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# swapoff /root/swap1 </span><br><span class="line">[root@wenhs5479 ~]# swapoff /dev/sdf</span><br><span class="line">[root@wenhs5479 ~]# free -mh</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           3.7G        860M        286M        170M        2.6G        2.3G</span><br><span class="line">Swap:          1.5G          0B        1.5G			#还原到没有增加虚拟磁盘</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">创建swap分区并且持久化使用</span><br><span class="line"></span><br><span class="line">例子： 给系统新增加一个交换分区(swap)</span><br><span class="line"></span><br><span class="line">考试题目：一般是要求新建一个分区，并且把分区作为swap分区使用</span><br><span class="line"></span><br><span class="line">查看内存和交换分区的使用情况</span><br><span class="line"> [root@wenhs5479 ~]# free -mh</span><br><span class="line">              total        used        free      shared  buff/cache   available</span><br><span class="line">Mem:           3.7G        859M        287M        170M        2.6G        2.3G</span><br><span class="line">Swap:          1.5G          0B        1.5G&lt;--- 只有1.5G的交换分区</span><br><span class="line"></span><br><span class="line"> swapon -s  也能用该命令查看，只是默认也是没有交换分区所有没有输出</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# fdisk -l /dev/sdf</span><br><span class="line"></span><br><span class="line">磁盘 /dev/sdf：5368 MB, 5368709120 字节，10485760 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line">磁盘标签类型：dos</span><br><span class="line">磁盘标识符：0x00000000</span><br><span class="line"></span><br><span class="line">   设备 Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdf1               1    10485759     5242879+  ee  GPT&lt;---准备把该分区作为交换分区</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1、新建一个分区，并且把分区类型更改为82 </span><br><span class="line">    新分区我们在上面的练习已经完成了，所以本例子不用分区，而是需要修改该分区的类型</span><br><span class="line"></span><br><span class="line"> [root@wenhs5479 ~]# fdisk /dev/sdf</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：l  列出所有支持的分区类型对应的id</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：T</span><br><span class="line">已选择分区 1</span><br><span class="line">Hex 代码(输入 L 列出所有代码)：82</span><br><span class="line">已将分区“GPT”的类型更改为“Linux swap / Solaris”</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：P</span><br><span class="line"></span><br><span class="line">磁盘 /dev/sdf：5368 MB, 5368709120 字节，10485760 个扇区</span><br><span class="line">Units = 扇区 of 1 * 512 = 512 bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 / 512 字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 / 512 字节</span><br><span class="line">磁盘标签类型：dos</span><br><span class="line">磁盘标识符：0x00000000</span><br><span class="line"></span><br><span class="line">   设备 Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdf1               1    10485759     5242879+  82  Linux swap / Solaris&lt;---修改成功</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：w</span><br><span class="line"></span><br><span class="line">强烈建议： 对分区做了修改后都刷新一下</span><br><span class="line">[root@wenhs5479 ~]# partprobe /dev/sdf</span><br><span class="line"></span><br><span class="line">2、把sdf1格式化为交换分区</span><br><span class="line">[root@wenhs5479 ~]# mkswap /dev/sdf1</span><br><span class="line">正在设置交换空间版本 1，大小 = 5242872 KiB</span><br><span class="line">无标签，UUID=cd6ce338-b8a5-4c3f-b9c2-be98b8606bee</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3、启动交换分区</span><br><span class="line"> swapon /dev/sdf1  或者  # swanon -a  启动所有交换分区</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">查看</span><br><span class="line">[root@wenhs5479 ~]# swapon -s</span><br><span class="line">文件名				类型		大小	已用	权限</span><br><span class="line">/dev/dm-1                              	partition	1572860	0	-2</span><br><span class="line">/dev/sdf1                              	partition	5242872	0	-3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4、持久化保存交换分区的使用</span><br><span class="line">[root@wenhs5479 ~]# blkid /dev/sdf1</span><br><span class="line">/dev/sdf1: UUID=&quot;cd6ce338-b8a5-4c3f-b9c2-be98b8606bee&quot; TYPE=&quot;swap&quot; </span><br><span class="line">[root@wenhs5479 ~]# echo &apos;UUID=cd6ce338-b8a5-4c3f-b9c2-be98b8606bee       swap    swap    defaults        0       0&apos; &gt;&gt;/etc/fstab </span><br><span class="line">[root@wenhs5479 ~]# tail -1 /etc/fstab </span><br><span class="line">UUID=cd6ce338-b8a5-4c3f-b9c2-be98b8606bee       swap    swap    defaults        0       0</span><br></pre></td></tr></table></figure>

<h1 id="7-生产磁盘故障案例"><a href="#7-生产磁盘故障案例" class="headerlink" title="7. 生产磁盘故障案例"></a>7. 生产磁盘故障案例</h1><p>Inode被占满，导致磁盘有可用的剩余空间也无法继续使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# dd if=/dev/zero of=/root/disk bs=1k count=2048</span><br><span class="line">记录了2048+0 的读入</span><br><span class="line">记录了2048+0 的写出</span><br><span class="line">2097152字节(2.1 MB)已复制，0.0237309 秒，88.4 MB/秒</span><br><span class="line">[root@wenhs5479 ~]# mkfs.ext4 -i 1024 /root/disk</span><br><span class="line">mke2fs 1.42.9 (28-Dec-2013)</span><br><span class="line">/root/disk is not a block special device.</span><br><span class="line">无论如何也要继续? (y,n) y</span><br><span class="line">Discarding device blocks: 完成                            </span><br><span class="line">文件系统标签=</span><br><span class="line">OS type: Linux</span><br><span class="line">块大小=1024 (log=0)</span><br><span class="line">分块大小=1024 (log=0)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">2048 inodes, 2048 blocks</span><br><span class="line">102 blocks (4.98%) reserved for the super user</span><br><span class="line">第一个数据块=1</span><br><span class="line">Maximum filesystem blocks=2097152</span><br><span class="line">1 block group</span><br><span class="line">8192 blocks per group, 8192 fragments per group</span><br><span class="line">2048 inodes per group</span><br><span class="line"></span><br><span class="line">Allocating group tables: 完成                            </span><br><span class="line">正在写入inode表: 完成                            </span><br><span class="line">Creating journal (1024 blocks): 完成</span><br><span class="line">Writing superblocks and filesystem accounting information: 完成</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# mkdir /disk</span><br><span class="line">[root@wenhs5479 ~]# mount -t ext4 -o loop /root/disk /disk/</span><br><span class="line"></span><br><span class="line">inode被占满</span><br><span class="line">[root@wenhs5479 disk]# touch &#123;1..20000&#125;</span><br><span class="line">touch: cannot touch `19997&apos;: No space left on device</span><br><span class="line">touch: cannot touch `19998&apos;: No space left on device</span><br><span class="line">touch: cannot touch `19999&apos;: No space left on device</span><br><span class="line">touch: cannot touch `20000&apos;: No space left on device</span><br><span class="line"></span><br><span class="line">inode被占满，剩余block也是无法继续使用</span><br><span class="line">[root@wenhs5479 disk]# df -i|grep disk</span><br><span class="line">/dev/loop0                 2048    2048       0     100% /disk</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 disk]# df -h|grep disk</span><br><span class="line">/dev/loop0               763K   52K  569K    9% /disk</span><br></pre></td></tr></table></figure>

<p>Block空间即将被占满, 但删除大文件也没有释放空间</p>
<blockquote>
<p>假设现在线上正在运行Nginx服务, Nginx产生的日志已经达到了20个G, 磁盘眼看就看沾满了, 请问不重启Nginx的方式如何处理</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# dd if=/dev/zero of=/root/access.log bs=1M count=2048 </span><br><span class="line">记录了2048+0 的读入</span><br><span class="line">记录了2048+0 的写出</span><br><span class="line">2147483648字节(2.1 GB)已复制，8.59438 秒，250 MB/秒</span><br><span class="line">[root@wenhs5479 ~]# df -h |grep centos-root</span><br><span class="line">/dev/mapper/centos-root   13G   11G  1.8G   87% /</span><br><span class="line">[root@wenhs5479 ~]# rm -f access.log </span><br><span class="line">[root@wenhs5479 ~]# ls</span><br><span class="line">anaconda-ks.cfg  initial-setup-ks.cfg  team.conf  模板  图片  下载  桌面</span><br><span class="line">disk             swap1                 公共       视频  文档  音乐</span><br><span class="line">[root@wenhs5479 ~]# df -h |grep centos-root</span><br><span class="line">/dev/mapper/centos-root   13G   11G  1.8G   87% /</span><br><span class="line">[root@wenhs5479 ~]# &gt;access.log </span><br><span class="line">[root@wenhs5479 ~]# df -h |grep centos-root</span><br><span class="line">/dev/mapper/centos-root   13G  8.8G  3.8G   70% /</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">是会删除文件, 但Nginx持续占用着文件, 所以空间并不会被释放</span><br><span class="line">rm -f access.log</span><br><span class="line"></span><br><span class="line">正确做法如下, 清空该文件即可释放文件内容</span><br><span class="line">&gt; access.log</span><br></pre></td></tr></table></figure>


          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    
	
	  <div>
        
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://aiwhs.github.io/2018/09/15/高可用网络配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="itw">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="itw">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/09/15/高可用网络配置/" class="post-title-link" itemprop="url">高可用网络配置</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-09-15 08:15:57" itemprop="dateCreated datePublished" datetime="2018-09-15T08:15:57+08:00">2018-09-15</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-12 15:22:32" itemprop="dateModified" datetime="2019-07-12T15:22:32+08:00">2019-07-12</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux运维/" itemprop="url" rel="index"><span itemprop="name">Linux运维</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h3 id="1-添加两块网卡，配置bonding"><a href="#1-添加两块网卡，配置bonding" class="headerlink" title="1.添加两块网卡，配置bonding"></a>1.添加两块网卡，配置bonding</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nmcli connection add type bond mode balance-rr con-name bond0 ifname bond0 ipv4.method manual ipv4.addresses 192.168.161.128/24 ipv4.gateway 192.168.161.1 ipv4.dns 192.168.161.1</span><br><span class="line"></span><br><span class="line">nmcli connection add type bond-slave con-name bond-slave0 ifname ens34 master bond0</span><br><span class="line"></span><br><span class="line">nmcli connection add type bond-slave con-name bond-slave1 ifname ens35 master bond0</span><br></pre></td></tr></table></figure>

<p><img src="../../img/bonging.jpg" alt="bonding"></p>
<h3 id="2-清除bonding配置，并配置team，配置成主备模式，并模拟主备故障"><a href="#2-清除bonding配置，并配置team，配置成主备模式，并模拟主备故障" class="headerlink" title="2.清除bonding配置，并配置team，配置成主备模式，并模拟主备故障"></a>2.清除bonding配置，并配置team，配置成主备模式，并模拟主备故障</h3><h5 id="清除bonding"><a href="#清除bonding" class="headerlink" title="清除bonding"></a>清除bonding</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nmcli device delete bond0</span><br><span class="line">rm -rf /etc/sysconfig/network-scripts/ifcfg-bond*</span><br></pre></td></tr></table></figure>

<h5 id="配置team成主备模式"><a href="#配置team成主备模式" class="headerlink" title="配置team成主备模式"></a>配置team成主备模式</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nmcli connection add type team con-name team0 ifname team0 config &apos;&#123;&quot;runner&quot;:&#123;&quot;name&quot;:&quot;activebackup&quot;&#125;&#125;&apos; ipv4.addresses 172.16.12.250/24 ipv4.gateway 172.16.12.2 ipv4.dns 172.16.12.2 ipv4.method manual</span><br><span class="line"></span><br><span class="line">nmcli connection add type team-slave con-name team0-port1 ifname ens34 master team0</span><br><span class="line"></span><br><span class="line">nmcli connection add type team-slave con-name team0-port2 ifname ens35 master team0</span><br><span class="line"></span><br><span class="line">systemctl restart network</span><br></pre></td></tr></table></figure>

<p><img src="../../img/bond2.jpg" alt="2"></p>
<h5 id="模拟主备故障"><a href="#模拟主备故障" class="headerlink" title="模拟主备故障"></a>模拟主备故障</h5><h5 id="无故障时-其中一个网卡工作-另外一个网卡不工作"><a href="#无故障时-其中一个网卡工作-另外一个网卡不工作" class="headerlink" title="无故障时:其中一个网卡工作,另外一个网卡不工作"></a>无故障时:其中一个网卡工作,另外一个网卡不工作</h5><p><img src="../../img/bond3.jpg" alt="bond3"></p>
<h5 id="模拟故障-虚拟机断开工作的网卡-发现另外一个网卡开始工作"><a href="#模拟故障-虚拟机断开工作的网卡-发现另外一个网卡开始工作" class="headerlink" title="模拟故障:虚拟机断开工作的网卡,发现另外一个网卡开始工作"></a>模拟故障:虚拟机断开工作的网卡,发现另外一个网卡开始工作</h5><p><img src="../../img/bond4.jpg" alt="bond4"></p>
<h5 id="故障解除-虚拟机重新连接上所用网卡-发现2个都工作-但是一个接收-一个发送"><a href="#故障解除-虚拟机重新连接上所用网卡-发现2个都工作-但是一个接收-一个发送" class="headerlink" title="故障解除:虚拟机重新连接上所用网卡,发现2个都工作,但是一个接收,一个发送"></a>故障解除:虚拟机重新连接上所用网卡,发现2个都工作,但是一个接收,一个发送</h5><p><img src="../../img/bond5.jpg" alt="bond5"></p>
<h3 id="3-使用ip和ifconfig命令配置ip地址（设置多个ip地址）"><a href="#3-使用ip和ifconfig命令配置ip地址（设置多个ip地址）" class="headerlink" title="3.使用ip和ifconfig命令配置ip地址（设置多个ip地址）"></a>3.使用ip和ifconfig命令配置ip地址（设置多个ip地址）</h3><h5 id="IP-发现不加掩码默认为32位"><a href="#IP-发现不加掩码默认为32位" class="headerlink" title="IP:发现不加掩码默认为32位"></a>IP:发现不加掩码默认为32位</h5><p><img src="../../img/bond6.jpg" alt="bond6"></p>
<h5 id="ifconfig-发现不加掩码-默认掩码为24位"><a href="#ifconfig-发现不加掩码-默认掩码为24位" class="headerlink" title="ifconfig:发现不加掩码,默认掩码为24位"></a>ifconfig:发现不加掩码,默认掩码为24位</h5><p><img src="../../img/bond7.jpg" alt="bond7"></p>
<h3 id="4-树状显示系统进程树，找到NetworkManaer进程的位置"><a href="#4-树状显示系统进程树，找到NetworkManaer进程的位置" class="headerlink" title="4.树状显示系统进程树，找到NetworkManaer进程的位置"></a>4.树状显示系统进程树，找到NetworkManaer进程的位置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pstree |grep NetworkManager</span><br></pre></td></tr></table></figure>

<p><img src="../../img/bond8.jpg" alt="bond8"></p>
<h3 id="5-列出所有和网络相关的服务"><a href="#5-列出所有和网络相关的服务" class="headerlink" title="5.列出所有和网络相关的服务"></a>5.列出所有和网络相关的服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl list-unit-files|grep network</span><br></pre></td></tr></table></figure>

<p><img src="../../img/bond9.jpg" alt="bond9"></p>
<p><img src="../../img/bond10.jpg" alt="bond10"></p>
<h3 id="6-使用tcpdump抓取icmp流量，并关闭缓冲区"><a href="#6-使用tcpdump抓取icmp流量，并关闭缓冲区" class="headerlink" title="6.使用tcpdump抓取icmp流量，并关闭缓冲区"></a>6.使用tcpdump抓取icmp流量，并关闭缓冲区</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump icmp -i ens33 -b</span><br></pre></td></tr></table></figure>

<p><img src="../../img/bond11.jpg" alt="bond11"></p>
<h3 id="7-ping-宿主机，发送30个包，每个包设置1000"><a href="#7-ping-宿主机，发送30个包，每个包设置1000" class="headerlink" title="7.ping 宿主机，发送30个包，每个包设置1000"></a>7.ping 宿主机，发送30个包，每个包设置1000</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping -c30 -s1000 192.168.161.206</span><br></pre></td></tr></table></figure>

<p><img src="../../img/bond12.jpg" alt="bond12"></p>
<h3 id="8-查看所有udp网络套接字"><a href="#8-查看所有udp网络套接字" class="headerlink" title="8.查看所有udp网络套接字"></a>8.查看所有udp网络套接字</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ss -ua</span><br><span class="line">或</span><br><span class="line">netstat -ua</span><br></pre></td></tr></table></figure>

<p><img src="../../img/bond13.jpg" alt="bond13"><br><img src="../../img/bond13b.jpg" alt="bond13b"></p>
<h3 id="9-查看所有tcp-udp套接字，并显示原端口，不解析端口名字"><a href="#9-查看所有tcp-udp套接字，并显示原端口，不解析端口名字" class="headerlink" title="9.查看所有tcp/udp套接字，并显示原端口，不解析端口名字"></a>9.查看所有tcp/udp套接字，并显示原端口，不解析端口名字</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss -tuan</span><br></pre></td></tr></table></figure>

<p><img src="../../img/bond14.jpg" alt="bond14"></p>
<h3 id="10-查看所有tcp-udp网络套接字，并解析ip地址。"><a href="#10-查看所有tcp-udp网络套接字，并解析ip地址。" class="headerlink" title="10.查看所有tcp/udp网络套接字，并解析ip地址。"></a>10.查看所有tcp/udp网络套接字，并解析ip地址。</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss -tua</span><br></pre></td></tr></table></figure>

<p><img src="../../img/bond15.jpg" alt="bond15"></p>
<h3 id="11-查看宿主机的所有arp列表"><a href="#11-查看宿主机的所有arp列表" class="headerlink" title="11.查看宿主机的所有arp列表"></a>11.查看宿主机的所有arp列表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arp</span><br></pre></td></tr></table></figure>

<p><img src="../../img/bond16.jpg" alt="bond16"></p>
<h3 id="12-关闭lo网卡"><a href="#12-关闭lo网卡" class="headerlink" title="12.关闭lo网卡"></a>12.关闭lo网卡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig lo down</span><br></pre></td></tr></table></figure>

<h3 id="13-开启lo网卡"><a href="#13-开启lo网卡" class="headerlink" title="13.开启lo网卡"></a>13.开启lo网卡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ifup lo</span><br><span class="line">或</span><br><span class="line">ifconfig lo up</span><br></pre></td></tr></table></figure>

<h3 id="14-清空lo网卡上所有ip地址"><a href="#14-清空lo网卡上所有ip地址" class="headerlink" title="14.清空lo网卡上所有ip地址"></a>14.清空lo网卡上所有ip地址</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip address flush dev lo</span><br></pre></td></tr></table></figure>

<h3 id="15-修改一个新添加网卡的mac地址"><a href="#15-修改一个新添加网卡的mac地址" class="headerlink" title="15.修改一个新添加网卡的mac地址"></a>15.修改一个新添加网卡的mac地址</h3><p>a,用虚拟机修改</p>
<p><img src="../../img/bond17.jpg" alt="bond17"><br><img src="../../img/bond18.jpg" alt="bond18"></p>
<p>b,用命令修改：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ifconfig  ens34 hw  ether   &apos;00:0c:29:4d:6a:51&apos;</span><br><span class="line">或者</span><br><span class="line">ip link set dev ens34  address  &apos;00:0c:29:4d:6a:47&apos;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    
	
	  <div>
        
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://aiwhs.github.io/2018/09/09/网络进阶管理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="itw">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="itw">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/09/09/网络进阶管理/" class="post-title-link" itemprop="url">网络进阶管理</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-09-09 08:15:57" itemprop="dateCreated datePublished" datetime="2018-09-09T08:15:57+08:00">2018-09-09</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-10 15:35:53" itemprop="dateModified" datetime="2019-07-10T15:35:53+08:00">2019-07-10</time>
              </span>
            
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Linux运维/" itemprop="url" rel="index"><span itemprop="name">Linux运维</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <a id="more"></a>

<h1 id="1-链路聚合"><a href="#1-链路聚合" class="headerlink" title="1.链路聚合"></a>1.链路聚合</h1><p>网卡的链路聚合就是将多块网卡连接起来，当一块网卡损坏，网络依旧可以正常运行，可以有效的防止因为网卡损坏带来的损失，同时也可以提高网络访问速度。</p>
<p><strong>网卡的链路聚合方式：</strong></p>
<ul>
<li>bond：最多可以添加两块网卡</li>
<li>team：最多可以添加八块网卡</li>
</ul>
<p><strong>bond的常用的2种模式：</strong></p>
<ul>
<li>bond0(balance-rr)<ul>
<li><input disabled type="checkbox"> bond0用于负载轮询（2个网单独都是100MB，聚合为1个网络传输带宽为200MB）</li>
</ul>
</li>
<li>bond1(active-backup)<ul>
<li><input disabled type="checkbox"> bond1用于高可用，其中一条线若断线，其他线路将会自动备援</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">                        --&gt; eth0  ----\</span><br><span class="line">app  --发送数据到--&gt; bond0          &lt;---&gt; switch </span><br><span class="line">                        --&gt; eth1  ----/</span><br></pre></td></tr></table></figure>

<h1 id="2-桥接网络"><a href="#2-桥接网络" class="headerlink" title="2.桥接网络"></a>2.桥接网络</h1><p>桥接网络也即网桥，可基于MAC地址在网络间转发流量。网桥识别哪些主机连接到每个网络，构建MAC地址表，然后根据该表做出包转发决策。</p>
<p>软件网桥的最常见应用是在虚拟化应用程序中，用于在一个或多个虚拟NIC中共享一个硬件网卡。</p>
<h1 id="3-链路聚合配置"><a href="#3-链路聚合配置" class="headerlink" title="3.链路聚合配置"></a>3.链路聚合配置</h1><h2 id="3-1-Centos7-RHEL7配置bond聚合链路"><a href="#3-1-Centos7-RHEL7配置bond聚合链路" class="headerlink" title="3.1 Centos7 / RHEL7配置bond聚合链路"></a>3.1 Centos7 / RHEL7配置bond聚合链路</h2><h3 id="3-1-1-Centos7-RHEL7配置bond0"><a href="#3-1-1-Centos7-RHEL7配置bond0" class="headerlink" title="3.1.1 Centos7 / RHEL7配置bond0"></a>3.1.1 Centos7 / RHEL7配置bond0</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 network-scripts]# nmcli device </span><br><span class="line">DEVICE      TYPE      STATE   CONNECTION </span><br><span class="line">eth1        ethernet  连接的  eth1       </span><br><span class="line">virbr0      bridge    连接的  virbr0     </span><br><span class="line">eth0        ethernet  不可用  --         </span><br><span class="line">lo          loopback  未托管  --         </span><br><span class="line">virbr0-nic  tun       未托管  --</span><br><span class="line"></span><br><span class="line">创建bond0, 模式为balance-rr</span><br><span class="line">[root@wenhs5479 ~]# nmcli connection add type bond mode balance-rr con-name bond0 ifname bond0 ipv4.method manual ipv4.addresses 192.168.131.103/24 ipv4.gateway 192.168.131.1 ipv4.dns 192.168.131.1</span><br><span class="line">连接“bond0”(e3ff9b6e-4343-4733-a3ff-32c0c623589f) 已成功添加。</span><br><span class="line">[root@wenhs5479 ~]#</span><br><span class="line"></span><br><span class="line">添加物理网卡连接至bond0</span><br><span class="line">[root@wenhs5479 ~]# nmcli connection add type bond-slave con-name bond-slave0 ifname eth0 master bond0 </span><br><span class="line">连接“bond-slave0”(4afe392d-2646-4125-a61d-4c52a7ea1056) 已成功添加。</span><br><span class="line">[root@wenhs5479 ~]# nmcli connection add type bond-slave con-name bond-slave1 ifname eth1 master bond0 </span><br><span class="line">连接“bond-slave1”(2f2046de-0be5-4ce9-86f8-8c9a22324f1b) 已成功添加。</span><br><span class="line"></span><br><span class="line">查看bond配置信息(一开始是down状态,重启了一下网络服务,都up了)</span><br><span class="line">[root@wenhs5479 ~]# cat /proc/net/bonding/bond0 </span><br><span class="line">Ethernet Channel Bonding Driver: v3.7.1 (April 27, 2011)</span><br><span class="line"></span><br><span class="line">Bonding Mode: load balancing (round-robin)</span><br><span class="line">MII Status: up</span><br><span class="line">MII Polling Interval (ms): 100</span><br><span class="line">Up Delay (ms): 0</span><br><span class="line">Down Delay (ms): 0</span><br><span class="line"></span><br><span class="line">Slave Interface: eth0</span><br><span class="line">MII Status: up</span><br><span class="line">Speed: 1000 Mbps</span><br><span class="line">Duplex: full</span><br><span class="line">Link Failure Count: 0</span><br><span class="line">Permanent HW addr: 00:0c:29:8a:2a:2e</span><br><span class="line">Slave queue ID: 0</span><br><span class="line"></span><br><span class="line">Slave Interface: eth1</span><br><span class="line">MII Status: up</span><br><span class="line">Speed: 1000 Mbps</span><br><span class="line">Duplex: full</span><br><span class="line">Link Failure Count: 0</span><br><span class="line">Permanent HW addr: 00:0c:29:8a:2a:38</span><br><span class="line">Slave queue ID: 0</span><br><span class="line"></span><br><span class="line">关闭eth0网卡, 测试bond0是否正常</span><br><span class="line">[root@wenhs5479 ~]# nmcli device disconnect eth0</span><br><span class="line">成功断开设备 &apos;eth0&apos;。</span><br><span class="line">[root@wenhs5479 ~]# cat /proc/net/bonding/bond0 </span><br><span class="line">Ethernet Channel Bonding Driver: v3.7.1 (April 27, 2011)</span><br><span class="line"></span><br><span class="line">Bonding Mode: load balancing (round-robin)</span><br><span class="line">MII Status: up</span><br><span class="line">MII Polling Interval (ms): 100</span><br><span class="line">Up Delay (ms): 0</span><br><span class="line">Down Delay (ms): 0</span><br><span class="line"></span><br><span class="line">Slave Interface: eth1</span><br><span class="line">MII Status: up</span><br><span class="line">Speed: 1000 Mbps</span><br><span class="line">Duplex: full</span><br><span class="line">Link Failure Count: 0</span><br><span class="line">Permanent HW addr: 00:0c:29:8a:2a:38</span><br><span class="line">Slave queue ID: 0</span><br><span class="line">[root@wenhs5479 ~]#</span><br></pre></td></tr></table></figure>

<h3 id="3-1-2-Centos7-RHEL7配置bond1"><a href="#3-1-2-Centos7-RHEL7配置bond1" class="headerlink" title="3.1.2 Centos7 / RHEL7配置bond1"></a>3.1.2 Centos7 / RHEL7配置bond1</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">[root@wenhs5479 ~]# nmcli device </span><br><span class="line">DEVICE      TYPE      STATE   CONNECTION </span><br><span class="line">eth0        ethernet  连接的  eth0       </span><br><span class="line">eth1        ethernet  连接的  eth1       </span><br><span class="line">virbr0      bridge    连接的  virbr0     </span><br><span class="line">lo          loopback  未托管  --         </span><br><span class="line">virbr0-nic  tun       未托管  --         </span><br><span class="line">[root@wenhs5479 ~]#</span><br><span class="line"></span><br><span class="line">创建bond1，模式为active-backup</span><br><span class="line">[root@wenhs5479 ~]# nmcli connection add type bond con-name bond1 mode active-backup ipv4.method manual ipv4.addresses 192.168.131.103/24 ipv4.gateway 192.168.131.1 ipv4.dns 192.168.131.1</span><br><span class="line">连接“bond1”(33a2f495-f178-408e-ad68-e2530d4cb76f) 已成功添加。</span><br><span class="line"></span><br><span class="line">添加物理网卡连接至bond1</span><br><span class="line">[root@wenhs5479 ~]# nmcli connection add type bond-slave con-name bond-slave0 ifname eth0 master bond1</span><br><span class="line">连接“bond-slave0”(016a15fa-d189-4afa-b66d-02cb6b07f4a4) 已成功添加。</span><br><span class="line">[root@wenhs5479 ~]# nmcli connection add type bond-slave con-name bond-slave1 ifname eth1 master bond1</span><br><span class="line">连接“bond-slave1”(10bfb1bb-87aa-4a12-bc65-b473282957c5) 已成功添加。</span><br><span class="line">[root@wenhs5479 ~]# </span><br><span class="line"></span><br><span class="line">启用连接</span><br><span class="line">[root@wenhs5479 ~]# nmcli connection up bond1</span><br><span class="line">Connection successfully activated (master waiting for slaves) (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/8)</span><br><span class="line">[root@wenhs5479 ~]# nmcli connection up bond-slave0</span><br><span class="line">连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/9）</span><br><span class="line">[root@wenhs5479 ~]# nmcli connection up bond-slave1</span><br><span class="line">连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/10）</span><br><span class="line">[root@wenhs5479 ~]# </span><br><span class="line"></span><br><span class="line">验证</span><br><span class="line">[root@wenhs5479 ~]# cat /proc/net/bonding/nm-bond </span><br><span class="line">Ethernet Channel Bonding Driver: v3.7.1 (April 27, 2011)</span><br><span class="line"></span><br><span class="line">Bonding Mode: fault-tolerance (active-backup)</span><br><span class="line">Primary Slave: None</span><br><span class="line">Currently Active Slave: eth0</span><br><span class="line">MII Status: up</span><br><span class="line">MII Polling Interval (ms): 100</span><br><span class="line">Up Delay (ms): 0</span><br><span class="line">Down Delay (ms): 0</span><br><span class="line"></span><br><span class="line">Slave Interface: eth0</span><br><span class="line">MII Status: up</span><br><span class="line">Speed: 1000 Mbps</span><br><span class="line">Duplex: full</span><br><span class="line">Link Failure Count: 0</span><br><span class="line">Permanent HW addr: 00:0c:29:8a:2a:2e</span><br><span class="line">Slave queue ID: 0</span><br><span class="line"></span><br><span class="line">Slave Interface: eth1</span><br><span class="line">MII Status: up</span><br><span class="line">Speed: 1000 Mbps</span><br><span class="line">Duplex: full</span><br><span class="line">Link Failure Count: 0</span><br><span class="line">Permanent HW addr: 00:0c:29:8a:2a:38</span><br><span class="line">Slave queue ID: 0</span><br><span class="line">[root@wenhs5479 ~]#</span><br><span class="line"></span><br><span class="line">停止eth0物理网卡设备</span><br><span class="line">[root@wenhs5479 ~]# nmcli device disconnect eth0</span><br><span class="line">成功断开设备 &apos;eth0&apos;。</span><br><span class="line"></span><br><span class="line">eth1物理网卡设备会进行自动切换</span><br><span class="line">[root@wenhs5479 ~]# grep &apos;Currently Active Slave&apos; /proc/net/bonding/nm-bond</span><br><span class="line">Currently Active Slave: eth1</span><br><span class="line">[root@wenhs5479 ~]#</span><br></pre></td></tr></table></figure>

<h2 id="3-2-Centos6-RHEL6配置bond聚合链路"><a href="#3-2-Centos6-RHEL6配置bond聚合链路" class="headerlink" title="3.2 Centos6 / RHEL6配置bond聚合链路"></a>3.2 Centos6 / RHEL6配置bond聚合链路</h2><p>适用于<code>RedHat6</code>以及<code>CentOS6</code></p>
<table>
<thead>
<tr>
<th>系统</th>
<th>网卡</th>
<th>bond地址</th>
<th>bond模式</th>
<th>bond功能</th>
</tr>
</thead>
<tbody><tr>
<td>Centos6.5</td>
<td>eth0:172.16.12.128<br>eth1: 172.16.12.129</td>
<td>172.16.12.250</td>
<td>模式0</td>
<td>负载均衡</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">1.创建绑定网卡配置文件</span><br><span class="line">[root@wenhs5479 ~]# cat /etc/sysconfig/network-scripts/ifcfg-bond0</span><br><span class="line">DEVICE=bond0</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">ONBOOT=yes</span><br><span class="line">USERCTL=no</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">IPADDR=192.168.131.102</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=192.168.131.1</span><br><span class="line">DNS1=192.168.131.1</span><br><span class="line">BONDING_OPTS=&quot;mode=0 miimon=50&quot; 		#如果使用模式1将mode修改为1即可</span><br><span class="line"></span><br><span class="line">2.修改eth0和eth1网卡配置文件</span><br><span class="line">[root@wenhs5479 ~]# vim /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line">DEVICE=eth0</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">ONBOOT=yes</span><br><span class="line">USERCTL=no</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">MASTER=bond0</span><br><span class="line">SLAVE=yes</span><br><span class="line">[root@wenhs5479 ~]# vim /etc/sysconfig/network-scripts/ifcfg-eth1</span><br><span class="line">DEVICE=eth1</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">ONBOOT=yes</span><br><span class="line">USERCTL=no</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">MASTER=bond0</span><br><span class="line">SLAVE=yes</span><br><span class="line"></span><br><span class="line">3.添加驱动支持bond0</span><br><span class="line">[root@wenhs5479 ~]# vim /etc/modprobe.d/bonding.conf</span><br><span class="line">alias bond0 bonding</span><br></pre></td></tr></table></figure>

<h2 id="3-3-Centos7-RHEL7配置团队聚合链路"><a href="#3-3-Centos7-RHEL7配置团队聚合链路" class="headerlink" title="3.3 Centos7 / RHEL7配置团队聚合链路"></a>3.3 Centos7 / RHEL7配置团队聚合链路</h2><p><code>centos/rhce7</code>使用<code>teaming</code>实现聚合链路，能够提供网卡绑定之后的网络吞吐性能，并且提供网卡的故障切换处理能力。<br><code>Team</code>是基于一个小型内核驱动实现聚合链路，用户在层提供<code>teamd</code>命令实现链路管理。</p>
<p><code>teamd</code>可以实现以下模式的聚合链路</p>
<blockquote>
<p>broadcast 广播容错</p>
<p>roundrobin 负载轮询 </p>
<p>activebackup 主备(必考) </p>
<p>loadbalance 负载均衡</p>
<p>lacp 需要交换机支持lacp协议</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">请使用命令行配置，图形界面配置不稳定</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# nmcli connection add type team con-name team0 config &apos;&#123;&quot;runner&quot;:&#123;&quot;name&quot;:&quot;activebackup&quot;&#125;&#125;&apos; ipv4.addresses 192.168.131.103/24 ipv4.gateway 192.168.131.1 ipv4.dns 192.168.131.1 ipv4.method manual </span><br><span class="line">连接“team0”(1cbeceec-a88b-4cc1-8c01-26197ea78f68) 已成功添加。</span><br><span class="line">[root@wenhs5479 ~]#</span><br><span class="line"></span><br><span class="line">添加物理网卡连接至team0</span><br><span class="line">[root@wenhs5479 ~]#nmcli connection add type team-slave con-name team0-port1 ifname eth0 master team0</span><br><span class="line">连接“team0-port1”(f34da831-b7d7-45b7-9ed7-19e3ba563283) 已成功添加。</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# nmcli connection add type team-slave con-name team0-port2 ifname eth1 master team0</span><br><span class="line">连接“team0-port2”(a6f6b515-87c8-4ea9-84a0-24aef28e2d37) 已成功添加。</span><br><span class="line">[root@wenhs5479 ~]# </span><br><span class="line"></span><br><span class="line">检查team0状态</span><br><span class="line">[root@wenhs5479 ~]# ping -I nm-team 192.168.131.1</span><br><span class="line">PING 192.168.131.1 (192.168.131.1) from 192.168.131.103 nm-team: 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.131.1: icmp_seq=1 ttl=255 time=0.440 ms</span><br><span class="line">64 bytes from 192.168.131.1: icmp_seq=2 ttl=255 time=0.430 ms</span><br><span class="line">64 bytes from 192.168.131.1: icmp_seq=3 ttl=255 time=0.470 ms</span><br><span class="line">^C</span><br><span class="line">--- 192.168.131.1 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 2003ms</span><br><span class="line">rtt min/avg/max/mdev = 0.430/0.446/0.470/0.029 ms</span><br><span class="line">[root@wenhs5479 ~]#</span><br><span class="line">[root@wenhs5479 ~]# teamdctl nm-team state</span><br><span class="line">setup:</span><br><span class="line">  runner: activebackup</span><br><span class="line">ports:</span><br><span class="line">  eth0</span><br><span class="line">    link watches:</span><br><span class="line">      link summary: up</span><br><span class="line">      instance[link_watch_0]:</span><br><span class="line">        name: ethtool</span><br><span class="line">        link: up</span><br><span class="line">        down count: 0</span><br><span class="line">  eth1</span><br><span class="line">    link watches:</span><br><span class="line">      link summary: up</span><br><span class="line">      instance[link_watch_0]:</span><br><span class="line">        name: ethtool</span><br><span class="line">        link: up</span><br><span class="line">        down count: 0</span><br><span class="line">runner:</span><br><span class="line">  active port: eth0</span><br><span class="line">[root@wenhs5479 ~]#</span><br><span class="line"></span><br><span class="line">断掉后检测</span><br><span class="line">[root@wenhs5479 ~]# nmcli device disconnect eth1</span><br><span class="line">成功断开设备 &apos;eth1&apos;。</span><br><span class="line">[root@wenhs5479 ~]# teamdctl nm-team state</span><br><span class="line">setup:</span><br><span class="line">  runner: activebackup</span><br><span class="line">ports:</span><br><span class="line">  eth0</span><br><span class="line">    link watches:</span><br><span class="line">      link summary: up</span><br><span class="line">      instance[link_watch_0]:</span><br><span class="line">        name: ethtool</span><br><span class="line">        link: up</span><br><span class="line">        down count: 0</span><br><span class="line">runner:</span><br><span class="line">  active port: eth0</span><br><span class="line">[root@wenhs5479 ~]#</span><br></pre></td></tr></table></figure>

<p><strong>动态修改团队模式</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">导出配置进行修改 (man teamd.conf)</span><br><span class="line">[root@wenhs5479 ~]# teamdctl nm-team config dump &gt; /root/team.conf</span><br><span class="line">[root@wenhs5479 ~]# vim team.conf</span><br><span class="line"></span><br><span class="line">以最新修改的配置选项修改team0属性</span><br><span class="line">[root@wenhs5479 ~]# nmcli connection modify team0 team.config /root/team.conf</span><br><span class="line"></span><br><span class="line">修改之后需要重启team0</span><br><span class="line">[root@wenhs5479 ~]# nmcli connection down team0</span><br><span class="line">成功取消激活连接 &apos;team0&apos;（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/5）</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# nmcli connection up team0</span><br><span class="line">Connection successfully activated (master waiting for slaves) (D-Bus active path: /org/freedesktop/NetworkManager/ActiveConnection/8)</span><br><span class="line">[root@wenhs5479 ~]# nmcli connection up team0-port1</span><br><span class="line">连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/10）</span><br><span class="line">[root@wenhs5479 ~]# nmcli connection up team0-port2</span><br><span class="line">连接已成功激活（D-Bus 活动路径：/org/freedesktop/NetworkManager/ActiveConnection/11）</span><br><span class="line">[root@wenhs5479 ~]# teamdctl nm-team state</span><br><span class="line">setup:</span><br><span class="line">  runner: roundrobin</span><br><span class="line">ports:</span><br><span class="line">  eth0</span><br><span class="line">    link watches:</span><br><span class="line">      link summary: up</span><br><span class="line">      instance[link_watch_0]:</span><br><span class="line">        name: ethtool</span><br><span class="line">        link: up</span><br><span class="line">        down count: 0</span><br><span class="line">  eth1</span><br><span class="line">    link watches:</span><br><span class="line">      link summary: up</span><br><span class="line">      instance[link_watch_0]:</span><br><span class="line">        name: ethtool</span><br><span class="line">        link: up</span><br><span class="line">        down count: 0</span><br><span class="line">[root@wenhs5479 ~]#</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">做team实验注意:一开始配置都正确,而且无报错,查状态却显示网卡没有组成team,然后就把所有网卡连接断开,再把设备断开,重新做,即可成功</span><br></pre></td></tr></table></figure>

<h1 id="4-桥接网络配置"><a href="#4-桥接网络配置" class="headerlink" title="4.桥接网络配置"></a>4.桥接网络配置</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">创建桥接网络br1</span><br><span class="line">[root@wenhs5479 ~]# nmcli connection add type bridge con-name br1 ifname br1 ipv4.addresses 192.168.131.103/24 ipv4.gateway 192.168.131.1 ipv4.method manual </span><br><span class="line">连接“br1”(d702846f-63e9-4cc8-b20c-282733775dbc) 已成功添加。</span><br><span class="line"></span><br><span class="line">桥接至eth1</span><br><span class="line">[root@wenhs5479 ~]# nmcli connection add type bridge-slave con-name br1-prot1 ifname eth0 master br1</span><br><span class="line">连接“br1-prot1”(2d0a79d7-763d-482e-ba72-e04330a1f099) 已成功添加。</span><br><span class="line"></span><br><span class="line">[root@wenhs5479 ~]# ping -I br1 192.168.131.1</span><br><span class="line">PING 192.168.131.1 (192.168.131.1) from 192.168.131.103 br1: 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.131.1: icmp_seq=1 ttl=255 time=0.679 ms</span><br><span class="line">64 bytes from 192.168.131.1: icmp_seq=2 ttl=255 time=0.431 ms</span><br><span class="line">64 bytes from 192.168.131.1: icmp_seq=3 ttl=255 time=0.479 ms</span><br><span class="line">^C</span><br><span class="line">--- 192.168.131.1 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 2003ms</span><br><span class="line">rtt min/avg/max/mdev = 0.431/0.529/0.679/0.110 ms</span><br><span class="line">[root@wenhs5479 ~]#</span><br><span class="line">[root@wenhs5479 ~]# brctl show</span><br><span class="line">bridge name	bridge id		STP enabled	interfaces</span><br><span class="line">br1		8000.000c298a2a2e	yes		eth0</span><br><span class="line">virbr0		8000.525400dcbd60	yes		virbr0-nic</span><br><span class="line">[root@wenhs5479 ~]#</span><br><span class="line"></span><br><span class="line">也可以再用一个网卡桥接到br1,断开eth0,工作的是eth1,不过真实环境中没什么用,实验玩玩就好</span><br></pre></td></tr></table></figure>


          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    
	
	  <div>
        
      </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  
  <p class="site-author-name" itemprop="name">itw</p>
  <div class="site-description motion-element" itemprop="description"></div>
</div>


  <nav class="site-state motion-element">
    
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">51</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    

    
      
      
      <div class="site-state-item site-state-categories">
        
        
        
          
        
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span>
        
      </div>
    

    
      
      
      <div class="site-state-item site-state-tags">
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">标签</span>
        
      </div>
    
  </nav>



  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>











          
          
        </div>
      </div>

      

      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">itw</span>

  

  
</div>


<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>
<!-- <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.2.0</div>
-->



<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共183.1k字</span>
</div>

        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>










  
  













  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>




  <script src="/js/utils.js?v=7.2.0"></script>

  <script src="/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.2.0"></script>



  

  <script src="/js/next-boot.js?v=7.2.0"></script>

  

  

  

  

  



  




  

  

  

  

  

  

  

  

  

  

  

  

  


  

   <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;"></canvas> 
   <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
   <script type="text/javascript" src="/js/fireworks.js"></script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
